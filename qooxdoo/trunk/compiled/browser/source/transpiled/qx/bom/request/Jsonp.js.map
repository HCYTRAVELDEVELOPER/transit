{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "define",
    "extend",
    "bom",
    "request",
    "Script",
    "construct",
    "apply",
    "__generateId",
    "members",
    "responseJson",
    "__id",
    "__callbackParam",
    "__callbackName",
    "__callbackCalled",
    "__customCallbackCreated",
    "__generatedUrl",
    "__disposed",
    "__prefix",
    "open",
    "method",
    "url",
    "query",
    "callbackParam",
    "callbackName",
    "that",
    "constructor",
    "window",
    "data",
    "callback",
    "core",
    "Environment",
    "get",
    "debug",
    "Jsonp",
    "util",
    "Uri",
    "appendParamsToUrl",
    "__callBase",
    "lang",
    "Json",
    "stringify",
    "parse",
    "undefined",
    "__deleteCustomCallback",
    "setCallbackParam",
    "param",
    "setCallbackName",
    "name",
    "setPrefix",
    "prefix",
    "getGeneratedUrl",
    "dispose",
    "_onNativeLoad",
    "status",
    "args",
    "prototype",
    "Date",
    "valueOf",
    "Math",
    "random",
    "substring"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/bom/request/Jsonp.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2004-2011 1&1 Internet AG, Germany, http://www.1und1.de\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Tristan Koch (tristankoch)\n\n************************************************************************ */\n\n/**\n * A special script loader handling JSONP responses. Automatically\n * provides callbacks and populates responseJson property.\n *\n * Example:\n *\n * <pre class=\"javascript\">\n *  var req = new qx.bom.request.Jsonp();\n *\n *  // Some services have a fixed callback name\n *  // req.setCallbackName(\"callback\");\n *\n *  req.onload = function() {\n *    // Handle data received\n *    req.responseJson;\n *  }\n *\n *  req.open(\"GET\", url);\n *  req.send();\n * </pre>\n *\n * @require(qx.bom.request.Script#open)\n * @require(qx.bom.request.Script#on)\n * @require(qx.bom.request.Script#onreadystatechange)\n * @require(qx.bom.request.Script#onload)\n * @require(qx.bom.request.Script#onloadend)\n * @require(qx.bom.request.Script#onerror)\n * @require(qx.bom.request.Script#onabort)\n * @require(qx.bom.request.Script#ontimeout)\n * @require(qx.bom.request.Script#send)\n *\n * @group (IO)\n */\nqx.Bootstrap.define(\"qx.bom.request.Jsonp\", {\n  extend: qx.bom.request.Script,\n\n  construct() {\n    // Borrow super-class constructor\n    qx.bom.request.Script.apply(this);\n\n    this.__generateId();\n  },\n\n  members: {\n    /**\n     * @type {Object} Parsed JSON response.\n     */\n    responseJson: null,\n\n    /**\n     * @type {Number} Identifier of this instance.\n     */\n    __id: null,\n\n    /**\n     * @type {String} Callback parameter.\n     */\n    __callbackParam: null,\n\n    /**\n     * @type {String} Callback name.\n     */\n    __callbackName: null,\n\n    /**\n     * @type {Boolean} Whether callback was called.\n     */\n    __callbackCalled: null,\n\n    /**\n     * @type {Boolean} Whether a custom callback was created automatically.\n     */\n    __customCallbackCreated: null,\n\n    /**\n     * @type {String} The generated URL for the current request\n     */\n    __generatedUrl: null,\n\n    /**\n     * @type {Boolean} Whether request was disposed.\n     */\n    __disposed: null,\n\n    /** Prefix used for the internal callback name. */\n    __prefix: \"\",\n\n    /**\n     * Initializes (prepares) request.\n     *\n     * @param method {String}\n     *   The HTTP method to use.\n     *   This parameter exists for compatibility reasons. The script transport\n     *   does not support methods other than GET.\n     * @param url {String}\n     *   The URL to which to send the request.\n     */\n    open(method, url) {\n      if (this.__disposed) {\n        return;\n      }\n\n      var query = {},\n        callbackParam,\n        callbackName,\n        that = this;\n\n      // Reset properties that may have been set by previous request\n      this.responseJson = null;\n      this.__callbackCalled = false;\n\n      callbackParam = this.__callbackParam || \"callback\";\n      callbackName =\n        this.__callbackName ||\n        this.__prefix + \"qx.bom.request.Jsonp.\" + this.__id + \".callback\";\n\n      // Default callback\n      if (!this.__callbackName) {\n        // Store globally available reference to this object\n        this.constructor[this.__id] = this;\n\n        // Custom callback\n      } else {\n        // Dynamically create globally available callback (if it does not\n        // exist yet) with user defined name. Delegate to this object’s\n        // callback method.\n        if (!window[this.__callbackName]) {\n          this.__customCallbackCreated = true;\n          window[this.__callbackName] = function (data) {\n            that.callback(data);\n          };\n        } else {\n          if (qx.core.Environment.get(\"qx.debug.io\")) {\n            qx.Bootstrap.debug(\n              qx.bom.request.Jsonp,\n              \"Callback \" + this.__callbackName + \" already exists\"\n            );\n          }\n        }\n      }\n\n      if (qx.core.Environment.get(\"qx.debug.io\")) {\n        qx.Bootstrap.debug(\n          qx.bom.request.Jsonp,\n          \"Expecting JavaScript response to call: \" + callbackName\n        );\n      }\n\n      query[callbackParam] = callbackName;\n      this.__generatedUrl = url = qx.util.Uri.appendParamsToUrl(url, query);\n\n      this.__callBase(\"open\", [method, url]);\n    },\n\n    /**\n     * Callback provided for JSONP response to pass data.\n     *\n     * Called internally to populate responseJson property\n     * and indicate successful status.\n     *\n     * Note: If you write a custom callback you’ll need to call\n     * this method in order to notify the request about the data\n     * loaded. Writing a custom callback should not be necessary\n     * in most cases.\n     *\n     * @param data {Object} JSON\n     */\n    callback(data) {\n      if (this.__disposed) {\n        return;\n      }\n\n      // Signal callback was called\n      this.__callbackCalled = true;\n\n      // Sanitize and parse\n      if (qx.core.Environment.get(\"qx.debug\")) {\n        data = qx.lang.Json.stringify(data);\n        data = qx.lang.Json.parse(data);\n      }\n\n      // Set response\n      this.responseJson = data;\n\n      // Delete global reference to this\n      this.constructor[this.__id] = undefined;\n\n      this.__deleteCustomCallback();\n    },\n\n    /**\n     * Set callback parameter.\n     *\n     * Some JSONP services expect the callback name to be passed labeled with a\n     * special URL parameter key, e.g. \"jsonp\" in \"?jsonp=myCallback\". The\n     * default is \"callback\".\n     *\n     * @param param {String} Name of the callback parameter.\n     * @return {qx.bom.request.Jsonp} Self reference for chaining.\n     */\n    setCallbackParam(param) {\n      this.__callbackParam = param;\n      return this;\n    },\n\n    /**\n     * Set callback name.\n     *\n     * Must be set to the name of the callback function that is called by the\n     * script returned from the JSONP service. By default, the callback name\n     * references this instance’s {@link #callback} method, allowing to connect\n     * multiple JSONP responses to different requests.\n     *\n     * If the JSONP service allows to set custom callback names, it should not\n     * be necessary to change the default. However, some services use a fixed\n     * callback name. This is when setting the callbackName is useful. A\n     * function is created and made available globally under the given name.\n     * The function receives the JSON data and dispatches it to this instance’s\n     * {@link #callback} method. Please note that this function is only created\n     * if it does not exist before.\n     *\n     * @param name {String} Name of the callback function.\n     * @return {qx.bom.request.Jsonp} Self reference for chaining.\n     */\n    setCallbackName(name) {\n      this.__callbackName = name;\n      return this;\n    },\n\n    /**\n     * Set the prefix used in front of 'qx.' in case 'qx' is not available\n     * (for qx.Website e.g.)\n     * @internal\n     * @param prefix {String} The prefix to put in front of 'qx'\n     */\n    setPrefix(prefix) {\n      this.__prefix = prefix;\n    },\n\n    /**\n     * Returns the generated URL for the current / last request\n     *\n     * @internal\n     * @return {String} The current generated URL for the request\n     */\n    getGeneratedUrl() {\n      return this.__generatedUrl;\n    },\n\n    dispose() {\n      // In case callback was not called\n      this.__deleteCustomCallback();\n\n      this.__callBase(\"dispose\");\n    },\n\n    /**\n     * Handle native load.\n     */\n    _onNativeLoad() {\n      // Indicate erroneous status (500) if callback was not called.\n      //\n      // Why 500? 5xx belongs to the range of server errors. If the callback was\n      // not called, it is assumed the server failed to provide an appropriate\n      // response. Since the exact reason of the error is unknown, the most\n      // generic message (\"500 Internal Server Error\") is chosen.\n      this.status = this.__callbackCalled ? 200 : 500;\n\n      this.__callBase(\"_onNativeLoad\");\n    },\n\n    /**\n     *  Delete custom callback if dynamically created before.\n     */\n    __deleteCustomCallback() {\n      if (this.__customCallbackCreated && window[this.__callbackName]) {\n        window[this.__callbackName] = undefined;\n        this.__customCallbackCreated = false;\n      }\n    },\n\n    /**\n     * Call overridden method.\n     *\n     * @param method {String} Name of the overridden method.\n     * @param args {Array} Arguments.\n     */\n    __callBase(method, args) {\n      qx.bom.request.Script.prototype[method].apply(this, args || []);\n    },\n\n    /**\n     * Generate ID.\n     */\n    __generateId() {\n      // Add random digits to date to allow immediately following requests\n      // that may be send at the same time\n      this.__id =\n        \"qx\" + new Date().valueOf() + (\"\" + Math.random()).substring(2, 5);\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}