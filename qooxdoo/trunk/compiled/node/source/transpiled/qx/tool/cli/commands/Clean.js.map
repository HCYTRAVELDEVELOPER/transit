{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "fs",
    "require",
    "process",
    "path",
    "rimraf",
    "Class",
    "define",
    "extend",
    "tool",
    "cli",
    "commands",
    "Command",
    "statics",
    "getYargsCommand",
    "command",
    "describe",
    "builder",
    "verbose",
    "alias",
    "members",
    "compileConfig",
    "config",
    "Compile",
    "getInstance",
    "load",
    "target",
    "getValue",
    "__removePath",
    "join",
    "cwd",
    "outputPath",
    "deployPath",
    "Package",
    "cache_dir",
    "checkMigrations",
    "pathToRemove",
    "existsAsync",
    "argv",
    "compiler",
    "Console",
    "info",
    "Promise",
    "resolve",
    "reject",
    "err",
    "Clean"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/cli/commands/Clean.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2017 Christian Boulanger and others\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Boulanger (info@bibliograph.org, @cboulanger)\n     * Henner Kollmann (hkollmann)\n\n************************************************************************ */\n\nconst fs = require(\"fs\");\nconst process = require(\"process\");\nconst path = require(\"upath\");\nconst rimraf = require(\"rimraf\");\n\n/**\n * Cleans generated and cache files\n */\nqx.Class.define(\"qx.tool.cli.commands.Clean\", {\n  extend: qx.tool.cli.commands.Command,\n  statics: {\n    getYargsCommand() {\n      return {\n        command: \"clean\",\n        describe: \"cleans generated files and caches.\",\n        builder: {\n          verbose: {\n            alias: \"v\",\n            describe: \"Verbose logging\"\n          }\n        }\n      };\n    }\n  },\n\n  members: {\n    /**\n     * Deletes all generated and cache files\n     */\n    async process() {\n      super.process();\n      let compileConfig = await qx.tool.config.Compile.getInstance().load();\n      for (let target of compileConfig.getValue(\"targets\")) {\n        await this.__removePath(path.join(process.cwd(), target.outputPath));\n        if (target.deployPath) {\n          await this.__removePath(path.join(process.cwd(), target.deployPath));\n        }\n      }\n      await this.__removePath(\n        path.join(process.cwd(), qx.tool.cli.commands.Package.cache_dir)\n      );\n\n      // check if we have to migrate files\n      await this.checkMigrations();\n    },\n\n    async __removePath(pathToRemove) {\n      if (await fs.existsAsync(pathToRemove)) {\n        if (this.argv.verbose) {\n          qx.tool.compiler.Console.info(`Removing ${pathToRemove}...`);\n        }\n        await new Promise((resolve, reject) => {\n          rimraf(pathToRemove, {}, err => {\n            if (err) {\n              reject(err);\n            } else {\n              resolve();\n            }\n          });\n        });\n      }\n    }\n  }\n});\n"
  ],
  "mappings": ";;;;;;;;;;;;;;;EAAAA,EAAE,CAACC,SAAH,CAAaC,oBAAb,CAAkCC,aAAlC;;EAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAEA,MAAMC,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;EACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,SAAD,CAAvB;;EACA,MAAME,IAAI,GAAGF,OAAO,CAAC,OAAD,CAApB;;EACA,MAAMG,MAAM,GAAGH,OAAO,CAAC,QAAD,CAAtB;EAEA;AACA;AACA;;;EACAL,EAAE,CAACS,KAAH,CAASC,MAAT,CAAgB,4BAAhB,EAA8C;IAC5CC,MAAM,EAAEX,EAAE,CAACY,IAAH,CAAQC,GAAR,CAAYC,QAAZ,CAAqBC,OADe;IAE5CC,OAAO,EAAE;MACPC,eAAe,GAAG;QAChB,OAAO;UACLC,OAAO,EAAE,OADJ;UAELC,QAAQ,EAAE,oCAFL;UAGLC,OAAO,EAAE;YACPC,OAAO,EAAE;cACPC,KAAK,EAAE,GADA;cAEPH,QAAQ,EAAE;YAFH;UADF;QAHJ,CAAP;MAUD;;IAZM,CAFmC;IAiB5CI,OAAO,EAAE;MACP;AACJ;AACA;MACI,MAAMjB,OAAN,GAAgB;QACd;QACA,IAAIkB,aAAa,GAAG,MAAMxB,EAAE,CAACY,IAAH,CAAQa,MAAR,CAAeC,OAAf,CAAuBC,WAAvB,GAAqCC,IAArC,EAA1B;;QACA,KAAK,IAAIC,MAAT,IAAmBL,aAAa,CAACM,QAAd,CAAuB,SAAvB,CAAnB,EAAsD;UACpD,MAAM,KAAKC,mBAAL,CAAkBxB,IAAI,CAACyB,IAAL,CAAU1B,OAAO,CAAC2B,GAAR,EAAV,EAAyBJ,MAAM,CAACK,UAAhC,CAAlB,CAAN;;UACA,IAAIL,MAAM,CAACM,UAAX,EAAuB;YACrB,MAAM,KAAKJ,mBAAL,CAAkBxB,IAAI,CAACyB,IAAL,CAAU1B,OAAO,CAAC2B,GAAR,EAAV,EAAyBJ,MAAM,CAACM,UAAhC,CAAlB,CAAN;UACD;QACF;;QACD,MAAM,KAAKJ,mBAAL,CACJxB,IAAI,CAACyB,IAAL,CAAU1B,OAAO,CAAC2B,GAAR,EAAV,EAAyBjC,EAAE,CAACY,IAAH,CAAQC,GAAR,CAAYC,QAAZ,CAAqBsB,OAArB,CAA6BC,SAAtD,CADI,CAAN,CATc,CAad;;QACA,MAAM,KAAKC,eAAL,EAAN;MACD,CAnBM;;MAqBP,MAAMP,mBAAN,CAAmBQ,YAAnB,EAAiC;QAC/B,IAAI,MAAMnC,EAAE,CAACoC,WAAH,CAAeD,YAAf,CAAV,EAAwC;UACtC,IAAI,KAAKE,IAAL,CAAUpB,OAAd,EAAuB;YACrBrB,EAAE,CAACY,IAAH,CAAQ8B,QAAR,CAAiBC,OAAjB,CAAyBC,IAAzB,CAA+B,YAAWL,YAAa,KAAvD;UACD;;UACD,MAAM,IAAIM,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;YACrCvC,MAAM,CAAC+B,YAAD,EAAe,EAAf,EAAmBS,GAAG,IAAI;cAC9B,IAAIA,GAAJ,EAAS;gBACPD,MAAM,CAACC,GAAD,CAAN;cACD,CAFD,MAEO;gBACLF,OAAO;cACR;YACF,CANK,CAAN;UAOD,CARK,CAAN;QASD;MACF;;IApCM;EAjBmC,CAA9C;EA3BA9C,EAAE,CAACY,IAAH,CAAQC,GAAR,CAAYC,QAAZ,CAAqBmC,KAArB,CAA2B9C,aAA3B,GAA2CA,aAA3C"
}