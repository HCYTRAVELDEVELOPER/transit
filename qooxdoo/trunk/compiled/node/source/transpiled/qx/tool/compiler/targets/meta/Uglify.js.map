{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "fs",
    "tool",
    "utils",
    "Promisify",
    "path",
    "require",
    "UglifyJS",
    "Class",
    "define",
    "extend",
    "compiler",
    "targets",
    "meta",
    "AbstractJavascriptMeta",
    "construct",
    "appMeta",
    "jsMeta",
    "getFilename",
    "__jsMeta",
    "properties",
    "needsWriteToDisk",
    "init",
    "refine",
    "members",
    "writeSourceCodeToStream",
    "ws",
    "uglifyOpts",
    "compress",
    "sequences",
    "output",
    "comments",
    "_appMeta",
    "getTarget",
    "getMinify",
    "mangle",
    "beautify",
    "application",
    "getApplication",
    "outJsFilename",
    "baseJsFilename",
    "basename",
    "inSourceCode",
    "ss",
    "Utils",
    "ToStringWriteStream",
    "LineCountingTransform",
    "pipe",
    "Promise",
    "resolve",
    "on",
    "end",
    "toString",
    "inSourceMap",
    "getSourceMap",
    "fireDataEvent",
    "filename",
    "sourceMap",
    "content",
    "url",
    "includeSources",
    "result",
    "minify",
    "err",
    "error",
    "name",
    "Console",
    "print",
    "line",
    "col",
    "message",
    "Error",
    "writeFileAsync",
    "code",
    "encoding",
    "map",
    "isSaveUnminified",
    "JSON",
    "stringify",
    "Uglify"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/compiler/targets/meta/Uglify.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n *\n *    qooxdoo-compiler - node.js based replacement for the Qooxdoo python\n *    toolchain\n *\n *    https://github.com/qooxdoo/qooxdoo-compiler\n *\n *    Copyright:\n *      2011-2021 Zenesis Limited, http://www.zenesis.com\n *\n *    License:\n *      MIT: https://opensource.org/licenses/MIT\n *\n *      This software is provided under the same licensing terms as Qooxdoo,\n *      please see the LICENSE file in the Qooxdoo project's top-level directory\n *      for details.\n *\n *    Authors:\n *      * John Spackman (john.spackman@zenesis.com, @johnspackman)\n *\n * ************************************************************************/\n\nconst fs = qx.tool.utils.Promisify.fs;\nconst path = require(\"upath\");\nconst UglifyJS = require(\"terser\");\n\nqx.Class.define(\"qx.tool.compiler.targets.meta.Uglify\", {\n  extend: qx.tool.compiler.targets.meta.AbstractJavascriptMeta,\n\n  /**\n   * Constructor\n   *\n   * @param appMeta {qx.tool.compiler.targets.meta.ApplicationMeta}\n   * @param jsMeta {AbstractJavascriptMeta} the source\n   */\n  construct(appMeta, jsMeta) {\n    super(appMeta, jsMeta.getFilename());\n    this.__jsMeta = jsMeta;\n  },\n\n  properties: {\n    needsWriteToDisk: {\n      init: true,\n      refine: true\n    }\n  },\n\n  members: {\n    __jsMeta: null,\n\n    /*\n     * @Override\n     */\n    async writeSourceCodeToStream(ws) {\n      var uglifyOpts = {\n        compress: {\n          sequences: false\n        },\n\n        output: {\n          comments: \"some\"\n        }\n      };\n\n      switch (this._appMeta.getTarget().getMinify()) {\n        case \"off\":\n          return;\n\n        case \"minify\":\n          uglifyOpts.mangle = false;\n          break;\n\n        case \"beautify\":\n          uglifyOpts.mangle = false;\n          uglifyOpts.output.beautify = true;\n          break;\n\n        case \"mangle\":\n          uglifyOpts.mangle = true;\n          break;\n      }\n\n      var application = this._appMeta.getApplication();\n\n      var outJsFilename = this.__jsMeta.getFilename();\n      let baseJsFilename = path.basename(outJsFilename);\n\n      let inSourceCode = await (async () => {\n        let ss = new qx.tool.utils.Utils.ToStringWriteStream();\n        let ws = new qx.tool.utils.Utils.LineCountingTransform();\n        ws.pipe(ss);\n        await new Promise(async resolve => {\n          ws.on(\"finish\", resolve);\n          await this.__jsMeta.writeSourceCodeToStream(ws);\n          ws.end();\n        });\n        return ss.toString();\n      })();\n\n      let inSourceMap = await this.__jsMeta.getSourceMap();\n      this.fireDataEvent(\"minifyingApplication\", {\n        application: application,\n        filename: baseJsFilename\n      });\n\n      uglifyOpts.sourceMap = {\n        content: inSourceMap,\n        url: baseJsFilename + \".map\",\n        includeSources: true\n      };\n\n      var result = await UglifyJS.minify(inSourceCode, uglifyOpts);\n      var err = result.error;\n      if (err) {\n        if (err.name == \"SyntaxError\") {\n          qx.tool.compiler.Console.print(\n            \"qx.tool.compiler.build.uglifyParseError\",\n            err.line,\n            err.col,\n            err.message,\n            baseJsFilename\n          );\n        }\n        throw new Error(\"UglifyJS failed to minimise: \" + (err.message || err));\n      }\n      await fs.writeFileAsync(outJsFilename, result.code, { encoding: \"utf8\" });\n      await fs.writeFileAsync(outJsFilename + \".map\", result.map, { encoding: \"utf8\"  });\n      if (this._appMeta.getTarget().isSaveUnminified()) {\n        await fs.writeFileAsync(outJsFilename + \".unminified\", inSourceCode, { encoding: \"utf8\" });\n        await fs.writeFileAsync(outJsFilename + \".unminified.map\", JSON.stringify(inSourceMap, null, 2), { encoding: \"utf8\" });\n      }\n\n      this.fireDataEvent(\"minifiedApplication\", {\n        application: application,\n        filename: baseJsFilename\n      });\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}