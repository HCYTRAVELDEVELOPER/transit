{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "fs",
    "require",
    "process",
    "path",
    "inquirer",
    "Class",
    "define",
    "extend",
    "tool",
    "cli",
    "commands",
    "Command",
    "statics",
    "getYargsCommand",
    "command",
    "describe",
    "builder",
    "resourcedir",
    "alias",
    "default",
    "rename",
    "undo",
    "noninteractive",
    "members",
    "manifestModel",
    "config",
    "Manifest",
    "getInstance",
    "load",
    "namespace",
    "getValue",
    "script_path",
    "argv",
    "scriptpath",
    "script_name",
    "basename",
    "resource_dir_path",
    "join",
    "cwd",
    "resource_file_path",
    "external_res_path",
    "endsWith",
    "utils",
    "Utils",
    "UserError",
    "existsAsync",
    "question",
    "type",
    "name",
    "message",
    "answer",
    "prompt",
    "doOverwrite",
    "exit",
    "script_list",
    "includes",
    "filter",
    "elem",
    "unlinkAsync",
    "mkdirSync",
    "recursive",
    "mode",
    "copyFileAsync",
    "push",
    "debug",
    "setValue",
    "save",
    "add",
    "Script"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/cli/commands/add/Script.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2017 Christian Boulanger and others\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Boulanger (info@bibliograph.org, @cboulanger)\n\n************************************************************************ */\n\nconst fs = require(\"fs\");\nconst process = require(\"process\");\nconst path = require(\"upath\");\nconst inquirer = require(\"inquirer\");\n/**\n * Add a new script file to the current project, to be loaded by the qooxdoo boot loader\n *\n * Syntax: `qx add script path/to/script.js`\n *\n */\nqx.Class.define(\"qx.tool.cli.commands.add.Script\", {\n  extend: qx.tool.cli.commands.Command,\n  statics: {\n    getYargsCommand() {\n      return {\n        command: \"script <scriptpath> [options]\",\n        describe:\n          \"adds a new script file to the current project, to be loaded before application startup.\",\n        builder: {\n          resourcedir: {\n            describe:\n              \"The subdirectory of the resource folder in which to place the file\",\n            alias: \"d\",\n            default: \"js\"\n          },\n\n          rename: {\n            describe: \"Rename the file to the given name\",\n            alias: \"r\"\n          },\n\n          undo: {\n            describe:\n              \"Removes the file that would normally be added with the given arguments\",\n            alias: \"z\"\n          },\n\n          noninteractive: {\n            alias: \"I\",\n            describe: \"Do not prompt user\"\n          }\n        }\n      };\n    }\n  },\n\n  members: {\n    async process() {\n      let manifestModel = await qx.tool.config.Manifest.getInstance().load();\n      let namespace = manifestModel.getValue(\"provides.namespace\");\n\n      let script_path = this.argv.scriptpath;\n      let script_name = path.basename(script_path);\n      let resource_dir_path = path.join(\n        process.cwd(),\n        \"source\",\n        \"resource\",\n        namespace,\n        this.argv.resourcedir\n      );\n\n      let resource_file_path = path.join(\n        resource_dir_path,\n        this.argv.rename || script_name\n      );\n\n      let external_res_path = path.join(\n        namespace,\n        this.argv.resourcedir,\n        this.argv.rename || script_name\n      );\n\n      // validate file paths\n      if (!script_path.endsWith(\".js\")) {\n        throw new qx.tool.utils.Utils.UserError(\n          \"File doesn't seem to be a javascript file.\"\n        );\n      }\n      if (!(await fs.existsAsync(script_path)) && !this.argv.undo) {\n        throw new qx.tool.utils.Utils.UserError(\n          `File does not exist: ${script_path}`\n        );\n      }\n      if ((await fs.existsAsync(resource_file_path)) && !this.argv.undo) {\n        if (!this.argv.noninteractive) {\n          let question = {\n            type: \"confirm\",\n            name: \"doOverwrite\",\n            message: `Script already exists and will be overwritten. Do you want to proceed?`,\n            default: \"y\"\n          };\n\n          let answer = await inquirer.prompt(question);\n          if (!answer.doOverwrite) {\n            process.exit(0);\n          }\n        }\n      }\n      // check manifest structure\n      let script_list =\n        manifestModel.getValue(\"externalResources.script\") || [];\n      if (this.argv.undo) {\n        // undo, i.e. remove file from resource folder and Manifest\n        if (script_list.includes(external_res_path)) {\n          script_list = script_list.filter(elem => elem !== external_res_path);\n        }\n        if (await fs.existsAsync(resource_file_path)) {\n          await fs.unlinkAsync(resource_file_path);\n        }\n      } else {\n        // copy script to app resources and add to manifest\n        if (!(await fs.existsAsync(resource_dir_path))) {\n          fs.mkdirSync(resource_dir_path, {\n            recursive: true,\n            mode: 0o755\n          });\n        }\n        await fs.copyFileAsync(script_path, resource_file_path);\n        if (!script_list.includes(external_res_path)) {\n          script_list.push(external_res_path);\n        }\n      }\n      // save\n      this.debug(script_list);\n      manifestModel.setValue(\"externalResources.script\", script_list).save();\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}