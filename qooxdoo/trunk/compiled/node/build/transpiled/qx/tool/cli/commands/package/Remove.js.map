{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "fs",
    "require",
    "path",
    "rimraf",
    "Class",
    "define",
    "extend",
    "tool",
    "cli",
    "commands",
    "Package",
    "statics",
    "getYargsCommand",
    "command",
    "describe",
    "builder",
    "verbose",
    "alias",
    "quiet",
    "members",
    "process",
    "argv",
    "uri",
    "utils",
    "Utils",
    "UserError",
    "data",
    "getLockfileData",
    "parts",
    "split",
    "tag",
    "length",
    "found",
    "libraries",
    "elem",
    "__removeApplication",
    "__deleteRequiredFromManifest",
    "c",
    "p",
    "dirname",
    "includes",
    "push",
    "sync",
    "compiler",
    "Console",
    "info",
    "warn",
    "writeFileSync",
    "getLockfilePath",
    "JSON",
    "stringify",
    "manifest",
    "Json",
    "loadJsonAsync",
    "config",
    "Manifest",
    "fileName",
    "requires",
    "saveJsonAsync",
    "pkgData",
    "libraryData",
    "find",
    "Error",
    "join",
    "provides",
    "application",
    "compileData",
    "Compile",
    "manifestApp",
    "app",
    "applications",
    "name",
    "idx",
    "indexOf",
    "splice",
    "package",
    "Remove"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/cli/commands/package/Remove.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n\n   qooxdoo - the new era of web development\n\n   http://qooxdoo.org\n\n   Copyright:\n     2017 Christian Boulanger\n\n   License:\n     MIT: https://opensource.org/licenses/MIT\n     See the LICENSE file in the project's top-level directory for details.\n\n   Authors:\n     * Christian Boulanger (info@bibliograph.org, @cboulanger)\n\n************************************************************************ */\nconst fs = require(\"fs\");\nconst path = require(\"upath\");\nconst rimraf = require(\"rimraf\");\n\n/**\n * Installs a package\n */\nqx.Class.define(\"qx.tool.cli.commands.package.Remove\", {\n  extend: qx.tool.cli.commands.Package,\n\n  statics: {\n    getYargsCommand() {\n      return {\n        command: \"remove [uri]\",\n        describe: \"removes a package from the configuration.\",\n        builder: {\n          verbose: {\n            alias: \"v\",\n            describe: \"Verbose logging\"\n          },\n\n          quiet: {\n            alias: \"q\",\n            describe: \"No output\"\n          }\n        }\n      };\n    }\n  },\n\n  members: {\n    /**\n     * Removes packages\n     */\n    async process() {\n      await super.process();\n      if (!this.argv.uri) {\n        throw new qx.tool.utils.Utils.UserError(\"No repository name given.\");\n      }\n      // read libraries array from the lockfile\n      let data = await this.getLockfileData();\n      // currently, the uri is github_username/repo_name[/path/to/repo].\n      let parts = this.argv.uri.split(/\\//);\n      let tag = parts.length > 2 ? \"uri\" : \"repo_name\";\n\n      let found = [];\n      let libraries = [];\n      for (const elem of data.libraries) {\n        if (elem[tag] === this.argv.uri) {\n          await this.__removeApplication(elem.uri);\n          await this.__deleteRequiredFromManifest(elem.uri);\n          let c = elem.path.split(/\\//).length;\n          let p = elem.path;\n          if (c > parts.length) {\n            p = path.dirname(p);\n          }\n          if (!found.includes(p)) {\n            found.push(p);\n          }\n        } else {\n          libraries.push(elem);\n        }\n      }\n      if (found.length) {\n        for (const p of found) {\n          rimraf.sync(p);\n        }\n        if (!this.argv.quiet) {\n          qx.tool.compiler.Console.info(\n            `Deleted ${found.length} entries for ${this.argv.uri}`\n          );\n        }\n      } else if (this.argv.verbose) {\n        qx.tool.compiler.Console.warn(`No entry for ${this.argv.uri}`);\n      }\n      data.libraries = libraries;\n      fs.writeFileSync(\n        this.getLockfilePath(),\n        JSON.stringify(data, null, 2),\n        \"utf-8\"\n      );\n\n      if (this.argv.verbose) {\n        qx.tool.compiler.Console.info(\">>> Done.\");\n      }\n    },\n\n    async __deleteRequiredFromManifest(uri) {\n      let manifest = await qx.tool.utils.Json.loadJsonAsync(\n        qx.tool.config.Manifest.config.fileName\n      );\n\n      if (manifest.requires && manifest.requires[uri]) {\n        delete manifest.requires[uri];\n        await qx.tool.utils.Json.saveJsonAsync(\n          qx.tool.config.Manifest.config.fileName,\n          manifest\n        );\n      }\n    },\n\n    /**\n     * Removes installed applications\n     * @param uri\n     * @return {Promise<void>}\n     * @private\n     */\n    async __removeApplication(uri) {\n      let pkgData = await this.getLockfileData();\n      let libraryData = pkgData.libraries.find(data => data.uri === uri);\n      if (!libraryData) {\n        throw new Error(\"Repo for \" + uri + \" is not an installed package\");\n      }\n\n      let manifest = await qx.tool.utils.Json.loadJsonAsync(\n        path.join(libraryData.path, qx.tool.config.Manifest.config.fileName)\n      );\n\n      if (!manifest || !manifest.provides || !manifest.provides.application) {\n        if (this.argv.verbose) {\n          qx.tool.compiler.Console.info(\">>> No application to remove.\");\n        }\n        return;\n      }\n\n      let compileData = await qx.tool.utils.Json.loadJsonAsync(\n        qx.tool.config.Compile.config.fileName\n      );\n\n      let manifestApp = manifest.provides.application;\n      let app = compileData.applications.find(app => {\n        if (manifestApp.name && app.name) {\n          return manifestApp.name === app.name;\n        }\n        return manifestApp[\"class\"] === app[\"class\"];\n      });\n      if (app) {\n        let idx = compileData.applications.indexOf(app);\n        compileData.applications.splice(idx, 1);\n\n        if (this.argv.verbose) {\n          qx.tool.compiler.Console.info(\n            \">>> Removed application \" + (app.name || app[\"class\"])\n          );\n        }\n        await qx.tool.utils.Json.saveJsonAsync(\n          qx.tool.config.Compile.config.fileName,\n          compileData\n        );\n      }\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}