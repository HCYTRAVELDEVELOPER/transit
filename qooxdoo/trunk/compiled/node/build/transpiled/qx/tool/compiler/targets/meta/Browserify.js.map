{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "fs",
    "tool",
    "utils",
    "Promisify",
    "path",
    "require",
    "Class",
    "define",
    "extend",
    "compiler",
    "targets",
    "meta",
    "AbstractJavascriptMeta",
    "construct",
    "appMeta",
    "getApplicationRoot",
    "__appMeta",
    "setNeedsWriteToDisk",
    "members",
    "writeSourceCodeToStream",
    "ws",
    "hasCommonjsModules",
    "commonjsModules",
    "Set",
    "references",
    "db",
    "getAnalyser",
    "getDatabase",
    "className",
    "classInfo",
    "Object",
    "keys",
    "forEach",
    "moduleName",
    "add",
    "__browserify",
    "Promise",
    "resolve",
    "write",
    "b",
    "browserify",
    "builtins",
    "process",
    "_process",
    "ignoreMissing",
    "insertGlobals",
    "detectGlobals",
    "_mdeps",
    "on",
    "id",
    "parent",
    "message",
    "push",
    "refs",
    "ref",
    "Console",
    "error",
    "join",
    "bundle",
    "e",
    "output",
    "getSourceMap",
    "Browserify"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/compiler/targets/meta/Browserify.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n *\n *    qooxdoo-compiler - node.js based replacement for the Qooxdoo python\n *    toolchain\n *\n *    https://github.com/qooxdoo/qooxdoo-compiler\n *\n *    Copyright:\n *      2022 Derrell Lipman\n *\n *    License:\n *      MIT: https://opensource.org/licenses/MIT\n *\n *      This software is provided under the same licensing terms as Qooxdoo,\n *      please see the LICENSE file in the Qooxdoo project's top-level directory\n *      for details.\n *\n *    Authors:\n *      * Derrell Lipman (@derrell)\n *\n * ************************************************************************/\n\nconst fs = qx.tool.utils.Promisify.fs;\nconst path = require(\"upath\");\n\n/**\n * \n */\nqx.Class.define(\"qx.tool.compiler.targets.meta.Browserify\", {\n  extend: qx.tool.compiler.targets.meta.AbstractJavascriptMeta,\n\n  construct(appMeta) {\n    super(appMeta, `${appMeta.getApplicationRoot()}commonjs-browserify.js`);\n    this.__appMeta = appMeta;\n    this.setNeedsWriteToDisk(true);\n  },\n\n  members: {\n    __appMeta : null,\n\n    /**\n     * @Override\n     */\n    async writeSourceCodeToStream(ws) {\n      let hasCommonjsModules = false;\n      let commonjsModules = new Set();\n      let references = {};\n      const db = this.__appMeta.getAnalyser().getDatabase();\n\n      // Get a Set of unique `require`d CommonJS module names from all classes\n      for (let className in db.classInfo) {\n        let classInfo = db.classInfo[className];\n        if (classInfo.commonjsModules) {\n          Object.keys(classInfo.commonjsModules).forEach(\n            moduleName =>\n            {\n              // Add this module name to the set of module names\n              commonjsModules.add(moduleName);\n\n              // Add the list of references from which this module was require()d\n              if (! references[moduleName]) {\n                references[moduleName] = new Set();\n              }\n              references[moduleName].add([ ...classInfo.commonjsModules[moduleName] ]);\n\n              // There is at least one module\n              hasCommonjsModules = true;\n            });\n        }\n      }\n\n      // If there are any CommonJS modules required, browserify them\n      if (hasCommonjsModules) {\n        await this.__browserify(\n          commonjsModules,\n          references,\n          ws\n        );\n      }\n\n      await new Promise(resolve => {\n        ws.write(\"\\n\", resolve);\n      });\n    },\n\n    async __browserify(commonjsModules, references, ws) {\n      let b;\n      const browserify = require(\"browserify\");\n      const builtins = require(\"browserify/lib/builtins.js\");\n\n      // For some reason, `process` is not require()able, but `_process` is.\n      // Make them equivalent.\n      builtins.process = builtins._process;\n\n      // Convert the Set of CommonJS module names to an array\n      commonjsModules = [...commonjsModules];\n\n      return new Promise(resolve =>\n        {\n          b = browserify(\n            [],\n            {\n              builtins      : builtins,\n              ignoreMissing : true,\n              insertGlobals : true,\n              detectGlobals : true\n            });\n          b._mdeps.on(\"missing\", (id, parent) => {\n              let message = [];\n\n              message.push(`ERROR: could not locate require()d module: \"${id}\"`);\n              message.push(\"  required from:\");\n              [ ...references[id] ].forEach(refs => {\n                refs.forEach(ref =>\n                  {\n                    message.push(`    ${ref}`);\n                  });\n              });\n\n              qx.tool.compiler.Console.error(message.join(\"\\n\"));\n            });\n          b.require(commonjsModules);\n          b.bundle((e, output) => {\n            if (e) {\n              // We've already handled the case of missing module. This is something else.\n              qx.tool.compiler.Console.error(`Failed: ${e}`);\n              throw(e);\n            }\n\n            ws.write(output);\n            resolve(null);\n          });\n        });\n    },\n\n    /**\n     * @Override\n     */\n    async getSourceMap() {\n      return null;\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}