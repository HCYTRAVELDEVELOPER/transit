{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "path",
    "require",
    "fs",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "construct",
    "appMeta",
    "packageIndex",
    "__appMeta",
    "__packageIndex",
    "__assets",
    "__locales",
    "__translations",
    "__javascriptMetas",
    "__classnames",
    "__javascript",
    "tool",
    "compiler",
    "targets",
    "meta",
    "PackageJavascript",
    "properties",
    "embedAllJavascript",
    "init",
    "check",
    "needsWriteToDisk",
    "apply",
    "members",
    "isEmpty",
    "length",
    "localeId",
    "isEmbedAllJavascript",
    "getPackageIndex",
    "addAsset",
    "asset",
    "push",
    "getAssets",
    "addLocale",
    "localeData",
    "getLocales",
    "addTranslationEntry",
    "entry",
    "translations",
    "msgstr",
    "lang",
    "Type",
    "isArray",
    "msgid",
    "msgid_plural",
    "getTranslations",
    "addJavascriptMeta",
    "jsMeta",
    "getJavascriptMetas",
    "removeJavascriptMeta",
    "Array",
    "remove",
    "addClassname",
    "classname",
    "getClassnames",
    "getJavascript",
    "serializeInto",
    "packages",
    "data",
    "String",
    "uris",
    "appRoot",
    "getApplicationRoot",
    "toUri",
    "filename",
    "isAddTimestampsToUrls",
    "stat",
    "statSync",
    "throwIfNoEntry",
    "uri",
    "relative",
    "mtimeMs",
    "map",
    "js",
    "getFilename",
    "isNeedsWriteToDisk",
    "unshift",
    "_applyNeedsWriteToDisk",
    "value",
    "setNeedsWriteToDisk",
    "Package"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/compiler/targets/meta/Package.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n *\n *    qooxdoo-compiler - node.js based replacement for the Qooxdoo python\n *    toolchain\n *\n *    https://github.com/qooxdoo/qooxdoo-compiler\n *\n *    Copyright:\n *      2011-2021 Zenesis Limited, http://www.zenesis.com\n *\n *    License:\n *      MIT: https://opensource.org/licenses/MIT\n *\n *      This software is provided under the same licensing terms as Qooxdoo,\n *      please see the LICENSE file in the Qooxdoo project's top-level directory\n *      for details.\n *\n *    Authors:\n *      * John Spackman (john.spackman@zenesis.com, @johnspackman)\n *\n * ************************************************************************/\n\nconst path = require(\"upath\");\nconst fs = require(\"fs\");\n\n/**\n * A Package is a collection of files and resources, used by either the boot process\n * or by one or more Parts\n */\nqx.Class.define(\"qx.tool.compiler.targets.meta.Package\", {\n  extend: qx.core.Object,\n\n  /**\n   * Constructor\n   */\n  construct(appMeta, packageIndex) {\n    super();\n    this.__appMeta = appMeta;\n    this.__packageIndex = packageIndex;\n    this.__assets = [];\n    this.__locales = {};\n    this.__translations = {};\n    this.__javascriptMetas = [];\n    this.__classnames = [];\n    this.__javascript = new qx.tool.compiler.targets.meta.PackageJavascript(\n      this.__appMeta,\n      this\n    );\n  },\n\n  properties: {\n    /** Whether to embed all the javascript into the one, main package .js file */\n    embedAllJavascript: {\n      init: false,\n      check: \"Boolean\"\n    },\n\n    /** If true, this is generated on the fly and needs to be output */\n    needsWriteToDisk: {\n      init: true,\n      check: \"Boolean\",\n      apply: \"_applyNeedsWriteToDisk\"\n    }\n  },\n\n  members: {\n    /** @type {AppMeta} the AppMeta instance */\n    __appMeta: null,\n\n    /** @type {Integer} the package index, 0 == boot package */\n    __packageIndex: -1,\n\n    /** @type {qx.tool.compiler.resources.Asset[]} assets to be included in this package */\n    __assets: null,\n\n    /** @type {Map} locale data, indexed by locale ID */\n    __locales: null,\n\n    /** @type {Map} translations, indexed by message ID */\n    __translations: null,\n\n    /** @type {String[]} array of class names loaded by this package */\n    __classnames: null,\n\n    /** @type {AbstractJavascriptMeta[]} array of Javascript sources loaded by this package */\n    __javascriptMetas: null,\n\n    /** @type {AbstractJavascriptMeta} the javascript generated by this package */\n    __javascript: null,\n\n    /**\n     * Detects whether this package is empty; packages can be added for a number\n     * of reasons, but sometimes they don't actually end up with anything in them.\n     *\n     * Note that this is used to suppress the generation of an additional `package-*.js`\n     * file in the output, and just means that the content of the file should be embedded\n     * (or ignored) instead of written into that package file; however, there can still\n     * be script files which need to be loaded by this package (and that is handled by\n     * the index.js file)\n     *\n     * @return {Boolean}\n     */\n    isEmpty() {\n      if (this.__assets.length > 0) {\n        return false;\n      }\n      for (let localeId in this.__locales) {\n        if (this.__locales[localeId]) {\n          return false;\n        }\n      }\n      for (let localeId in this.__translations) {\n        if (this.__translations[localeId]) {\n          return false;\n        }\n      }\n      if (this.isEmbedAllJavascript()) {\n        if (this.__javascriptMetas.length > 0) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Returns the package index\n     *\n     * @return {Integer}\n     */\n    getPackageIndex() {\n      return this.__packageIndex;\n    },\n\n    /**\n     * Adds an asset, expected to be unique\n     *\n     * @param asset {qx.tool.compiler.resources.Asset}\n     */\n    addAsset(asset) {\n      this.__assets.push(asset);\n    },\n\n    /**\n     * Returns the array of assets\n     *\n     * @return {qx.tool.compiler.resources.Asset[]}\n     */\n    getAssets() {\n      return this.__assets;\n    },\n\n    /**\n     * Adds locale data\n     *\n     * @param localeId {String}\n     * @param localeData {Object}\n     */\n    addLocale(localeId, localeData) {\n      this.__locales[localeId] = localeData;\n    },\n\n    /**\n     * Returns locale data, as a map where the key is the locale ID\n     *\n     * @return {Map}\n     */\n    getLocales() {\n      return this.__locales;\n    },\n\n    /**\n     * Adds a translation\n     *\n     * @param localeId {String} locale ID\n     * @param entry {Object} translation\n     */\n    addTranslationEntry(localeId, entry) {\n      let translations = this.__translations[localeId];\n      if (!translations) {\n        this.__translations[localeId] = translations = {};\n      }\n      var msgstr = entry.msgstr;\n      if (!qx.lang.Type.isArray(msgstr)) {\n        msgstr = [msgstr];\n      }\n      if (msgstr[0]) {\n        translations[entry.msgid] = msgstr[0];\n      }\n      if (entry.msgid_plural && msgstr[1]) {\n        translations[entry.msgid_plural] = msgstr[1];\n      }\n    },\n\n    /**\n     * Returns a map of all translations, indexed by Locale ID\n     *\n     * @return {Object}\n     */\n    getTranslations() {\n      return this.__translations;\n    },\n\n    /**\n     * Adds a Javascript to be loaded by this package.  You typically need to\n     * call `addClassname` also.\n     *\n     * @param jsMeta {AbstractJavascriptMeta}\n     */\n    addJavascriptMeta(jsMeta) {\n      this.__javascriptMetas.push(jsMeta);\n    },\n\n    /**\n     * Returns a list of all Javascripts to be loaded by this package\n     *\n     * @return {AbstractJavascriptMeta[]}\n     */\n    getJavascriptMetas() {\n      return this.__javascriptMetas;\n    },\n\n    /**\n     * Removes a Javascript\n     *\n     * @param jsMeta {AbstractJavascriptMeta} the javascript to remove\n     */\n    removeJavascriptMeta(jsMeta) {\n      qx.lang.Array.remove(this.__javascriptMetas, jsMeta);\n    },\n\n    /**\n     * Adds a classname to the list which is loaded by this package; this does not\n     * cause the code to be loaded, @see {addJavascriptMeta}.\n     *\n     * @param classname {String}\n     */\n    addClassname(classname) {\n      this.__classnames.push(classname);\n    },\n\n    /**\n     * Returns a list of all classnames\n     *\n     * @return {String[]}\n     */\n    getClassnames() {\n      return this.__classnames;\n    },\n\n    /**\n     * Returns the AbstractJavascriptMeta for this Package\n     *\n     * @return {AbstractJavascriptMeta}\n     */\n    getJavascript() {\n      return this.__javascript;\n    },\n\n    /**\n     * Writes the data into the configuration which is passed to the loader template\n     *\n     * @param packages {Object} the `qx.$$packages` object data\n     */\n    serializeInto(packages) {\n      let data = (packages[String(this.__packageIndex)] = {\n        uris: []\n      });\n\n      let appRoot = this.__appMeta.getApplicationRoot();\n      const toUri = filename => {\n        if (this.__appMeta.isAddTimestampsToUrls()) {\n          let stat = fs.statSync(filename, { throwIfNoEntry: false });\n          let uri = path.relative(appRoot, filename);\n          if (stat) {\n            uri += \"?\" + stat.mtimeMs;\n          }\n          return uri;\n        } else {\n          return path.relative(appRoot, filename);\n        }\n      };\n      if (!this.isEmbedAllJavascript()) {\n        data.uris = this.__javascriptMetas.map(js => toUri(js.getFilename()));\n      }\n      if (this.isNeedsWriteToDisk()) {\n        data.uris.unshift(toUri(this.__javascript.getFilename()));\n      }\n    },\n\n    /**\n     * Apply for needsWriteToDisk property\n     */\n    _applyNeedsWriteToDisk(value) {\n      this.__javascript.setNeedsWriteToDisk(value);\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}