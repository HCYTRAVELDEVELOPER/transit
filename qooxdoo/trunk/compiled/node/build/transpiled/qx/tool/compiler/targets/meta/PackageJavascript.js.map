{
  "version": 3,
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "path",
    "require",
    "Class",
    "define",
    "extend",
    "tool",
    "compiler",
    "targets",
    "meta",
    "AbstractJavascriptMeta",
    "construct",
    "appMeta",
    "pkg",
    "getApplicationRoot",
    "getPackageIndex",
    "__pkg",
    "properties",
    "needsWriteToDisk",
    "init",
    "refine",
    "members",
    "__sourceMapOffsets",
    "writeSourceCodeToStream",
    "ws",
    "data",
    "locales",
    "getLocales",
    "resources",
    "translations",
    "getTranslations",
    "getAssets",
    "forEach",
    "asset",
    "ext",
    "extname",
    "getFilename",
    "length",
    "substring",
    "fileInfo",
    "getFileInfo",
    "arr",
    "width",
    "height",
    "getLibrary",
    "getNamespace",
    "composite",
    "undefined",
    "push",
    "x",
    "y",
    "isEmbedAllJavascript",
    "strip",
    "utils",
    "Utils",
    "StripSourceMapTransform",
    "pipe",
    "Promise",
    "resolve",
    "i",
    "getJavascriptMetas",
    "js",
    "getLineNumber",
    "unwrap",
    "write",
    "basename",
    "Date",
    "getTime",
    "JSON",
    "stringify",
    "writeToDisk",
    "getSourceMap",
    "Error",
    "_copySourceMap",
    "PackageJavascript"
  ],
  "sources": [
    "/home/andresf/workspace_qooxdoo/qooxdoo/qooxdoo-7.0/source/class/qx/tool/compiler/targets/meta/PackageJavascript.js"
  ],
  "sourcesContent": [
    "/* ************************************************************************\n *\n *    qooxdoo-compiler - node.js based replacement for the Qooxdoo python\n *    toolchain\n *\n *    https://github.com/qooxdoo/qooxdoo-compiler\n *\n *    Copyright:\n *      2011-2021 Zenesis Limited, http://www.zenesis.com\n *\n *    License:\n *      MIT: https://opensource.org/licenses/MIT\n *\n *      This software is provided under the same licensing terms as Qooxdoo,\n *      please see the LICENSE file in the Qooxdoo project's top-level directory\n *      for details.\n *\n *    Authors:\n *      * John Spackman (john.spackman@zenesis.com, @johnspackman)\n *\n * ************************************************************************/\n\nconst path = require(\"upath\");\n\n/**\n * A PackageJavascript is the serialisation of the javascript required to produce a package;\n * at the minimum, this is the locales and resources provided by the package, but also can be\n * the javascript code from loaded classes, all merged into one .js file for the browser.\n */\nqx.Class.define(\"qx.tool.compiler.targets.meta.PackageJavascript\", {\n  extend: qx.tool.compiler.targets.meta.AbstractJavascriptMeta,\n\n  /**\n   * Constructor\n   */\n  construct(appMeta, pkg) {\n    super(\n      appMeta,\n      `${appMeta.getApplicationRoot()}package-${pkg.getPackageIndex()}.js`\n    );\n\n    this.__pkg = pkg;\n  },\n\n  properties: {\n    needsWriteToDisk: {\n      init: true,\n      refine: true\n    }\n  },\n\n  members: {\n    __sourceMapOffsets: null,\n\n    /*\n     * @Override\n     */\n    async writeSourceCodeToStream(ws) {\n      let pkg = this.__pkg;\n      let data = {\n        locales: pkg.getLocales(),\n        resources: {},\n        translations: pkg.getTranslations()\n      };\n\n      pkg.getAssets().forEach(asset => {\n        let ext = path.extname(asset.getFilename());\n        if (ext.length) {\n          ext = ext.substring(1);\n        }\n        let fileInfo = asset.getFileInfo();\n        var arr = (data.resources[asset.getFilename()] = [\n          fileInfo.width,\n          fileInfo.height,\n          ext,\n          asset.getLibrary().getNamespace()\n        ]);\n\n        if (fileInfo.composite !== undefined) {\n          arr.push(fileInfo.composite);\n          arr.push(fileInfo.x);\n          arr.push(fileInfo.y);\n        }\n      });\n\n      if (pkg.isEmbedAllJavascript()) {\n        this.__sourceMapOffsets = [];\n        let strip = new qx.tool.utils.Utils.StripSourceMapTransform();\n        strip.pipe(ws);\n        await new Promise(async resolve => {\n          for (let i = 0; i < pkg.getJavascriptMetas().length; i++) {\n            let js = pkg.getJavascriptMetas()[i];\n            this.__sourceMapOffsets.push(ws.getLineNumber());\n            await js.unwrap().writeSourceCodeToStream(strip);\n            strip.write(\"\\n\");\n          }\n          resolve();\n        });\n        ws.write(\n          `//# sourceMappingURL=${path.basename(\n            this.getFilename()\n          )}.map?dt=${new Date().getTime()}\\n`\n        );\n      }\n\n      ws.write(\n        `qx.$$packageData['${this.__pkg.getPackageIndex()}'] = ${JSON.stringify(\n          data,\n          null,\n          2\n        )};\\n`\n      );\n    },\n\n    /*\n     * @Override\n     */\n    async writeToDisk() {\n      await super.writeToDisk();\n      if (!this.__pkg.isEmbedAllJavascript()) {\n        for (let i = 0; i < this.__pkg.getJavascriptMetas().length; i++) {\n          await this.__pkg.getJavascriptMetas()[i].unwrap().writeToDisk();\n        }\n      }\n    },\n\n    /*\n     * @Override\n     */\n    async getSourceMap() {\n      if (!this.__pkg.isEmbedAllJavascript()) {\n        return null;\n      }\n      if (this.__sourceMapOffsets === null) {\n        throw new Error(\n          `Cannot get the source map for ${this} until the stream has been written`\n        );\n      }\n      return this._copySourceMap(\n        this.__pkg.getJavascriptMetas(),\n        this.__sourceMapOffsets\n      );\n    }\n  }\n});\n"
  ],
  "mappings": "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"
}