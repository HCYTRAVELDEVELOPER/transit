//main
var interactUserInDocRingow=!0;document.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",function(){!1===interactUserInDocRingow&&(interactUserInDocRingow=!0)});var e=webrtcNw.GET();if((t=document.querySelector(".volver_a_llamar"))&&t.addEventListener("click",function(){history.back()}),(t=document.querySelector(".loadingNwChat"))&&t.remove(),"true"===e.callEnd){var t;(t=document.querySelector(".contenedorMain"))&&(t.style.display="none");for(var n=!1,o=document.querySelectorAll(".califica"),a=0;a<o.length;a++){o[a].addEventListener("click",function(){n=this.getAttribute("data-val")})}return document.querySelector(".send_califica").addEventListener("click",function(){if(!n)return!1;var t={};t.calificacion=n,t.id_all=e.id_call,t.terminal=e.terminal,t.usuario_califica=e.usuario_califica,t.asesor=e.asesor,t.comentarios=document.querySelector(".textarea_califica").value,webrtcNw.califica(t)}),void((t=document.querySelector(".containerButtonVolver"))&&(t.style.display="block"))}var i=e.room;i&&initwebrtcNW.startRoom(i)}),createinitwebrtcNW=!1;var initwebrtcNW={startRoom:function(e,t){if(webrtcNw.endCall(!0),createinitwebrtcNW){webrtcNw.options(t),webrtcNw.nameConference=e;webrtcNw.createLienzo();webrtcNw.createChat(),webrtcNw.joinRoom(e),setTimeout(function(){webrtcNw.scrollBottomMessages()},500)}else webrtcNw.initialize(e,t),setTimeout(function(){webrtcNw.scrollBottomMessages()},500);createinitwebrtcNW=!0},getUsers:function(e,t){var n=location.origin;void 0!==e.domain&&(n=e.domain);var o="";o+="id="+e.id,void 0!==e.service&&!1!==e.service&&null!==e.service&&""!==e.service&&(o+="&service="+e.service),void 0!==e.search&&(o+="&search="+e.search),void 0!==e.username&&!1!==e.username&&null!==e.username&&""!==e.username&&(o+="&username="+e.username);var a=new XMLHttpRequest;a.onload=function(){var e=JSON.parse(this.responseText);return t(e)},a.onerror=function(e){return t("Fetch Error :-S",e)},a.open("POST",n+"/nwlib6/nwproject/modules/webrtc/v2/rpc/getUsers.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(o)},getServices:function(e,t){var n=location.origin;void 0!==e.domain&&(n=e.domain);var o="";o+="id="+e.id,void 0!==e.parent&&(o+="&parent="+e.parent),o+="&mode=contactos";var a=new XMLHttpRequest;a.onload=function(){var e=JSON.parse(this.responseText);return t(e)},a.onerror=function(e){return t("Fetch Error :-S",e)},a.open("POST",n+"/nwlib6/nwproject/modules/webrtc/v2/rpc/getServices.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(o)},GET:function(){var e=document.location.href.split("?")[1];if(null==e)return!1;for(var t=e.split("&"),n={},o=0,a=t.length;o<a;o++){var i=t[o].split("=");n[i[0]]=unescape(decodeURI(i[1]))}return n}},webrtcNw={debug:!1,readyToCall:null,lastTextTraducido:"",nameConference:null,tokens:[],interValRinging:null,statusCallRingow:!1,isCallingRingow:!1,numberCallingRingow:0,IntervalisCallingRingow:null,video:!0,audio:!0,chat:!0,id_session:"",id_session_call:!1,myUser:!1,isSetMyName:!1,setMyCelular:!1,setMyCorreo:!1,myName:"",myPhoto:"",myCelular:"",heName:"",heUser:!1,hePhoto:!1,bot:!1,nameUserRingow:!1,mailUserRingow:!1,celUserRingow:!1,usejoin:"false",openchat:"false",terminal:null,apikey:null,id_call:null,domain:null,domainVisitor:null,urlVisitor:null,useServer:!0,loadHistory:!1,useAudioCall:!0,useVideoCall:!0,focusIn:!1,get:!1,tipoChat:"chat",isOperatorRingow:"false",useForRingow:"false",canvasChat:null,haveOptions:!1,getSaludoBotPredeterminate:"Hola, ¿cómo puedo ayudarte?",getNameBotPredeterminate:"Será un placer asistirte, ¿Cuál es tu nombre?",getEmailBotPredeterminate:"¿Puedes dejarme tu email?",getPhoneBotPredeterminate:"¿Puedes dejarme tu teléfono con código de área o móvil?",botInResponse:null,botLastMsg:!1,botResponseHelloInitial:"Bienvenido a nuestro chat",botResponseNoFound:"No he entendido tu pregunta... ¿Puedes formularla nuevamente por favor?",botResponseWaiting:"Dame un momento, me estoy encargando de ponterte en contacto con un asesor para que responda tu consulta",options:function(e){debugMainRingow=this.debug,void 0!==e&&(this.haveOptions=!0,void 0!==e.domain&&(this.domain=e.domain),void 0!==e.heUser&&(this.heUser=e.heUser),void 0!==e.hePhoto&&(this.hePhoto=e.hePhoto),void 0!==e.heName&&(this.heName=e.heName),void 0!==e.myUser&&(this.myUser=e.myUser),void 0!==e.myName&&(this.myName=e.myName),void 0!==e.myPhoto&&(this.myPhoto=e.myPhoto),void 0!==e.chat&&(this.chat=e.chat),void 0!==e.openchat&&(!0===e.openchat?this.openchat="true":!1===e.openchat?this.openchat="false":this.openchat=e.openchat),void 0!==e.useServer&&(!0===e.useServer?this.useServer="true":!1===e.useServer?this.useServer="false":this.useServer=e.useServer),void 0!==e.audio&&(this.audio=e.audio),void 0!==e.video&&(this.video=e.video),void 0!==e.bot&&(this.bot=e.bot),void 0!==e.isOperatorRingow&&(this.isOperatorRingow=e.isOperatorRingow),void 0!==e.id_call&&(this.id_call=e.id_call),void 0!==e.body&&(this.body=e.body),void 0!==e.useForRingow&&(!0===e.useForRingow?this.useForRingow="true":!1===e.useForRingow?this.useForRingow="false":this.useForRingow=e.useForRingow),void 0!==e.statusCallRingow&&(this.statusCallRingow=e.statusCallRingow))},initialize:function(e,t){if(this.domain=location.origin,this.domainVisitor=location.origin,this.urlVisitor=location.href,top.location!=location){var n=document.referrer.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),o=n&&n[1],a=document.referrer.split(/[\/?#]/)[0]+"//"+o;this.domainVisitor=a,this.urlVisitor=document.referrer}var i=this.GET();this.debug&&console.log(i.room),this.get=i,void 0!==localStorage.id_session?this.id_session=localStorage.id_session:(this.id_session=Math.floor(1e4*Math.random()+999999999).toString(),localStorage.id_session=this.id_session),this.setMyName("guest_"+this.id_session),"undefined"!==i.id_session&&(this.id_session_call=i.id_session),"false"===i.video&&(this.video=!1),"false"===i.audio&&(this.audio=!1),"false"===i.chat&&(this.chat=!1),"true"!==i.bot&&"SI"!==i.bot||(this.bot=!0),void 0!==i.useVideoCall&&"NO"===i.useVideoCall&&(this.useVideoCall=!1),void 0!==i.useAudioCall&&"NO"===i.useAudioCall&&(this.useAudioCall=!1),void 0!==i.isOperatorRingow&&(this.isOperatorRingow=i.isOperatorRingow),void 0!==i.useForRingow&&(this.useForRingow=i.useForRingow),void 0!==i.myName&&this.setMyName(i.myName,!0),void 0!==i.myUser&&(this.myUser=i.myUser),void 0!==i.myPhoto&&(this.myPhoto=i.myPhoto),void 0!==i.heUser&&(this.heUser=i.heUser),void 0!==i.hePhoto&&(this.hePhoto=i.hePhoto),void 0!==i.heName&&(this.heName=i.heName),void 0!==i.usejoin&&(this.usejoin=i.usejoin),void 0!==i.openchat&&(this.openchat=i.openchat),void 0!==i.useServer&&("true"===i.useServer?this.useServer=!0:"false"===i.useServer&&(this.useServer=!1)),-1===this.myName.indexOf("Visitor-")&&(this.isSetMyName=!0),this.nameConference=e,this.setTerminalKey(),this.options(t),this.createLienzo(),this.addCssRingow(),this.setReady(),this.setRoom(),this.setButtons()},createLienzo:function(){return!document.querySelector(".bubble_ringow_"+this.nameConference)&&(void 0===this.body&&(this.body=document.querySelector(".containWebRtcNw"),this.body||(this.body=document.querySelector(".miniBar"))),this.canvas=document.createElement("div"),this.canvas.className="contenedorChatAndVideo bubble_ringow_"+this.nameConference,this.canvas.innerHTML=" <div class='contenedorVideosAndAudio contenedorMain'>\n                    <div class='contain_me contain_me_alone'>\n                        <video id='localVideo'></video>\n                        <div id='localVolume' class='volumen'></div>\n                    </div>\n                </div>",this.body.appendChild(this.canvas),this.remotes=document.createElement("div"),this.remotes.className="remotes",this.remotes.id="remotes",this.canvas.appendChild(this.remotes),this.debug&&console.log("self.useForRingow",this.useForRingow),this.containerButtons=document.createElement("div"),this.containerButtons.className="containerButtons isOperatorRingow_"+this.isOperatorRingow+" useForRingow_"+this.useForRingow,this.canvas.appendChild(this.containerButtons),this.canvasChat=this.createCanvasChat(),this.debug&&console.log(this.canvasChat),this.canvas.appendChild(this.canvasChat),!0)},setMyName:function(e,t){!0===t?this.myName=e:void 0!==localStorage.myName?this.myName=localStorage.myName:this.myName=e,this.myUser=this.myName},setHeName:function(e,t){!0===t?this.heName=e:void 0!==localStorage.heName||(this.heName=e);var n=document.querySelector(".encName");n&&(n.innerHTML=this.heName)},setHePhoto:function(e,t){!0===t?this.hePhoto=e:void 0!==localStorage.hePhoto||(this.hePhoto=e);var n=document.querySelector(".encPhoto");n&&(n.style.backgroundImage="url("+this.hePhoto+")")},setReady:function(){var e=this;e.webrtc=new SimpleWebRTC({localVideoEl:"localVideo",remoteVideosEl:"",autoRequestMedia:!0,debug:!1,detectSpeakingEvents:!1,autoAdjustMic:!0,media:{video:e.video,audio:e.audio}}),e.init=!1,e.webrtc.on("readyToCall",function(t){e.debug&&console.log("readyToCall to "+e.nameConference),"true"!==e.usejoin&&(e.joinRoom(),e.init=!0)}),e.webrtc.on("channelMessage",function(t,n,o){"volume"===o.type&&e.showVolume(document.getElementById("volume_"+t.id),o.volume),e.changeStatusActiveOther()}),e.webrtc.on("channelOpen",function(t,n){e.debug&&console.log("channelOpen",t),e.bot=!1,clearInterval(e.IntervalisCallingRingow),void 0!==e.othersButtons&&null!==e.othersButtons==e.othersButtons!==""&&!1!==e.othersButtons&&(e.othersButtons.style.display="none");var o={};o.name=e.myName,o.photo=e.myPhoto,o.user=e.myUser,e.sendMessage(o,"sendNickName"),e.sendMessage(!1,"deliveryMessages"),e.changeStatusActiveOther()}),e.webrtc.on("channelClose",function(t,n){e.debug&&console.log("channelClose",t),e.changeStatusInactiveOther()}),e.webrtc.on("videoAdded",function(t,n){e.debug&&console.log("video added in "+e.nameConference,n);var o=document.getElementById("remotes");if(o){e.bot=!1;var a=document.createElement("div");a.className="contenedor",a.id="container_"+e.webrtc.getDomId(n),a.appendChild(t);var i=document.createElement("div");i.id="volume_"+n.id,i.className="volumen",a.appendChild(i),o.appendChild(a),e.setSizesRemotes(),e.soundNewAddUser(),e.stopRingCalling(),document.querySelector(".terminar_before_container").style.display="none",document.querySelector(".terminar").style.display="inline-block",e.removeClass(".contain_me","contain_me_alone"),e.audio&&!e.video&&(document.querySelector(".callvioce_container").style.display="block")}}),e.webrtc.on("videoRemoved",function(t,n){e.debug&&console.log("video removed in "+e.nameConference,n);var o=document.getElementById("remotes"),a=document.getElementById("container_"+e.webrtc.getDomId(n));if(o&&a){o.removeChild(a),e.setSizesRemotes();var i=document.querySelectorAll(".contenedor");i&&(i.length<=0&&(e.soundLostCalling(),e.addClass(document.querySelector(".contain_me"),"contain_me_alone"),document.querySelector(".terminar_before_container").style.display="block"),document.querySelector(".callvioce_container").style.display="none")}}),e.webrtc.on("volumeChange",function(t,n){e.showVolume(document.getElementById("localVolume"),t)}),e.webrtc.connection.on("message",function(t){if(e.debug&&console.log("message "+t.type,t),"sendNickName"===t.type){var n=!0,o=!0;void 0!==e.get.heName&&(n=!1),void 0!==e.get.heUser&&(o=!1),"true"===e.useForRingow&&(o=!0,n=!0),void 0===e.get.hePhoto&&t.payload.message.photo!==e.myPhoto&&e.setHePhoto(t.payload.message.photo,!0),n&&t.payload.message.name!==e.myName&&e.setHeName(t.payload.message.name,!0),o&&t.payload.message.user!==e.myUser&&(e.heUser=t.payload.message.user,e.getTokensNotifyPush(e.heUser))}else if("messageReceivedFull"===t.type)e.showChat(),document.querySelector(".messages").innerHTML=t.payload.message,e.scrollBottomMessages();else if("messageReceived"===t.type){"undefined"===e.get.heName&&e.setHeName(t.payload.user,!0);var a=t.payload.message;if("true"===e.isOperatorRingow||!0===e.isOperatorRingow){var i=window.localStorage.getItem(e.nameConference+"select_transtale_origin_setings_other"),s=window.localStorage.getItem(e.nameConference+"select_transtale_trad_setings_other");null!==i&&""!==i&&null!==s&&""!==s&&i!==s?e.translateText(a,i,s,function(t){e.lastTextTraducido=t.source,r(t.translation)}):r(a)}else r(a);function r(n){e.addMessage(n,!1,!1,!1,t.payload.user,"NO"),e.readMessages(e.heName,!0);var o={tipo:"sendMessageCallRingow"};o.text=n,o.room=e.nameConference,o.userName=e.heName,o.user=e.heUser,window.parent.postMessage(o,"*")}}else"messagesendWritten"===t.type?e.createWritten(t.payload.message):"readMessages"===t.type?e.readMessages(e.myName,!0):"deliveryMessages"===t.type&&(e.readMsgCall(e.myName,"recibido"),e.onDevMessages(e.myName,!0))})},cleanWritten:function(){var e=document.querySelector(".isWritten");e&&(e.innerHTML="")},createWritten:function(e,t){void 0===t&&(t=500);var n=this,o=document.querySelector(".isWritten");o&&(o.innerHTML="<img src='"+n.domain+"/nwlib6/icons/lg.-text-entering-comment-loader.gif' />"),n.scrollBottomMessages(),setTimeout(function(){n.cleanWritten()},t)},sendWritten:function(){this.sendMessage(this.myName,"messagesendWritten")},onDevMessages:function(e){for(var t=document.querySelectorAll(".spanTextDev_"+this.cleanUserNwC(e)),n=0;n<t.length;n++)t[n].innerHTML="SI"},onReadMessages:function(e){for(var t=document.querySelectorAll(".spanTextSee_"+this.cleanUserNwC(e)),n=0;n<t.length;n++)t[n].innerHTML="SI"},readAllMessages:function(e){for(var t=!0,n=document.querySelectorAll(".spanTextSee_"+this.cleanUserNwC(e)),o=0;o<n.length;o++)"NO"===n[o].innerHTML&&(t=!1);return t},readMessages:function(e,t){if(this.focusIn){var n=this.readAllMessages(e);e!==this.myName&&this.sendMessage(e,"readMessages"),this.useServer&&e!==this.myName&&(n||this.readMsgCall(e,"leido")),this.onReadMessages(e)}e!==this.myName&&this.sendMessage(!1,"deliveryMessages"),e===this.myName&&this.onReadMessages(e),this.setHoursMsg()},setFocus:function(){var e=this;e.messageBox.addEventListener("focusin",function(){e.focusIn=!0,"true"===e.useForRingow?e.readMessages(e.heName):e.readMessages(e.heUser)}),e.messageBox.addEventListener("focusout",function(){e.focusIn=!1})},sendMessage:function(e,t){this.debug&&"messageReceived"===t&&console.log(e),this.webrtc.sendToAll(t,{message:e,user:this.myName,nick:"nick"}),this.scrollBottomMessages()},joinRoom:function(e){var t=this.nameConference;void 0!==e&&(t=e,this.nameConference=t),this.webrtc.joinRoom(t),(this.video||this.audio)&&(this.soundIntroCalling(),this.ringCalling());var n=document.querySelector(".containerButtonJoin");n&&(n.style.display="none"),this.readyToCall=!0},endCall:function(e){var t;this.stopRingCalling(),this.offVideo(),this.close(),(t=document.querySelector(".terminar"))&&(t.style.display="none"),(t=document.querySelector(".llamar"))&&(t.style.display="inline-block"),(t=this.canvasChat)&&(t.innerHTML=""),!0!==e&&(window.location="?callEnd=true&id_call="+this.id_call+"&terminal="+this.terminal+"&usuario_califica="+this.myUser+"&asesor="+this.heUser)},close:function(){void 0!==this.webrtc&&(this.webrtc.stopLocalVideo(),this.webrtc.leaveRoom()),this.remotes&&(this.remotes.innerHTML="")},GET:function(){var e=document.location.href.split("?")[1];if(null==e)return!1;for(var t=e.split("&"),n={},o=0,a=t.length;o<a;o++){var i=t[o].split("=");n[i[0]]=unescape(decodeURI(i[1]))}return n},soundNewMsgHe:function(){var e=this,t=document.querySelector(".soundNewMsgHe");if(t)!0===interactUserInDocRingow?t.play():setTimeout(function(){e.soundNewMsgHe()},1e3);else{var n=document.createElement("audio");n.className="soundNewMsgHe",n.src=e.domain+"/nwlib6/audio/ping.mp3",document.body.appendChild(n),!0===interactUserInDocRingow?n.play():setTimeout(function(){e.soundNewMsgHe()},1e3)}},soundNewMsgMe:function(){var e=this,t=document.querySelector(".soundNewMsgMe");if(t)!0===interactUserInDocRingow?t.play():setTimeout(function(){e.soundNewMsgMe()},1e3);else{var n=document.createElement("audio");n.className="soundNewMsgMe",n.src=e.domain+"/nwlib6/audio/blop.mp3",document.body.appendChild(n),!0===interactUserInDocRingow?n.play():setTimeout(function(){e.soundNewMsgMe()},1e3)}},soundNewAddUser:function(){var e=this,t=document.createElement("audio");t.className="soundNewAddUser",t.src=e.domain+"/nwlib6/audio/2017/BeepcortoparaWhatsapp.mp3",document.body.appendChild(t),!0===interactUserInDocRingow?t.play():setTimeout(function(){e.soundNewAddUser()},1e3)},soundLostCalling:function(){var e=this,t=document.createElement("audio");t.className="soundLostCalling",t.src=e.domain+"/nwlib6/audio/misc312.mp3",document.body.appendChild(t),!0===interactUserInDocRingow?t.play():setTimeout(function(){e.soundLostCalling()},1e3)},soundIntroCalling:function(){var e=this,t=document.createElement("audio");t.className="soundIntroCalling",t.src=e.domain+"/nwlib6/audio/misc101.mp3",document.body.appendChild(t),!0===interactUserInDocRingow?t.play():setTimeout(function(){e.soundIntroCalling()},1e3)},ringCalling:function(){var e=this;e.stopRingCalling();var t=document.createElement("audio");t.className="soundCalling",t.src=e.domain+"/nwlib6/audio/misc027.mp3",document.body.appendChild(t),e.interValRinging=setInterval(function(){!0===interactUserInDocRingow?t.play():setTimeout(function(){e.ringCalling()},1e3)},2500)},stopRingCalling:function(){clearInterval(this.interValRinging);var e=document.querySelector(".soundCalling");e&&e.remove()},isMobile:function(){var e=navigator.userAgent;return!!(e.match(/Iphone/i)||e.match(/Ipod/i)||e.match(/Android/i)||e.match(/J2ME/i)||e.match(/BlackBerry/i)||e.match(/iPhone|iPad|iPod/i)||e.match(/Opera Mini/i)||e.match(/IEMobile/i)||e.match(/Mobile/i)||e.match(/Windows Phone/i)||e.match(/windows mobile/i)||e.match(/windows ce/i)||e.match(/webOS/i)||e.match(/palm/i)||e.match(/bada/i)||e.match(/series60/i)||e.match(/nokia/i)||e.match(/symbian/i)||e.match(/HTC/i))},setSizesRemotes:function(){var e="100%",t=document.querySelectorAll(".contenedor");t&&(e=100/t.length);for(var n=0;n<t.length;n++){t[n].style.width=e+"%"}},setButtons:function(){var e=this;"true"===e.usejoin&&(document.querySelector(".containerButtonJoin").style.display="block",document.querySelector(".join").addEventListener("click",function(){e.joinRoom()}));var t,n=e.containerButtons;n.innerHTML="",e.callvioce_container=document.createElement("div"),e.callvioce_container.className="callvioce_container",e.callvioce_container.style="display:none",e.canvas.appendChild(e.callvioce_container),(t=document.createElement("div")).className="btnvoice_active",t.innerHTML="<i class='material-icons'>mic</i>",e.callvioce_container.appendChild(t),t.onclick=function(){window.history.back()},e.terminar_before_container=document.createElement("div"),e.terminar_before_container.className="terminar_before_container",n.appendChild(e.terminar_before_container),e.terminarBeforeBtn=document.createElement("button"),e.terminarBeforeBtn.className="terminar_before",e.terminarBeforeBtn.innerHTML="<i class='material-icons'>call_end</i>",e.terminar_before_container.appendChild(e.terminarBeforeBtn),e.terminarBeforeBtn.onclick=function(){var t="He salido de la video-audio llamada";e.sendMessage(t,"messageReceived"),e.addMessage(t,"me",!0,!1,"NO"),"true"===e.useForRingow?e.endCall():window.history.back()},(t=document.createElement("button")).className="terminar",t.innerHTML="<i class='material-icons'>call_end</i>",t.style="display:none",n.appendChild(t),t.onclick=function(){var t="He salido de la video-audio llamada";e.sendMessage(t,"messageReceived"),e.addMessage(t,"me",!0,!1,"NO"),"true"===e.useForRingow?e.endCall():window.history.back()},(t=document.createElement("button")).className="llamar",t.innerHTML="<i class='material-icons'>call</i>",t.style="display:none",n.appendChild(t),t.onclick=function(){webrtcNw.initialize(e.nameConference),window.location.reload()},(t=document.createElement("button")).className="oncam",t.innerHTML="<i class='material-icons'>videocam_off</i>",t.style="display:none",n.appendChild(t),t.onclick=function(){e.OnVideo()},(t=document.createElement("button")).className="offcam",t.innerHTML="<i class='material-icons'>videocam</i>",n.appendChild(t),t.onclick=function(){e.offVideo()},(t=document.createElement("button")).className="onsound",t.innerHTML="<i class='material-icons'>volume_off</i>",t.style="display:none",n.appendChild(t),t.onclick=function(){e.soundOn()},(t=document.createElement("button")).className="offsound",t.innerHTML="<i class='material-icons'>volume_up</i>",n.appendChild(t),t.onclick=function(){e.soundOff()},(t=document.createElement("button")).className="showChat",t.innerHTML="<i class='material-icons'>chat</i>",n.appendChild(t),t.onclick=function(){e.showChat()},(t=document.createElement("button")).className="hiddenChat",t.innerHTML="<i class='material-icons'>chat</i>",t.style="display:none",n.appendChild(t),t.onclick=function(){e.hiddenChat()},e.btnShareScreen=document.createElement("button"),e.btnShareScreen.className="btnShareScreen",e.btnShareScreen.innerHTML="<i class='material-icons'>screen_share</i>",n.appendChild(e.btnShareScreen),e.btnShareScreen.onclick=function(){e.webrtc.getLocalScreen()?e.webrtc.stopScreenShare():e.webrtc.shareScreen(function(e){})},"true"===e.openchat&&(e.showChat(),e.video||e.audio?(e.addClass(document.querySelector(".encChat"),"encChat_fix"),document.querySelector(".hiddenChat").style.display="none"):(document.querySelector(".callEnc").style.display="block",document.querySelector(".videocallEnc").style.display="block",document.querySelector(".contenedorMain").style.display="none",e.addClass(e.canvasChat,"containerChat_maximice"),e.stopRingCalling())),document.body.onresize=function(){e.scrollBottomMessages()}},createChat:function(){var e=this,t=document.createElement("div");function n(t){""!==t&&(e.sendMessage(t,"messageReceived"),e.addMessage(t,"me",!0,!1))}t.className="contentChat",e.canvasChat.appendChild(t),e.encChat=document.createElement("div"),e.encChat.className="encChat",t.appendChild(e.encChat),e.messages=document.createElement("div"),e.messages.className="messages",t.appendChild(e.messages),e.NoMoreMessages=document.createElement("div"),e.NoMoreMessages.className="NoMoreMessages",e.NoMoreMessages.style="display:none;",e.NoMoreMessages.innerHTML="No hay más mensajes",e.messages.appendChild(e.NoMoreMessages),e.loadMoreMessages=document.createElement("button"),e.loadMoreMessages.className="loadMoreMessages",e.loadMoreMessages.style="display:none;",e.loadMoreMessages.innerHTML="Leer más mensajes",e.loadMoreMessages.onclick=function(){for(var t=this,n=document.querySelectorAll(".message"),o=0;o<n.length;o++)n[o].remove();e.limitLoadMessages=e.limitLoadMessages+10,e.loadMessages(function(n){document.querySelector(".contentChat .messages").scrollTop=0,e.totalMessages>=n.length&&(t.style.display="none",e.NoMoreMessages.style.display="block")})},e.messages.appendChild(e.loadMoreMessages),e.isWritten=document.createElement("div"),e.isWritten.className="isWritten",t.appendChild(e.isWritten),e.form=document.createElement("form"),e.form.className="footerChat",t.appendChild(e.form),e.form.setAttribute("onsubmit","return false"),e.othersButtons=document.createElement("div"),e.othersButtons.style="position: absolute;bottom: 0;width: 100%;padding: 10px;display: none;flex-shrink: 0;background-color: #ffffff;",t.appendChild(e.othersButtons),e.btnCallAgain=document.createElement("button"),e.btnCallAgain.innerHTML="Volver a llamar",e.btnCallAgain.style="border: 1px solid #ccc;margin: auto;padding: 15px;",e.btnCallAgain.onclick=function(){e.createWritten(e.heName,3e3),setTimeout(function(){var t=e.botResponseWaiting;e.addMessage(t)},3e3),e.form.style.visibility="visible",e.othersButtons.style.display="none",e.bot=!1,e.isCallingRingow=!1,e.changeStatusCall("LLAMANDO","chat")},e.othersButtons.appendChild(e.btnCallAgain),e.btnCloseAgain=document.createElement("button"),e.btnCloseAgain.innerHTML="Cerrar",e.btnCloseAgain.style="border: 1px solid #ccc;margin: auto;padding: 15px;",e.btnCloseAgain.onclick=function(){e.hiddenChat()},e.othersButtons.appendChild(e.btnCloseAgain),e.btnCalificarAgain=document.createElement("button"),e.btnCalificarAgain.innerHTML="Calificar",e.btnCalificarAgain.style="border: 1px solid #ccc;margin: auto;padding: 15px;",e.btnCalificarAgain.onclick=function(){e.hiddenChat()},e.othersButtons.appendChild(e.btnCalificarAgain),e.messageBox=document.createElement("input"),e.messageBox.className="messageBox",e.messageBox.type="text",e.messageBox.placeholder="Your message...",e.form.appendChild(e.messageBox),e.dictation=document.createElement("div"),e.dictation.className="imgSpeach",e.dictation.innerHTML="<img src='"+e.domain+"/nwlib6/nwproject/modules/webrtc/v2/icons/mic.svg' />",e.dictation.onclick=function(){e.startDictation(".messageBox")},e.form.appendChild(e.dictation),e.btnsubmit=document.createElement("button"),e.btnsubmit.className="btnsubmit",e.btnsubmit.type="submit",e.btnsubmit.innerHTML="<img src='"+e.domain+"/nwlib6/icons/svg/send.svg' />",e.form.appendChild(e.btnsubmit),e.form.addEventListener("submit",function(){var t=e.messageBox,o=t.value;if(""!==o)if("true"===e.isOperatorRingow||!0===e.isOperatorRingow){var a=window.localStorage.getItem(e.nameConference+"select_transtale_origin_setings"),i=window.localStorage.getItem(e.nameConference+"select_transtale_trad_setings");null!==a&&""!==a&&null!==i&&""!==i&&a!==i?e.translateText(o,a,i,function(t){e.lastTextTraducido=t.source,n(t.translation)}):n(o)}else n(o);t.value=""}),e.btnsubmit.addEventListener("click",function(){var t=e.messageBox,o=t.value;if(""!==o)if("true"===e.isOperatorRingow||!0===e.isOperatorRingow){var a=window.localStorage.getItem(e.nameConference+"select_transtale_origin_setings"),i=window.localStorage.getItem(e.nameConference+"select_transtale_trad_setings");null!==a&&""!==a&&null!==i&&""!==i&&a!==i?e.translateText(o,a,i,function(t){e.lastTextTraducido=t.source,n(t.translation)}):n(o)}else n(o);t.value=""});var o="",a="";e.evalueData(e.hePhoto)&&(a=" style='background-image: url("+e.hePhoto+");' "),o+="<div class='encStatus'></div>",o+="<div class='encPhoto' "+a+"></div>",o+="<div class='encName'>"+e.heName+"</div>";var i="";!1===e.useAudioCall&&(i="hiddenButton"),o+="<i class='material-icons iconsEnc callEnc "+i+"'>call</i>";var s="";!1===e.useVideoCall&&(s="hiddenButton"),o+="<i class='material-icons iconsEnc videocallEnc "+s+"'>videocam</i> ",o+="<img class='iconsEnc settingsEnc' src='"+e.domain+"/nwlib6/nwproject/modules/webrtc/v2/icons/settings.png' style='position: absolute;right: 28px;' /> ",o+="<img class='iconsEnc closeChat' src='"+e.domain+"/nwlib6/icons/svg/close_blanco.png' />",o+="<i class='material-icons iconsEnc openChat'>open_in_new</i>",o+="<div class='myName' style='display: none;'>myName: "+e.myName+"</div>",e.encChat.innerHTML=o,document.querySelector(".settingsEnc").addEventListener("click",function(){e.openSettings()}),document.querySelector(".closeChat").addEventListener("click",function(){e.hiddenChat()}),document.querySelector(".openChat").addEventListener("click",function(){e.showChat();var t={tipo:"openringow"};t.room=e.nameConference,window.parent.postMessage(t,"*")}),!0===e.useAudioCall&&document.querySelector(".callEnc").addEventListener("click",function(){var t=location.href.replace("video=true","video=false"),n=(t=t.replace("audio=false","audio=true")).replace(/&/gi,"(ampersand)"),o=location.href.replace("video=true","video=false");o=(o=o.replace("audio=true","audio=false")).replace(/&/gi,"(ampersand)");var a="<div class='globeCall callVoice'>He iniciado una llamada de voz. ";a+="<a href='"+encodeURI(n)+"' target='_SELF' class='btn_conts contestar_a'><i class='material-icons'>mic</i> <span>Contestar</span></a>";var i=(a+="</div>").replace(/\(ampersand\)/g,"&");e.sendMessage(i,"messageReceived"),e.addMessage(a,"me",!0,!1);var s="iniciar_audiollamada";e.sendMessage(s,"messageReceived"),e.addMessage(s,"me",!0,!1);var r={tipo:"initaudiocallringow"};r.room=e.nameConference,r.loc=t,window.parent.postMessage(r,"*"),location.href=t}),!0===e.useVideoCall&&document.querySelector(".videocallEnc").addEventListener("click",function(){var t=location.href.replace("video=false","video=true"),n=(t=t.replace("audio=false","audio=true")).replace(/&/gi,"(ampersand)"),o=location.href.replace("video=true","video=false");o=(o=o.replace("audio=true","audio=false")).replace(/&/gi,"(ampersand)");var a="<div class='globeCall callVideo'>He iniciado una video llamada. ";a+="<a href='"+n+"' target='_SELF' class='btn_conts contestar_a'><i class='material-icons'>videocam</i> <span>Contestar</span></a>";var i=(a+="</div>").replace(/\(ampersand\)/g,"&");e.sendMessage(i,"messageReceived"),e.addMessage(a,"me",!1,!1);var s={tipo:"initvideocallringow"};s.room=e.nameConference,s.loc=t,window.parent.postMessage(s,"*"),location.href=t}),e.loadMessages(),e.messageBox.onkeyup=function(t){""!==e.messageBox.value&&e.sendWritten()},e.setFocus(),setInterval(function(){e.setHoursMsg()},1e4)},totalMessages:0,limitLoadMessages:10,loadMessages:function(e){var t=this;t.useServer&&t.saveOrUpdate(function(n){var o=t.totalMessages;if(void 0!==n&&"true"!==n){if(o=n.length,null!=n&&!1!==n&&""!==n){o>=10&&(document.querySelector(".loadMoreMessages").style.display="block");for(var a=0;a<o;a++){var i=n[a].usuario,s=n[a].fecha,r=n[a].texto,l=n[a].leido,c=n[a].recibido;r=r.replace(/\(ampersand\)/g,"&");var d="";i===t.myName&&(d="me"),t.addMessage(r,d,!1,s,i,l,c)}}t.scrollBottomMessages()}t.loadHistory=!0,t.debug&&console.log("self.loadHistory",o),t.bot&&t.botInit(),void 0!==e&&e(n),t.totalMessages=o,!1!==t.statusCallRingow&&"LLAMANDO"===t.statusCallRingow&&t.artiveSearchCallEnded()})},changeStatusActiveOther:function(){this.addClass(document.querySelector(".encStatus"),"changeStatusActive")},changeStatusInactiveOther:function(){this.removeClass(".encStatus","changeStatusActive")},setHoursMsg:function(){var e=document.querySelectorAll(".message__fecha");if(e.length>0)for(var t=0;t<e.length;t++){var n=e[t].getAttribute("data-date"),o=this.calcularTiempoDosFechas(n).dateInFormat;e[t].innerHTML=o}},btnInitVideo:function(){this.video=!0,this.setReady()},cleanUserNwC:function(e){if(null===e)return"";var t=(e=e.toString()).replace(/\//gi,"");t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\?/gi,"")).replace(/\=/gi,"")).replace(/\./gi,"")).replace(/\,/gi,"")).replace(/\&/gi,"")).replace(/\=/gi,"")).replace(/\@/gi,"")).replace(/\-/gi,"")).replace(/\./gi,"")).replace(/\_/gi,"")).replace(/\-/gi,"")).replace(/\ /gi,"")).replace(/\!/gi,"")).replace(/\:/gi,"")).replace(".","");for(var n="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",o=0;o<n.length;o++)t=t.replace(n.charAt(o),"AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc".charAt(o));return t},notificationPushNwrtc:function(e,t,n,o){void 0!==t&&!1!==t&&null!==t&&""!==t||(t=this.domain+"/app/nwchat/img/logor1.png");var a=!1,i={body:e,icon:t,requireInteraction:!1,silent:!1,vibrate:!0,tag:e,dir:"ltr"};if(!("Notification"in window))return console.log("Este navegador no soporta notificaciones de escritorio"),!1;"granted"===Notification.permission?a=new Notification(n,i):"denied"!==Notification.permission?Notification.requestPermission(function(e){"permission"in Notification||(Notification.permission=e),"granted"===e&&(a=new Notification(n,i))}):(this.debug&&console.log("Send notifica"),Notification.requestPermission(function(e){"permission"in Notification||(Notification.permission=e),"granted"===e&&(a=new Notification(n,i))})),!1!==a&&(setTimeout(a.close.bind(a),1e4),a.onclick=function(e){this.close(),void 0===o||!1===o||o()})},getNavigator:function(e){return-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?"Internet Explorer":-1!=navigator.userAgent.indexOf("Firefox")?"Firefox":-1!=navigator.userAgent.indexOf("Chrome")?"Google Chrome":-1!=navigator.userAgent.indexOf("Opera")?"Opera":"Navegador no identificado ..."},scrollBottomMessages:function(){var e=document.querySelectorAll(".contentChat .messages")[0];if(e){var t=e.scrollHeight;document.querySelector(".contentChat .messages").scrollTop=t}},addMessage:function(e,t,n,o,a,i,s){var r=this;r.botLastMsg===r.getNameBotPredeterminate&&(r.myName=e,r.isSetMyName=!0),r.botLastMsg===r.getEmailBotPredeterminate&&(r.myUser=e,r.setMyCorreo=!0),r.botLastMsg===r.getPhoneBotPredeterminate&&(r.myCelular=e,r.setMyCelular=!0),"llamada_finalizada"===e&&(e="La llamada ha sido finalizada",clearInterval(r.IntervalisCallingRingow),r.createWritten(r.heName,3e3),setTimeout(function(){r.addMessage("¿Qué deseas hacer?"),r.othersButtons.style.display="flex",r.form.style.visibility="hidden"},3e3));var l=r.bubbleChat(e,t,o,a,i,s),c=r.messages;if(c&&c.appendChild(l),r.scrollBottomMessages(),!1!==n){var d=l.querySelector(".message__bubble").innerHTML;r.saveMsgSrv(d,a)}var u=!1;if(!1!==n&&("iniciar_chat"===e?(u=!0,r.changeStatusCall("LLAMANDO","chat")):"iniciar_videollamada"===e?(u=!0,r.changeStatusCall("LLAMANDO","videocalldirect")):"iniciar_audiollamada"===e&&(u=!0,r.changeStatusCall("LLAMANDO","audiocalldirect")),u&&r.messages.appendChild(r.bubbleChat(r.botResponseWaiting,t))),a!==r.myName&&"NO"===i&&!r.focusIn&&r.loadHistory){var m=e,h=a+" escribe:";r.notificationPushNwrtc(m,"",h,!1)}r.setHoursMsg()},bubbleChat:function(e,t,n,o,a,i){var s=this,r=s.getDateHour();void 0!==n&&!1!==n&&(r=n);var l=s.calcularTiempoDosFechas(r).dateInFormat,c="NO",d="NO";("SI"===a||s.bot)&&(d="SI",c="SI"),("SI"===i||s.bot)&&(c="SI");var u=s.heName;!0!==s.bot&&(s.heUser!==s.myUser&&o!==s.myUser&&o!==s.myName&&s.heName!==s.myName&&s.heName!==s.myUser||(t="me"));var m="";s.debug&&console.log(e),"iniciar_chat"===e&&(m="style='display: none;'");var h="bubbler_"+Math.floor(1e7*Math.random()+1),g="message message--theirs";"me"===t?(g="message message--mine",u=s.myName,s.loadHistory&&s.soundNewMsgMe()):(c="SI",s.loadHistory&&s.soundNewMsgHe()),void 0!==o&&(u=o);var p="";s.evalueData(u)&&-1!==u.indexOf("Visitor-")&&(p="style='display:none;'");var f="<div class='"+g+"' "+m+" >",v="";v+="<div class='message__name' "+p+">"+u+"</div>",v+="<div class='message__fecha' data-date='"+r+"'>"+l+"</div>",v+="<div class='message__bubble'>",v+=e=s.renderHTML(e),v+="</div>","true"!==s.isOperatorRingow&&!0!==s.isOperatorRingow||(v+=s.lastTextTraducido),f+=v+=" <div class='message__see'>Visto: <span class='spanTextSee spanTextSee_"+s.cleanUserNwC(u)+"'>"+d+"</span> Entregado: <span class='spanTextDev spanTextDev_"+s.cleanUserNwC(u)+"'>"+c+"</span></div>",f+="</div>",s.lastTextTraducido="";var b=document.createElement("div");if(b.className=g+" "+h,b.innerHTML=f,"true"===s.isOperatorRingow||!0===s.isOperatorRingow){var w=document.createElement("img");w.className="g_translate",w.src="icons/g_translate.svg",w.data={parentClass:h},w.onclick=function(){var e=this.data,t=document.createElement("div");this.parentNode.insertBefore(t,this.nextSibling);for(var n=document.createElement("select"),o="en",a="",i=0;i<4;i++){var r="";o===s.getLanguages[i].lang&&(r="selected"),a+="<option "+r+" value='"+s.getLanguages[i].lang+"'>"+s.getLanguages[i].name+"</option>"}n.innerHTML=a,n.className="select_langOrigin",t.appendChild(n);var l=document.createElement("select");for(o="es",a="",i=0;i<4;i++){r="";o===s.getLanguages[i].lang&&(r="selected"),a+="<option "+r+" value='"+s.getLanguages[i].lang+"'>"+s.getLanguages[i].name+"</option>"}l.innerHTML=a,l.className="select_langTranslate",t.appendChild(l),(l=document.createElement("button")).innerHTML="Traducir",l.data=e,l.style="background: #fff;border: 1px solid #ccc;padding: 3px 8px;font-size: 12px;",l.onclick=function(){var e="."+this.data.parentClass,t=document.querySelector(e+" .message__bubble"),n=t.innerHTML,o=document.querySelector(e+" .select_langOrigin").value,a=document.querySelector(e+" .select_langTranslate").value;if(o===a)return!1;s.translateText(n,o,a,function(e){console.log(e);var n=e.translation;t.innerHTML=n})},t.appendChild(l)},b.appendChild(w)}return b},renderHTML:function(e,t){return this.strip(e).replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,function(e){return!0===t&&(e=encodeURIComponent(e)),'<a href="'+e+'" target="_BLANK">'+e+"</a><br/>"})},urlify:function(e){e=e.replace(/ampersanNW/gi,"&");var t=this.strip(e);return t=/(https?:\/\/[^\s]+)/g,e.replace(t,function(e){return'<a href="'+e+'" target="_BLANK">'+e+"</a>"})},strip:function(e){var t=document.createElement("DIV");t.innerHTML=e;return t.innerText.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,function(e){return"\n"+e})},strip_tags:function(e){return this.evalueData(e)?(e=e.toString()).replace(/<\/?[^>]+>/gi,""):""},showChat:function(e){if(!1===this.chat)return!1;var t=this.canvasChat;!0!==e&&(t&&void 0!==t.length||this.createChat()),this.removeClass(this.encChat,"encChatMinimiced",!0),this.addClass(document.querySelector(".contenedorMain"),"contenedorMainMiddle"),this.addClass(document.querySelector(".remotes"),"contenedorMainMiddle"),this.addClass(this.canvasChat,"containerChatMiddle"),this.addClass(this.canvasChat,"containerChatVisible"),document.querySelector(".closeChat").style.display="block",document.querySelector(".openChat").style.display="none",this.video||this.audio?(document.querySelector(".showChat").style.display="none",document.querySelector(".hiddenChat").style.display="inline-block"):(document.querySelector(".callEnc").style.display="block",document.querySelector(".videocallEnc").style.display="block")},hiddenChat:function(){this.addClass(this.encChat,"encChatMinimiced"),document.querySelector(".myName").style.display="none",document.querySelector(".closeChat").style.display="none",document.querySelector(".openChat").style.display="block",this.video||this.audio?(this.removeClass(".contenedorMain","contenedorMainMiddle"),this.removeClass(".remotes","contenedorMainMiddle"),this.removeClass(this.canvasChat,"containerChatMiddle",!0),this.removeClass(this.canvasChat,"containerChatVisible",!0),document.querySelector(".showChat").style.display="inline-block",document.querySelector(".hiddenChat").style.display="none"):(document.querySelector(".callEnc").style.display="none",document.querySelector(".videocallEnc").style.display="none");var e={tipo:"closeringow"};e.room=this.nameConference,window.parent.postMessage(e,"*")},OnVideo:function(){this.webrtc.resumeVideo(),document.querySelector(".offcam").style.display="inline-block",document.querySelector(".oncam").style.display="none"},offVideo:function(){var e;this.webrtc&&this.webrtc.pauseVideo(),(e=document.querySelector(".offcam"))&&(e.style.display="none"),(e=document.querySelector(".oncam"))&&(e.style.display="inline-block")},soundOff:function(){this.webrtc.mute(),document.querySelector(".offsound").style.display="none",document.querySelector(".onsound").style.display="inline-block"},soundOn:function(){this.webrtc.unmute(),document.querySelector(".onsound").style.display="none",document.querySelector(".offsound").style.display="inline-block"},getLanguages:[{lang:"en",name:"Inglés"},{lang:"es",name:"Español"},{lang:"pt",name:"Portugués"},{lang:"fr",name:"Frances"}],openSettings:function(){var e=this,t=document.createElement("div");t.className="containerSettings",t.style="position: absolute;width: 100%;height: 100%;background-color: rgba(0, 0, 0, 0.38);z-index: 10;top: 0;left: 0;display: flex;align-items: center;",t.innerHTML="<div class='containerSettingsInt' style='overflow-y: auto;overflow-x: hidden;box-sizing: border-box;max-width: 90%;background-color: #fff;position: relative;margin: auto;padding: 10px;height: calc(100% - 100px);display: flex;flex-direction: column;align-items: center;border-radius: 5px;'></div>",document.querySelector(".containerChat").appendChild(t);var n=document.querySelector(".containerSettingsInt");if("true"===e.isOperatorRingow||!0===e.isOperatorRingow){(a=document.createElement("label")).innerHTML="Traducir lo que escribo de: <br /><br />",a.className="label_trad",n.appendChild(a);var o="";o=window.localStorage.getItem(e.nameConference+"select_transtale_origin_setings");for(var a=document.createElement("select"),i="<option value=''>Ninguno</option>",s=0;s<4;s++){var r="";o===e.getLanguages[s].lang&&(r="selected"),i+="<option "+r+" value='"+e.getLanguages[s].lang+"'>"+e.getLanguages[s].name+"</option>"}a.innerHTML=i,a.className="select_transtale_origin_setings",n.appendChild(a),(a=document.createElement("label")).innerHTML="a: <br />",a.className="label_trad",n.appendChild(a);o="";o=window.localStorage.getItem(e.nameConference+"select_transtale_trad_setings");var a=document.createElement("select");for(i="<option value=''>Ninguno</option>",s=0;s<4;s++){r="";o===e.getLanguages[s].lang&&(r="selected"),i+="<option "+r+" value='"+e.getLanguages[s].lang+"'>"+e.getLanguages[s].name+"</option>"}a.innerHTML=i,a.className="select_transtale_trad_setings",n.appendChild(a),(a=document.createElement("label")).innerHTML="<br /><br />Traducir lo que me  escriben de: <br /><br />",a.className="label_trad",n.appendChild(a);o="";o=window.localStorage.getItem(e.nameConference+"select_transtale_origin_setings_other");var a=document.createElement("select");for(i="<option value=''>Ninguno</option>",s=0;s<4;s++){r="";o===e.getLanguages[s].lang&&(r="selected"),i+="<option "+r+" value='"+e.getLanguages[s].lang+"'>"+e.getLanguages[s].name+"</option>"}a.innerHTML=i,a.className="select_transtale_origin_setings_other",n.appendChild(a),(a=document.createElement("label")).innerHTML="a: <br />",a.className="label_trad",n.appendChild(a);o="";o=window.localStorage.getItem(e.nameConference+"select_transtale_trad_setings_other");for(a=document.createElement("select"),i="<option value=''>Ninguno</option>",s=0;s<4;s++){r="";o===e.getLanguages[s].lang&&(r="selected"),i+="<option "+r+" value='"+e.getLanguages[s].lang+"'>"+e.getLanguages[s].name+"</option>"}a.innerHTML=i,a.className="select_transtale_trad_setings_other",n.appendChild(a)}(a=document.createElement("label")).innerHTML="Voz a texto, ¿Detener automáticamente al terminar de hablar?",a.style="margin:20px 5px 5px 5px;text-align: center;",n.appendChild(a);var l="",c="";"SI"===(o=window.localStorage.getItem(e.nameConference+"select_voice_text_detener"))?l="selected":"NO"===o&&(c="selected");i="<option "+l+" value='SI'>Si</option>";i+="<option "+c+" value='NO'>No</option>",(a=document.createElement("select")).innerHTML=i,a.className="select_voice_text_detener",n.appendChild(a),(a=document.createElement("label")).innerHTML="Voz a texto, ¿Enviar mensaje automáticamente al terminar de hablar?",a.style="margin: 20px 5px 5px 5px;text-align: center;",n.appendChild(a);l="",c="";"NO"===(o=window.localStorage.getItem(e.nameConference+"send_auto_voice_text"))?l="selected":"SI"===o&&(c="selected");i="<option "+l+" value='NO'>NO</option>";i+="<option "+c+" value='SI'>SI</option>",(a=document.createElement("select")).innerHTML=i,a.className="send_auto_voice_text",n.appendChild(a),(a=document.createElement("button")).innerHTML="<img src='"+e.domain+"/nwlib6/icons/svg/close.svg' />",a.style="position: absolute;top: 0;right: 0;font-size: 12px;padding: 0;margin: 0;border-radius: 50%;width: 30px;height: 30px;",a.onclick=function(){t.remove()},n.appendChild(a),(a=document.createElement("button")).innerHTML="Guardar",a.className="save_settings",a.style="font-size: 14px;margin: auto auto 0 auto;background: #32a9e9;color: #fff;border: 0;cursor: pointer;padding: 9px 13px;",a.onclick=function(){if("true"===e.isOperatorRingow||!0===e.isOperatorRingow){var n=document.querySelector(".select_transtale_origin_setings").value;window.localStorage.setItem(e.nameConference+"select_transtale_origin_setings",n);n=document.querySelector(".select_transtale_trad_setings").value;window.localStorage.setItem(e.nameConference+"select_transtale_trad_setings",n);n=document.querySelector(".select_transtale_origin_setings_other").value;window.localStorage.setItem(e.nameConference+"select_transtale_origin_setings_other",n);n=document.querySelector(".select_transtale_trad_setings_other").value;window.localStorage.setItem(e.nameConference+"select_transtale_trad_setings_other",n)}n=document.querySelector(".select_voice_text_detener").value;window.localStorage.setItem(e.nameConference+"select_voice_text_detener",n);n=document.querySelector(".send_auto_voice_text").value;window.localStorage.setItem(e.nameConference+"send_auto_voice_text",n),t.remove()},n.appendChild(a)},createRoom:function(){var e=this;e.webrtc.createRoom(e.nameConference,function(t,n){console.log(" create sala conferencia cb in "+e.nameConference,arguments);location.pathname;t?console.log(t):e.setRoom()})},setRoom:function(){},showVolume:function(e,t){e&&(e.style.height=t<-45?"0px":t>-20?"100%":Math.floor(100*(t+100)/25-220)+"%")},calcularTiempoDosFechas:function(e,t){void 0===t&&(t=this.getDateHour());var n=this.getDateHour(),o=new Date(e),a=(new Date(t)-o)/1e3,i=Math.floor(a/3600),s=Math.floor(a%3600)/60,r=a%60,l=this.diffEntreFechas(e,t),c=i<10?"0"+i:i,d=this.dataOfDate(e),u=(this.dataOfDate(n),d.fecha_mes),m=d.fecha_mes_text,h=d.fecha_dia,g=d.fecha_dia_text,p=d.hora_horas,f=d.hora_minutos,v=s<10?"0"+s:s,b=s<10?"0"+s:r,w=c+":"+v;v=parseInt(v);var y=!1;e>n&&(y=!0);var x={};x.hoy=n,x.fecha_mayor_a_hoy=y,x.date1=e,x.time_complet=w,x.days=l,x.hours=c,x.mesDate=u,x.mesDateText=m,x.dayDate=h,x.dayDateText=g,x.hoursDate=p,x.minutesDate=f,x.minutes=v,x.seconds=b;var _=m+" "+h+" a las "+p+":"+f;return 1==y||(l>0?_=1==l?this.str("Ayer a las")+" "+p+":"+f:m+" "+h+" a las "+p+":"+f:c<24&&(c<1?v<59&&(_=this.str("Hace")+" "+v+" "+this.str("minutos")):_=this.str("Hace")+" "+c+" "+this.str("horas")+" "+this.str("y")+" "+v+" "+this.str("minutos"))),x.dateInFormat=_,x},diffEntreFechas:function(e,t){null==t&&(t=this.getDateHour());var n=new Date(e.substr(0,10)),o=(new Date(t.substr(0,10)).getTime()-n.getTime()+864e5)/864e5;return o-=1},dataOfDate:function(e){var t;null==e&&(e=getDateHour()),1==e.split(" ").length&&(e+=" 00:00:00"),t=e.split(" ")[0];var n=new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"),o=e;o=o.replace(/-/g,"/");var a=new Date(o),i={};i.fecha_sin_hora=t,i.fecha_completa=e,i.fecha_anio=a.getFullYear(),i.fecha_mes=a.getMonth()+1,i.fecha_mes_string=i.fecha_mes.toString(),1==i.fecha_mes_string.length&&(i.fecha_mes_string="0"+i.fecha_mes_string),i.fecha_mes_text=this.lettersArray(i.fecha_mes),i.fecha_dia=a.getDate(),i.fecha_dia_semana=a.getDay(),i.fecha_dia_text=n[a.getDay()];var s="SI",r="NO";return 6!=i.fecha_dia_semana&&0!=i.fecha_dia_semana||(s="NO"),0==i.fecha_dia_semana&&(r="SI"),i.fecha_dia_habil=s,i.fecha_dia_festivo=r,i.fecha=i.fecha_anio+"-"+i.fecha_mes+"-"+i.fecha_dia,i.hora_ex=a.getTime(),i.hora_horas=a.getHours(),i.hora_minutos=a.getMinutes(),i.hora_segundos=a.getSeconds(),i.hora_completa=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),i},str:function(e){return e},lettersArray:function(e){var t={1:"Enero",2:"Febrero",3:"Marzo",4:"Abril",5:"Mayo",6:"Junio",7:"Julio",8:"Agosto",9:"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"};return t[e.toString()]},getDateHour:function(){var e=new Date,t=(e.getMonth()+1).toString(),n=e.getDate().toString(),o=e.getHours().toString(),a=e.getMinutes().toString(),i=e.getSeconds().toString();return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==o.length&&(o="0"+o),1==a.length&&(a="0"+a),1==i.length&&(i="0"+i),e.getFullYear()+"-"+t+"-"+n+" "+o+":"+a+":"+i},getFullDate:function(){return this.getDate()+" "+this.getHour()},getDate:function(){var e=new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"),t=new Array("Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"),n=new Date;return t[n.getDay()]+", "+n.getDate()+" de "+e[n.getMonth()]+" de "+n.getFullYear()},getHour:function(){var e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},addClass:function(e,t){if(e)if(e.classList)e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&setClass(e,(n+t).trim())}},removeClass:function(e,t,n){var o=null;!0===n?(o=e).classList.remove(t):o=document.querySelectorAll(e);for(var a=o.length,i=0;i<a;i++){o[i].classList.remove(t)}},botInit:function(){var e=this;if(e.form.addEventListener("submit",function(){var t=document.querySelectorAll(".message--mine"),n=t[t.length-1].querySelector(".message__bubble"),o=e.botSearchResponse(n.innerHTML);o===e.botResponseNoFound&&void 0!==e.botInResponse&&(o=e.botSearchResponse(!1,parseInt(e.botInResponse))),!1!==o&&e.botSend(o)}),!1===e.loadHistory){var t=e.botSearchResponse(!1,0);!1!==t&&e.botSend(t,0)}},botSend:function(e,t){var n=this;if(!n.bot)return!1;setTimeout(function(){n.createWritten(n.heName,5e3)},1e3),void 0===t&&(t=3e3),setTimeout(function(){var t=e;n.sendMessage(t,"messageReceived"),n.addMessage(t,!1,!0,!1,n.heName,"SI"),n.scrollBottomMessages(),n.cleanWritten()},t)},keyw:!1,searchText:!1,botSearchResponse:function(e,t){this.searchText=e;var n=this.botDataMsg(),o=this.botResponseNoFound;if("iniciar_chat"===e)return this.botResponseWaiting;if("iniciar_videollamada"===e)return this.botResponseWaiting;if("iniciar_audiollamada"===e)return this.botResponseWaiting;for(var a=0;a<n.length;a++)for(var i=n[a],s=i.response,r=i.keywords,l=i.options,c=i.in_response,d=r.split(","),u=0;u<d.length;u++){var m=d[u];if(!1!==e&&-1!==e.indexOf(m)||t===a){if(o=s,this.keyw=r,void 0!==c&&(this.botInResponse=c),void 0!==l)for(var h=0;h<l.length;h++){var g=l[h];o+="<button class='buttonBot' data-response='"+g.response+"' onclick='sendMsgBotButton(this)'>"+g.text+"</button>"}break}}return o===this.botLastMsg?this.botSearchResponse("en_que_ayudo"):(this.botLastMsg=o,o)},botDataMsg:function(){var e=[];return 0===e.length&&(e=this.botDataMsgDefault()),e},botDataMsgDefault:function(){var e=[];return e.push({response:"¡Hola!",keywords:"inicio",in_response:"1"},{response:this.getSaludoBotPredeterminate,keywords:"en_que_ayudo",in_response:"2"},{response:this.getNameBotPredeterminate,keywords:"nombre",in_response:"3"},{response:this.getEmailBotPredeterminate,keywords:"correo",in_response:"4"},{response:this.getPhoneBotPredeterminate,keywords:"correo",in_response:"7"},{response:"Si no tienes correo, ¿me puedes dar tu número de celular?",keywords:"no tengo correo",in_response:"7"},{response:"No tienes celular, entiendo",keywords:"no tengo celular",in_response:"7"},{response:"iniciar_chat",keywords:"iniciar_chat"}),e},setTerminalKey:function(){var e;if((e=this.nameConference.split("ringow_")).length>1){var t=e[1].split("_");this.id_call=t[0],this.terminal=t[1],this.apikey=t[2]}if((e=this.nameConference.split("userchat_")).length>1){t=e[1].split("_");this.terminal=t[1],this.tipoChat="CHAT_INTERNO"}},validateIfUseServer:function(){return!!this.useServer},sendEmailCallEnded:function(){var e=this;if(!e.validateIfUseServer())return!1;var t="id_enc="+e.id_call;t+="&terminal="+e.terminal,t+="&href="+e.domainVisitor,t+="&domain="+e.domainVisitor;var n=new XMLHttpRequest;n.onload=function(){var t=JSON.parse(this.responseText);e.debug&&console.log("sendEmailCallEnded",t),e.bot=!1,clearInterval(e.IntervalisCallingRingow),e.createWritten(e.heName,3e3),setTimeout(function(){e.addMessage("Gracias por escribirnos. Hemos recibido su mensaje y en breve será contactado."),e.othersButtons.style.display="flex",e.btnCallAgain.style.display="none",e.form.style.visibility="hidden"},3e3)},n.onerror=function(e){console.log("Fetch Error :-S",e)},n.open("POST",e.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/sendEmailCallEnded.php",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t)},searchCallEnded:function(){var e=this;if(!e.validateIfUseServer())return!1;var t="id="+e.id_call;var n=new XMLHttpRequest;n.onload=function(){var t=JSON.parse(this.responseText);e.debug&&console.log("searchCallEnded",t),"LLAMADA_PERDIDA"===t?(e.bot=!1,clearInterval(e.IntervalisCallingRingow),e.createWritten(e.heName,3e3),setTimeout(function(){e.addMessage("La llamada no pudo ser atendida. ¿Qué deseas hacer? "),e.othersButtons.style.display="flex",e.form.style.visibility="hidden"},3e3)):(e.createWritten(e.heName,3e3),setTimeout(function(){e.debug&&console.log("self.numberCallingRingow",e.numberCallingRingow);var t="En este momento nuestros asesores se encuentran ocupados, en un momento serás atendid@",n="Te agradecemos que sigas en línea.",o=t;0===e.numberCallingRingow?o=t:1===e.numberCallingRingow?o=n:2===e.numberCallingRingow?o="Seguimos buscando asesores disponibles, por favor espera.":3===e.numberCallingRingow?o="Al parecer, seguimos un poco ocupados, espera por favor.":(o=n,e.numberCallingRingow=0),e.addMessage(o),e.numberCallingRingow++},3e3))},n.onerror=function(e){console.log("Fetch Error :-S",e)},n.open("POST",e.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/searchCallEnded.php",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t)},artiveSearchCallEnded:function(){var e=this;if(!e.validateIfUseServer())return!1;e.isCallingRingow=!0,e.numberCallingRingow=0,e.IntervalisCallingRingow=setInterval(function(){e.searchCallEnded()},1e4)},readMsgCall:function(e,t){if(!this.validateIfUseServer())return!1;var n="room="+this.nameConference;n+="&myUser="+this.myUser,n+="&usuario="+e,n+="&type="+t,n+="&isOperatorRingow="+this.isOperatorRingow;var o=new XMLHttpRequest;o.onload=function(){JSON.parse(this.responseText)},o.onerror=function(e){console.log("Fetch Error :-S",e)},o.open("POST",this.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/readMsgCall.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(n)},getTokensNotifyPush:function(e){var t=this;if(!t.validateIfUseServer())return!1;if("false"!==t.isOperatorRingow)return!1;if(t.tokens.length>0)return!1;var n="";n+="usuario="+e;var o=new XMLHttpRequest;o.onload=function(){var e=this.responseText;t.debug&&console.log(e);var n=JSON.parse(e);if("NO_FOUND"===n)return!1;t.tokens=n,t.debug&&console.log(t.tokens)},o.onerror=function(e){console.log("Fetch Error :-S",e)},o.open("POST",t.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/getTokensNotifyPush.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(n)},changeStatusCall:function(e,t){var n=this;if(!n.validateIfUseServer())return!1;var o="room="+n.nameConference;if(o+="&nombre="+n.myName,o+="&correo="+n.myUser,o+="&celular="+n.myCelular,o+="&estado="+e,o+="&tipo="+t,o+="&isOperatorRingow="+n.isOperatorRingow,null!==n.terminal&&(o+="&terminal="+n.terminal),null!==n.terminal&&(o+="&terminal="+n.terminal),null===n.id_call)return alert("No existe el ID de encabezado"),!1;o+="&id="+n.id_call;var a=new XMLHttpRequest;a.onload=function(){var t=JSON.parse(this.responseText);n.debug&&console.log("changeStatusCall",t),"OK"!==t?(n.createWritten(n.heName,6e3),"ASESORES_NO_DISPONIBLES"===t.type&&(n.sendEmailCallEnded(),n.bot=!1)):"LLAMANDO"===e&&!1===n.isCallingRingow&&n.artiveSearchCallEnded()},a.onerror=function(e){console.log("Fetch Error :-S",e)},a.open("POST",n.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/changeStatusCall.php",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(o)},saveOrUpdate:function(e){var t=this;if(!t.validateIfUseServer())return!1;var n="room="+t.nameConference;null!==t.id_call&&(n+="&id="+t.id_call),null!==t.terminal&&(n+="&terminal="+t.terminal),n+="&limit="+t.limitLoadMessages,n+="&myUser="+t.myUser,n+="&myName="+t.myName,n+="&heUser="+t.heUser,n+="&domain="+t.domainVisitor,n+="&origin="+t.urlVisitor,n+="&tipo="+t.tipoChat,n+="&isOperatorRingow="+t.isOperatorRingow,!1!==t.id_session_call&&(n+="&id_session="+t.id_session_call);var o=new XMLHttpRequest;o.onload=function(){var n=JSON.parse(this.responseText);t.debug&&console.log("saveOrUpdate",n);var o=n.dataEnc;"EN LINEA"!==o.estado&&"LLAMANDO"!==o.estado||(t.bot=!1);var a=n.msg,i={tipo:"startCallRingow"};return window.parent.postMessage(i,"*"),t.debug&&console.log("self.tokens",t.tokens),void 0!==n.tokens&&t.tokens.length<=0&&(t.tokens=n.tokens),null!=a&&!1!==a&&""!==a&&a.sort(function(e,t){return+(e.fecha>t.fecha)||+(e.fecha===t.fecha)-1}),e(a)},o.onerror=function(t){return console.log("Fetch Error :-S",t),e(!1)},o.open("POST",t.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/saveOrUpdate.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(n)},saveMsgSrv:function(e,t){var n=this;if(!n.validateIfUseServer())return!1;var o=n.myName;!1!==n.myUser&&(o=n.myUser),void 0!==t&&(o=t);var a="NO";n.bot&&(a="SI");var i=e;i=n.renderHTML(i,!0);var s="room="+n.nameConference;s+="&texto="+i,s+="&isOperatorRingow="+n.isOperatorRingow,s+="&useForRingow="+n.useForRingow,s+="&myUser="+o,s+="&myName="+n.myName,s+="&myPhoto="+n.myPhoto,!1!==n.heUser?s+="&heUser="+n.heUser:!1!==n.heName&&""!==n.heName&&(s+="&heUser="+n.heName),s+="&visto="+a,null!==n.terminal&&(s+="&terminal="+n.terminal),null!==n.id_call&&(s+="&visitante="+n.id_call);var r=new XMLHttpRequest;r.onload=function(){if(void 0!==n.tokens&&n.tokens.length>0)for(var t=0;t<n.tokens.length;t++){var a=n.tokens[t];n.sendNotificacion({title:n.myName,body:e,icon:"fcm_push_icon",sound:"default",data:"main.openChatPush('"+o+"', '"+n.myName+"', '"+e+"', '"+n.myPhoto+"', '"+n.id_call+"')",callback:"FCM_PLUGIN_ACTIVITY",to:a.json},function(e){n.debug&&console.log("Notify send OK to "+a.json+"! "+e)})}},r.onerror=function(e){console.log("Fetch Error :-S",e)},r.open("POST",n.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/saveMsgSrv.php",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(s)},sendNotificacion:function(e,t){var n=this,o=e.to,a={title:e.title,body:e.body,sound:e.sound,icon:e.icon,click_action:e.callback,priority:"high",content_available:!0,show_in_foreground:!0};fetch("https://fcm.googleapis.com/fcm/send",{method:"POST",content_available:!0,headers:{Authorization:"key=AIzaSyCOoH2AZXucFRnHljZOQxQC8PPwtuIqIss","Content-Type":"application/json"},body:JSON.stringify({notification:a,show_in_foreground:!0,content_available:!0,priority:"high",to:o,data:{data:e.data,callback:e.callback.toString(),title:e.title,body:e.body}})}).then(function(e){n.debug&&console.log(e),n.evalueData(t)&&t(e)}).catch(function(e){console.error(e)})},getconfig:function(e){if(!this.validateIfUseServer())return!1;var t="";t+="terminal="+this.terminal,t+="&apikey="+this.apikey,t+="&domain="+this.domainVisitor,t+="&origin="+this.urlVisitor,t+="&country="+this.dataIP.country_name,t+="&city="+this.dataIP.city,t+="&lang="+this.dataIP.languages;var n=new XMLHttpRequest;n.onload=function(){var t=JSON.parse(this.responseText);return e(t)},n.onerror=function(t){return e("Fetch Error :-S",t)},n.open("POST",this.domain+"/app/nwchat/js/config.php",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t)},translateText:function(e,t,n,o){var a=this;if(!a.validateIfUseServer())return!1;var i="";i+="text="+e,i+="&langOrigin="+t,i+="&langTranslate="+n;var s=new XMLHttpRequest;s.onload=function(){a.debug&&console.log(this.responseText);var e=JSON.parse(this.responseText);return o(e)},s.onerror=function(e){return o("Fetch Error :-S",e)},s.open("POST",a.domain+"/nwlib6/nwproject/modules/webrtc/v2/rpc/translateText.php",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(i)},evalueData:function(e,t){return void 0!==e&&(!(!this.evalueData(t)||e!=t)||null!=e&&(null!=e&&("null"!=e&&(0!=e&&""!=e))))},addCssRingow:function(){var e="",t="";this.haveOptions&&(e+=".contentChat ::-webkit-scrollbar-thumb{-webkit-border-radius:10px;-moz-border-radius:10px;-o-border-radius:10px;-moz-osx-border-radius:10px;-ms-border-radius:10px;border-radius:10px;-webkit-box-shadow:inset 0 -6px 0 0 #fff,inset 0 6px 0 0 #fff;-moz-box-shadow:inset 0 -6px 0 0 #fff,inset 0 6px 0 0 #fff;-o-box-shadow:inset 0 -6px 0 0 #fff,inset 0 6px 0 0 #fff;-moz-osx-box-shadow:inset 0 -6px 0 0 #fff,inset 0 6px 0 0 #fff;-ms-box-shadow:inset 0 -6px 0 0 #fff,inset 0 6px 0 0 #fff;box-shadow:inset 0 -6px 0 0 #fff,inset 0 6px 0 0 #fff;background-color:rgba(209,209,209,.97)}.contentChat ::-webkit-scrollbar{width:8px;background-color:#fff}.contentChat{box-shadow:0 0 10px 2px rgba(0,0,0,.16);border-radius:10px;height:100vh;max-height:100%;width:100vw;max-width:100%;display:flex;flex-direction:column;background-color:#fff;background-color:#f9f9f9;overflow:hidden;margin:auto}.contentChat .messages{flex-grow:1;padding:20px 30px;overflow:auto;position:relative}.contentChat .message{display:flex;flex-direction:column;margin:10px 0 5px 0}.contentChat .message--mine{align-items:flex-end}.contentChat .message--theirs{align-items:flex-start}.contentChat .message__name{padding:10px 0;padding:10px 0 0 0;color:#919090;font-size:12px;word-break:break-word;font-weight:700}.message__see{position:relative;color:#929292;font-size:11px;font-size:9px}.contentChat .message__fecha{font-size:10px;padding:0 0 5px 0;color:#919090;word-break:break-word}.message--mine .message__name{text-align:right}.contentChat .message__bubble{padding:10px;border-radius:3px;word-break:break-word}.g_translate{cursor: pointer;margin: 0px 5px 0px 0px;width: 15px;opacity: 0.5;}.g_translate:hover{opacity: 1;}.contentChat .message--theirs .message__bubble{display: flex;align-items: center;background:#6363bf;color:#fff;background-color:#e6ecf0;color:#50565d;-webkit-border-radius:5px 5px 5px 0;-moz-border-radius:5px 5px 5px 0;-o-border-radius:5px 5px 5px 0;-moz-osx-border-radius:5px 5px 5px 0;-ms-border-radius:5px 5px 5px 0;border-radius:5px 5px 5px 0}.contentChat .message--mine .message__bubble{background-color:#1f8ceb;color:#fff;-webkit-border-radius:5px 5px 0 5px;-moz-border-radius:5px 5px 0 5px;-o-border-radius:5px 5px 0 5px;-moz-osx-border-radius:5px 5px 0 5px;-ms-border-radius:5px 5px 0 5px;border-radius:5px 5px 0 5px}.contentChat .footerChat{position:relative;line-height:76px;border-top:1px solid rgba(156,172,172,.2);border-bottom:1px solid rgba(156,172,172,.2);display:flex;flex-shrink:0;-webkit-box-shadow:0 0 18px rgba(0,0,0,.1);-moz-box-shadow:0 0 18px rgba(0,0,0,.1);-o-box-shadow:0 0 18px rgba(0,0,0,.1);-moz-osx-box-shadow:0 0 18px rgba(0,0,0,.1);-ms-box-shadow:0 0 18px rgba(0,0,0,.1);box-shadow:0 0 18px rgba(0,0,0,.1);background-color:#fff}.contentChat input{height:76px;border:none;flex-grow:1;padding:0 30px;font-size:16px;background:0 0}.contentChat button{border:none;background:0 0;padding:0 30px;font-size:16px;cursor:pointer}.containerChat_maximice{max-width:100%;height:100%;-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none}.isWritten{position:relative;color:#878686;margin:0;padding:0;display:block;bottom:0;height:0;top:-40px;pointer-events:none}.isWritten img{height:56px;position:relative}.isWritten span{display:inline-block;top:-5px;position:relative;margin:0 3px}body .loadMoreMessages{margin:auto}body .NoMoreMessages{margin:auto;text-align:center}.speak_mic_cancel{position:relative;font-size:15px;display:flex;align-items:center;margin:20px auto 0 auto;width:max-content;padding:5px 15px;border-radius:5px;background-color:#3ea9e9;color:#fff;cursor:pointer}.imgSpeach{display:flex;align-items:center;border-left:1px solid #efefef;border-right:1px solid #efefef;padding:0 7px;cursor:pointer}@media screen and (max-width:900px){.imgSpeach{padding: 0 3px;}.contentChat input{padding:0 30px;height:45px;font-size:14px}.footerChat button{padding:0 3px;font-size:10px}.footerChat .material-icons{font-size:21px;color:#919090}.contentChat{margin:0;max-width:100%;max-height:100%;border-radius:0}}",t+=".containWebRtcNw .clear{clear:both}.containWebRtcNw{margin:0;padding:0;font-family:arial;vertical-align:baseline;font-size:13px;position:fixed;overflow:hidden;top:0;left:0;width:100%;height:100%}.contain_me,.containerChat,.contenedor{-webkit-transition:all .5s ease;-moz-transition:all .5s ease;-o-transition:all .5s ease;transition:all .5s ease}.containWebRtcNw button{padding:9px 13px;margin:2px 2px;border-radius:2px;background-color:#fff;border:0;font-size:1.3em}.containerButtonJoin{position:absolute;z-index:3;text-align:center;width:100%;padding:10px;box-sizing:border-box;color:#fff;text-shadow:0 0 5px #000}.containerButtonJoin p{font-size:2em}.contenedorMain{width:100%;height:100%;position:absolute;background-color:#1e1e1e}.contain_me{position:absolute;top:0;left:0;max-height:250px;max-width:250px;z-index:1}.contain_me_alone{width:100%;height:100%;max-width:100%;max-height:100%}#localVideo{position:relative;height:100%;width:100%;object-fit:contain;object-position:center}.contenedor{position:relative;width:100%;height:100%;display:inline-block}.contenedor video{position:relative;min-width:100%;min-height:100%;max-width:100%;max-height:100%;width:auto;height:max-content;object-fit:contain;object-position:center}#remotes{position:fixed;width:100%;height:100%;top:0;left:0;text-align:center;display:none}.containerButtons{position:absolute;position:relative;bottom:0;left:0;width:100%;text-align:center;z-index:2;display:none}.containerButtonVolver{position:relative;text-align:center;color:#fff;background-color:#2d2c2c;height:100%;padding:0;margin:0;position:fixed;top:0;left:0;width:100%}.volver_a_llamar{font-size:1.5em}.containerChat{position:absolute;z-index:3;bottom:0;right:0;height:100%;bottom:-100%;max-width:400px}.containerChatVisible{bottom:0}.containerChat iframe{position:relative;width:100%;height:100%;border:0}.encChat{position:relative;top:0;z-index:1;background-color:#1f8ceb;box-sizing:border-box;width:100%;min-height:55px;height:auto;color:#fff;border-top-left-radius:10px;border-top-right-radius:10px;-webkit-box-shadow:0 0 18px rgba(0,0,0,.5);-moz-box-shadow:0 0 18px rgba(0,0,0,.5);-o-box-shadow:0 0 18px rgba(0,0,0,.5);-moz-osx-box-shadow:0 0 18px rgba(0,0,0,.5);-ms-box-shadow:0 0 18px rgba(0,0,0,.5);box-shadow:0 0 18px rgba(0,0,0,.5);display:flex;flex-wrap:wrap}.iconsEnc{cursor:pointer;float:right;position:relative;margin:5px 4px;font-size:28px;height:26px}.closeChat{position:absolute;top:0;right:0}.callEnc,.openChat,.videocallEnc{display:none}body .openChat{left:0;display:block;width:100%;height:100%;top:0;position:absolute;margin:0}.encPhoto{position:relative;width:50px;height:50px;float:left;border-radius:50%;margin:3px 4px;background-image:url(/nwlib6/nwproject/modules/nw_user_session/img/icon_user.png);background-size:cover;background-position:center;background-color:#fff}.encName,.myName{position:relative;margin:11px 0 0 3px;max-width:50%;overflow:hidden;font-size:10px;font-weight:lighter;line-height:11px;white-space:pre-wrap;max-height:22px}.encName{display:block;font-size:13px;font-weight:700}.myName{min-width:100%}.terminar_before_container{position:fixed;top:0;left:0;width:100%;height:100%;max-height:calc(100% - 55px)}body .terminar_before{color:#fff;background-color:red;position:relative;margin:auto;top:40%;border-radius:50%;width:70px;height:70px;padding:0;cursor:pointer}body .terminar{color:#fff;background-color:red}.btn_conts{text-decoration:none;color:#fff;padding:5px 6px;display:block;border-radius:5px;margin:10px 0 0 0;cursor:pointer}.contestar_a{background-color:green}.rechazar_a{background-color:red}.btn_conts .material-icons{border-right:1px solid rgba(255,255,255,.42);padding-right:3px;margin-right:3px}.btn_conts span{display:inline-block;top:-6px;position:relative;left:0;font-weight:700}.callvioce_container{position:absolute;width:100%;text-align:center;background-color:#00cd30;margin:auto;left:0;top:25%}.btnvoice_active{position:relative;color:#fff;padding:5px}.contentChat .buttonBot{background-color:#2767c3;color:#fff;border:1px solid #3156c2;padding:6px 10px;display:block;margin:5px 0;border-radius:5px;cursor:pointer;position:relative}.callendedfoot{position:relative;text-align:center;width:100%;font-weight:700;font-size:16px;cursor:pointer}.hiddenButton{display:none!important}.encChatMinimiced{height:80px}.encChatMinimiced .encPhoto{height:50px;width:50px}.encStatus{position:absolute;top:0;left:0;width:20px;height:20px;background-color:#c3c3c3;z-index:1;border-radius:50%}.changeStatusActive{background-color:#00ff37}@media screen and (max-width:900px){.terminar_before_container{max-height:40%}.contenedorMain{max-height:calc(100% - 15px);max-width:calc(100% - 15px);background-color:#1e1e1e;margin:auto}.encChat_fix{position:fixed;height:32px;font-size:14px;max-width:calc(100% - 15px)}.encChat_fix .material-icons{font-size:20px}.contain_me{left:auto;right:0;max-height:120px;max-width:120px;top:31px}#remotes{max-height:calc(100% - 35px);top:33px}.contain_me_alone{max-width:100%;max-height:100%}.contenedorMainMiddle{height:50%!important}.containerChatMiddle{height:50%}.containerChat{max-width:100%}.containerButtons .button{font-size:11px;padding:5px 8px}.containerButtons .material-icons{font-size:20px}}.terminar_before .material-icons{font-size:32px}"),this.video&&(t+="#remotes, .containerButtons{display:block;}");var n,o="<style>";(o+=t,o+=e,o+="</style>",n=document.querySelector("ringow_contain_css_chat"))||((n=document.createElement("div")).className="ringow_contain_css_chat",n.innerHTML=o,document.body.appendChild(n))},createCanvasChat:function(){var e=document.createElement("div");return e.className="containerChat",e},califica:function(e){var t="";t+="id="+e.id_call,t+="&asesor="+e.asesor,t+="&usuario_califica="+e.usuario_califica,t+="&terminal="+e.terminal,t+="&calificacion="+e.calificacion,t+="&comentarios="+e.comentarios;var n=new XMLHttpRequest;n.onload=function(){console.log(this.responseText);var e=JSON.parse(this.responseText);alert(e)},n.onerror=function(e){alert(e)},n.open("POST",this.domain+"/app/nwchat/js/califica.php",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(t)},removeDictation:function(){var e=document.querySelector(".speak_mic");e&&e.remove()},startDictation:function(e){var t=this;if(!("webkitSpeechRecognition"in window))return alert("¡API no soportada!"),!1;if(window.hasOwnProperty("webkitSpeechRecognition")){t.removeDictation();var n=!1;"SI"===(o=window.localStorage.getItem(t.nameConference+"send_auto_voice_text"))?n=!0:"NO"===o&&(n=!1);var o,a=!0;"SI"===(o=window.localStorage.getItem(t.nameConference+"select_voice_text_detener"))?a=!0:"NO"===o&&(a=!1);var i,s=new webkitSpeechRecognition;!0===a?(s.continuous=!1,s.interimResults=!1):(s.continuous=!0,s.interimResults=!0),s.lang="es-COL",s.start(),s.onstart=function(){},s.onresult=function(n){if(!0===a)document.querySelector(e).value=n.results[0][0].transcript,s.stop(),t.removeDictation();else for(var o=n.resultIndex;o<n.results.length;o++)n.results[o].isFinal&&(document.querySelector(e).value+=n.results[o][0].transcript)},s.onerror=function(e){s.stop(),t.removeDictation()},s.onend=function(){s.stop(),t.removeDictation(),!0===n&&document.querySelector(".btnsubmit").click()},(i=document.createElement("div")).innerHTML="<div class='speak_mic_int' style='position: relative;margin: auto;background-color: #fff;padding: 15px 40px;border-radius: 5px;font-size: 25px;'><img src='"+t.domain+"/nwlib6/nwproject/modules/webrtc/v2/icons/mic.svg' /> Escuchando...</div>",i.className="speak_mic",i.style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: 100000000000;background-color: rgba(0, 0, 0, 0.43);display: flex!important;align-items: center;",document.querySelector(".containerChat").appendChild(i),(i=document.createElement("div")).className="speak_mic_cancel",i.innerHTML="<img src='"+t.domain+"/nwlib6/nwproject/modules/webrtc/v2/icons/stop_blanco.png' /> Detener</div>",i.onclick=function(){s.stop(),t.removeDictation()},document.querySelector(".speak_mic_int").appendChild(i)}}};function sendMsgBotButton(e){sendMsgAuto(e.getAttribute("data-response"))}function sendMsgAuto(e,t){document.querySelector(".messageBox").value=e,document.querySelector(".messageBox").focus(),!0!==t&&document.querySelector(".btnsubmit").click()}function sendMsgInterval(e,t){document.querySelector(".messageBox")?sendMsgAuto(e,t):setTimeout(function(){sendMsgInterval(e,t)},1e3)}window.addEventListener("message",function(e){if(void 0!==e.data){var t=e.data;if("add_css_ringow"===t.tipo){var n,o=document.createElement("div");if(o.innerHTML="<style>"+t.message+"</style>",!(n=document.querySelector("ringow_contain_css_chat")))(n=document.createElement("div")).className="ringow_contain_css_chat",document.body.appendChild(n);n.appendChild(o)}else"input_message_ringow"===t.tipo?sendMsgInterval(t.message,!0):"send_message_ringow"===t.tipo?sendMsgInterval(t.message):"openRingow"===t.tipo&&webrtcNw.showChat()}});
//res
var serverSocket="https://sandbox.simplewebrtc.com:443/";function getConfigWrpc(){var e=[];return!!navigator.mozGetUserMedia?(e.push({url:"stun:23.21.150.121"}),e.push({url:"stun:stun.services.mozilla.com"})):(e.push({url:"stun:stun.l.google.com:19302"}),e.push({url:"stun:stun.anyfirewall.com:3478"})),e.push({url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}),e.push({url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}),e.push({url:"turn:turn.bistri.com:80",username:"homeo",credential:"homeo"}),e.push({url:"stun:stun.l.google.com:19302"}),e.push({url:"stun:stun1.l.google.com:19302"}),e.push({url:"stun:stun2.l.google.com:19302"}),e.push({url:"stun:stu3.l.google.com:19302"}),e.push({url:"stun:stun4.l.google.com:19302"}),e.push({url:"stun:stun.ekiga.net"}),e.push({url:"stun:stun.ideasip.com"}),e.push({url:"stun:stun.iptel.org"}),e.push({url:"stun:stun.rixtelecom.se"}),e.push({url:"stun:stun.schlund.de"}),e.push({url:"stun:stunserver.org"}),e.push({url:"stun:stun.softjoys.com"}),e.push({url:"stun:stun.voiparound.com"}),e.push({url:"stun:stun.voipbuster.com"}),e.push({url:"stun:stun.voipstunt.com"}),e.push({url:"stun:stun.stunprotocol.org:3478"}),e.push({url:"stun:stun.services.mozilla.com"}),e.push({url:"stun:stun.sipgate.net"}),e.push({url:"turn:numb.viagenie.ca:3478",username:"assdres@gmail.com",credential:"padre08"}),{iceServers:e}}!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SimpleWebRTC=e()}}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){var n=t[a][1][e];return i(n||e)},p,p.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){function r(){}t.exports=function(e,t,n){var i=!1;return n=n||r,o.count=e,0===e?t():o;function o(e,r){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=n):0!==o.count||i||t(null,r)}}},{}],2:[function(e,t,n){t.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),a=t,s=0;a<n;a++,s++)o[s]=i[a];return o.buffer}},{}],3:[function(e,t,n){e("webrtc-adapter");t.exports=function(e,t,n){window.URL;var r,i=t,o={autoplay:!0,mirror:!1,muted:!1,audio:!1,disableContextMenu:!1};if(n)for(r in n)o[r]=n[r];return i?"audio"===i.tagName.toLowerCase()&&(o.audio=!0):i=document.createElement(o.audio?"audio":"video"),o.disableContextMenu&&(i.oncontextmenu=function(e){e.preventDefault()}),o.autoplay&&(i.autoplay="autoplay"),o.muted&&(i.muted=!0),!o.audio&&o.mirror&&["","moz","webkit","o","ms"].forEach(function(e){var t=e?e+"Transform":"transform";i.style[t]="scaleX(-1)"}),i.srcObject=e,i}},{"webrtc-adapter":4}],4:[function(e,t,n){"use strict";!function(){var n=e("./utils").log,r=e("./utils").browserDetails;t.exports.browserDetails=r,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var i=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),t.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimPeerConnection();break;case"safari":if(!s)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),t.exports.browserShim=s,s.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},{"./chrome/chrome_shim":5,"./edge/edge_shim":7,"./firefox/firefox_shim":9,"./safari/safari_shim":11,"./utils":12}],5:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=getConfigWrpc(),i=new webkitRTCPeerConnection(n,t),o=i.getStats.bind(i);return i.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){return o.apply(this,[function(e){i[1](s(a(e)))},arguments[0]])}return new Promise(function(t,n){1===i.length&&"object"==typeof e?o.apply(r,[function(e){t(s(a(e)))},n]):o.apply(r,[function(e){t(s(a(e),e.result()))},n])}).then(t,n)},i},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":12,"./getusermedia":6}],6:[function(e,t,n){"use strict";var r=e("../utils.js").log;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),(o={})[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if((t=JSON.parse(JSON.stringify(t)))&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var i=t.video.facingMode;if((i=i&&("object"==typeof i?i:{ideal:i}))&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then(function(o){var a=(o=o.filter(function(e){return"videoinput"===e.kind})).find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||o.length&&o[o.length-1];return a&&(t.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)});t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};var i=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return o(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return i(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":12}],7:[function(e,t,n){"use strict";var r=e("sdp"),i=e("../utils").browserDetails,o={shimPeerConnection:function(){if(window.RTCIceGatherer){window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e});var e=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(t){e.set.call(this,t);var n=new Event("enabled");n.enabled=t,this.dispatchEvent(n)}})}window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var r=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=r.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),!!(t=t.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")||0===e.indexOf("stun:")&&i.version>=14393})[0])}return!1})}this._config=e,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(!n.candidate||0===Object.keys(n.candidate).length)for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");else-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");(e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState)||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(e){var t=e.clone();e.getTracks().forEach(function(e,n){var r=t.getTracks()[n];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),this.localStreams.push(t),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate){i.numChannels=Math.min(e.numChannels,i.numChannels),n.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(t){for(var n=0;n<e.rtcpFeedback.length;n++)if(e.rtcpFeedback[n].type===t.type&&e.rtcpFeedback[n].parameter===t.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,i=new RTCIceGatherer(n.iceOptions),o=new RTCIceTransport(i);i.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=a.candidate,u=!c||0===Object.keys(c).length;u?(void 0===i.state&&(i.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===o.component?2:1,s.candidate.candidate=r.writeCandidate(c));var p=r.splitSections(n.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?p[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":p[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",n.localDescription.sdp=p.join("");var d=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(s),u&&d&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s),d&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete")}},o.onicestatechange=function(){n._updateConnectionState()};var a=new RTCDtlsTransport(o);return a.ondtlsstatechange=function(){n._updateConnectionState()},a.onerror=function(){a.state="failed",n._updateConnectionState()},{iceGatherer:i,iceTransport:o,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:r.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,i=this;if("offer"===e.type)this._pendingOffer&&(t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var o=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],s=a.iceGatherer,c=a.iceTransport,u=a.dtlsTransport,p=a.localCapabilities,d=a.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])&&!a.isDatachannel){var f=r.getIceParameters(e,n);if(o){var l=r.matchPrefix(e,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});l.length&&c.setRemoteCandidates(l)}var h=r.getDtlsParameters(e,n);o&&(h.role="server"),i.usingBundle&&0!==t||(c.start(s,f,o?"controlling":"controlled"),u.start(h));var m=i._getCommonCapabilities(p,d);i._transceive(a,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout(function(){s(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){a||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,i=[],o=r.splitSections(e.sdp),a=o.shift(),s=r.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=r.matchPrefix(a,"a=group:BUNDLE ").length>0,o.forEach(function(o,c){var u=r.splitLines(o)[0].substr(2).split(" "),p=u[0],d="0"===u[1],f=r.getDirection(o,a),l=r.matchPrefix(o,"a=mid:");if(l=l.length?l[0].substr(6):r.generateIdentifier(),"application"!==p||"DTLS/SCTP"!==u[2]){var h,m,g,v,y,b,w,S,C,k,E,T,x,P=r.parseRtpParameters(o);d||(E=r.getIceParameters(o,a),(T=r.getDtlsParameters(o,a)).role="client"),S=r.parseRtpEncodingParameters(o);var R=r.matchPrefix(o,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];R&&(x=R.value);var O=r.matchPrefix(o,"a=end-of-candidates",a).length>0,_=r.matchPrefix(o,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||d)"answer"!==e.type||d||(m=(h=t.transceivers[c]).iceGatherer,g=h.iceTransport,v=h.dtlsTransport,y=h.rtpSender,b=h.rtpReceiver,w=h.sendEncodingParameters,C=h.localCapabilities,t.transceivers[c].recvEncodingParameters=S,t.transceivers[c].remoteCapabilities=P,t.transceivers[c].cname=x,(s||O)&&_.length&&g.setRemoteCandidates(_),t.usingBundle&&0!==c||(g.start(m,E,"controlling"),v.start(T)),t._transceive(h,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f),!b||"sendrecv"!==f&&"sendonly"!==f?delete h.rtpReceiver:(k=b.track,i.push([k,b]),n.addTrack(k)));else{var D,j=t.usingBundle&&c>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(l,c);if(O&&j.iceTransport.setRemoteCandidates(_),(C=RTCRtpReceiver.getCapabilities(p)).codecs=C.codecs.filter(function(e){return"rtx"!==e.name}),w=[{ssrc:1001*(2*c+2)}],k=(b=new RTCRtpReceiver(j.dtlsTransport,p)).track,i.push([k,b]),n.addTrack(k),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=c)"audio"===p?D=t.localStreams[0].getAudioTracks()[0]:"video"===p&&(D=t.localStreams[0].getVideoTracks()[0]),D&&(y=new RTCRtpSender(D,j.dtlsTransport));t.transceivers[c]={iceGatherer:j.iceGatherer,iceTransport:j.iceTransport,dtlsTransport:j.dtlsTransport,localCapabilities:C,remoteCapabilities:P,rtpSender:y,rtpReceiver:b,kind:p,mid:l,cname:x,sendEncodingParameters:w,recvEncodingParameters:S},t._transceive(t.transceivers[c],!1,"sendrecv"===f||"sendonly"===f)}}else t.transceivers[c]={mid:l,isDatachannel:!0}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),i.forEach(function(r){var i=r[0],o=r[1],a=new Event("track");a.track=i,a.receiver=o,a.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(a)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},window.RTCPeerConnection.prototype.createOffer=function(){var e,t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var n=[],i=0,o=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(i=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(o=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:o>0}),"audio"===e.kind?i--:"video"===e.kind&&o--});i>0||o>0;)i>0&&(n.push({kind:"audio",wantReceive:!0}),i--),o>0&&(n.push({kind:"video",wantReceive:!0}),o--);var a=r.writeSessionBoilerplate(),s=[];n.forEach(function(e,n){var i,o,a=e.track,c=e.kind,u=r.generateIdentifier(),p=t.usingBundle&&n>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:t._createIceAndDtlsTransports(u,n),d=RTCRtpSender.getCapabilities(c);d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name}),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var f=[{ssrc:1001*(2*n+1)}];a&&(i=new RTCRtpSender(a,p.dtlsTransport)),e.wantReceive&&(o=new RTCRtpReceiver(p.dtlsTransport,c)),s[n]={iceGatherer:p.iceGatherer,iceTransport:p.iceTransport,dtlsTransport:p.dtlsTransport,localCapabilities:d,remoteCapabilities:null,rtpSender:i,rtpReceiver:o,kind:c,mid:u,sendEncodingParameters:f,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),n.forEach(function(e,n){var i=s[n];a+=r.writeMediaSection(i,i.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=r.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n){if(n.isDatachannel)t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n";else{var i=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=r.writeMediaSection(n,i,"answer",e.localStreams[0])}});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var i=this.transceivers[t];if(i){var o=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return;if("1"!==o.component)return;"endOfCandidates"===o.type&&(o={}),i.iceTransport.addRemoteCandidate(o);var a=r.splitSections(this.remoteDescription.sdp);a[t+1]+=(o.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}else this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){r.set(t,e[t]),r[t]=e[t]})}),t&&window.setTimeout(t,0,r),n(r)})})}}};t.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":12,"./getusermedia":8,sdp:59}],8:[function(e,t,n){"use strict";t.exports=function(){var e=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return e(t).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],9:[function(e,t,n){"use strict";var r=e("../utils").browserDetails,i={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(r.version<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),n.push(s)}else n.push(e.iceServers[i])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;if(RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},r.version<48){var t=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,n,r){return t.apply(this,[e||null]).then(function(e){return function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)}).then(n,r)}}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":12,"./getusermedia":10}],10:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,o){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){o(e(t))})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(e){return new Promise(function(n,r){t(e,n,r)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var n=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return n().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return o(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,r){if(i.version<44)return t(e,n,r);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,r)}}},{"../utils":12}],11:[function(e,t,n){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],12:[function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}],13:[function(e,t,n){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},{}],14:[function(e,t,n){!function(e){"use strict";n.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},n.decode=function(t){var n,r,i,o,a,s=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var p=new ArrayBuffer(s),d=new Uint8Array(p);for(n=0;n<c;n+=4)r=e.indexOf(t[n]),i=e.indexOf(t[n+1]),o=e.indexOf(t[n+2]),a=e.indexOf(t[n+3]),d[u++]=r<<2|i>>4,d[u++]=(15&i)<<4|o>>2,d[u++]=(3&o)<<6|63&a;return p}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],15:[function(e,t,n){(function(e){var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),o=n&&n.prototype.append&&n.prototype.getBlob;function a(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function s(e,t){t=t||{};var r=new n;a(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}function c(e,t){return a(e),new Blob(e,t||{})}t.exports=r?i?e.Blob:c:o?s:void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(e,t,n){var r=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},{}],17:[function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],18:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],19:[function(e,t,n){function r(e){return r.enabled(e)?function(t){var n;t=(n=t)instanceof Error?n.stack||n.message:n;var i=new Date,o=i-(r[e]||i);r[e]=i,t=e+" "+t+" +"+r.humanize(o),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}t.exports=r,r.names=[],r.skips=[],r.enable=function(e){try{localStorage.debug=e}catch(e){}for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)"-"===(e=t[i].replace("*",".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$"))},r.disable=function(){r.enable("")},r.humanize=function(e){return e>=36e5?(e/36e5).toFixed(1)+"h":e>=6e4?(e/6e4).toFixed(1)+"m":e>=1e3?(e/1e3|0)+"s":e+"ms"},r.enabled=function(e){for(var t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1};try{window.localStorage&&r.enable(localStorage.debug)}catch(e){}},{}],20:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":21}],21:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":22,"engine.io-parser":33}],22:[function(e,t,n){(function(n){var r=e("./transports"),i=e("component-emitter"),o=e("debug")("engine.io-client:socket"),a=e("indexof"),s=e("engine.io-parser"),c=e("parseuri"),u=e("parsejson"),p=e("parseqs");function d(e,t){if(!(this instanceof d))return new d(e,t);if(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e&&(e=c(e),t.host=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol,t.host){var r=t.host.split(":");t.hostname=r.shift(),r.length?t.port=r.pop():t.port||(t.port=this.secure?"443":"80")}this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=p.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized||null,this.open()}t.exports=d,d.priorWebsocketSuccess=!1,i(d.prototype),d.protocol=s.protocol,d.Socket=d,d.Transport=e("./transport"),d.transports=e("./transports"),d.parser=e("engine.io-parser"),d.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);return t.EIO=s.protocol,t.transport=e,this.id&&(t.sid=this.id),new r[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized})},d.prototype.open=function(){var e;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0==this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},d.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},d.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!n)if("pong"==i.type&&"probe"==i.data){if(o('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;d.priorWebsocketSuccess="websocket"==t.name,o('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!=r.readyState&&(o("changing transport and sending upgrade packet"),f(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{o('probe transport "%s" failed',e);var a=new Error("probe error");a.transport=t.name,r.emit("upgradeError",a)}}))}function a(){n||(n=!0,f(),t.close(),t=null)}function s(n){var i=new Error("probe error: "+n);i.transport=t.name,a(),o('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",i)}function c(){s("transport closed")}function u(){s("socket closed")}function p(e){t&&e.name!=t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),a())}function f(){t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",c),r.removeListener("close",u),r.removeListener("upgrading",p)}d.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",s),t.once("close",c),this.once("close",u),this.once("upgrading",p),t.open()},d.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},d.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},d.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},d.prototype.ping=function(){this.sendPacket("ping")},d.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(e,t){return this.sendPacket("message",e,t),this},d.prototype.sendPacket=function(e,t,n){if("closing"!=this.readyState&&"closed"!=this.readyState){var r={type:e,data:t};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()}},d.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var e=this;function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}return this},d.prototype.onError=function(e){o("socket error %j",e),d.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},d.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){o('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t)}},d.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~a(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":23,"./transports":24,"component-emitter":17,debug:30,"engine.io-parser":33,indexof:41,parsejson:49,parseqs:50,parseuri:32}],23:[function(e,t,n){var r=e("engine.io-parser"),i=e("component-emitter");function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized}t.exports=o,i(o.prototype),o.timestamps=0,o.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},o.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":17,"engine.io-parser":33}],24:[function(e,t,n){(function(t){var r=e("xmlhttprequest"),i=e("./polling-xhr"),o=e("./polling-jsonp"),a=e("./websocket");n.polling=function(e){var n=!1,a=!1,s=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,u=location.port;u||(u=c?443:80),n=e.hostname!=location.hostname||u!=e.port,a=e.secure!=c}if(e.xdomain=n,e.xscheme=a,"open"in new r(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new o(e)},n.websocket=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":25,"./polling-xhr":26,"./websocket":28,xmlhttprequest:29}],25:[function(e,t,n){(function(n){var r=e("./polling"),i=e("component-inherit");t.exports=u;var o,a=/\n/g,s=/\\n/g;function c(){}function u(e){r.call(this,e),this.query=this.query||{},o||(n.___eio||(n.___eio=[]),o=n.___eio),this.index=o.length;var t=this;o.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=c)},!1)}i(u,r),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},u.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},u.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function u(){p(),t()}function p(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),p(),e=e.replace(s,"\\\n"),this.area.value=e.replace(a,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==n.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":27,"component-inherit":18}],26:[function(e,t,n){(function(n){var r=e("xmlhttprequest"),i=e("./polling"),o=e("component-emitter"),a=e("component-inherit"),s=e("debug")("engine.io-client:polling-xhr");function c(){}function u(e){if(i.call(this,e),n.location){var t="https:"==location.protocol,r=location.port;r||(r=t?443:80),this.xd=e.hostname!=n.location.hostname||r!=e.port,this.xs=e.secure!=t}}function p(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=null!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.create()}function d(){for(var e in p.requests)p.requests.hasOwnProperty(e)&&p.requests[e].abort()}t.exports=u,t.exports.Request=p,a(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,new p(e)},u.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},u.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o(p.prototype),p.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new r(e),i=this;try{if(s("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async),this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0))},s("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}n.document&&(this.index=p.requestsCount++,p.requests[this.index]=this)},p.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},p.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},p.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},p.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}n.document&&delete p.requests[this.index],this.xhr=null}},p.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}e="application/octet-stream"===t?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},p.prototype.hasXDR=function(){return void 0!==n.XDomainRequest&&!this.xs&&this.enablesXDR},p.prototype.abort=function(){this.cleanup()},n.document&&(p.requestsCount=0,p.requests={},n.attachEvent?n.attachEvent("onunload",d):n.addEventListener&&n.addEventListener("beforeunload",d,!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":27,"component-emitter":17,"component-inherit":18,debug:30,xmlhttprequest:29}],27:[function(e,t,n){var r=e("../transport"),i=e("parseqs"),o=e("engine.io-parser"),a=e("component-inherit"),s=e("debug")("engine.io-client:polling");t.exports=u;var c=null!=new(e("xmlhttprequest"))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),r.call(this,e)}a(u,r),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function n(){s("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(s("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){s("pre-pause polling complete"),--r||n()})),this.writable||(s("we are currently writing - waiting to pause"),r++,this.once("drain",function(){s("pre-pause writing complete"),--r||n()}))}else n()},u.prototype.poll=function(){s("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;s("polling got data %s",e);o.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():s('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){s("writing close packet"),e.write([{type:"close"}])}"open"==this.readyState?(s("transport open - closing"),t()):(s("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};t=this;o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+new Date+"-"+r.timestamps++),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e}},{"../transport":23,"component-inherit":18,debug:30,"engine.io-parser":33,parseqs:50,xmlhttprequest:29}],28:[function(e,t,n){var r=e("../transport"),i=e("engine.io-parser"),o=e("parseqs"),a=e("component-inherit"),s=e("debug")("engine.io-client:websocket"),c=e("ws");function u(e){e&&e.forceBase64&&(this.supportsBinary=!1),r.call(this,e)}t.exports=u,a(u,r),u.prototype.name="websocket",u.prototype.supportsBinary=!0,u.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.ws=new c(e,void 0,t),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},u.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(u.prototype.onData=function(e){var t=this;setTimeout(function(){r.prototype.onData.call(t,e)},0)}),u.prototype.write=function(e){var t=this;this.writable=!1;for(var n=0,r=e.length;n<r;n++)i.encodePacket(e[n],this.supportsBinary,function(e){try{t.ws.send(e)}catch(e){s("websocket closed before onclose event")}});setTimeout(function(){t.writable=!0,t.emit("drain")},0)},u.prototype.onClose=function(){r.prototype.onClose.call(this)},u.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+new Date),this.supportsBinary||(e.b64=1),(e=o.encode(e)).length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e},u.prototype.check=function(){return!(!c||"__initialize"in c&&this.name===u.prototype.name)}},{"../transport":23,"component-inherit":18,debug:30,"engine.io-parser":33,parseqs:50,ws:76}],29:[function(e,t,n){var r=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(e){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":40}],30:[function(e,t,n){function r(){var e;try{e=localStorage.debug}catch(e){}return e}(n=t.exports=e("./debug")).log=function(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r),e},n.save=function(e){try{null==e?localStorage.removeItem("debug"):localStorage.debug=e}catch(e){}},n.load=r,n.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(r())},{"./debug":31}],31:[function(e,t,n){(n=t.exports=function(e){function t(){}function o(){var e=o,t=+new Date,a=t-(r||t);e.diff=a,e.prev=r,e.curr=t,r=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=n.colors[i++%n.colors.length]);var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;c++;var i=n.formatters[r];if("function"==typeof i){var o=s[c];t=i.call(e,o),s.splice(c,1),c--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s));var u=o.log||n.log||console.log.bind(console);u.apply(e,s)}t.enabled=!1,o.enabled=!0;var a=n.enabled(e)?o:t;return a.namespace=e,a}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var r,i=0},{ms:47}],32:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,n=e.indexOf("["),o=e.indexOf("]");-1!=n&&-1!=o&&(e=e.substring(0,n)+e.substring(n,o).replace(/:/g,";")+e.substring(o,e.length));for(var a=r.exec(e||""),s={},c=14;c--;)s[i[c]]=a[c]||"";return-1!=n&&-1!=o&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},{}],33:[function(e,t,n){(function(t){var r=e("./keys"),i=e("has-binary"),o=e("arraybuffer.slice"),a=e("base64-arraybuffer"),s=e("after"),c=e("utf8"),u=navigator.userAgent.match(/Android/i),p=/PhantomJS/i.test(navigator.userAgent),d=u||p;n.protocol=3;var f=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},l=r(f),h={type:"error",data:"parser error"},m=e("blob");function g(e,t,n){for(var r=new Array(e.length),i=s(e.length,n),o=function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})},a=0;a<e.length;a++)o(a,e[a],i)}n.encodePacket=function(e,r,i,o){"function"==typeof r&&(o=r,r=!1),"function"==typeof i&&(o=i,i=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&a instanceof ArrayBuffer)return function(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),a=new Uint8Array(1+i.byteLength);a[0]=f[e.type];for(var s=0;s<o.length;s++)a[s+1]=o[s];return r(a.buffer)}(e,r,o);if(m&&a instanceof t.Blob)return function(e,t,r){if(!t)return n.encodeBase64Packet(e,r);if(d)return function(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,n.encodePacket(e,t,!0,r)},i.readAsArrayBuffer(e.data)}(e,t,r);var i=new Uint8Array(1);i[0]=f[e.type];var o=new m([i.buffer,e.data]);return r(o)}(e,r,o);if(a&&a.base64)return function(e,t){var r="b"+n.packets[e.type]+e.data.data;return t(r)}(e,o);var s=f[e.type];return void 0!==e.data&&(s+=i?c.encode(String(e.data)):String(e.data)),o(""+s)},n.encodeBase64Packet=function(e,r){var i,o="b"+n.packets[e.type];if(m&&e.data instanceof m){var a=new FileReader;return a.onload=function(){var e=a.result.split(",")[1];r(o+e)},a.readAsDataURL(e.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),c=new Array(s.length),u=0;u<s.length;u++)c[u]=s[u];i=String.fromCharCode.apply(null,c)}return o+=t.btoa(i),r(o)},n.decodePacket=function(e,t,r){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(r)try{e=c.decode(e)}catch(e){return h}var i=e.charAt(0);return Number(i)==i&&l[i]?e.length>1?{type:l[i],data:e.substring(1)}:{type:l[i]}:h}i=new Uint8Array(e)[0];var a=o(e,1);return m&&"blob"===t&&(a=new m([a])),{type:l[i],data:a}},n.decodeBase64Packet=function(e,n){var r=l[e.charAt(0)];if(!t.ArrayBuffer)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=a.decode(e.substr(1));return"blob"===n&&m&&(i=new m([i])),{type:r,data:i}},n.encodePayload=function(e,t,r){"function"==typeof t&&(r=t,t=null);var o=i(e);if(t&&o)return m&&!d?n.encodePayloadAsBlob(e,r):n.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");g(e,function(e,r){n.encodePacket(e,!!o&&t,!0,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},n.decodePayload=function(e,t,r){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,r);var i;if("function"==typeof t&&(r=t,t=null),""==e)return r(h,0,1);for(var o,a,s="",c=0,u=e.length;c<u;c++){var p=e.charAt(c);if(":"!=p)s+=p;else{if(""==s||s!=(o=Number(s)))return r(h,0,1);if(s!=(a=e.substr(c+1,o)).length)return r(h,0,1);if(a.length){if(i=n.decodePacket(a,t,!0),h.type==i.type&&h.data==i.data)return r(h,0,1);if(!1===r(i,c+o,u))return}c+=o,s=""}}return""!=s?r(h,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){if(!e.length)return t(new ArrayBuffer(0));g(e,function(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})},function(e,n){var r=n.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),i=new Uint8Array(r),o=0;return n.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);n=r.buffer}i[o++]=t?0:1;var s=n.byteLength.toString();for(a=0;a<s.length;a++)i[o++]=parseInt(s[a]);i[o++]=255;for(r=new Uint8Array(n),a=0;a<r.length;a++)i[o++]=r[a]}),t(i.buffer)})},n.encodePayloadAsBlob=function(e,t){g(e,function(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,n[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),a=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)a[i]=parseInt(o[i]);if(a[o.length]=255,m){var s=new m([n.buffer,a.buffer,e]);t(null,s)}})},function(e,n){return t(new m(n))})},n.decodePayloadAsBinary=function(e,t,r){"function"==typeof t&&(r=t,t=null);for(var i=e,a=[],s=!1;i.byteLength>0;){for(var c=new Uint8Array(i),u=0===c[0],p="",d=1;255!=c[d];d++){if(p.length>310){s=!0;break}p+=c[d]}if(s)return r(h,0,1);i=o(i,2+p.length),p=parseInt(p);var f=o(i,0,p);if(u)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(e){var l=new Uint8Array(f);f="";for(d=0;d<l.length;d++)f+=String.fromCharCode(l[d])}a.push(f),i=o(i,p)}var m=a.length;a.forEach(function(e,i){r(n.decodePacket(e,t,!0),i,m)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":34,after:1,"arraybuffer.slice":2,"base64-arraybuffer":14,blob:15,"has-binary":39,utf8:70}],34:[function(e,t,n){t.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},{}],35:[function(e,t,n){var r=e("wildemitter"),i=e("util");function o(e){r.call(this);var t,n=e||{};for(t in this.config={chunksize:16384,pacing:0},n)this.config[t]=n[t];this.file=null,this.channel=null}function a(){r.call(this),this.receiveBuffer=[],this.received=0,this.metadata={},this.channel=null}i.inherits(o,r),o.prototype.send=function(e,t){var n=this;this.file=e,this.channel=t;var r="number"!=typeof t.bufferedAmountLowThreshold,i=0,o=function(){var a=new window.FileReader;a.onload=function(a){n.channel.send(a.target.result),n.emit("progress",i,e.size,a.target.result),e.size>i+a.target.result.byteLength?r?window.setTimeout(o,n.config.pacing):t.bufferedAmount<=t.bufferedAmountLowThreshold&&window.setTimeout(o,0):(n.emit("progress",e.size,e.size,null),n.emit("sentFile")),i+=n.config.chunksize};var s=e.slice(i,i+n.config.chunksize);a.readAsArrayBuffer(s)};r||(t.bufferedAmountLowThreshold=8*this.config.chunksize,t.addEventListener("bufferedamountlow",o)),window.setTimeout(o,0)},i.inherits(a,r),a.prototype.receive=function(e,t){var n=this;e&&(this.metadata=e),this.channel=t,t.binaryType="arraybuffer",this.channel.onmessage=function(e){var t=e.data.byteLength;n.received+=t,n.receiveBuffer.push(e.data),n.emit("progress",n.received,n.metadata.size,e.data),n.received===n.metadata.size?(n.emit("receivedFile",new window.Blob(n.receiveBuffer),n.metadata),n.receiveBuffer=[]):n.received>n.metadata.size&&(console.error("received more than expected, discarding..."),n.receiveBuffer=[])}},t.exports={},t.exports.support="undefined"!=typeof window&&window&&window.File&&window.FileReader&&window.Blob,t.exports.Sender=o,t.exports.Receiver=a},{util:73,wildemitter:75}],36:[function(e,t,n){var r={};t.exports=function(e,t){var n,i=2===arguments.length,o=i?t:e;if("undefined"==typeof window||"http:"===window.location.protocol)return(n=new Error("NavigatorUserMediaError")).name="HTTPS_REQUIRED",o(n);if(window.navigator.userAgent.match("Chrome")){var a=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),s=33,c=!window.chrome.webstore;if(window.navigator.userAgent.match("Linux")&&(s=35),sessionStorage.getScreenMediaJSExtensionId)chrome.runtime.sendMessage(sessionStorage.getScreenMediaJSExtensionId,{type:"getScreen",id:1},null,function(t){if(t&&""!==t.sourceId)(e=i&&e||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}}).video.mandatory.chromeMediaSourceId=t.sourceId,window.navigator.mediaDevices.getUserMedia(e).then(function(e){o(null,e)}).catch(function(e){o(e)});else{var n=new Error("NavigatorUserMediaError");n.name="NotAllowedError",o(n)}});else if(window.cefGetScreenMedia)window.cefGetScreenMedia(function(t){if(t)(e=i&&e||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,window.navigator.mediaDevices.getUserMedia(e).then(function(e){o(null,e)}).catch(function(e){o(e)});else{var n=new Error("cefGetScreenMediaError");n.name="CEF_GETSCREENMEDIA_CANCELED",o(n)}});else if(c||a>=26&&a<=s)e=i&&e||{video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}}},window.navigator.mediaDevices.getUserMedia(e).then(function(e){o(null,e)}).catch(function(e){o(e)});else{var u=window.setTimeout(function(){return(n=new Error("NavigatorUserMediaError")).name="EXTENSION_UNAVAILABLE",o(n)},1e3);r[u]=[o,i?e:null],window.postMessage({type:"getScreen",id:u},"*")}}else if(window.navigator.userAgent.match("Firefox")){parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)>=33?(e=i&&e||{video:{mozMediaSource:"window",mediaSource:"window"}},window.navigator.mediaDevices.getUserMedia(e).then(function(e){o(null,e);var t=e.currentTime,n=window.setInterval(function(){e||window.clearInterval(n),e.currentTime==t&&(window.clearInterval(n),e.onended&&e.onended()),t=e.currentTime},500)}).catch(function(e){o(e)})):(n=new Error("NavigatorUserMediaError")).name="EXTENSION_UNAVAILABLE"}},"undefined"!=typeof window&&window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("gotScreen"==e.data.type&&r[e.data.id]){var t=r[e.data.id],n=t[1],i=t[0];if(delete r[e.data.id],""===e.data.sourceId){var o=new Error("NavigatorUserMediaError");o.name="NotAllowedError",i(o)}else(n=n||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=e.data.sourceId,window.navigator.mediaDevices.getUserMedia(n).then(function(e){i(null,e)}).catch(function(e){i(e)})}else"getScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})},{}],37:[function(e,t,n){t.exports=function(){return this}()},{}],38:[function(e,t,n){var r,i=e("wildemitter");"undefined"!=typeof window&&(r=window.AudioContext||window.webkitAudioContext);var o=null;t.exports=function(e,t){var n=new i;if(!r)return n;var a,s,c,u=(t=t||{}).smoothing||.1,p=t.interval||50,d=t.threshold,f=t.play,l=t.history||10,h=!0;o||(o=new r),(c=o.createAnalyser()).fftSize=512,c.smoothingTimeConstant=u,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(a=o.createMediaElementSource(e),void 0===f&&(f=!0),d=d||-50):(a=o.createMediaStreamSource(e),d=d||-50),a.connect(c),f&&c.connect(o.destination),n.speaking=!1,n.setThreshold=function(e){d=e},n.setInterval=function(e){p=e},n.stop=function(){h=!1,n.emit("volume_change",-100,d),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),c.disconnect(),a.disconnect()},n.speakingHistory=[];for(var m=0;m<l;m++)n.speakingHistory.push(0);var g=function(){setTimeout(function(){if(h){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var r=4,i=t.length;r<i;r++)t[r]>n&&t[r]<0&&(n=t[r]);return n}(c,s);n.emit("volume_change",e,d);var t=0;if(e>d&&!n.speaking){for(var r=n.speakingHistory.length-3;r<n.speakingHistory.length;r++)t+=n.speakingHistory[r];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<d&&n.speaking){for(r=0;r<n.speakingHistory.length;r++)t+=n.speakingHistory[r];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>d)),g()}},p)};return g(),n}},{wildemitter:75}],39:[function(e,t,n){(function(n){var r=e("isarray");t.exports=function(e){return function e(t){if(!t)return!1;if(n.Buffer&&n.Buffer.isBuffer(t)||n.ArrayBuffer&&t instanceof ArrayBuffer||n.Blob&&t instanceof Blob||n.File&&t instanceof File)return!0;if(r(t)){for(var i=0;i<t.length;i++)if(e(t[i]))return!0}else if(t&&"object"==typeof t)for(var o in t.toJSON&&(t=t.toJSON()),t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1}(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:42}],40:[function(e,t,n){var r=e("global");try{t.exports="XMLHttpRequest"in r&&"withCredentials"in new r.XMLHttpRequest}catch(e){t.exports=!1}},{global:37}],41:[function(e,t,n){var r=[].indexOf;t.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],42:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],43:[function(e,t,n){!function(e){var t,r,i,o={}.toString,a="object"==typeof JSON&&JSON,s="object"==typeof n&&n&&!n.nodeType&&n;s&&a?(s.stringify=a.stringify,s.parse=a.parse):s=e.JSON=a||{};var c=new Date(-0xc782b5b800cec);try{c=-109252==c.getUTCFullYear()&&0===c.getUTCMonth()&&1===c.getUTCDate()&&10==c.getUTCHours()&&37==c.getUTCMinutes()&&6==c.getUTCSeconds()&&708==c.getUTCMilliseconds()}catch(e){}function u(e){if(u[e]!==i)return u[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=u("json-stringify")&&u("json-parse");else{var n,r='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var a=s.stringify,p="function"==typeof a&&c;if(p){(n=function(){return 1}).toJSON=n;try{p="0"===a(0)&&"0"===a(new Number)&&'""'==a(new String)&&a(o)===i&&a(i)===i&&a()===i&&"1"===a(n)&&"[1]"==a([n])&&"[null]"==a([i])&&"null"==a(null)&&"[null,null,null]"==a([i,o,null])&&a({a:[n,!0,!1,null,"\0\b\n\f\r\t"]})==r&&"1"===a(null,n)&&"[\n 1,\n 2\n]"==a([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==a(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==a(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==a(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==a(new Date(-1))}catch(e){p=!1}}t=p}if("json-parse"==e){var d=s.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){var f=5==(n=d(r)).a.length&&1===n.a[0];if(f){try{f=!d('"\t"')}catch(e){}if(f)try{f=1!==d("01")}catch(e){}if(f)try{f=1!==d("1.")}catch(e){}}}}catch(e){f=!1}t=f}}return u[e]=!!t}if(!u("json")){var p=u("bug-string-char-index");if(!c)var d=Math.floor,f=[0,31,59,90,120,151,181,212,243,273,304,334],l=function(e,t){return f[t]+365*(e-1970)+d((e-1969+(t=+(t>1)))/4)-d((e-1901+t)/100)+d((e-1601+t)/400)};(t={}.hasOwnProperty)||(t=function(e){var n,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=o?t=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(n=r.constructor,t=function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),r=null,t.call(this,e)});var h={boolean:1,number:1,string:1,undefined:1};if(r=function(e,n){var i,a,s,c=0;for(s in(i=function(){this.valueOf=0}).prototype.valueOf=0,a=new i)t.call(a,s)&&c++;return i=a=null,c?r=2==c?function(e,n){var r,i={},a="[object Function]"==o.call(e);for(r in e)a&&"prototype"==r||t.call(i,r)||!(i[r]=1)||!t.call(e,r)||n(r)}:function(e,n){var r,i,a="[object Function]"==o.call(e);for(r in e)a&&"prototype"==r||!t.call(e,r)||(i="constructor"===r)||n(r);(i||t.call(e,r="constructor"))&&n(r)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],r=function(e,n){var r,i,s="[object Function]"==o.call(e),c=!s&&"function"!=typeof e.constructor&&function(e,t){var n=typeof e[t];return"object"==n?!!e[t]:!h[n]}(e,"hasOwnProperty")?e.hasOwnProperty:t;for(r in e)s&&"prototype"==r||!c.call(e,r)||n(r);for(i=a.length;r=a[--i];c.call(e,r)&&n(r));}),r(e,n)},!u("json-stringify")){var m={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},g=function(e,t){return("000000"+(t||0)).slice(-e)},v=function(e){var t,n='"',r=0,i=e.length,o=i>10&&p;for(o&&(t=e.split(""));r<i;r++){var a=e.charCodeAt(r);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=m[a];break;default:if(a<32){n+="\\u00"+g(2,a.toString(16));break}n+=o?t[r]:p?e.charAt(r):e[r]}}return n+'"'},y=function(e,n,a,s,c,u,p){var f,h,m,b,w,S,C,k,E,T,x,P,R,O,_,D;try{f=n[e]}catch(e){}if("object"==typeof f&&f)if("[object Date]"!=(h=o.call(f))||t.call(f,"toJSON"))"function"==typeof f.toJSON&&("[object Number]"!=h&&"[object String]"!=h&&"[object Array]"!=h||t.call(f,"toJSON"))&&(f=f.toJSON(e));else if(f>-1/0&&f<1/0){if(l){for(w=d(f/864e5),m=d(w/365.2425)+1970-1;l(m+1,0)<=w;m++);for(b=d((w-l(m,0))/30.42);l(m,b+1)<=w;b++);w=1+w-l(m,b),C=d((S=(f%864e5+864e5)%864e5)/36e5)%24,k=d(S/6e4)%60,E=d(S/1e3)%60,T=S%1e3}else m=f.getUTCFullYear(),b=f.getUTCMonth(),w=f.getUTCDate(),C=f.getUTCHours(),k=f.getUTCMinutes(),E=f.getUTCSeconds(),T=f.getUTCMilliseconds();f=(m<=0||m>=1e4?(m<0?"-":"+")+g(6,m<0?-m:m):g(4,m))+"-"+g(2,b+1)+"-"+g(2,w)+"T"+g(2,C)+":"+g(2,k)+":"+g(2,E)+"."+g(3,T)+"Z"}else f=null;if(a&&(f=a.call(n,e,f)),null===f)return"null";if("[object Boolean]"==(h=o.call(f)))return""+f;if("[object Number]"==h)return f>-1/0&&f<1/0?""+f:"null";if("[object String]"==h)return v(""+f);if("object"==typeof f){for(O=p.length;O--;)if(p[O]===f)throw TypeError();if(p.push(f),x=[],_=u,u+=c,"[object Array]"==h){for(R=0,O=f.length;R<O;R++)P=y(R,f,a,s,c,u,p),x.push(P===i?"null":P);D=x.length?c?"[\n"+u+x.join(",\n"+u)+"\n"+_+"]":"["+x.join(",")+"]":"[]"}else r(s||f,function(e){var t=y(e,f,a,s,c,u,p);t!==i&&x.push(v(e)+":"+(c?" ":"")+t)}),D=x.length?c?"{\n"+u+x.join(",\n"+u)+"\n"+_+"}":"{"+x.join(",")+"}":"{}";return p.pop(),D}};s.stringify=function(e,t,n){var r,i,a,s;if("function"==typeof t||"object"==typeof t&&t)if("[object Function]"==(s=o.call(t)))i=t;else if("[object Array]"==s){a={};for(var c,u=0,p=t.length;u<p;c=t[u++],("[object String]"==(s=o.call(c))||"[object Number]"==s)&&(a[c]=1));}if(n)if("[object Number]"==(s=o.call(n))){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==s&&(r=n.length<=10?n:n.slice(0,10));return y("",((c={})[""]=e,c),i,a,r,"",[])}}if(!u("json-parse")){var b,w,S=String.fromCharCode,C={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},k=function(){throw b=w=null,SyntaxError()},E=function(){for(var e,t,n,r,i,o=w,a=o.length;b<a;)switch(i=o.charCodeAt(b)){case 9:case 10:case 13:case 32:b++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=p?o.charAt(b):o[b],b++,e;case 34:for(e="@",b++;b<a;)if((i=o.charCodeAt(b))<32)k();else if(92==i)switch(i=o.charCodeAt(++b)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=C[i],b++;break;case 117:for(t=++b,n=b+4;b<n;b++)(i=o.charCodeAt(b))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||k();e+=S("0x"+o.slice(t,b));break;default:k()}else{if(34==i)break;for(i=o.charCodeAt(b),t=b;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++b);e+=o.slice(t,b)}if(34==o.charCodeAt(b))return b++,e;k();default:if(t=b,45==i&&(r=!0,i=o.charCodeAt(++b)),i>=48&&i<=57){for(48==i&&((i=o.charCodeAt(b+1))>=48&&i<=57)&&k(),r=!1;b<a&&((i=o.charCodeAt(b))>=48&&i<=57);b++);if(46==o.charCodeAt(b)){for(n=++b;n<a&&((i=o.charCodeAt(n))>=48&&i<=57);n++);n==b&&k(),b=n}if(101==(i=o.charCodeAt(b))||69==i){for(43!=(i=o.charCodeAt(++b))&&45!=i||b++,n=b;n<a&&((i=o.charCodeAt(n))>=48&&i<=57);n++);n==b&&k(),b=n}return+o.slice(t,b)}if(r&&k(),"true"==o.slice(b,b+4))return b+=4,!0;if("false"==o.slice(b,b+5))return b+=5,!1;if("null"==o.slice(b,b+4))return b+=4,null;k()}return"$"},T=function(e){var t,n;if("$"==e&&k(),"string"==typeof e){if("@"==(p?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=E());n||(n=!0))n&&(","==e?"]"==(e=E())&&k():k()),","==e&&k(),t.push(T(e));return t}if("{"==e){for(t={};"}"!=(e=E());n||(n=!0))n&&(","==e?"}"==(e=E())&&k():k()),","!=e&&"string"==typeof e&&"@"==(p?e.charAt(0):e[0])&&":"==E()||k(),t[e.slice(1)]=T(E());return t}k()}return e},x=function(e,t,n){var r=P(e,t,n);r===i?delete e[t]:e[t]=r},P=function(e,t,n){var i,a=e[t];if("object"==typeof a&&a)if("[object Array]"==o.call(a))for(i=a.length;i--;)x(a,i,n);else r(a,function(e){x(a,e,n)});return n.call(e,t,a)};s.parse=function(e,t){var n,r;return b=0,w=""+e,n=T(E()),"$"!=E()&&k(),b=w=null,t&&"[object Function]"==o.call(t)?P(((r={})[""]=n,r),"",t):n}}}}(this)},{}],44:[function(e,t,n){var r=e("util"),i=e("hark"),o=e("getscreenmedia"),a=e("wildemitter"),s=e("mockconsole");function c(){if("undefined"==typeof window)return!1;if(!window.navigator.mozGetUserMedia)return!1;var e=window.navigator.userAgent.match(/Firefox\/(\d+)\./);return(e&&e.length>=1&&parseInt(e[1],10))<50}function u(e){a.call(this);var t,n=this.config={detectSpeakingEvents:!1,audioFallback:!1,media:{audio:!0,video:!0},harkOptions:null,logger:s};for(t in e)e.hasOwnProperty(t)&&(this.config[t]=e[t]);this.logger=n.logger,this._log=this.logger.log.bind(this.logger,"LocalMedia:"),this._logerror=this.logger.error.bind(this.logger,"LocalMedia:"),this.localStreams=[],this.localScreens=[],navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||this._logerror("Your browser does not support local media capture."),this._audioMonitors=[],this.on("localStreamStopped",this._stopAudioMonitor.bind(this)),this.on("localScreenStopped",this._stopAudioMonitor.bind(this))}r.inherits(u,a),u.prototype.start=function(e,t){var n=this,r=e||this.config.media;this.emit("localStreamRequested",r),navigator.mediaDevices.getUserMedia(r).then(function(e){if(r.audio&&n.config.detectSpeakingEvents&&n._setupAudioMonitor(e,n.config.harkOptions),n.localStreams.push(e),e.getTracks().forEach(function(t){t.addEventListener("ended",function(){(function(e){var t=!0;return e.getTracks().forEach(function(e){t="ended"===e.readyState&&t}),t})(e)&&n._removeStream(e)})}),n.emit("localStream",e),t)return t(null,e)}).catch(function(e){return n.config.audioFallback&&"DevicesNotFoundError"===e.name&&!1!==r.video?(r.video=!1,void n.start(r,t)):(n.emit("localStreamRequestFailed",r),t?t(e,null):void 0)})},u.prototype.stop=function(e){this.stopStream(e),this.stopScreenShare(e)},u.prototype.stopStream=function(e){var t=this;e?this.localStreams.indexOf(e)>-1&&(e.getTracks().forEach(function(e){e.stop()}),c()&&this._removeStream(e)):this.localStreams.forEach(function(e){e.getTracks().forEach(function(e){e.stop()}),c()&&t._removeStream(e)})},u.prototype.startScreenShare=function(e,t){var n=this;this.emit("localScreenRequested"),"function"!=typeof e||t||(t=e,e=null),o(e,function(e,r){if(e?n.emit("localScreenRequestFailed"):(n.localScreens.push(r),r.getTracks().forEach(function(e){e.addEventListener("ended",function(){var e=!0;r.getTracks().forEach(function(t){e="ended"===t.readyState&&e}),e&&n._removeStream(r)})}),n.emit("localScreen",r)),t)return t(e,r)})},u.prototype.stopScreenShare=function(e){var t=this;e?this.localScreens.indexOf(e)>-1&&(e.getTracks().forEach(function(e){e.stop()}),c()&&this._removeStream(e)):this.localScreens.forEach(function(e){e.getTracks().forEach(function(e){e.stop()}),c()&&t._removeStream(e)})},u.prototype.mute=function(){this._audioEnabled(!1),this.emit("audioOff")},u.prototype.unmute=function(){this._audioEnabled(!0),this.emit("audioOn")},u.prototype.pauseVideo=function(){this._videoEnabled(!1),this.emit("videoOff")},u.prototype.resumeVideo=function(){this._videoEnabled(!0),this.emit("videoOn")},u.prototype.pause=function(){this.mute(),this.pauseVideo()},u.prototype.resume=function(){this.unmute(),this.resumeVideo()},u.prototype._audioEnabled=function(e){this.localStreams.forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!!e})})},u.prototype._videoEnabled=function(e){this.localStreams.forEach(function(t){t.getVideoTracks().forEach(function(t){t.enabled=!!e})})},u.prototype.isAudioEnabled=function(){var e=!0;return this.localStreams.forEach(function(t){t.getAudioTracks().forEach(function(t){e=e&&t.enabled})}),e},u.prototype.isVideoEnabled=function(){var e=!0;return this.localStreams.forEach(function(t){t.getVideoTracks().forEach(function(t){e=e&&t.enabled})}),e},u.prototype._removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1?(this.localStreams.splice(t,1),this.emit("localStreamStopped",e)):(t=this.localScreens.indexOf(e))>-1&&(this.localScreens.splice(t,1),this.emit("localScreenStopped",e))},u.prototype._setupAudioMonitor=function(e,t){this._log("Setup audio");var n,r=i(e,t),o=this;r.on("speaking",function(){o.emit("speaking")}),r.on("stopped_speaking",function(){n&&clearTimeout(n),n=setTimeout(function(){o.emit("stoppedSpeaking")},1e3)}),r.on("volume_change",function(e,t){o.emit("volumeChange",e,t)}),this._audioMonitors.push({audio:r,stream:e})},u.prototype._stopAudioMonitor=function(e){var t=-1;this._audioMonitors.forEach(function(n,r){n.stream===e&&(t=r)}),t>-1&&(this._audioMonitors[t].audio.stop(),this._audioMonitors.splice(t,1))},t.exports=u},{getscreenmedia:36,hark:38,mockconsole:46,util:73,wildemitter:75}],45:[function(e,t,n){(function(e){var r=200,i="__lodash_hash_undefined__",o=9007199254740991,a="[object Arguments]",s="[object Boolean]",c="[object Date]",u="[object Function]",p="[object GeneratorFunction]",d="[object Map]",f="[object Number]",l="[object Object]",h="[object RegExp]",m="[object Set]",g="[object String]",v="[object Symbol]",y="[object ArrayBuffer]",b="[object DataView]",w="[object Float32Array]",S="[object Float64Array]",C="[object Int8Array]",k="[object Int16Array]",E="[object Int32Array]",T="[object Uint8Array]",x="[object Uint8ClampedArray]",P="[object Uint16Array]",R="[object Uint32Array]",O=/\w*$/,_=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,j={};j[a]=j["[object Array]"]=j[y]=j[b]=j[s]=j[c]=j[w]=j[S]=j[C]=j[k]=j[E]=j[d]=j[f]=j[l]=j[h]=j[m]=j[g]=j[v]=j[T]=j[x]=j[P]=j[R]=!0,j["[object Error]"]=j[u]=j["[object WeakMap]"]=!1;var A="object"==typeof e&&e&&e.Object===Object&&e,M="object"==typeof self&&self&&self.Object===Object&&self,I=A||M||Function("return this")(),L="object"==typeof n&&n&&!n.nodeType&&n,N=L&&"object"==typeof t&&t&&!t.nodeType&&t,B=N&&N.exports===L;function U(e,t){return e.set(t[0],t[1]),e}function F(e,t){return e.add(t),e}function z(e,t,n,r){var i=-1,o=e?e.length:0;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function J(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function V(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function q(e,t){return function(n){return e(t(n))}}function G(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var H,W=Array.prototype,X=Function.prototype,$=Object.prototype,Y=I["__core-js_shared__"],K=(H=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",Z=X.toString,Q=$.hasOwnProperty,ee=$.toString,te=RegExp("^"+Z.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=B?I.Buffer:void 0,re=I.Symbol,ie=I.Uint8Array,oe=q(Object.getPrototypeOf,Object),ae=Object.create,se=$.propertyIsEnumerable,ce=W.splice,ue=Object.getOwnPropertySymbols,pe=ne?ne.isBuffer:void 0,de=q(Object.keys,Object),fe=Ne(I,"DataView"),le=Ne(I,"Map"),he=Ne(I,"Promise"),me=Ne(I,"Set"),ge=Ne(I,"WeakMap"),ve=Ne(Object,"create"),ye=Je(fe),be=Je(le),we=Je(he),Se=Je(me),Ce=Je(ge),ke=re?re.prototype:void 0,Ee=ke?ke.valueOf:void 0;function Te(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function xe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Pe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Re(e){this.__data__=new xe(e)}function Oe(e,t){var n=qe(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ge(e)}(e)&&Q.call(e,"callee")&&(!se.call(e,"callee")||ee.call(e)==a)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,i=!!r;for(var o in e)!t&&!Q.call(e,o)||i&&("length"==o||Fe(o,r))||n.push(o);return n}function _e(e,t,n){var r=e[t];Q.call(e,t)&&Ve(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function De(e,t){for(var n=e.length;n--;)if(Ve(e[n][0],t))return n;return-1}function je(e,t,n,r,i,o,_){var D;if(r&&(D=o?r(e,i,o,_):r(e)),void 0!==D)return D;if(!Xe(e))return e;var A=qe(e);if(A){if(D=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&Q.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,D)}else{var M=Ue(e),I=M==u||M==p;if(He(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(M==l||M==a||I&&!o){if(J(e))return o?e:{};if(D=function(e){return"function"!=typeof e.constructor||ze(e)?{}:(t=oe(e),Xe(t)?ae(t):{});var t}(I?{}:e),!t)return function(e,t){return Ie(e,Be(e),t)}(e,function(e,t){return e&&Ie(t,$e(t),e)}(D,e))}else{if(!j[M])return o?e:{};D=function(e,t,n,r){var i=e.constructor;switch(t){case y:return Me(e);case s:case c:return new i(+e);case b:return function(e,t){var n=t?Me(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case w:case S:case C:case k:case E:case T:case x:case P:case R:return function(e,t){var n=t?Me(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case d:return function(e,t,n){return z(t?n(V(e),!0):V(e),U,new e.constructor)}(e,r,n);case f:case g:return new i(e);case h:return(u=new(a=e).constructor(a.source,O.exec(a))).lastIndex=a.lastIndex,u;case m:return function(e,t,n){return z(t?n(G(e),!0):G(e),F,new e.constructor)}(e,r,n);case v:return o=e,Ee?Object(Ee.call(o)):{}}var o;var a,u}(e,M,je,t)}}_||(_=new Re);var L=_.get(e);if(L)return L;if(_.set(e,D),!A)var N=n?function(e){return function(e,t,n){var r=t(e);return qe(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,$e,Be)}(e):$e(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(N||e,function(i,o){N&&(i=e[o=i]),_e(D,o,je(i,t,n,r,o,e,_))}),D}function Ae(e){return!(!Xe(e)||(t=e,K&&K in t))&&(We(e)||J(e)?te:_).test(Je(e));var t}function Me(e){var t=new e.constructor(e.byteLength);return new ie(t).set(new ie(e)),t}function Ie(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],s=r?r(n[a],e[a],a,n,e):void 0;_e(n,a,void 0===s?e[a]:s)}return n}function Le(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Ne(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Ae(n)?n:void 0}Te.prototype.clear=function(){this.__data__=ve?ve(null):{}},Te.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Te.prototype.get=function(e){var t=this.__data__;if(ve){var n=t[e];return n===i?void 0:n}return Q.call(t,e)?t[e]:void 0},Te.prototype.has=function(e){var t=this.__data__;return ve?void 0!==t[e]:Q.call(t,e)},Te.prototype.set=function(e,t){return this.__data__[e]=ve&&void 0===t?i:t,this},xe.prototype.clear=function(){this.__data__=[]},xe.prototype.delete=function(e){var t=this.__data__,n=De(t,e);return!(n<0||(n==t.length-1?t.pop():ce.call(t,n,1),0))},xe.prototype.get=function(e){var t=this.__data__,n=De(t,e);return n<0?void 0:t[n][1]},xe.prototype.has=function(e){return De(this.__data__,e)>-1},xe.prototype.set=function(e,t){var n=this.__data__,r=De(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},Pe.prototype.clear=function(){this.__data__={hash:new Te,map:new(le||xe),string:new Te}},Pe.prototype.delete=function(e){return Le(this,e).delete(e)},Pe.prototype.get=function(e){return Le(this,e).get(e)},Pe.prototype.has=function(e){return Le(this,e).has(e)},Pe.prototype.set=function(e,t){return Le(this,e).set(e,t),this},Re.prototype.clear=function(){this.__data__=new xe},Re.prototype.delete=function(e){return this.__data__.delete(e)},Re.prototype.get=function(e){return this.__data__.get(e)},Re.prototype.has=function(e){return this.__data__.has(e)},Re.prototype.set=function(e,t){var n=this.__data__;if(n instanceof xe){var i=n.__data__;if(!le||i.length<r-1)return i.push([e,t]),this;n=this.__data__=new Pe(i)}return n.set(e,t),this};var Be=ue?q(ue,Object):function(){return[]},Ue=function(e){return ee.call(e)};function Fe(e,t){return!!(t=null==t?o:t)&&("number"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function ze(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||$)}function Je(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ve(e,t){return e===t||e!=e&&t!=t}(fe&&Ue(new fe(new ArrayBuffer(1)))!=b||le&&Ue(new le)!=d||he&&"[object Promise]"!=Ue(he.resolve())||me&&Ue(new me)!=m||ge&&"[object WeakMap]"!=Ue(new ge))&&(Ue=function(e){var t=ee.call(e),n=t==l?e.constructor:void 0,r=n?Je(n):void 0;if(r)switch(r){case ye:return b;case be:return d;case we:return"[object Promise]";case Se:return m;case Ce:return"[object WeakMap]"}return t});var qe=Array.isArray;function Ge(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=o}(e.length)&&!We(e)}var He=pe||function(){return!1};function We(e){var t=Xe(e)?ee.call(e):"";return t==u||t==p}function Xe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function $e(e){return Ge(e)?Oe(e):function(e){if(!ze(e))return de(e);var t=[];for(var n in Object(e))Q.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}t.exports=function(e){return je(e,!0,!0)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],46:[function(e,t,n){for(var r="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),i=r.length,o=function(){},a={};i--;)a[r[i]]=o;t.exports=a},{}],47:[function(e,t,n){var r=1e3,i=60*r,o=60*i,a=24*o,s=365.25*a;function c(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}t.exports=function(e,t){return t=t||{},"string"==typeof e?function(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"y":return n*s;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"h":return n*o;case"minutes":case"minute":case"m":return n*i;case"seconds":case"second":case"s":return n*r;case"ms":return n}}(e):t.long?c(n=e,a,"day")||c(n,o,"hour")||c(n,i,"minute")||c(n,r,"second")||n+" ms":function(e){return e>=a?Math.round(e/a)+"d":e>=o?Math.round(e/o)+"h":e>=i?Math.round(e/i)+"m":e>=r?Math.round(e/r)+"s":e+"ms"}(e);var n}},{}],48:[function(e,t,n){var r=Object.prototype.hasOwnProperty;n.keys=Object.keys||function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(n);return t},n.values=function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(e[n]);return t},n.merge=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e},n.length=function(e){return n.keys(e).length},n.isEmpty=function(e){return 0==n.length(e)}},{}],49:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(a,"").replace(s,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(r,"@").replace(i,"]").replace(o,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},{}],51:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){for(var t=r.exec(e||""),n={},o=14;o--;)n[i[o]]=t[o]||"";return n}},{}],52:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var u,p=[],d=!1,f=-1;function l(){d&&u&&(d=!1,u.length?p=u.concat(p):f=-1,p.length&&h())}function h(){if(!d){var e=c(l);d=!0;for(var t=p.length;t;){for(u=p,p=[];++f<t;)u&&u[f].run();f=-1,t=p.length}u=null,d=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new m(e,t)),1!==p.length||d||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],53:[function(e,t,n){var r=e("util"),i=e("sdp-jingle-json"),o=e("wildemitter"),a=e("lodash.clonedeep");function s(e,t){var n,r=this;for(n in o.call(this),(e=e||{}).iceServers=e.iceServers||[],this.enableChromeNativeSimulcast=!1,t&&t.optional&&window.chrome&&null===navigator.appVersion.match(/Chromium\//)&&t.optional.forEach(function(e){e.enableChromeNativeSimulcast&&(r.enableChromeNativeSimulcast=!0)}),this.enableMultiStreamHacks=!1,t&&t.optional&&window.chrome&&t.optional.forEach(function(e){e.enableMultiStreamHacks&&(r.enableMultiStreamHacks=!0)}),this.restrictBandwidth=0,t&&t.optional&&t.optional.forEach(function(e){e.andyetRestrictBandwidth&&(r.restrictBandwidth=e.andyetRestrictBandwidth)}),this.batchIceCandidates=0,t&&t.optional&&t.optional.forEach(function(e){e.andyetBatchIce&&(r.batchIceCandidates=e.andyetBatchIce)}),this.batchedIceCandidates=[],t&&t.optional&&window.chrome&&t.optional.forEach(function(e){e.andyetFasterICE&&(r.eliminateDuplicateCandidates=e.andyetFasterICE)}),t&&t.optional&&t.optional.forEach(function(e){e.andyetDontSignalCandidates&&(r.dontSignalCandidates=e.andyetDontSignalCandidates)}),this.assumeSetLocalSuccess=!1,t&&t.optional&&t.optional.forEach(function(e){e.andyetAssumeSetLocalSuccess&&(r.assumeSetLocalSuccess=e.andyetAssumeSetLocalSuccess)}),window.navigator.mozGetUserMedia&&t&&t.optional&&(this.wtFirefox=0,t.optional.forEach(function(e){e.andyetFirefoxMakesMeSad&&(r.wtFirefox=e.andyetFirefoxMakesMeSad,r.wtFirefox>0&&(r.firefoxcandidatebuffer=[]))})),this.pc=new RTCPeerConnection(e,t),"function"==typeof this.pc.getLocalStreams?this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc):this.getLocalStreams=function(){return[]},this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc),this.addStream=this.pc.addStream.bind(this.pc),this.removeStream=function(e){"function"==typeof r.pc.removeStream?r.pc.removeStream.apply(r.pc,arguments):"function"==typeof r.pc.removeTrack&&e.getTracks().forEach(function(e){r.pc.removeTrack(e)})},"function"==typeof this.pc.removeTrack&&(this.removeTrack=this.pc.removeTrack.bind(this.pc)),this.pc.onremovestream=this.emit.bind(this,"removeStream"),this.pc.onremovetrack=this.emit.bind(this,"removeTrack"),this.pc.onaddstream=this.emit.bind(this,"addStream"),this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded"),this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange"),this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange"),this.pc.onicecandidate=this._onIce.bind(this),this.pc.ondatachannel=this._onDataChannel.bind(this),this.localDescription={contents:[]},this.remoteDescription={contents:[]},this.config={debug:!1,sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1},this.iceCredentials={local:{},remote:{}},e)this.config[n]=e[n];this.config.debug&&this.on("*",function(){(e.logger||console).log("PeerConnection event:",arguments)}),this.hadLocalStunCandidate=!1,this.hadRemoteStunCandidate=!1,this.hadLocalRelayCandidate=!1,this.hadRemoteRelayCandidate=!1,this.hadLocalIPv6Candidate=!1,this.hadRemoteIPv6Candidate=!1,this._remoteDataChannels=[],this._localDataChannels=[],this._candidateBuffer=[]}r.inherits(s,o),Object.defineProperty(s.prototype,"signalingState",{get:function(){return this.pc.signalingState}}),Object.defineProperty(s.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}}),s.prototype._role=function(){return this.isInitiator?"initiator":"responder"},s.prototype.addStream=function(e){this.localStream=e,this.pc.addStream(e)},s.prototype._checkLocalCandidate=function(e){var t=i.toCandidateJSON(e);"srflx"==t.type?this.hadLocalStunCandidate=!0:"relay"==t.type&&(this.hadLocalRelayCandidate=!0),-1!=t.ip.indexOf(":")&&(this.hadLocalIPv6Candidate=!0)},s.prototype._checkRemoteCandidate=function(e){var t=i.toCandidateJSON(e);"srflx"==t.type?this.hadRemoteStunCandidate=!0:"relay"==t.type&&(this.hadRemoteRelayCandidate=!0),-1!=t.ip.indexOf(":")&&(this.hadRemoteIPv6Candidate=!0)},s.prototype.processIce=function(e,t){t=t||function(){};var n=this;if("closed"===this.pc.signalingState)return t();if(e.contents||e.jingle&&e.jingle.contents){var r=this.remoteDescription.contents.map(function(e){return e.name});(e.contents||e.jingle.contents).forEach(function(e){var o=e.transport||{},a=o.candidates||[],s=r.indexOf(e.name),c=e.name,u=n.remoteDescription.contents.find(function(t){return t.name===e.name}),p=function(){a.forEach(function(e){var t=i.toCandidateSDP(e);n.pc.addIceCandidate(new RTCIceCandidate({candidate:t,sdpMLineIndex:s,sdpMid:c}),function(){},function(e){n.emit("error",e)}),n._checkRemoteCandidate(t)}),t()};if(n.iceCredentials.remote[e.name]&&o.ufrag&&n.iceCredentials.remote[e.name].ufrag!==o.ufrag)if(u){u.transport.ufrag=o.ufrag,u.transport.pwd=o.pwd;var d={type:"offer",jingle:n.remoteDescription};d.sdp=i.toSessionSDP(d.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"incoming"}),n.pc.setRemoteDescription(new RTCSessionDescription(d),function(){p()},function(e){n.emit("error",e)})}else n.emit("error","ice restart failed to find matching content");else p()})}else{if(e.candidate&&0!==e.candidate.candidate.indexOf("a=")&&(e.candidate.candidate="a="+e.candidate.candidate),this.wtFirefox&&null!==this.firefoxcandidatebuffer&&this.pc.localDescription&&"offer"===this.pc.localDescription.type)return this.firefoxcandidatebuffer.push(e.candidate),t();n.pc.addIceCandidate(new RTCIceCandidate(e.candidate),function(){},function(e){n.emit("error",e)}),n._checkRemoteCandidate(e.candidate.candidate),t()}},s.prototype.offer=function(e,t){var n=this,r=2===arguments.length,o=r&&e?e:{offerToReceiveAudio:1,offerToReceiveVideo:1};if(t=(t=r?t:e)||function(){},"closed"===this.pc.signalingState)return t("Already closed");this.pc.createOffer(function(e){var r={type:"offer",sdp:e.sdp};n.assumeSetLocalSuccess&&(n.emit("offer",r),t(null,r)),n._candidateBuffer=[],n.pc.setLocalDescription(e,function(){var o;n.config.useJingle&&((o=i.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"})).sid=n.config.sid,n.localDescription=o,o.contents.forEach(function(e){var t=e.transport||{};t.ufrag&&(n.iceCredentials.local[e.name]={ufrag:t.ufrag,pwd:t.pwd})}),r.jingle=o),r.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkLocalCandidate(e)}),n.assumeSetLocalSuccess||(n.emit("offer",r),t(null,r))},function(e){n.emit("error",e),t(e)})},function(e){n.emit("error",e),t(e)},o)},s.prototype.handleOffer=function(e,t){t=t||function(){};var n=this;if(e.type="offer",e.jingle){if(this.enableChromeNativeSimulcast&&e.jingle.contents.forEach(function(e){"video"===e.name&&(e.application.googConferenceFlag=!0)}),this.enableMultiStreamHacks&&e.jingle.contents.forEach(function(e){if("video"===e.name){var t=e.application.sources||[];0!==t.length&&"3735928559"===t[0].ssrc||(t.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]}),e.application.sources=t)}}),n.restrictBandwidth>0&&e.jingle.contents.length>=2&&"video"===e.jingle.contents[1].name){var r=e.jingle.contents[1];r.application&&r.application.bandwidth&&r.application.bandwidth.bandwidth||(e.jingle.contents[1].application.bandwidth={type:"AS",bandwidth:n.restrictBandwidth.toString()},e.sdp=i.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"outgoing"}))}e.jingle.contents.forEach(function(e){var t=e.transport||{};t.ufrag&&(n.iceCredentials.remote[e.name]={ufrag:t.ufrag,pwd:t.pwd})}),e.sdp=i.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"incoming"}),n.remoteDescription=e.jingle}e.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkRemoteCandidate(e)}),n.pc.setRemoteDescription(new RTCSessionDescription(e),function(){t()},t)},s.prototype.answerAudioOnly=function(e){this._answer({mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},e)},s.prototype.answerBroadcastOnly=function(e){this._answer({mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},e)},s.prototype.answer=function(e,t){var n=2===arguments.length,r=n?t:e,i=n&&e?e:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this._answer(i,r)},s.prototype.handleAnswer=function(e,t){t=t||function(){};var n=this;e.jingle&&(e.sdp=i.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"incoming"}),n.remoteDescription=e.jingle,e.jingle.contents.forEach(function(e){var t=e.transport||{};t.ufrag&&(n.iceCredentials.remote[e.name]={ufrag:t.ufrag,pwd:t.pwd})})),e.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkRemoteCandidate(e)}),n.pc.setRemoteDescription(new RTCSessionDescription(e),function(){n.wtFirefox&&window.setTimeout(function(){n.firefoxcandidatebuffer.forEach(function(e){n.pc.addIceCandidate(new RTCIceCandidate(e),function(){},function(e){n.emit("error",e)}),n._checkRemoteCandidate(e.candidate)}),n.firefoxcandidatebuffer=null},n.wtFirefox),t(null)},t)},s.prototype.close=function(){this.pc.close(),this._localDataChannels=[],this._remoteDataChannels=[],this.emit("close")},s.prototype._answer=function(e,t){t=t||function(){};var n=this;if(!this.pc.remoteDescription)throw new Error("remoteDescription not set");if("closed"===this.pc.signalingState)return t("Already closed");n.pc.createAnswer(function(e){var r=[];if(n.enableChromeNativeSimulcast&&(e.jingle=i.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"}),e.jingle.contents.length>=2&&"video"===e.jingle.contents[1].name)){var o=e.jingle.contents[1].application.sourceGroups||[],s=!1;if(o.forEach(function(e){"SIM"==e.semantics&&(s=!0)}),!s&&e.jingle.contents[1].application.sources.length){var c=JSON.parse(JSON.stringify(e.jingle.contents[1].application.sources[0]));c.ssrc=""+Math.floor(4294967295*Math.random()),e.jingle.contents[1].application.sources.push(c),r.push(e.jingle.contents[1].application.sources[0].ssrc),r.push(c.ssrc),o.push({semantics:"SIM",sources:r});var u=JSON.parse(JSON.stringify(c));u.ssrc=""+Math.floor(4294967295*Math.random()),e.jingle.contents[1].application.sources.push(u),o.push({semantics:"FID",sources:[c.ssrc,u.ssrc]}),e.jingle.contents[1].application.sourceGroups=o,e.sdp=i.toSessionSDP(e.jingle,{sid:n.config.sdpSessionID,role:n._role(),direction:"outgoing"})}}var p={type:"answer",sdp:e.sdp};if(n.assumeSetLocalSuccess){var d=a(p);n.emit("answer",d),t(null,d)}n._candidateBuffer=[],n.pc.setLocalDescription(e,function(){if(n.config.useJingle){var r=i.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"});r.sid=n.config.sid,n.localDescription=r,p.jingle=r}if(n.enableChromeNativeSimulcast&&(p.jingle||(p.jingle=i.toSessionJSON(e.sdp,{role:n._role(),direction:"outgoing"})),p.jingle.contents[1].application.sources.forEach(function(e,t){e.parameters=e.parameters.map(function(e){return"msid"===e.key&&(e.value+="-"+Math.floor(t/2)),e})}),p.sdp=i.toSessionSDP(p.jingle,{sid:n.sdpSessionID,role:n._role(),direction:"outgoing"})),p.sdp.split("\r\n").forEach(function(e){0===e.indexOf("a=candidate:")&&n._checkLocalCandidate(e)}),!n.assumeSetLocalSuccess){var o=a(p);n.emit("answer",o),t(null,o)}},function(e){n.emit("error",e),t(e)})},function(e){n.emit("error",e),t(e)},e)},s.prototype._onIce=function(e){var t=this;if(e.candidate){if(this.dontSignalCandidates)return;var n=e.candidate,r={candidate:{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}};this._checkLocalCandidate(n.candidate);var o,a,s=i.toCandidateJSON(n.candidate);if(this.eliminateDuplicateCandidates&&"relay"===s.type&&(a=(o=this._candidateBuffer.filter(function(e){return"relay"===e.type}).map(function(e){return e.foundation+":"+e.component})).indexOf(s.foundation+":"+s.component))>-1&&s.priority>>24>=o[a].priority>>24)return;if("max-bundle"===this.config.bundlePolicy&&(a=(o=this._candidateBuffer.filter(function(e){return s.type===e.type}).map(function(e){return e.address+":"+e.port})).indexOf(s.address+":"+s.port))>-1)return;if("require"===this.config.rtcpMuxPolicy&&"2"===s.component)return;if(this._candidateBuffer.push(s),t.config.useJingle){if(n.sdpMid||(t.pc.remoteDescription&&"offer"===t.pc.remoteDescription.type?n.sdpMid=t.remoteDescription.contents[n.sdpMLineIndex].name:n.sdpMid=t.localDescription.contents[n.sdpMLineIndex].name),!t.iceCredentials.local[n.sdpMid])i.toSessionJSON(t.pc.localDescription.sdp,{role:t._role(),direction:"outgoing"}).contents.forEach(function(e){var n=e.transport||{};n.ufrag&&(t.iceCredentials.local[e.name]={ufrag:n.ufrag,pwd:n.pwd})});if(r.jingle={contents:[{name:n.sdpMid,creator:t._role(),transport:{transportType:"iceUdp",ufrag:t.iceCredentials.local[n.sdpMid].ufrag,pwd:t.iceCredentials.local[n.sdpMid].pwd,candidates:[s]}}]},t.batchIceCandidates>0)return 0===t.batchedIceCandidates.length&&window.setTimeout(function(){var e={};t.batchedIceCandidates.forEach(function(t){t=t.contents[0],e[t.name]||(e[t.name]=t),e[t.name].transport.candidates.push(t.transport.candidates[0])});var n={jingle:{contents:[]}};Object.keys(e).forEach(function(t){n.jingle.contents.push(e[t])}),t.batchedIceCandidates=[],t.emit("ice",n)},t.batchIceCandidates),void t.batchedIceCandidates.push(r.jingle)}this.emit("ice",r)}else this.emit("endOfCandidates")},s.prototype._onDataChannel=function(e){var t=e.channel;this._remoteDataChannels.push(t),this.emit("addChannel",t)},s.prototype.createDataChannel=function(e,t){var n=this.pc.createDataChannel(e,t);return this._localDataChannels.push(n),n},s.prototype.getStats=function(){if("function"!=typeof arguments[0])return this.pc.getStats.apply(this.pc,arguments);var e=arguments[0];this.pc.getStats().then(function(t){e(null,t)},function(t){e(t)})},t.exports=s},{"lodash.clonedeep":45,"sdp-jingle-json":54,util:73,wildemitter:75}],54:[function(e,t,n){var r=e("./lib/tosdp"),i=e("./lib/tojson");n.toIncomingSDPOffer=function(e){return r.toSessionSDP(e,{role:"responder",direction:"incoming"})},n.toOutgoingSDPOffer=function(e){return r.toSessionSDP(e,{role:"initiator",direction:"outgoing"})},n.toIncomingSDPAnswer=function(e){return r.toSessionSDP(e,{role:"initiator",direction:"incoming"})},n.toOutgoingSDPAnswer=function(e){return r.toSessionSDP(e,{role:"responder",direction:"outgoing"})},n.toIncomingMediaSDPOffer=function(e){return r.toMediaSDP(e,{role:"responder",direction:"incoming"})},n.toOutgoingMediaSDPOffer=function(e){return r.toMediaSDP(e,{role:"initiator",direction:"outgoing"})},n.toIncomingMediaSDPAnswer=function(e){return r.toMediaSDP(e,{role:"initiator",direction:"incoming"})},n.toOutgoingMediaSDPAnswer=function(e){return r.toMediaSDP(e,{role:"responder",direction:"outgoing"})},n.toCandidateSDP=r.toCandidateSDP,n.toMediaSDP=r.toMediaSDP,n.toSessionSDP=r.toSessionSDP,n.toIncomingJSONOffer=function(e,t){return i.toSessionJSON(e,{role:"responder",direction:"incoming",creators:t})},n.toOutgoingJSONOffer=function(e,t){return i.toSessionJSON(e,{role:"initiator",direction:"outgoing",creators:t})},n.toIncomingJSONAnswer=function(e,t){return i.toSessionJSON(e,{role:"initiator",direction:"incoming",creators:t})},n.toOutgoingJSONAnswer=function(e,t){return i.toSessionJSON(e,{role:"responder",direction:"outgoing",creators:t})},n.toIncomingMediaJSONOffer=function(e,t){return i.toMediaJSON(e,{role:"responder",direction:"incoming",creator:t})},n.toOutgoingMediaJSONOffer=function(e,t){return i.toMediaJSON(e,{role:"initiator",direction:"outgoing",creator:t})},n.toIncomingMediaJSONAnswer=function(e,t){return i.toMediaJSON(e,{role:"initiator",direction:"incoming",creator:t})},n.toOutgoingMediaJSONAnswer=function(e,t){return i.toMediaJSON(e,{role:"responder",direction:"outgoing",creator:t})},n.toCandidateJSON=i.toCandidateJSON,n.toMediaJSON=i.toMediaJSON,n.toSessionJSON=i.toSessionJSON},{"./lib/tojson":57,"./lib/tosdp":58}],55:[function(e,t,n){n.lines=function(e){return e.split("\r\n").filter(function(e){return e.length>0})},n.findLine=function(e,t,n){for(var r=e.length,i=0;i<t.length;i++)if(t[i].substr(0,r)===e)return t[i];if(!n)return!1;for(var o=0;o<n.length;o++)if(n[o].substr(0,r)===e)return n[o];return!1},n.findLines=function(e,t,n){for(var r=[],i=e.length,o=0;o<t.length;o++)t[o].substr(0,i)===e&&r.push(t[o]);if(r.length||!n)return r;for(var a=0;a<n.length;a++)n[a].substr(0,i)===e&&r.push(n[a]);return r},n.mline=function(e){for(var t=e.substr(2).split(" "),n={media:t[0],port:t[1],proto:t[2],formats:[]},r=3;r<t.length;r++)t[r]&&n.formats.push(t[r]);return n},n.rtpmap=function(e){var t=e.substr(9).split(" "),n={id:t.shift()};return t=t[0].split("/"),n.name=t[0],n.clockrate=t[1],n.channels=3==t.length?t[2]:"1",n},n.sctpmap=function(e){var t=e.substr(10).split(" ");return{number:t.shift(),protocol:t.shift(),streams:t.shift()}},n.fmtp=function(e){for(var t,n,r,i=e.substr(e.indexOf(" ")+1).split(";"),o=[],a=0;a<i.length;a++)n=(t=i[a].split("="))[0].trim(),r=t[1],n&&r?o.push({key:n,value:r}):n&&o.push({key:"",value:n});return o},n.crypto=function(e){var t=e.substr(9).split(" ");return{tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")}},n.fingerprint=function(e){var t=e.substr(14).split(" ");return{hash:t[0],value:t[1]}},n.extmap=function(e){var t=e.substr(9).split(" "),n={},r=t.shift(),i=r.indexOf("/");return i>=0?(n.id=r.substr(0,i),n.senders=r.substr(i+1)):(n.id=r,n.senders="sendrecv"),n.uri=t.shift()||"",n},n.rtcpfb=function(e){var t=e.substr(10).split(" "),n={};return n.id=t.shift(),n.type=t.shift(),"trr-int"===n.type?n.value=t.shift():n.subtype=t.shift()||"",n.parameters=t,n},n.candidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},r=8;r<t.length;r+=2)"raddr"===t[r]?n.relAddr=t[r+1]:"rport"===t[r]?n.relPort=t[r+1]:"generation"===t[r]?n.generation=t[r+1]:"tcptype"===t[r]&&(n.tcpType=t[r+1]);return n.network="1",n},n.sourceGroups=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].substr(13).split(" ");t.push({semantics:r.shift(),sources:r})}return t},n.sources=function(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r].substr(7).split(" "),o=i.shift();if(!n[o]){var a={ssrc:o,parameters:[]};t.push(a),n[o]=a}var s=(i=i.join(" ").split(":")).shift(),c=i.join(":")||null;n[o].parameters.push({key:s,value:c})}return t},n.groups=function(e){for(var t,n=[],r=0;r<e.length;r++)t=e[r].substr(8).split(" "),n.push({semantics:t.shift(),contents:t});return n},n.bandwidth=function(e){var t=e.substr(2).split(":"),n={};return n.type=t.shift(),n.bandwidth=t.shift(),n},n.msid=function(e){var t=e.substr(7),n=t.split(" ");return{msid:t,mslabel:n[0],label:n[1]}}},{}],56:[function(e,t,n){t.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"}}}},{}],57:[function(e,t,n){var r=e("./senders"),i=e("./parsers"),o=Math.random();n._setIdCounter=function(e){o=e},n.toSessionJSON=function(e,t){var r,o=t.creators||[],a=t.role||"initiator",s=t.direction||"outgoing",c=e.split("\r\nm=");for(r=1;r<c.length;r++)c[r]="m="+c[r],r!==c.length-1&&(c[r]+="\r\n");var u=c.shift()+"\r\n",p=i.lines(u),d={},f=[];for(r=0;r<c.length;r++)f.push(n.toMediaJSON(c[r],u,{role:a,direction:s,creator:o[r]||"initiator"}));d.contents=f;var l=i.findLines("a=group:",p);return l.length&&(d.groups=i.groups(l)),d},n.toMediaJSON=function(e,t,o){var a=o.creator||"initiator",s=o.role||"initiator",c=o.direction||"outgoing",u=i.lines(e),p=i.lines(t),d=i.mline(u[0]),f={creator:a,name:d.media,application:{applicationType:"rtp",media:d.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transportType:"iceUdp",candidates:[],fingerprints:[]}};"application"==d.media&&(f.application={applicationType:"datachannel"},f.transport.sctp=[]);var l=f.application,h=f.transport,m=i.findLine("a=mid:",u);if(m&&(f.name=m.substr(6)),i.findLine("a=sendrecv",u,p)?f.senders="both":i.findLine("a=sendonly",u,p)?f.senders=r[s][c].sendonly:i.findLine("a=recvonly",u,p)?f.senders=r[s][c].recvonly:i.findLine("a=inactive",u,p)&&(f.senders="none"),"rtp"==l.applicationType){var g=i.findLine("b=",u);g&&(l.bandwidth=i.bandwidth(g));var v=i.findLine("a=ssrc:",u);v&&(l.ssrc=v.substr(7).split(" ")[0]),i.findLines("a=rtpmap:",u).forEach(function(e){var t=i.rtpmap(e);t.parameters=[],t.feedback=[],i.findLines("a=fmtp:"+t.id,u).forEach(function(e){t.parameters=i.fmtp(e)}),i.findLines("a=rtcp-fb:"+t.id,u).forEach(function(e){t.feedback.push(i.rtcpfb(e))}),l.payloads.push(t)}),i.findLines("a=crypto:",u,p).forEach(function(e){l.encryption.push(i.crypto(e))}),i.findLine("a=rtcp-mux",u)&&(l.mux=!0),i.findLines("a=rtcp-fb:*",u).forEach(function(e){l.feedback.push(i.rtcpfb(e))}),i.findLines("a=extmap:",u).forEach(function(e){var t=i.extmap(e);t.senders=r[s][c][t.senders],l.headerExtensions.push(t)});var y=i.findLines("a=ssrc-group:",u);l.sourceGroups=i.sourceGroups(y||[]);var b=i.findLines("a=ssrc:",u),w=l.sources=i.sources(b||[]),S=i.findLine("a=msid:",u);if(S){var C=i.msid(S);["msid","mslabel","label"].forEach(function(e){for(var t=0;t<w.length;t++){for(var n=!1,r=0;r<w[t].parameters.length;r++)w[t].parameters[r].key===e&&(n=!0);n||w[t].parameters.push({key:e,value:C[e]})}})}i.findLine("a=x-google-flag:conference",u,p)&&(l.googConferenceFlag=!0)}var k=i.findLines("a=fingerprint:",u,p),E=i.findLine("a=setup:",u,p);k.forEach(function(e){var t=i.fingerprint(e);E&&(t.setup=E.substr(8)),h.fingerprints.push(t)});var T=i.findLine("a=ice-ufrag:",u,p),x=i.findLine("a=ice-pwd:",u,p);T&&x&&(h.ufrag=T.substr(12),h.pwd=x.substr(10),h.candidates=[],i.findLines("a=candidate:",u,p).forEach(function(e){h.candidates.push(n.toCandidateJSON(e))}));"datachannel"==l.applicationType&&i.findLines("a=sctpmap:",u).forEach(function(e){var t=i.sctpmap(e);h.sctp.push(t)});return f},n.toCandidateJSON=function(e){var t=i.candidate(e.split("\r\n")[0]);return t.id=(o++).toString(36).substr(0,12),t}},{"./parsers":55,"./senders":56}],58:[function(e,t,n){var r=e("./senders");n.toSessionSDP=function(e,t){t.role,t.direction;var r=["v=0","o=- "+(t.sid||e.sid||Date.now())+" "+(t.time||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"],i=e.contents||[],o=!1;return i.forEach(function(e){e.application.sources&&e.application.sources.length&&(o=!0)}),o&&r.push("a=msid-semantic: WMS *"),(e.groups||[]).forEach(function(e){r.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),i.forEach(function(e){r.push(n.toMediaSDP(e,t))}),r.join("\r\n")+"\r\n"},n.toMediaSDP=function(e,t){var i=[],o=t.role||"initiator",a=t.direction||"outgoing",s=e.application,c=e.transport,u=s.payloads||[],p=c&&c.fingerprints||[],d=[];if("datachannel"==s.applicationType?(d.push("application"),d.push("1"),d.push("DTLS/SCTP"),c.sctp&&c.sctp.forEach(function(e){d.push(e.number)})):(d.push(s.media),d.push("1"),p.length>0?d.push("UDP/TLS/RTP/SAVPF"):s.encryption&&s.encryption.length>0?d.push("RTP/SAVPF"):d.push("RTP/AVPF"),u.forEach(function(e){d.push(e.id)})),i.push("m="+d.join(" ")),i.push("c=IN IP4 0.0.0.0"),s.bandwidth&&s.bandwidth.type&&s.bandwidth.bandwidth&&i.push("b="+s.bandwidth.type+":"+s.bandwidth.bandwidth),"rtp"==s.applicationType&&i.push("a=rtcp:1 IN IP4 0.0.0.0"),c){c.ufrag&&i.push("a=ice-ufrag:"+c.ufrag),c.pwd&&i.push("a=ice-pwd:"+c.pwd);p.forEach(function(e){i.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&i.push("a=setup:"+e.setup)}),c.sctp&&c.sctp.forEach(function(e){i.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}return"rtp"==s.applicationType&&i.push("a="+(r[o][a][e.senders]||"sendrecv")),i.push("a=mid:"+e.name),s.sources&&s.sources.length&&(s.sources[0].parameters||[]).forEach(function(e){"msid"===e.key&&i.push("a=msid:"+e.value)}),s.mux&&i.push("a=rtcp-mux"),(s.encryption||[]).forEach(function(e){i.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),s.googConferenceFlag&&i.push("a=x-google-flag:conference"),u.forEach(function(e){var t="a=rtpmap:"+e.id+" "+e.name+"/"+e.clockrate;if(e.channels&&"1"!=e.channels&&(t+="/"+e.channels),i.push(t),e.parameters&&e.parameters.length){var n=["a=fmtp:"+e.id],r=[];e.parameters.forEach(function(e){r.push((e.key?e.key+"=":"")+e.value)}),n.push(r.join(";")),i.push(n.join(" "))}e.feedback&&e.feedback.forEach(function(t){"trr-int"===t.type?i.push("a=rtcp-fb:"+e.id+" trr-int "+(t.value?t.value:"0")):i.push("a=rtcp-fb:"+e.id+" "+t.type+(t.subtype?" "+t.subtype:""))})}),s.feedback&&s.feedback.forEach(function(e){"trr-int"===e.type?i.push("a=rtcp-fb:* trr-int "+(e.value?e.value:"0")):i.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(s.headerExtensions||[]).forEach(function(e){i.push("a=extmap:"+e.id+(e.senders?"/"+r[o][a][e.senders]:"")+" "+e.uri)}),(s.sourceGroups||[]).forEach(function(e){i.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(s.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var n=e.parameters[t];i.push("a=ssrc:"+(e.ssrc||s.ssrc)+" "+n.key+(n.value?":"+n.value:""))}}),(c.candidates||[]).forEach(function(e){i.push(n.toCandidateSDP(e))}),i.join("\r\n")},n.toCandidateSDP=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"srflx"!==n&&"prflx"!==n&&"relay"!==n||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")}},{"./senders":56}],59:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var p=r.matchPrefix(e,"b=");return p.length&&(0===p[0].indexOf("b=TIAS:")?p=parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")&&(p=parseInt(p[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=p})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.exports=r},{}],60:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":61}],61:[function(e,t,n){var r=e("./url"),i=e("socket.io-parser"),o=e("./manager"),a=e("debug")("socket.io-client");t.exports=n=c;var s=n.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i=r(e),c=i.source,u=i.id;return t.forceNew||t["force new connection"]||!1===t.multiplex?(a("ignoring socket cache for %s",c),n=o(c,t)):(s[u]||(a("new io instance for %s",c),s[u]=o(c,t)),n=s[u]),n.socket(i.path)}n.protocol=i.protocol,n.connect=c,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":62,"./socket":64,"./url":65,debug:19,"socket.io-parser":67}],62:[function(e,t,n){e("./url");var r=e("engine.io-client"),i=e("./socket"),o=e("component-emitter"),a=e("socket.io-parser"),s=e("./on"),c=e("component-bind"),u=(e("object-component"),e("debug")("socket.io-client:manager")),p=e("indexof"),d=e("backo2");function f(e,t){if(!(this instanceof f))return new f(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}t.exports=f,f.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)this.nsps[e].emit.apply(this.nsps[e],arguments)},f.prototype.updateSocketIds=function(){for(var e in this.nsps)this.nsps[e].id=this.engine.id},o(f.prototype),f.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},f.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},f.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var i=s(t,"open",function(){n.onopen(),e&&e()}),o=s(t,"error",function(t){if(u("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout;u("connect attempt will timeout after %d",a);var c=setTimeout(function(){u("connect attempt timed out after %d",a),i.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(i),this.subs.push(o),this},f.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(s(e,"data",c(this,"ondata"))),this.subs.push(s(this.decoder,"decoded",c(this,"ondecoded"))),this.subs.push(s(e,"error",c(this,"onerror"))),this.subs.push(s(e,"close",c(this,"onclose")))},f.prototype.ondata=function(e){this.decoder.add(e)},f.prototype.ondecoded=function(e){this.emit("packet",e)},f.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},f.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new i(this,e),this.nsps[e]=t;var n=this;t.on("connect",function(){t.id=n.engine.id,~p(n.connected,t)||n.connected.push(t)})}return t},f.prototype.destroy=function(e){var t=p(this.connected,e);~t&&this.connected.splice(t,1),this.connected.length||this.close()},f.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(e){for(var n=0;n<e.length;n++)t.engine.write(e[n]);t.encoding=!1,t.processPacketQueue()}))},f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},f.prototype.cleanup=function(){for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},f.prototype.onclose=function(e){u("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},f.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":63,"./socket":64,"./url":65,backo2:13,"component-bind":16,"component-emitter":17,debug:19,"engine.io-client":20,indexof:41,"object-component":48,"socket.io-parser":67}],63:[function(e,t,n){t.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},{}],64:[function(e,t,n){var r=e("socket.io-parser"),i=e("component-emitter"),o=e("to-array"),a=e("./on"),s=e("component-bind"),c=e("debug")("socket.io-client:socket"),u=e("has-binary");t.exports=f;var p={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},d=i.prototype.emit;function f(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}i(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",s(this,"onopen")),a(e,"packet",s(this,"onpacket")),a(e,"close",s(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},f.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(p.hasOwnProperty(e))return d.apply(this,arguments),this;var t=o(arguments),n=r.EVENT;u(t)&&(n=r.BINARY_EVENT);var i={type:n,data:t};return"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:r.CONNECT})},f.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},f.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=o(arguments);c("sending ack %j",i);var a=u(i)?r.BINARY_ACK:r.ACK;t.packet({type:a,id:e,data:i})}}},f.prototype.onack=function(e){c("calling ack %s with %j",e.id,e.data),this.acks[e.id].apply(this,e.data),delete this.acks[e.id]},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":63,"component-bind":16,"component-emitter":17,debug:19,"has-binary":39,"socket.io-parser":67,"to-array":69}],65:[function(e,t,n){(function(n){var r=e("parseuri"),i=e("debug")("socket.io-client:url");t.exports=function(e,t){var o=e,t=t||n.location;null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.hostname+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),o=r(e));o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443"));return o.path=o.path||"/",o.id=o.protocol+"://"+o.host+":"+o.port,o.href=o.protocol+"://"+o.host+(t&&t.port==o.port?"":":"+o.port),o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:19,parseuri:51}],66:[function(e,t,n){(function(t){var r=e("isarray"),i=e("./is-buffer");n.deconstructPacket=function(e){var t=[],n=e.data;var o=e;return o.data=function e(n){if(!n)return n;if(i(n)){var o={_placeholder:!0,num:t.length};return t.push(n),o}if(r(n)){for(var a=new Array(n.length),s=0;s<n.length;s++)a[s]=e(n[s]);return a}if("object"==typeof n&&!(n instanceof Date)){for(var c in a={},n)a[c]=e(n[c]);return a}return n}(n),o.attachments=t.length,{packet:o,buffers:t}},n.reconstructPacket=function(e,t){return e.data=function e(n){if(n&&n._placeholder)return t[n.num];if(r(n)){for(var i=0;i<n.length;i++)n[i]=e(n[i]);return n}if(n&&"object"==typeof n){for(var o in n)n[o]=e(n[o]);return n}return n}(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){var o=0,a=e;!function e(s,c,u){if(!s)return s;if(t.Blob&&s instanceof Blob||t.File&&s instanceof File){o++;var p=new FileReader;p.onload=function(){u?u[c]=this.result:a=this.result,--o||n(a)},p.readAsArrayBuffer(s)}else if(r(s))for(var d=0;d<s.length;d++)e(s[d],d,s);else if(s&&"object"==typeof s&&!i(s))for(var f in s)e(s[f],f,s)}(a),o||n(a)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":68,isarray:42}],67:[function(e,t,n){var r=e("debug")("socket.io-parser"),i=e("json3"),o=(e("isarray"),e("component-emitter")),a=e("./binary"),s=e("./is-buffer");function c(){}function u(e){var t="",o=!1;return t+=e.type,n.BINARY_EVENT!=e.type&&n.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(o=!0,t+=e.nsp),null!=e.id&&(o&&(t+=",",o=!1),t+=e.id),null!=e.data&&(o&&(t+=","),t+=i.stringify(e.data)),r("encoded %j as %s",e,t),t}function p(){this.reconstructor=null}function d(e){this.reconPack=e,this.buffers=[]}function f(e){return{type:n.ERROR,data:"parser error"}}n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=c,n.Decoder=p,c.prototype.encode=function(e,t){(r("encoding packet %j",e),n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)?function(e,t){a.removeBlobs(e,function(e){var n=a.deconstructPacket(e),r=u(n.packet),i=n.buffers;i.unshift(r),t(i)})}(e,t):t([u(e)])},o(p.prototype),p.prototype.add=function(e){var t;if("string"==typeof e)t=function(e){var t={},o=0;if(t.type=Number(e.charAt(0)),null==n.types[t.type])return f();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){for(var a="";"-"!=e.charAt(++o)&&(a+=e.charAt(o),o!=e.length););if(a!=Number(a)||"-"!=e.charAt(o))throw new Error("Illegal attachments");t.attachments=Number(a)}if("/"==e.charAt(o+1))for(t.nsp="";++o;){var s=e.charAt(o);if(","==s)break;if(t.nsp+=s,o==e.length)break}else t.nsp="/";var c=e.charAt(o+1);if(""!==c&&Number(c)==c){for(t.id="";++o;){var s=e.charAt(o);if(null==s||Number(s)!=s){--o;break}if(t.id+=e.charAt(o),o==e.length)break}t.id=Number(t.id)}if(e.charAt(++o))try{t.data=i.parse(e.substr(o))}catch(e){return f()}return r("decoded %s as %j",e,t),t}(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new d(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!s(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},p.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=a.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":66,"./is-buffer":68,"component-emitter":17,debug:19,isarray:42,json3:43}],68:[function(e,t,n){(function(e){t.exports=function(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],69:[function(e,t,n){t.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},{}],70:[function(e,t,n){(function(e){!function(r){var i="object"==typeof n&&n,o="object"==typeof t&&t&&t.exports==i&&t,a="object"==typeof e&&e;a.global!==a&&a.window!==a||(r=a);var s,c,u,p=String.fromCharCode;function d(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function f(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function l(e,t){return p(e>>t&63|128)}function h(e){if(0==(4294967168&e))return p(e);var t="";return 0==(4294965248&e)?t=p(e>>6&31|192):0==(4294901760&e)?(f(e),t=p(e>>12&15|224),t+=l(e,6)):0==(4292870144&e)&&(t=p(e>>18&7|240),t+=l(e,12),t+=l(e,6)),t+=p(63&e|128)}function m(){if(u>=c)throw Error("Invalid byte index");var e=255&s[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function g(){var e,t;if(u>c)throw Error("Invalid byte index");if(u==c)return!1;if(e=255&s[u],u++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|m())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|m()<<6|m())>=2048)return f(t),t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(15&e)<<18|m()<<12|m()<<6|m())>=65536&&t<=1114111)return t;throw Error("Invalid UTF-8 detected")}var v={version:"2.0.0",encode:function(e){for(var t=d(e),n=t.length,r=-1,i="";++r<n;)i+=h(t[r]);return i},decode:function(e){s=d(e),c=s.length,u=0;for(var t,n=[];!1!==(t=g());)n.push(t);return function(e){for(var t,n=e.length,r=-1,i="";++r<n;)(t=e[r])>65535&&(i+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=p(t);return i}(n)}};if(i&&!i.nodeType)if(o)o.exports=v;else{var y={}.hasOwnProperty;for(var b in v)y.call(v,b)&&(i[b]=v[b])}else r.utf8=v}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],71:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],72:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],73:[function(e,t,n){(function(t,r){var i=/%[sdj%]/g;n.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),c=r[n];n<o;c=r[++n])m(c)||!w(c)?a+=" "+c:a+=" "+s(c);return a},n.deprecate=function(e,i){if(y(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,a={};function s(e,t){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),p(r,e,r.depth)}function c(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function u(e,t){return e}function p(e,t,r){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return v(i)||(i=p(e,i,r)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,t);if(o)return o;var a=Object.keys(t),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),C(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(t);if(0===a.length){if(k(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(S(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return d(t)}var u,w="",E=!1,T=["{","}"];(l(t)&&(E=!0,T=["[","]"]),k(t))&&(w=" [Function"+(t.name?": "+t.name:"")+"]");return b(t)&&(w=" "+RegExp.prototype.toString.call(t)),S(t)&&(w=" "+Date.prototype.toUTCString.call(t)),C(t)&&(w=" "+d(t)),0!==a.length||E&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=E?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)P(t,String(a))?o.push(f(e,t,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(e,t,n,r,i,!0))}),o}(e,t,r,s,a):a.map(function(n){return f(e,t,r,s,n,E)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,w,T)):T[0]+w+T[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),P(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(c.value)<0?(s=m(n)?p(e,c.value,null):p(e,c.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),y(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function l(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return w(e)&&"[object RegExp]"===E(e)}function w(e){return"object"==typeof e&&null!==e}function S(e){return w(e)&&"[object Date]"===E(e)}function C(e){return w(e)&&("[object Error]"===E(e)||e instanceof Error)}function k(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;a[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else a[e]=function(){};return a[e]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=l,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=g,n.isString=v,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=y,n.isRegExp=b,n.isObject=w,n.isDate=S,n.isError=C,n.isFunction=k,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":"),[e.getDate(),x[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":72,_process:52,inherits:71}],74:[function(e,t,n){var r,i;window.mozRTCPeerConnection||navigator.mozGetUserMedia?(r="moz",i=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)):(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia)&&(r="webkit",i=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10));var o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,a=window.mozRTCIceCandidate||window.RTCIceCandidate,s=window.mozRTCSessionDescription||window.RTCSessionDescription,c=window.webkitMediaStream||window.MediaStream,u="https:"===window.location.protocol&&("webkit"===r&&i>=26||"moz"===r&&i>=33),p=window.AudioContext||window.webkitAudioContext,d=document.createElement("video"),f=d&&d.canPlayType&&"probably"===d.canPlayType('video/webm; codecs="vp8", vorbis'),l=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;t.exports={prefix:r,browserVersion:i,support:!!o&&!!l,supportRTCPeerConnection:!!o,supportVp8:f,supportGetUserMedia:!!l,supportDataChannel:!!(o&&o.prototype&&o.prototype.createDataChannel),supportWebAudio:!(!p||!p.prototype.createMediaStreamSource),supportMediaStream:!(!c||!c.prototype.removeTrack),supportScreenSharing:!!u,AudioContext:p,PeerConnection:o,SessionDescription:s,IceCandidate:a,MediaStream:c,getUserMedia:l}},{}],75:[function(e,t,n){function r(){}t.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var r=this,i=3===arguments.length,o=i?arguments[1]:void 0,a=i?arguments[2]:arguments[1];return this.on(e,o,function t(){r.off(e,t),a.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,n,r,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,r=(i=this.callbacks[t]).length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,r=this.callbacks[e];return r?1===arguments.length?(delete this.callbacks[e],this):(n=r.indexOf(t),r.splice(n,1),0===r.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,r,i=[].slice.call(arguments,1),o=this.callbacks[e],a=this.getWildcardCallbacks(e);if(o)for(t=0,n=(r=o.slice()).length;t<n&&r[t];++t)r[t].apply(this,i);if(a)for(n=a.length,t=0,n=(r=a.slice()).length;t<n&&r[t];++t)r[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},r.mixin(r)},{}],76:[function(e,t,n){var r=function(){return this}(),i=r.WebSocket||r.MozWebSocket;function o(e,t,n){return t?new i(e,t):new i(e)}t.exports=i?o:null,i&&(o.prototype=i.prototype)},{}],77:[function(e,t,n){var r=e("util"),i=e("webrtcsupport"),o=e("rtcpeerconnection"),a=e("wildemitter"),s=e("filetransfer"),c="https://simplewebrtc.com/protocol/filetransfer#inband-v1";function u(e){var t=this;a.call(this),this.id=e.id,this.parent=e.parent,this.type=e.type||"video",this.oneway=e.oneway||!1,this.sharemyscreen=e.sharemyscreen||!1,this.browserPrefix=e.prefix,this.stream=e.stream,this.enableDataChannels=void 0===e.enableDataChannels?this.parent.config.enableDataChannels:e.enableDataChannels,this.receiveMedia=e.receiveMedia||this.parent.config.receiveMedia,this.channels={},this.sid=e.sid||Date.now().toString(),this.pc=new o(this.parent.config.peerConnectionConfig,this.parent.config.peerConnectionConstraints),this.pc.on("ice",this.onIceCandidate.bind(this)),this.pc.on("endOfCandidates",function(e){t.send("endOfCandidates",e)}),this.pc.on("offer",function(e){t.parent.config.nick&&(e.nick=t.parent.config.nick),t.send("offer",e)}),this.pc.on("answer",function(e){t.parent.config.nick&&(e.nick=t.parent.config.nick),t.send("answer",e)}),this.pc.on("addStream",this.handleRemoteStreamAdded.bind(this)),this.pc.on("addChannel",this.handleDataChannelAdded.bind(this)),this.pc.on("removeStream",this.handleStreamRemoved.bind(this)),this.pc.on("negotiationNeeded",this.emit.bind(this,"negotiationNeeded")),this.pc.on("iceConnectionStateChange",this.emit.bind(this,"iceConnectionStateChange")),this.pc.on("iceConnectionStateChange",function(){switch(t.pc.iceConnectionState){case"failed":"offer"===t.pc.pc.localDescription.type&&(t.parent.emit("iceFailed",t),t.send("connectivityError"))}}),this.pc.on("signalingStateChange",this.emit.bind(this,"signalingStateChange")),this.logger=this.parent.logger,"screen"===e.type?this.parent.localScreens&&this.parent.localScreens[0]&&this.sharemyscreen&&(this.logger.log("adding local screen stream to peer connection"),this.pc.addStream(this.parent.localScreens[0]),this.broadcaster=e.broadcaster):this.parent.localStreams.forEach(function(e){t.pc.addStream(e)}),this.on("channelOpen",function(e){e.protocol===c&&(e.onmessage=function(n){var r=JSON.parse(n.data),i=new s.Receiver;i.receive(r,e),t.emit("fileTransfer",r,i),i.on("receivedFile",function(e,t){i.channel.close()})})}),this.on("*",function(){t.parent.emit.apply(t.parent,arguments)})}r.inherits(u,a),u.prototype.handleMessage=function(e){var t=this;if(this.logger.log("getting",e.type,e),e.prefix&&(this.browserPrefix=e.prefix),"offer"===e.type)this.nick||(this.nick=e.payload.nick),delete e.payload.nick,this.pc.handleOffer(e.payload,function(e){e||t.pc.answer(function(e,t){})});else if("answer"===e.type)this.nick||(this.nick=e.payload.nick),delete e.payload.nick,this.pc.handleAnswer(e.payload);else if("candidate"===e.type)this.pc.processIce(e.payload);else if("connectivityError"===e.type)this.parent.emit("connectivityError",t);else if("mute"===e.type)this.parent.emit("mute",{id:e.from,name:e.payload.name});else if("unmute"===e.type)this.parent.emit("unmute",{id:e.from,name:e.payload.name});else if("endOfCandidates"===e.type){(this.pc.pc.transceivers||[]).forEach(function(e){e.iceTransport&&e.iceTransport.addRemoteCandidate({})})}},u.prototype.send=function(e,t){var n={to:this.id,sid:this.sid,broadcaster:this.broadcaster,roomType:this.type,type:e,payload:t,prefix:i.prefix};this.logger.log("sending",e,n),this.parent.emit("message",n)},u.prototype.sendDirectly=function(e,t,n){var r={type:t,payload:n};this.logger.log("sending via datachannel",e,t,r);var i=this.getDataChannel(e);return"open"==i.readyState&&(i.send(JSON.stringify(r)),!0)},u.prototype._observeDataChannel=function(e){var t=this;e.onclose=this.emit.bind(this,"channelClose",e),e.onerror=this.emit.bind(this,"channelError",e),e.onmessage=function(n){t.emit("channelMessage",t,e.label,JSON.parse(n.data),e,n)},e.onopen=this.emit.bind(this,"channelOpen",e)},u.prototype.getDataChannel=function(e,t){if(!i.supportDataChannel)return this.emit("error",new Error("createDataChannel not supported"));var n=this.channels[e];return t||(t={}),n||(n=this.channels[e]=this.pc.createDataChannel(e,t),this._observeDataChannel(n),n)},u.prototype.onIceCandidate=function(e){if(!this.closed)if(e){var t=this.parent.config.peerConnectionConfig;"moz"===i.prefix&&t&&t.iceTransports&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.indexOf(t.iceTransports)<0?this.logger.log("Ignoring ice candidate not matching pcConfig iceTransports type: ",t.iceTransports):this.send("candidate",e)}else this.logger.log("End of candidates.")},u.prototype.start=function(){this.enableDataChannels&&this.getDataChannel("simplewebrtc"),this.pc.offer(this.receiveMedia,function(e,t){})},u.prototype.icerestart=function(){var e=this.receiveMedia;e.mandatory.IceRestart=!0,this.pc.offer(e,function(e,t){})},u.prototype.end=function(){this.closed||(this.pc.close(),this.handleStreamRemoved())},u.prototype.handleRemoteStreamAdded=function(e){var t=this;this.stream?this.logger.warn("Already have a remote stream"):(this.stream=e.stream,this.stream.getTracks().forEach(function(e){e.addEventListener("ended",function(){(function(e){var t=!0;return e.getTracks().forEach(function(e){t="ended"===e.readyState&&t}),t})(t.stream)&&t.end()})}),this.parent.emit("peerStreamAdded",this))},u.prototype.handleStreamRemoved=function(){var e=this.parent.peers.indexOf(this);e>-1&&(this.parent.peers.splice(e,1),this.closed=!0,this.parent.emit("peerStreamRemoved",this))},u.prototype.handleDataChannelAdded=function(e){this.channels[e.label]=e,this._observeDataChannel(e)},u.prototype.sendFile=function(e){var t=new s.Sender,n=this.getDataChannel("filetransfer"+(new Date).getTime(),{protocol:c});return n.onopen=function(){n.send(JSON.stringify({size:e.size,name:e.name})),t.send(e,n)},n.onclose=function(){console.log("sender received transfer"),t.emit("complete")},t},t.exports=u},{filetransfer:35,rtcpeerconnection:53,util:73,webrtcsupport:74,wildemitter:75}],78:[function(e,t,n){var r=e("./webrtc"),i=e("wildemitter"),o=e("webrtcsupport"),a=e("attachmediastream"),s=e("mockconsole"),c=e("./socketioconnection");function u(e){var t,n,u=this,p=e||{},d=this.config={url:serverSocket,socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}};for(t in this.logger=e.debug?e.logger||console:e.logger||s,p)p.hasOwnProperty(t)&&(this.config[t]=p[t]);this.capabilities=o,i.call(this),(n=null===this.config.connection?this.connection=new c(this.config):this.connection=this.config.connection).on("connect",function(){u.emit("connectionReady",n.getSessionid()),u.sessionReady=!0,u.testReadiness()}),n.on("message",function(e){var t,n=u.webrtc.getPeers(e.from,e.roomType);"offer"===e.type?(n.length&&n.forEach(function(n){n.sid==e.sid&&(t=n)}),t||(t=u.webrtc.createPeer({id:e.from,sid:e.sid,type:e.roomType,enableDataChannels:u.config.enableDataChannels&&"screen"!==e.roomType,sharemyscreen:"screen"===e.roomType&&!e.broadcaster,broadcaster:"screen"!==e.roomType||e.broadcaster?null:u.connection.getSessionid()}),u.emit("createdPeer",t)),t.handleMessage(e)):n.length&&n.forEach(function(t){e.sid?t.sid===e.sid&&t.handleMessage(e):t.handleMessage(e)})}),n.on("remove",function(e){e.id!==u.connection.getSessionid()&&u.webrtc.removePeers(e.id,e.type)}),e.logger=this.logger,e.debug=!1,this.webrtc=new r(e),["mute","unmute","pauseVideo","resumeVideo","pause","resume","sendToAll","sendDirectlyToAll","getPeers"].forEach(function(e){u[e]=u.webrtc[e].bind(u.webrtc)}),this.webrtc.on("*",function(){u.emit.apply(u,arguments)}),d.debug&&this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:")),this.webrtc.on("localStream",function(){u.testReadiness()}),this.webrtc.on("message",function(e){u.connection.emit("message",e)}),this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this)),this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this)),this.config.adjustPeerVolume&&(this.webrtc.on("speaking",this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1))),n.on("stunservers",function(e){u.webrtc.config.peerConnectionConfig.iceServers=e,u.emit("stunservers",e)}),n.on("turnservers",function(e){u.webrtc.config.peerConnectionConfig.iceServers=u.webrtc.config.peerConnectionConfig.iceServers.concat(e),u.emit("turnservers",e)}),this.webrtc.on("iceFailed",function(e){}),this.webrtc.on("connectivityError",function(e){}),this.webrtc.on("audioOn",function(){u.webrtc.sendToAll("unmute",{name:"audio"})}),this.webrtc.on("audioOff",function(){u.webrtc.sendToAll("mute",{name:"audio"})}),this.webrtc.on("videoOn",function(){u.webrtc.sendToAll("unmute",{name:"video"})}),this.webrtc.on("videoOff",function(){u.webrtc.sendToAll("mute",{name:"video"})}),this.webrtc.on("localScreen",function(e){var t=document.createElement("video"),n=u.getRemoteVideoContainer();t.oncontextmenu=function(){return!1},t.id="localScreen",a(e,t),n&&n.appendChild(t),u.emit("localScreenAdded",t),u.connection.emit("shareScreen"),u.webrtc.peers.forEach(function(e){var t;"video"===e.type&&(t=u.webrtc.createPeer({id:e.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:u.connection.getSessionid()}),u.emit("createdPeer",t),t.start())})}),this.webrtc.on("localScreenStopped",function(e){u.getLocalScreen()&&u.stopScreenShare()}),this.webrtc.on("channelMessage",function(e,t,n){"volume"==n.type&&u.emit("remoteVolumeChange",e,n.volume)}),this.config.autoRequestMedia&&this.startLocalVideo()}u.prototype=Object.create(i.prototype,{constructor:{value:u}}),u.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare(),this.emit("leftRoom",this.roomName),this.roomName=void 0}},u.prototype.disconnect=function(){this.connection.disconnect(),delete this.connection},u.prototype.handlePeerStreamAdded=function(e){var t=this,n=this.getRemoteVideoContainer(),r=a(e.stream);e.videoEl=r,r.id=this.getDomId(e),n&&n.appendChild(r),this.emit("videoAdded",r,e),window.setTimeout(function(){t.webrtc.isAudioEnabled()||e.send("mute",{name:"audio"}),t.webrtc.isVideoEnabled()||e.send("mute",{name:"video"})},250)},u.prototype.handlePeerStreamRemoved=function(e){var t=this.getRemoteVideoContainer(),n=e.videoEl;this.config.autoRemoveVideos&&t&&n&&t.removeChild(n),n&&this.emit("videoRemoved",n,e)},u.prototype.getDomId=function(e){return[e.id,e.type,e.broadcaster?"broadcasting":"incoming"].join("_")},u.prototype.setVolumeForAll=function(e){this.webrtc.peers.forEach(function(t){t.videoEl&&(t.videoEl.volume=e)})},u.prototype.joinRoom=function(e,t){var n=this;this.roomName=e,this.connection.emit("join",e,function(r,i){var o,a,s,c;if("undefined"!=typeof debugMainRingow&&!0===debugMainRingow&&console.log("join CB",r,i),r)n.emit("error",r);else for(o in i.clients)for(s in a=i.clients[o])a[s]&&(c=n.webrtc.createPeer({id:o,type:s,enableDataChannels:n.config.enableDataChannels&&"screen"!==s,receiveMedia:{offerToReceiveAudio:"screen"!==s&&n.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:n.config.receiveMedia.offerToReceiveVideo}}),n.emit("createdPeer",c),c.start());t&&t(r,i),n.emit("joinedRoom",e)})},u.prototype.getEl=function(e){return"string"==typeof e?document.getElementById(e):e},u.prototype.startLocalVideo=function(){var e=this;this.webrtc.start(this.config.media,function(t,n){t?e.emit("localMediaError",t):a(n,e.getLocalVideoContainer(),e.config.localVideo)})},u.prototype.stopLocalVideo=function(){this.webrtc.stop()},u.prototype.getLocalVideoContainer=function(){var e=this.getEl(this.config.localVideoEl);if(e&&"VIDEO"===e.tagName)return e.oncontextmenu=function(){return!1},e;if(e){var t=document.createElement("video");return t.oncontextmenu=function(){return!1},e.appendChild(t),t}},u.prototype.getRemoteVideoContainer=function(){return this.getEl(this.config.remoteVideosEl)},u.prototype.shareScreen=function(e){this.webrtc.startScreenShare(e)},u.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]},u.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var e=document.getElementById("localScreen"),t=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&t&&e&&t.removeChild(e),e&&this.emit("videoRemoved",e),this.getLocalScreen()&&this.webrtc.stopScreenShare(),this.webrtc.peers.forEach(function(e){e.broadcaster&&e.end()})},u.prototype.testReadiness=function(){this.sessionReady&&(this.config.media.video||this.config.media.audio?this.webrtc.localStreams.length>0&&this.emit("readyToCall",this.connection.getSessionid()):this.emit("readyToCall",this.connection.getSessionid()))},u.prototype.createRoom=function(e,t){this.roomName=e,2===arguments.length?this.connection.emit("create",e,t):this.connection.emit("create",e)},u.prototype.sendFile=function(){if(!o.dataChannel)return this.emit("error",new Error("DataChannelNotSupported"))},t.exports=u},{"./socketioconnection":79,"./webrtc":80,attachmediastream:3,mockconsole:46,webrtcsupport:74,wildemitter:75}],79:[function(e,t,n){var r=e("socket.io-client");function i(e){this.connection=r.connect(e.url,e.socketio)}i.prototype.on=function(e,t){this.connection.on(e,t)},i.prototype.emit=function(){this.connection.emit.apply(this.connection,arguments)},i.prototype.getSessionid=function(){return this.connection.id},i.prototype.disconnect=function(){return this.connection.disconnect()},t.exports=i},{"socket.io-client":60}],80:[function(e,t,n){var r=e("util"),i=e("webrtcsupport"),o=e("mockconsole"),a=e("localmedia"),s=e("./peer");function c(e){var t,n=this,r=e||{};this.config={debug:!1,peerConnectionConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[]},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},enableDataChannels:!0};for(t in this.logger=e.debug?e.logger||console:e.logger||o,r)r.hasOwnProperty(t)&&(this.config[t]=r[t]);i.support||this.logger.error("Your browser doesn't seem to support WebRTC"),this.peers=[],a.call(this,this.config),this.on("speaking",function(){n.hardMuted||n.peers.forEach(function(e){if(e.enableDataChannels){var t=e.getDataChannel("hark");if("open"!=t.readyState)return;t.send(JSON.stringify({type:"speaking"}))}})}),this.on("stoppedSpeaking",function(){n.hardMuted||n.peers.forEach(function(e){if(e.enableDataChannels){var t=e.getDataChannel("hark");if("open"!=t.readyState)return;t.send(JSON.stringify({type:"stoppedSpeaking"}))}})}),this.on("volumeChange",function(e,t){n.hardMuted||n.peers.forEach(function(t){if(t.enableDataChannels){var n=t.getDataChannel("hark");if("open"!=n.readyState)return;n.send(JSON.stringify({type:"volume",volume:e}))}})}),this.config.debug&&this.on("*",function(e,t,r){(n.config.logger===o?console:n.logger).log("event:",e,t,r)})}r.inherits(c,a),c.prototype.createPeer=function(e){var t;return e.parent=this,t=new s(e),this.peers.push(t),t},c.prototype.removePeers=function(e,t){this.getPeers(e,t).forEach(function(e){e.end()})},c.prototype.getPeers=function(e,t){return this.peers.filter(function(n){return!(e&&n.id!==e||t&&n.type!==t)})},c.prototype.sendToAll=function(e,t){this.peers.forEach(function(n){n.send(e,t)})},c.prototype.sendDirectlyToAll=function(e,t,n){this.peers.forEach(function(r){r.enableDataChannels&&r.sendDirectly(e,t,n)})},t.exports=c},{"./peer":77,localmedia:44,mockconsole:46,util:73,webrtcsupport:74}]},{},[78])(78)});