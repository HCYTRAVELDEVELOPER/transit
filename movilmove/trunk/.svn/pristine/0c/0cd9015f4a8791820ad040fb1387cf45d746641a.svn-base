nw.Class.define("f_documentos_conductor",{extend:nw.forms,construct:function(e,a){var i=this,o=!0,n=!1,a=(!0===(o=void 0!==a?a:o)?(n="f_documentos_conductor_foo",i.canvas="#foo",i.id_form="f_documentos_conductor"):(i.id="f_documentos_conductor",i.setTitle="",i.html="<div class='vehiculo'>"+nw.tr("Documentos")+"</div>",i.showBack=!0,i.closeBack=!1,i.textClose="Volver",i.colorBtnBackIOS="#ffffff;",i.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",i.createBase()),i.actualizar=!1,i.event=new Event("cancelservice"),nw.userPolicies.getUserData()),o=!1,t=!1,r=!1,c=!1,s=!1,l=!1,d=!1,u=!1,p=!1,v=!1,m=!1,_=!1,f=!1,a=(nw.evalueData(e)?(nw.evalueData(e.foto_perfil)&&(o=e.foto_perfil),nw.evalueData(e.lic_conductor1)&&(t=e.lic_conductor1),nw.evalueData(e.lic_conductor2)&&(r=e.lic_conductor2),nw.evalueData(e.selfie_licencia)&&(c=e.selfie_licencia),nw.evalueData(e.hoja_vida)&&(s=e.hoja_vida),nw.evalueData(e.antecedentes_judiciales)&&(d=e.antecedentes_judiciales),nw.evalueData(e.documento_imagen)&&(l=e.documento_imagen),nw.evalueData(e.documento_imagen_respaldo)&&(u=e.documento_imagen_respaldo),nw.evalueData(e.referencias_per_lab)&&(p=e.referencias_per_lab),nw.evalueData(e.arl)&&(v=e.arl),nw.evalueData(e.eps)&&(m=e.eps),nw.evalueData(e.afp)&&(_=e.afp),nw.evalueData(e.adjunto_rut)&&(f=e.adjunto_rut)):nw.evalueData(e.foto_perfil)||(o=a.foto_perfil),[{name:"title_enc",label:"<h5 class='titleencdocs'>"+nw.tr("Documentos de conducción")+"</h5>",type:"html"},{name:"foto_perfil",label:"Foto de conductor",placeholder:"Foto de conductor",type:"button",mode:"camera_files",quality:25,allowEdit:!1,data:o,required:!0,visible:!0},{name:"tipo_doc",label:"Tipo de documento",placeholder:"Tipo de documento",type:"selectBox",visible:!0},{name:"nit",label:"Número de documento",placeholder:"Número de documento",type:"textField",car_min:"5",car_max:"25",required:!0,visible:!0},{name:"documento_imagen",label:"Imagen de documento",placeholder:"Imagen de documento",type:"button",mode:"camera_files",data:l,required:!0,visible:!0},{name:"documento_imagen_respaldo",label:"Imagen de documento respaldo",placeholder:"Imagen de documento respaldo",type:"button",mode:"camera_files",data:u},{name:"direccion_domicilio",label:"Dirección de domicilio",placeholder:"Dirección de domicilio",type:"textField"},{name:"celular",label:"Número móvil celular",placeholder:"Celular",type:"numeric"},{name:"afp",label:"Pensión",placeholder:"Pensión",type:"button",mode:"camera_files",data:_},{name:"eps",label:"EPS",placeholder:"EPS",type:"button",mode:"camera_files",data:m},{name:"arl",label:"ARL",placeholder:"ARL",type:"button",mode:"camera_files",data:v},{name:"referencias_per_lab",label:"Referencia personal y laboral",placeholder:"Referencia personal y laboral",type:"button",mode:"camera_files",data:p},{name:"no_licencia",label:"Licencia de conducción",placeholder:"Licencia de conducción",type:"numeric",car_min:"5",car_max:"16"},{name:"categoria",label:"Categoría licencia",placeholder:"Categoría licencia",type:"selectBox"},{name:"fecha_vencimiento",label:"Licencia fecha vencimiento",placeholder:"Licencia fecha vencimiento",type:"dateField"},{name:"lic_conductor1",label:"Imagen de licencia frontal",placeholder:"Imagen de licencia frontal",type:"button",mode:"camera_files",data:t},{name:"lic_conductor2",label:"Imagen de licencia trasera",placeholder:"Imagen de licencia trasera",type:"button",mode:"camera_files",data:r},{name:"selfie_licencia",label:"Foto de conductor y licencia",placeholder:"Foto de conductor y licencia",type:"button",mode:"camera_files",data:c},{name:"hoja_vida",label:"Hoja de vida",placeholder:"Hoja de vida",type:"button",mode:"camera_files",data:s},{name:"antecedentes_judiciales",label:"Antecedentes judiciales",placeholder:"Antecedentes judiciales",type:"button",mode:"camera_files",data:d},{name:"codigo_rut",label:"Código Rut",placeholder:"Código Rut",type:"textField"},{name:"adjunto_rut",label:"Imagen Rut",placeholder:"Imagen Rut",type:"button",mode:"camera_files",data:f},{name:"capacitaciones",label:"Capacitaciones",type:"switch",options:"<option value='false'>NO</option><option value='true'>SI</option>"},{styleContainer:"margin:0;",label:"Otros documentos",name:"adjuntos_html",type:"startGroup"},{style:"background: #ec7c7c; color: #fff;",name:"nuevo_documento",label:"Nuevo Documento",type:"button"},{type:"endGroup"}]),o=(a.push({name:"datos_contacto_emergencia",label:"Nombre y número de contacto en caso de emergencia",placeholder:"",type:"textArea"}),i.setFields(main.labels(a)),i.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar btn_generic btn_generic_aceptar_vehiculo",label:"Guardar",callback:function(){i.actualizar?i.actualizarDocu():i.save()}}],i.show(),nw.addClass(document.querySelector(i.canvas),"f_documentos_conductor"),nw.evalueData(n)&&nw.addClass(document.querySelector(i.canvas),n),void 0!==main.configCliente.documentos_driver&&$.each(main.configCliente.documentos_driver,function(e,a){var o;"id"!=e&&(o="NO"!==a,void 0!==i.ui[e])&&("SI_REQUIRED_FALSE"===a?(i.ui[e].setVisibility(!0),i.ui[e].setRequired(!1)):(i.ui[e].setVisibility(o),i.ui[e].setRequired(o)))}),i.ui.nuevo_documento.addListener("click",function(){i.nuevoDocumento()}),i.ui.tipo_doc.populateSelectFromArray(main.tipoDoc()),0==e?i.consultaDocu():"1"==e.estado_activacion&&(nw.utils.validateElementIfExist("#f_documentos_conductor .contentCenter",function(e){e&&(e.style.pointerEvents="none")}),nw.utils.validateElementIfExist("#f_documentos_conductor .btn_generic_aceptar_vehiculo",function(e){e&&(e.style.display="none")})),{});o[""]="Seleccione",o.A1="A1",o.A2="A2",o.B1="B1",o.B2="B2",o.B3="B3",o.C1="C1",o.C2="C2",o.C3="C3",i.ui.categoria.populateSelectFromArray(o),i.createNavTableOtrosDocumentos()},destruct:function(){},members:{nuevoDocumento:function(){var o=this,i=new nw.forms;i.id="generarFirma",i.html="<h1 style='text-align:center;'>Nuevo documento</h1><br />",i.showBack=!0,i.createBase();i.setFields([{name:"nombre",label:"Nombre",type:"textField",required:!0},{name:"adjunto",label:"Adjunto",type:"button",mode:"camera_files",required:!0},{name:"descripcion",label:"Descripción Adjunto",type:"textField"}]),i.buttons=[{style:"text-shadow: none;font-weight: lighter;border: 0;",className:"btn_maxwidth",name:"aceptar",label:"Guardar",callback:function(){if(!i.validate())return!1;var e=nw.userPolicies.getUserData(),a=i.getRecord(),e=(a.usuario=e.usuario,a.conductor=e.usuario,a.empresa=e.empresa,a.usuario_text=e.nombre,a.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0);e.exec("saveOtrosDocumentosConductor",a,function(e){nw.setUserInfo(e,function(){o.navTable.applyFilters(),nw.back()})})}}],i.show()},createNavTableOtrosDocumentos:function(){var e=this.datos,a=(console.log(e),new l_navtable_otros_documentos);a.construct("#f_documentos_conductor #adjuntos_html",e),this.navTable=a},consultaDocu:function(){var a=this,e=nw.userPolicies.getUserData(),o=a.getRecord(!0),e=(o.usuario=e.usuario,o.empresa=e.empresa,o.usuario_text=e.nombre,o.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0);e.exec("consultaDatosConductor",o,function(e){console.log(e),a.populate(e)})},actualizarDocu:function(){if(!this.validate())return!1;var e=nw.userPolicies.getUserData(),a=this.getRecord(!0),e=(a.usuario=e.usuario,a.empresa=e.empresa,a.usuario_text=e.nombre,a.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0),e.setLoading(!0);e.exec("actualizarDatosConductor",a,function(e){nw.setUserInfo(e,function(){window.location.reload()})})},save:function(){if(!this.validate())return!1;var e=nw.userPolicies.getUserData(),a=this.getRecord(!0),e=(a.usuario=e.usuario,a.empresa=e.empresa,a.usuario_text=e.nombre,a.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0),e.setLoading(!0);e.exec("saveDatosConductor",a,function(e){nw.setUserInfo(e,function(){window.location.reload()})})},populate:function(e){var a=nw.userPolicies.getUserData();console.log("populatepopulatepopulate::::::::::::",a),nw.evalueData(e)||(e={}),nw.evalueData(e.nit)||(e.nit=a.nit),nw.evalueData(e.tipo_doc)||(e.tipo_doc_tab=a.tipo_doc),nw.evalueData(e.celular)||(e.celular=a.celular),console.log("populate::::::::::::::::::::::::::::::::::",e),this.setRecord(e),nw.evalueData(e.tipo_doc_tab)&&this.ui.tipo_doc.setValue(e.tipo_doc_tab)}}}),nw.Class.define("f_referidos",{extend:nw.forms,construct:function(e){var a=this,i=(a.id="f_referidos",a.setTitle="<span style='color:#fff;'>Referidos</span>",a.html="",a.showBack=!0,a.closeBack=!1,a.textClose="Volver",a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e,a.configCliente=main.configCliente,nw.userPolicies.getUserData()),e=[],o=(console.log(i.code_referido),console.log(a.configCliente),{}),o=(o.id_ref=i.id_usuario,o.perf=i.perfil,nw.evalueData(i.code_referido)&&nw.evalueData(a.configCliente.numero_referidos)&&0<(e=JSON.parse(i.code_referido)).length&&e.length==a.configCliente.numero_referidos&&e.shift(),e.push(o),e=JSON.stringify(e),domainExternConfigName.replace("_driver","")),o=(console.log("nameconfig",o),a.link=config.domain_rpc+"/lib_mobile/user/index.html?empresa="+i.empresa+"&createAccount=true&code_referido="+e+"&conf="+o,a.link_driver=config.domain_rpc+"/lib_mobile/driver/index.html?empresa="+i.empresa+"&createAccount=true&code_referido="+e+"&conf="+domainExternConfigName,[]);o.push({label:"",style:"",name:"contenedor_refiere_amigos",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRefiereAmigos' style='background-image: url("+config.domain_rpc+"/lib_mobile/user/img/imagen_referido_amigo.png);'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRefiereAmigos'>"+nw.tr("Refiere amigos")+"</span><span class='descpRefiereAmigos'>"+nw.tr("Este es tu link, puedes copiarlo y compartirlo para que tus contactos se registren como usuario")+"</span>",type:"html"},{label:"",style:"",name:"contenedor_refiere_amigos_actions",mode:"div",type:"startGroup"},{name:"my_link",label:"",placeholder:a.link,type:"textField",required:!0,visible:!0},{label:"",style:"",name:"contenedor_refiere_amigos_buttons",mode:"div",type:"startGroup"},{name:"my_link_copy",label:'<i class="material-icons">content_copy</i>',type:"button"},{name:"my_link_shared",label:nw.tr("Compartir")+" <i class='material-icons'>share</i>",type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}),o.push({label:"",style:"",name:"contenedor_refiere_conductores",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRefiereAmigos'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRefiereAmigos'>"+nw.tr("Refiere conductores")+"</span><span class='descpRefiereAmigos'>"+nw.tr("Cópialo y compártelo con tus amigos conductores")+"</span>",type:"html"},{label:"",style:"",name:"contenedor_refiere_amigos_actions",mode:"div",type:"startGroup"},{name:"my_link_driver",label:"",placeholder:a.link,type:"textField",required:!0,visible:!0},{label:"",style:"",name:"contenedor_refiere_amigos_buttons",mode:"div",type:"startGroup"},{name:"my_link_copy_driver",label:'<i class="material-icons">content_copy</i>',type:"button"},{name:"my_link_shared_driver",label:nw.tr("Compartir")+" <i class='material-icons'>share</i>",type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}),$(a.canvas).append("<style>.contentCenter .contenedor_refiere_conductores{background-image: url("+config.domain_rpc+"/lib_mobile/user/img/Referido_amigo_conductor.jpg);}</style>"),a.setFields(o),a.show(),a.onAppear(function(){setTimeout(function(){a.getUrl(function(o){a.ui.my_link.setValue(o.link),a.ui.my_link_driver.setValue(o.link_driver),a.ui.my_link_copy.addListener("click",function(){document.querySelector(".my_link").select(),document.execCommand("copy")}),a.ui.my_link_shared.addListener("click",function(){var e="¡Gana más con "+config.name+"!",a="¡Gana más con "+config.name+"! "+i.nombre+" te refirió para que te unas como usuario a "+config.name+", la línea de transporte única en Colombia, enlace: "+o.link;nw.evalueData(config.titleReferidoUser)&&(e=config.titleReferidoUser.replace("{link}",o.link)),nw.evalueData(config.bodyReferidoUser)&&(a=config.bodyReferidoUser.replace("{link}",o.link)),nw.shareSocial(a,e)}),a.ui.my_link_copy_driver.addListener("click",function(){document.querySelector(".my_link_driver").select(),document.execCommand("copy")}),a.ui.my_link_shared_driver.addListener("click",function(){var e="¡Gana más con "+config.name+"!",a="¡Gana más con "+config.name+"! "+i.nombre+" te refirió para que te unas como conductor a "+config.name+", la línea de transporte única en Colombia, enlace: "+o.link_driver;nw.evalueData(config.titleReferidoDriver)&&(e=config.titleReferidoDriver.replace("{link}",o.link_driver)),nw.evalueData(config.bodyReferidoDriver)&&(a=config.bodyReferidoDriver.replace("{link}",o.link_driver)),nw.shareSocial(a,e)})})},100)})},destruct:function(){},members:{getUrl:function(a){var e=nw.userPolicies.getUserData(),o=this.getRecord(!0),e=(o.usuario=e.usuario,o.empresa=e.empresa,o.perfil=e.perfil,o.domain=config.domain_rpc,o.link_driver=this.link_driver,o.link=this.link,new nw.rpc(nw.getRpcUrl(),"conductores"));e.setAsync(!0),e.setLoading(!1);e.exec("getUrlShort",o,function(e){nw.loadingRemove(),console.log(e),a(e)})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_recargas",{extend:nw.forms,construct:function(e){var l=this;nw.userPolicies.getUserData(),l.id="f_recargas",l.setTitle="<span style='color:#fff;'>Recargas</span>",l.showBack=!0,l.closeBack=!1,l.textClose="Volver",l.colorBtnBackIOS="#ffffff;",l.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",l.createBase(),l.callback=e,l.configCliente=main.configCliente;l.consultaPlanes(function(s){l.consultaSaldo(function(e){for(var a=0,o=(nw.evalueData(e.saldo)&&(a=e.saldo),""),i=(nw.evalueData(config.usaFechaVencimientoSaldo)&&!0===config.usaFechaVencimientoSaldo&&(o="<br />Saldo recargado en tiempo: <span class='saldo_tit_tot'>$"+e.saldo_por_tiempo+"</span>",o=(o+="<br />Fecha vencimiento: <span class='saldo_tit_tot'>"+e.fecha_vencimiento_saldo+"</span>")+"<br />Fecha Última recarga: <span class='saldo_tit_tot'>"+e.fecha_ultima_recarga+"</span>"),[{label:"",style:"",name:"contenedor_recargas",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRecargas' style='background-image: url("+config.domain_rpc+"/lib_mobile/driver/img/recargas.png); background-size: 144px;background-position: center;'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRecargas'>Recarga saldo</span><span class='descpRecargas'>Te quedaste sin saldo recarga y sigue disfrutando de nuestros servicios.</span>",type:"html"},{label:"",style:"",name:"contenedor_service_recargas",mode:"div",type:"startGroup"},{name:"my_link_description_saldo",label:"<div class='titleSaldo'>Tu saldo es <span class='saldo_tit_tot'> $"+nw.addNumber(a)+"</span>"+o+"</div>",type:"html"},{name:"my_link_saldo",label:"<span class='iconRecargas'><i class='material-icons'>attach_money</i></span><span class='contSaldo'>Recargar Saldo</span>",type:"html"},{label:"",style:"",name:"contenedor_recargas_actions",mode:"div",type:"startGroup"},{name:"valor_recarga",label:"",placeholder:"Ingresa el valor",type:"integer",visible:!0},{label:"",style:"",name:"contenedor_recargas_buttons_actions",mode:"div",type:"startGroup"},{name:"recargar",label:"Pagar con "+config.paymentStore,type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}]),n=0;n<s.length;n++){console.log(s[n]);var t={name:"my_link_planes",label:"<span class='iconContPlanes'><i class='material-icons'>library_add</i></span><span class='contPlanes' data='"+s[n].valor_recarga+"' data_id='"+s[n].id+"' data_recarga='"+s[n].total_recarga+"' data_tiempo='"+(void 0===s[n].tiempo_vencimiento||void 0!==s[n].tiempo_vencimiento&&null==s[n].tiempo_vencimiento?0:s[n].tiempo_vencimiento)+"'>"+s[n].nombre+"</span>",type:"html"};i.push(t)}for(var r=[{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}],c=0;c<r.length;c++)i.push(r[c]);l.setFields(i),l.show(),nw.evalueData(l.configCliente.usar_recarga_libre_driver)&&"NO"==l.configCliente.usar_recarga_libre_driver&&(l.ui.my_link_saldo.setVisibility(!1),l.ui.valor_recarga.setVisibility(!1),$("#f_recargas .nw_widget_div_my_link_planes").css("cssText","margin-top: 51px;")),$("#f_recargas .nw_label_valor_recarga").css("cssText","display:none!important;"),l.ui.recargar.addListener("click",function(){var e,a,o=l.ui.valor_recarga.getValue(),i=(nw.evalueData(o)||(o="0"),300);console.log(l.configCliente),nw.evalueData(l.configCliente.valor_minimo_recarga)&&(i=l.configCliente.valor_minimo_recarga),parseFloat(o)<parseFloat(i)?(nw.dialog("El valor debe ser superior a $"+i),l.ui.valor_recarga.setValue("")):parseFloat(o)>parseFloat(1e4)?(nw.dialog("El valor maximo de recarga es de $"+1e4),l.ui.valor_recarga.setValue("")):(nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(e=l.ui.valor_recarga.getValue(),o+="00"),i=nw.userPolicies.getUserData(),(a={}).valor_plan=o,a.id_plan=0,a.total_recarga=o,a.usuario=i.usuario,a.empresa=i.empresa,a.nombre=i.nombre+" "+i.apellido,a.perfil=i.perfil,a.tipo="recarga",a.name_empresa=config.name,nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(a.valor_formato=e),l.pago(a))}),$(".nw_widget_div_my_link_planes").bind("click",function(){var e=nw.userPolicies.getUserData(),a={},o=(a.valor_plan=this.querySelector(".contPlanes").getAttribute("data"),nw.evalueData(a.valor_plan)||(a.valor_plan="0"),300);console.log(l.configCliente),nw.evalueData(l.configCliente.valor_minimo_recarga)&&(o=l.configCliente.valor_minimo_recarga),parseFloat(a.valor_plan)<parseFloat(o)?(nw.dialog("El valor debe ser superior a $"+o),l.ui.valor_recarga.setValue("")):parseFloat(a.valor_plan)>parseFloat(1e6)?(nw.dialog("El valor maximo de recarga es de $"+1e6),l.ui.valor_recarga.setValue("")):(nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(a.valor_plan=a.valor_plan.slice(0,-2)),console.log(a.valor_plan),a.id_plan=this.querySelector(".contPlanes").getAttribute("data_id"),a.total_recarga=this.querySelector(".contPlanes").getAttribute("data_recarga"),a.total_tiempo=this.querySelector(".contPlanes").getAttribute("data_tiempo"),a.usuario=e.usuario,a.empresa=e.empresa,a.nombre=e.nombre+" "+e.apellido,a.perfil=e.perfil,a.name_empresa=config.name,a.tipo="plan",l.pago(a))})})})},destruct:function(){},members:{consultaSaldo:function(a){var e=nw.userPolicies.getUserData(),o={},e=(o.id=e.id_usuario,nw.evalueData(config.usaFechaVencimientoSaldo)&&!0===config.usaFechaVencimientoSaldo&&(o.fecha_vencimiento_saldo="SI"),new nw.rpc(nw.getRpcUrl(),"nwMaker"));e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Verificando saldos y vencimientos..."});e.exec("consultaSaldoUserApp",o,function(e){console.log(e),nw.loadingRemove(),a(e)})},pago:function(n){var e,a,o=nw.userPolicies.getUserData();console.log("up",o),console.log("datos",n),console.log("config.paymentStore",config.paymentStore),"Wompi"==config.paymentStore?(a=parseFloat(Math.trunc(n.total_recarga.toString())+"00"),console.log("price",a),(e={}).reference=n.usuario+"-"+Math.random(),e.price=a,e.email=o.email,e.fullName=o.nombre+" "+o.apellido,e.phoneNumber=o.celular,e.phoneNumberPrefix="+"+config.indicativo,(new nw.payWompi).start(e)):nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore?(nw.createNotificacionBarInter({addClass:"notifyRedirect",timeToRemove:2e3,title:"Cargando...",body:"En segundos serás redireccionado a la pasarela de pagos.",icon:!1,callbackEndTime:function(){}}),setTimeout(function(){var e={ruta:"/app/pagos/"},a=(e.name=n.nombre,e.email=n.usuario,e.itemName="Recarga saldo "+n.name_empresa,e.itemDescription="Recarga saldo "+n.name_empresa,e.item_unit_price=n.total_recarga,e.itemQuantity=1,e.street1="Calle 123, int 2",e.postal_code="06100",e.country="MX",e.callBackEnd=function(e){},e.callBackClose=function(e){return nw.refreshSessionApp(function(){main.reloadApp()}),!0},{total_recarga:n.valor_plan,tipo:n.tipo,descripcion:"Recarga saldo "+n.name_empresa,total_tiempo:n.total_tiempo});nw.evalueData(n.valor_formato)&&(a.valor_formato=n.valor_formato),e.extra=JSON.stringify(a),nw.payConekta.start(e)},1e3)):((a=new nw.rpc(nw.getRpcUrl(),"servicios")).setAsync(!0),a.exec("saveRecarga",n,function(o){nw.createNotificacionBarInter({addClass:"notifyRedirect",timeToRemove:15e3,title:"Cargando...",body:"En segundos serás redireccionado a la pasarela de pagos.",icon:!1,data:o,callbackEndTime:function(){nw.dialog("Finalizar",function(){nw.activateBackgroundMode(),nw.refreshSessionApp(function(){main.reloadApp()})})}});var i="f3566b13f1e134574b53e67121b5a588";void 0!==config.apiKeyEpayco&&""!==config.apiKeyEpayco&&(i=config.apiKeyEpayco),setTimeout(function(){nw.loadJs("https://checkout.epayco.co/checkout.js",function(){var e=ePayco.checkout.configure({key:i,test:!1}),a={name:"Recarga saldo "+n.name_empresa,description:"Recarga saldo "+n.name_empresa,invoice:o,currency:"cop",amount:n.valor_plan,tax_base:"0",tax:"0",country:"CO",lang:"es",external:"false",extra1:n.usuario,extra2:n.empresa,extra3:n.perfil,extra4:n.total_recarga,extra5:n.tipo,confirmation:config.domain_rpc+"/app/confirmacionPayco.php?type=false",response:config.domain_rpc+"/app/confirmacionPayco.php?type=true",name_billing:"",address_billing:"",type_doc_billing:"",mobilephone_billing:"",number_doc_billing:""};e.open(a)})},1e3)}))},consultaPlanes:function(a){var e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,o.empresa=e.empresa,o.perfil=e.perfil,new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Consultando planes..."});e.exec("consultaSaldo",o,function(e){console.log(e),nw.loadingRemove(),a(e)})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_driver_mapa_servicios",{extend:nw.forms,construct:function(e){var o=this,a=(main.f_drive_mapa_servicios=o,nw.activateBackgroundMode(),o.canvas="#foo",o.id_form="f_driver_mapa_servicios",o.recorridosave=null,o.map=null,o.timeToValideServiceActive=1e4,o.deviceRotation=0,o.oncal=!1,o.debug=!1,o.debugConstruct=main.debugConstruct,o.drag=!1,o.zoom=16,o.valor_total_digitado=0,o.intervalService=null,o.intervalServiceCount=null,o.actEnRuta=!1,o.configCliente=main.configCliente,nw.evalueData(o.configCliente.valor_minimo_retiro)&&(config.valor_minimo_retiro=o.configCliente.valor_minimo_retiro),o.positionConductor={},o.__intvHours=!1,o.cobro_con=main.cobro_con,o.execCallBakWatchInitial=!1,o.trazaLineaCreada=!1,o.timeIntervaloSearchServices=1e4,o.frameChat=null,o.serviceActive=!1,o.latitudDestino=null,o.longitudDestino=null,o.idServicesMostrados=[],nw.evalueData(window.localStorage.getItem("addRechazadoServiceMostrado"))?(a=window.localStorage.getItem("addRechazadoServiceMostrado"),o.idServicesMostrados=JSON.parse(a)):window.localStorage.setItem("addRechazadoServiceMostrado","[]"),o.idServicesRechazados=[],o.id_service=!1,o.data_service=!1,o.loadedFirst=!1,o.interval=null,o.marker1=!1,o.marker2=!1,o.markerSelected=!1,o.line=!1,o.launch=!0,o.dragMapa=!0,o.time=0,o.heatmap=!1,o.vehiculo=main.vehiculo,o.numServicio=new Array,o.hora_inicio_viaje="",o.estado_activacion="",o.finalizaServiceActive=!1,o.poly={},o.geo={},o.geoDestino={},o.ui_servi={},o.heightMap=$("body").height(),o.cancela_conductor=!1,"Confirmar abordaje"),i=("string"==typeof o.configCliente.texto_boton_confirmar_abordaje&&""!=o.configCliente.texto_boton_confirmar_abordaje&&"0"!=o.configCliente.texto_boton_confirmar_abordaje&&o.configCliente.texto_boton_confirmar_abordaje.length<=25&&(a=o.configCliente.texto_boton_confirmar_abordaje),"Finalizar viaje"),n=(nw.evalueData(o.configCliente.texto_boton_llegada_destino)&&(i=o.configCliente.texto_boton_llegada_destino),"SI"==o.configCliente.cancela_conductor&&(o.cancela_conductor=!0),[{styleContainer:"margin:0;",label:"",name:"mapa",mode:"div",type:"startGroup"},{mode:"div",type:"endGroup"},{styleContainer:"margin:0;",style:"",label:"",name:"ofline",type:"startGroup"},{type:"endGroup"},{style:"",label:"",name:"buttons_driver",type:"startGroup"},{type:"button",label:"Desconectarme, no recibir nuevos servicios",name:"status_driver",visible:!1},{type:"button",label:"Poner online",name:"driver_online",visible:!1},{type:"button",label:"Ob",name:"driver_novedad"},{type:"endGroup"},{style:"",label:"",name:"grupo_nueva_solicitud",type:"startGroup"},{type:"html",label:"",name:"html_grupo_nueva_solicitud"},{icon:"material-icons timer tiempo",visible:!1,required:!0,label:"Llegaré en",name:"tiempo_estimado",type:"selectBox"},(n={},n=1==o.cancela_conductor?{type:"button",label:"Cancelar",name:"cancelar_pedido"}:n),{type:"button",label:"Confirmar llegada",name:"confirmar_llegada"},{type:"button",label:a,name:"confirmar_abordaje"},{type:"numeric",label:"precio viaje",name:"precio_viaje",required:!0},{type:"button",label:"Cobrar",name:"cobrar"},{type:"button",rangeMax:"100",rangeMin:"1",label:i,name:"finalizar_viaje"},{type:"button",label:"Rechazar",name:"rechazar_pedido_driver"},{type:"button",label:"Aceptar",name:"aceptar_pedido_driver"},{type:"endGroup"},{label:"",name:"widget_hours",type:"startGroup",mode:"vertical"},{name:"state_travel",label:"Estado del viaje",placeholder:"Escriba  el estado o descripción del viaje",type:"textArea"},{type:"button",name:"save_state",label:"Guardar"},{type:"endGroup"},{label:"",name:"widget_verifica_codigo",type:"startGroup",mode:"vertical"},{label:"Ingrese el código de verificación",name:"widget_verifica_codigo_inter",type:"startGroup",mode:"vertical"},{name:"codigo1",label:"",placeholder:"",car_max:4,type:"numeric"},{type:"button",name:"cancel_code",label:"Cancelar"},{type:"button",name:"confirmar_code",label:"Confirmar"},{type:"endGroup"},{type:"endGroup"},{label:"",name:"frame",type:"startGroup",mode:"vertical"},{type:"endGroup"}]),i=(o.setFields(n),o.buttons=[],o.buttons.push({colorBtnBackIOS:"#19b8d3",icon:"material-icons my_location mi_ubication_pin_geo",position:"top",name:"centrar_mapa",label:"",callback:function(){o.dragMapa=!0,o.drag=!1,void 0!==o.timeDrag&&(clearTimeout(o.timeDrag),delete o.timeDrag),o.centerUbication()}},{colorBtnBackIOS:"rgb(25, 24, 23)",icon:"material-icons blur_off map_cal",position:"top",name:"map_calor",label:"",callback:function(){var e=document.querySelector(".map_calor .map_cal");o.oncal?(e.innerHTML="blur_off",e.style="rgb(25, 24, 23);",o.oncal=!1,o.removeMapaDeCalorService()):(e.innerHTML="blur_on",e.style="color:#c04025;",o.oncal=!0,o.mapaDeCalorService())}}),o.show(),$("body").delegate(".cliente_foto","click touch",function(){var e=this.getAttribute("data");nw.evalueData(e)&&nw.nw_dialog("<div class='imgClienteOpen' style='background-image: url("+e+");'></div>")}),nw.addClass(document.querySelector(o.canvas),"f_driver_mapa_servicios"),o.removeStateTravel(),1==o.cancela_conductor&&((a=document.querySelector(".nw_widget_div_confirmar_llegada"))&&a.classList.add("nw_widget_div_parent_cancel"),(i=document.querySelector("#confirmar_llegada"))&&i.classList.add("parent_cancel"),(n=document.querySelector(".nw_widget_div_confirmar_abordaje"))&&n.classList.add("nw_widget_div_parent_cancel"),(a=document.querySelector("#confirmar_abordaje"))&&a.classList.add("parent_cancel"),o.ui.cancelar_pedido.addListener("click",function(){(new f_cancelar_servicio).construct(o.data_service)})),o.ui.grupo_nueva_solicitud.setVisibility(!1),o.ui.confirmar_llegada.setVisibility(!1),o.ui.confirmar_abordaje.setVisibility(!1),o.ui.finalizar_viaje.setVisibility(!1),o.ui.precio_viaje.setVisibility(!1),o.ui.cobrar.setVisibility(!1),o.ui.ofline.setVisibility(!1),o.ui.driver_novedad.setVisibility(!1),o.ui.rechazar_pedido_driver.addListener("click",function(){o.idServicesRechazados.push(o.id_service),o.activeNormal()}),o.ui.confirmar_code.addListener("click",function(){var e=o.ui.codigo1.getValue();""==e?nw.dialog("Ingrese un código por favor."):((0==o.finalizaServiceActive?o.data_service.code_verifi_service:o.data_service.code_verifi_service_fin)===e?(0==o.finalizaServiceActive?o.confirmarAbordaje():(o.finalizaServiceActive=!1,"LIBRE"===o.cobro_con?o.precio_viaje():o.finalizarViaje()),o.ui.widget_verifica_codigo.removeClass("widget_verifica_codigo_visible")):nw.dialog("El código ingresado no es correcto."),console.log(e),console.log(o.data_service))}),o.ui.cancel_code.addListener("click",function(){o.ui.widget_verifica_codigo.removeClass("widget_verifica_codigo_visible")}),o.ui.confirmar_llegada.addListener("click",function(){o.confirmarLlegada()}),o.ui.confirmar_abordaje.addListener("click",function(){"SI"===o.configCliente.usa_codigos_verificacion_servicio?(o.ui.codigo1.setValue(""),o.ui.widget_verifica_codigo.addClass("widget_verifica_codigo_visible")):o.confirmarAbordaje()}),o.ui.finalizar_viaje.addListener("click",function(){if(0!==o.totalParadas)return nw.remove(".popup_pil"),nw.dialog("No puede finalizar el servicio, aún tiene paradas adicionales pendientes por cumplir."),o.ui.finalizar_viaje.setValue("1"),!1;var e=!1;"SI"===o.configCliente.usa_codigos_verificacion_servicio&&(e=!0),(e="SI"===o.configCliente.usa_codigos_verificacion_solo_al_iniciar?!1:e)?(o.ui.codigo1.setValue(""),o.finalizaServiceActive=!0,o.ui.widget_verifica_codigo.addClass("widget_verifica_codigo_visible")):"LIBRE"===o.cobro_con?o.precio_viaje():o.finalizarViaje()}),o.ui.status_driver.addListener("click",function(){o.ponerOnOffline("offline")}),o.ui.driver_online.addListener("click",function(){o.ponerOnOffline("online"),o.initIntervalo(),nw.dialog("Activando... por favor espere",!1,!1,{original:!0}),setTimeout(function(){window.location.reload()},5e3)}),o.ui.cobrar.addListener("click",function(){var e=o.ui.precio_viaje.getValue();if(!nw.evalueData(e))return nw.dialog("Debe ingresar el valor del servicio"),!1;o.valor_total_digitado=e,o.finalizarViaje()}),document.addEventListener("ver_viaje",function(e){o.ui.finalizar_viaje.setVisibility(!1),o.data_service=e.detail,o.resolveStatus()}),document.addEventListener("cancelServi",function(e){o.clearIntervaloInService(),o.sendMsgFrameCancel(e.detail),o.centerUbication()}),document.addEventListener("calificaService",function(e){o.centerUbication()}),nw.userPolicies.getUserData());o.debug&&console.log("servicios activos conductor",JSON.parse(i.servicios_activos)),$("body").delegate("#novelty","click",function(){var e={iconAccept:"<i class='material-icons' style='top: 5px;position: relative;'>report</i>",iconCancel:"<i class='material-icons' style='top: 5px;position: relative;'>access_time</i> ",useDialogNative:!1,closeEnc:!0,autocierre:!0,cleanHtml:!1,textAccept:"Problema",textCancel:"Retraso"};nw.dialog("¿Qué desea reportar?",function(){var e=new f_novedades;e.populate(o.data_service),e.construct()},function(){(new f_chat).construct(o.data_service,!0);var e=nw.userPolicies.getUserData();console.log(o.data_service),nw.sendNotificacion({title:nw.utils.tr("Nuevo mensaje de")+" "+e.nombre,body:e.nombre+": "+nw.utils.tr("Me encuentro retrasado"),icon:"fcm_push_icon",sound:"default",data:"nw.dialog('"+nw.utils.tr("Nuevo mensaje: Me encuentro retrasado")+"')",callback:"FCM_PLUGIN_ACTIVITY",to:o.data_service.token_usuario})},e)}),(main.selfMapaDriver=o).status="activo","SI"==o.configCliente.conductores_siempre_online?(o.status="activo",window.localStorage.setItem("status_driver_online_offline","activo")):void 0===window.localStorage.getItem("status_driver_online_offline")||null===window.localStorage.getItem("status_driver_online_offline")||"activo"===window.localStorage.getItem("status_driver_online_offline")?window.localStorage.setItem("status_driver_online_offline","activo"):o.status=window.localStorage.getItem("status_driver_online_offline"),(new f_activeChangeStatus).construct(o),console.log("self.status",o.status),$(".dataUserNameMail").append("<span class='dataUser dataUserStatus'>"+nw.utils.tr(o.status)+"</span>"),setTimeout(function(){!function e(){var a=document.querySelector("#mapa");if(a.offsetWidth<100||a.offsetHeight<100)return void setTimeout(function(){e()},500);o.createMapa(function(){o.positionConductor={lat:nwgeo.latitude,lng:nwgeo.longitude},o.initialMyUbication(),o.eventsDrag(),"activo"===o.status?(nw.activateBackgroundMode(),o.ponerOnOffline("online",!1)):o.ponerOnOffline("offline",!1),"SI"==main.configCliente.soat&&o.validaSoatVigente(),setTimeout(function(){"SI"==main.configCliente.usa_firebase?main.validaServicioActivoFirebase():o.validaServiceActive()},2e3)})}()},600),main.listDriverMap=o},destruct:function(){},members:{validateCodeVerifiService:function(){},createParadas:!1,totalParadas:0,validaExistMarker:function(e){var a=this,o=a.marker2;return null!=o&&!1!==o&&""!==o?e(o):(setTimeout(function(){a.validaExistMarker(e)},500),!1)},validaExistPoly:function(e){var a=this,o=a.polylineRuta;return console.log("self.line",a.line),console.log("self.polylineRuta",o),null!=o&&!1!==o&&""!==o?e(o):(setTimeout(function(){a.validaExistPoly(e)},500),!1)},paradasAdicionales:function(){if("undefined"==typeof f_paradas_adicionales)return nw.dialog("Debe actualizar la aplicación (code 23)",function(){main.actualizarApp()}),!1;(new f_paradas_adicionales).construct(this)},resetParadasAdicionales:function(){var e=this;nw.removeClass(e.parada_list,"parada_list_show",!0),nw.removeClass(e.parada_list,"parada_list_open",!0),void 0!==e.markerParada&&nwgeo.removeMarker(e.markerParada),nw.remove(".vista_parada"),nwgeo.centerMap(e.map,e.marker1,e.marker2),e.cleanParadasPoly(),e.paradasAdicionales()},cambiaEstadoParada:function(a,e,i){console.log("cambiaEstadoParada:::START"),console.log("cambiaEstadoParada:::dataParada",a);var o=nw.userPolicies.getUserData(),n={},e=(n.latitud=this.geo.latitude,n.longitud=this.geo.longitude,n.id=a.id,n.id_servicio=a.id_servicio,n.estado=e,n.empresa=o.empresa,n.usuario=o.usuario,n.observacion="",n.numero_guia=a.descripcion_carga,n.imagen_guia="",nw.evalueData(a.detalleRegistroFoto)&&nw.evalueData(a.detalleRegistroFoto.registro_fotografico)&&(n.imagen_guia=config.domain_rpc+a.detalleRegistroFoto.registro_fotografico),nw.evalueData(a.detalleNovedad)&&(n.observacion=a.detalleNovedad.novedad_text+" Observaciones driver"+a.detalleNovedad.observaciones,n.novedad_causa=a.detalleNovedad.novedad),n.usaSitca="NO","SI"===this.configCliente.usaSitca&&(n.usaSitca="SI"),console.log("cambiaEstadoParada:::data",n),new nw.rpc(nw.getRpcUrl(),"api_movilmove"));e.setAsync(!0),e.setLoading(!0);e.exec("actualizaGuiaSitca",n,function(e){if(console.log("cambiaEstadoParada:::RESPONSE_SERVER:::",e),"object"==typeof e&&1!=e.result){var o="";if($.each(e,function(e,a){nw.evalueData(a)&&(o+=e+": "+a+"<br />")}),nw.dialog("<strong>Ha ocurrido una novedad:</strong> <br />"+o,!1,!1,{original:!0}),-1===o.indexOf("No existe la guía"))return!1}i(a),main.registerServiceInFirebase(a.id)})},actualizaParadaNovedad:function(i){var n=this;n.subirImagenes(function(e){var a="",o=(console.log("e",e),{});return 0!=e&&(o.registro_fotografico_comentarios=e.comentarios,nw.utils.evalueData(e.files)&&nw.utils.evalueData(e.files[0])&&(o.registro_fotografico=e.files[0].imagen,o.registro_fotografico_otras_fotos=e.files),o.all_data=e,o.novedad=e.novedad,o.novedad_text=e.novedad_text,o.observaciones=e.comentarios,void 0!==e.rotulos&&(o.rotulos=e.rotulos),a="SI"),i.tiene_novedad=a,i.detalleNovedad=o,i.detalleRegistroFoto=o,i.numero_guia=i.descripcion_carga,console.log("data",o),console.log("parada",i),n.actualizaParada(i,"NOVEDAD"),!1},{mostrarNovedades:!0,permitirOmitir:!1,data:i})},subirImagenes:function(e,a){var o=new f_agregar_imagenes;return o.construct(e,a),o},actualizaParadaFoto:function(o,i){var n=this,e=n.subirImagenes(function(e){console.log("e",e);var a={};return 0!=e&&(a.registro_fotografico_comentarios=e.comentarios,void 0!==e.files&&(a.registro_fotografico_otras_fotos=e.files,void 0!==e.files[0])&&(a.registro_fotografico=e.files[0].imagen),void 0!==e.rotulos)&&(a.rotulos=e.rotulos),nw.evalueData(i)?i(a):(o.numero_guia=o.descripcion_carga,o.detalleRegistroFoto=a,console.log("data",a),console.log("parada",o),n.actualizaParada(o),!1)},{data:o});console.log("form",e)},actualizaParada:function(a,o){console.log("actualizaParada:::START"),console.log("actualizaParada:::parada",a),nw.evalueData(o)||(o="ENTREGADO"),console.log("actualizaParada:::estado",o);var e,i=this;function n(){main.dataServiceOpenHistory=!1,console.log("CLEAN:::::main.dataServiceOpenHistory"),nw.remove(".pruebauno_container");var e=new nw.rpc(i.getRpcUrl(),"servicios_conductor");e.setAsync(!0),e.setLoading(!0),console.log("parada",a),console.log("self.data_service",i.data_service),console.log("self.data_service.paradas_adicional_numero_total",i.data_service.paradas_adicional_numero_total),a.estado=o,a.latitud_final=i.geo.latitude,a.longitud_final=i.geo.longitude,a.paradas_adicional_valor_unitario=0,nw.utils.evalueData(i.configCliente.recargos_valor_parada_adicional)&&(a.paradas_adicional_valor_unitario=i.configCliente.recargos_valor_parada_adicional),a.usaSitca="NO","SI"===i.configCliente.usaSitca&&(a.usaSitca="SI"),nw.utils.evalueData(a.estado_origendestino)||(nw.utils.evalueData(a.origen_manual_direccion)||nw.utils.evalueData(a.origen_manual_latitud)||nw.utils.evalueData(a.origen_manual_longitud)||nw.utils.evalueData(a.origen_manual_ciudad))&&(a.estado_origendestino="ORIGEN_FINALIZADO"),console.log("paradaparadaparadaparadaparadaparadaparadaparada",a);e.exec("actualizaParada",a,function(e){console.log("parada:::rrrrrrrrrrrrrrr",e),e&&(i.paradasAdicionales(),nw.remove(".vista_parada"),void 0!==i.markerParada&&nwgeo.removeMarker(i.markerParada),nwgeo.centerMap(i.map,i.marker1,i.marker2),console.log("self.polylineParadaAdd",i.polylineParadaAdd),i.cleanParadasPoly(),main.registerServiceInFirebase(a.id_servicio))})}"SI"==i.configCliente.paradaValidaFinalizar?(e={original:!0,textAccept:"Si, finalizar",textCancel:"Volver"},nw.dialog("¿Realmente quiere finalizar esta parada?",function(){n()},function(){return!0},e)):n()},markerParadas:function(a){var o=this,e=parseFloat(a.latitud_parada),i=parseFloat(a.longitud_parada),n=new nwgeo.addMarker;n.map=o.map,n.latitude=e,n.longitude=i,n.title=a.direccion,n.label="",n.icon=config.domain_rpc+config.carpet_files_extern+"img/ubicacion-usuario.png",nw.evalueData(config.iconDriverPuntoB)&&(n.icon=config.iconDriverPuntoB),n.draggable=!1,n.animation=!0,n.rotation=o.deviceRotation,o.markerParada=n.show(function(){}),nwgeo.centerMap(o.map,o.marker1,o.markerParada),setTimeout(function(){var e=[{lat:o.positionConductor.lat,lng:o.positionConductor.lng},{lat:parseFloat(a.latitud_parada),lng:parseFloat(a.longitud_parada)}];nwgeo.centerMap(o.map,o.markerParada,o.marker1,!1,e,!0,"center")},2e3)},__polyParadas:new Array,cleanParadasPoly:function(){nwgeo.removeAllPolyLines(this.__polyParadas)},dataByBooking:function(e){var a={};return(a=this.data_service).config=this.configCliente,a.estado_nuevo=e,a.latitude=nwgeo.latitude,a.longitude=nwgeo.longitude,a},ColorCode:function(){for(var e="#",a=0;a<6;a++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},getTimeToCoords:function(e,a,o,i,n){this.lineNotify=nwgeo.addLineStreet(this.map,{lat:e,lng:a,lat2:o,lng2:i},function(e){n(e)},"#dc471e",!0)},getDistanceToCoords:function(e,a,o,i){function n(e){return e*(Math.PI/180)}var t=n(o-e),i=n(i-a),a=Math.sin(t/2)*Math.sin(t/2)+Math.cos(n(e))*Math.cos(n(o))*Math.sin(i/2)*Math.sin(i/2);return(6378137*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))).toFixed(3)},removeMapaDeCalorService:function(){var e=this;if(nwgeo.native){for(var a=e.markersCalor.length,o=0;o<a;o++)nwgeo.removeMarker(e.markersCalor[o]);return!0}e.map;e.heatmap&&(e.heatmap.setMap(null),e.heatmap=!1)},mapaDeCalorService:function(){var e,a,i=this;0==i.heatmap&&(a=nw.userPolicies.getUserData(),JSON.parse(a.servicios_activos),(e={}).empresa=a.empresa,(a=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),a.setLoading(!1),i.markersCalor=[],a.exec("consultaTotalServicios",e,function(e){for(var a=0;a<e.length;a++){var o=e[a];i.markersCalor[a]=i.map.addMarker({position:{lat:o.latitudOri,lng:o.longitudOri},icon:{url:config.domain_rpc+config.carpet_files_extern+"/img/calor1.png"},scale:.5,offset:"15%",strokeColor:"#000000",strokeWeight:.3,fillColor:"#f15228",fillOpacity:1,anchor:new google.maps.Point(0,5),rotation:0})}return!0}))},cerrarNotificionMain:function(){this.activeNormal(),this.LimpiarTodo(),this.cleanMarkerTwo(),this.initIntervalo()},useWaze:function(){var e=this,a=e.latitudDestino,o=e.longitudDestino,i=($(".btn_waze").remove(),""),n=(1==e.cancela_conductor&&(i="parent_btn_waze"),document.createElement("div"));n.className="btn_waze "+i,n.innerHTML="<i class='material-icons'>navigation</i> <span>"+nw.tr("Navegar")+"</span>",n.data={latitud:a,logitud:o},n.onclick=function(){var e={};e.latitude=this.data.latitud,e.longitude=this.data.logitud,e.mode="waze,googleMaps",nw.launchNavigatorUbication(e)},document.querySelector(".grupo_nueva_solicitud").appendChild(n),e.useMoreInfoInTravel(),"SI"==e.configCliente.informacion_primer_conductor&&e.useMoreInformation()},useMoreInfoInTravel:function(){var i=this,e=($(".btn_more_info_intravel").remove(),document.createElement("div"));e.className="btn_more_info_intravel",e.innerHTML="<i class='material-icons'>more_vert</i> <span>"+nw.tr("Más info")+"</span>",e.onclick=function(){var e="<div class='containMoreInfo'>",a=((e+="<h3>Seleccione la opción que desea ampliar del servicio</h3>")+"<div class='listoMoreInfo'></div>"+"</div>",nw.dialog("<div class='containMoreInfo'><h3>Seleccione la opción que desea ampliar del servicio</h3><div class='listoMoreInfo'></div></div>",!1,!1,{original:!0,textAccept:"Volver"})),o=(console.log("s",a),"SI"===main.configCliente.ver_voucher&&((o=document.createElement("div")).className="rowMoreInfoLIst",o.innerHTML=nw.utils.tr("Ver voucher"),o.onclick=function(){console.log("self.data_service",i.data_service),main.imprimir("VER_VOUCHER",i.data_service.id)},a.querySelector(".listoMoreInfo").appendChild(o)),"SI"===main.configCliente.ver_cartel_vuelo&&((o=document.createElement("div")).className="rowMoreInfoLIst",o.innerHTML=nw.utils.tr("Ver cartel de vuelo"),o.onclick=function(){console.log("self.data_service",i.data_service),main.imprimir("CARTEL_VUELO",i.data_service.id)},a.querySelector(".listoMoreInfo").appendChild(o)),"SI"==main.configCliente.pide_fuec&&((o=document.createElement("div")).className="rowMoreInfoLIst",o.innerHTML=nw.utils.tr("Ver FUEC"),o.onclick=function(){console.log("self.data_service",i.data_service),main.verFuec(i.data_service)},a.querySelector(".listoMoreInfo").appendChild(o)),document.createElement("div"));o.className="rowMoreInfoLIst",o.innerHTML=nw.utils.tr("Ampliar"),o.onclick=function(){console.log("self.data_service",i.data_service),main.ampliar(i.data_service),a.remove()},a.querySelector(".listoMoreInfo").appendChild(o),(o=document.createElement("div")).className="rowMoreInfoLIst",o.innerHTML=nw.utils.tr("Paradas o pasajeros"),o.onclick=function(){console.log("self.data_service",i.data_service),main.editaParadasAdicionales(i.data_service),a.remove()},a.querySelector(".listoMoreInfo").appendChild(o)},document.querySelector(".grupo_nueva_solicitud").appendChild(e)},useVoucherInTravel:function(){$(".btn_more_info_intravel").remove();var e=document.createElement("div");e.className="btn_more_info_intravel",e.innerHTML="<i class='material-icons'>more_vert</i> <span>"+nw.tr("Más info")+"</span>",e.onclick=function(){},document.querySelector(".grupo_nueva_solicitud").appendChild(e)},useChat:function(){var e,a,o=this;if(o.creatBtnVerPasajeros(),"NO"==main.configCliente.mostrar_chat_a_conductor_de_pax_principal)return!1;document.querySelector(".btn_chat")||((e=document.createElement("div")).innerHTML='<i class="material-icons">chat_bubble</i>',e.className="btn_chat btn_chat_initservice",e.onclick=function(){(new f_chat).construct(o.data_service)},(a=document.querySelector(".containChatCallCliente"))?a.appendChild(e):setTimeout(function(){o.useChat()},2e3))},creatBtnVerPasajeros:function(){var e,a,o=this;if("SI"!=main.configCliente.mostrar_boton_ver_pasajeros_a_conductor_en_pax_principal)return!1;document.querySelector(".btn_pasajeros")||((e=document.createElement("div")).innerHTML='<i class="material-icons">group</i>',e.className="btn_pasajeros btn_pasajeros_initservice",e.onclick=function(){console.log("self.data_service",o.data_service),main.editaParadasAdicionales(o.data_service)},(a=document.querySelector(".containChatCallCliente"))?a.appendChild(e):setTimeout(function(){o.creatBtnVerPasajeros()},2e3))},useMoreInformation:function(){var e,a,o=this;document.querySelector(".btn_more_info")||((e=document.createElement("div")).innerHTML='<i class="material-icons">group</i>',e.className="btn_more_info btn_more_info_initservice",e.onclick=function(){console.log("self.data_service",o.data_service),main.ampliar(o.data_service)},(a=document.querySelector(".containChatCallCliente"))?a.appendChild(e):setTimeout(function(){o.useMoreInformation()},2e3))},ponerOnOffline:function(e,a){(new f_ponerOnOffline).construct(this,e,a)},createMapa:function(e){(new f_0_createMapa).construct(this,e)},enableOrientationArrow:function(){var o=this;FULLTILT.getDeviceOrientation({type:"world"}).then(function(a){a.listen(function(){var e=360-a.getScreenAdjustedEuler().alpha;o.deviceRotation=e,nw.evalueData(o.marker1)&&o.marker1.setRotation(o.deviceRotation)})}).catch(function(e){console.log(e)})},eventsDrag:function(){var a=this;nwgeo.dragMap("dragstart",a.map,function(e){a.drag=!0,void 0!==a.timeDrag&&(clearTimeout(a.timeDrag),delete a.timeDrag)}),nwgeo.dragMap("dragend",a.map,function(e){a.timeDrag=setTimeout(function(){a.drag=!1},1e3)})},initialMyUbication:function(){this.setMyUbication(),this.positionConductor={lat:nwgeo.latitude,lng:nwgeo.longitude},config.latitud=nwgeo.latitude,config.longitud=nwgeo.longitude,this.iniciarWatchPosition(),nwgeo.api_geocodeInverse(nwgeo.latitude,nwgeo.longitude,function(e){config.ciudad_text=e.locality})},setMyUbication:function(){var e=this;e.geo.latitude=e.positionConductor.lat,e.geo.longitude=e.positionConductor.lng,e.geo.latitudOri=e.positionConductor.lat,e.geo.longitudOri=e.positionConductor.lng,e.markerMyUbication()},markerMyUbication:function(){var e=this,a=new nwgeo.addMarker;a.map=e.map,a.latitude=e.geo.latitude,a.longitude=e.geo.longitude,a.title="",a.label="",a.icon=config.domain_rpc+config.carpet_files_extern+"img/normal1.png",nw.evalueData(config.iconDriverMap)&&(a.icon=config.iconDriverMap),a.draggable=!1,a.animation=!0,a.rotation=e.deviceRotation,e.marker1=a.show(function(){nw.loadingRemove()})},iniciarWatchPosition:function(){var a=this;clearInterval(a.interIframeSend),a.numIntSet=0,a.interIframeSend=setInterval(function(){a.numIntSet++},1e3);return nwgeo.watchMapPosition(function(e){a.execPositionMove(e)}),!0},execPositionMove:function(e){var a,o,i=this;5<i.numIntSet&&(i.numIntSet=0,a=nw.userPolicies.getUserData(),(o={}).lat=e.coords.latitude,o.lng=e.coords.longitude,o.id=a.id_usuario,o.usuario=a.usuario,o.empresa=a.empresa,o.perfil=a.perfil,o.ciudad=config.ciudad_text,o.nombre=a.nombre,o.apellido=a.apellido,o.nit=a.nit,o.placa=i.vehiculo.placa,o.up={},o.up.nit=a.nit,o.up.nombre=a.nombre,o.up.apellido=a.apellido,config.latitud=o.lat,config.longitud=o.lng,sendDataPosition=!0,i.debug&&console.log("PPPPP self.positionConductor",o.lat+", "+o.lng),i.positionConductor=o,i.geo.latitude=o.lat,i.geo.longitude=o.lng,!0===i.serviceActive&&(i.debug&&console.log("SENDDDDDD sendMsgFrame"),i.sendMsgFrame()),!1===nw.workInBackgroundMode)&&(nwgeo.setPositionMarker(i.marker1,i.positionConductor.lat,i.positionConductor.lng),1!=i.serviceActive)&&i.centerUbication()},centerUbication:function(){var e=this;!0===e.serviceActive?0==e.drag&&nwgeo.centerMap(e.map,e.marker1,e.marker2):0==e.drag&&nwgeo.centerMap(e.map,e.marker1)},cleanMarkerTwo:function(){nw.evalueData(this.marker2)&&nwgeo.removeMarker(this.marker2)},removeLine:function(){nw.evalueData(this.line)&&nwgeo.removeLine(this.line)},initIntervalo:function(){var a=this;if(a.clearIntervalo(),"activo"!==a.status)return!1;a.totalSolicitudesServer=0,a.searchServiceSolicitud(function(){a.debugConstruct&&console.log("Buscando servicios...",a.timeIntervaloSearchServices);var e=0;a.intervalSearchCount=setInterval(function(){e++,a.debugConstruct&&console.log("Buscando servicios",e)},1e3),a.interval=setTimeout(function(){a.clearIntervalo(),a.initIntervalo()},a.timeIntervaloSearchServices)})},clearIntervalo:function(){clearTimeout(this.interval),clearInterval(this.interval),clearInterval(this.intervalSearchCount),clearTimeout(this.intervalSearchCount)},initIntervaloService:function(){var a=this;"SI"!=main.configCliente.usa_firebase&&(a.clearIntervaloInService(),a.validaServiceActive(!0,function(){a.debugConstruct&&console.log("Validando servicio activo si cambia o es cancelado o modificado por admin o user en ",a.timeToValideServiceActive);var e=0;a.intervalServiceCount=setInterval(function(){e++,a.debugConstruct&&console.log("Validando servicio activo",e)},1e3),a.intervalService=setTimeout(function(){a.clearIntervaloInService(),a.initIntervaloService()},a.timeToValideServiceActive)}))},clearIntervaloInService:function(){clearTimeout(this.intervalService),clearTimeout(this.intervalServiceCount),clearInterval(this.intervalService),clearInterval(this.intervalServiceCount)},constructServiceSolicitud:function(e){(new f_constructServiceSolicitud).construct(this,e)},tiempoPagos:function(){var e=nw.userPolicies.getUserData(),a=this.configCliente;if(console.log("conf",a),console.log("conf.saldo_minimo_para_tomar_servicios_conductor",a.saldo_minimo_para_tomar_servicios_conductor),nw.evalueData(a.saldo_minimo_para_tomar_servicios_conductor)&&!0===config.usaRecargas&&parseFloat(e.saldo)<0){if(!isNaN(parseInt(a.dias_maximo_pago))){var o=new Date;if(o.setDate(o.getDate()-parseInt(a.dias_maximo_pago)),nw.evalueData(e.fecha_ultimo_pago)){var i=new Date(e.fecha_ultimo_pago);if(i<o&&-1*parseFloat(e.saldo)>parseInt(a.tope_maximo_pago))return nw.dialog("No hemos registrado tu ultimo pago",function(){main.slotRecargas()}),!1}}if(-1*parseFloat(e.saldo)>parseInt(a.tope_maximo_pago))return nw.dialog("Has excedido el tope maximo, por favor recarga para continuar trabajando.",function(){main.slotRecargas()}),!1}return!0},inactiveVehiculo:function(){var e=nw.userPolicies.getUserData(),a=this.vehiculo;if(void 0===a.id)return!1;var o={},a=(o.id=e.id_usuario,o.id_vehiculo=a.id,o.usuario=e.usuario,o.tipo="ahora",o.empresa=e.empresa,new nw.rpc(this.getRpcUrl(),"servicios_conductor"));a.setAsync(!0),a.setLoading(!1);a.exec("inactiveVehiculo",o,function(e){e&&nw.dialog("El vehículo se ha inactivado por vencimiento de soat actualiza los datos de tu vehiculo.",function(){window.location.reload()})})},validaSoatVigente:function(){(new f_validaSoatVigente).construct(this)},addRechazadoServiceMostrado:function(e){this.idServicesMostrados.push(e),console.log("self.idServicesMostrados",this.idServicesMostrados),window.localStorage.setItem("addRechazadoServiceMostrado",JSON.stringify(this.idServicesMostrados))},searchServiceMostrado:function(e){for(var a=0;a<this.idServicesMostrados.length;a++)if(this.idServicesMostrados[a].id===e)return!1;return!0},searchServiceRechazado:function(e){for(var a=0;a<this.idServicesRechazados.length;a++)if(this.idServicesRechazados[a]===e)return!1;return!0},cleanServiceSolicitud:function(){var e=this;e.data_service=!1,e.id_service=!1,e.ui.grupo_nueva_solicitud.setVisibility(!1),e.ui.rechazar_pedido_driver.setVisibility(!1),e.ui.aceptar_pedido_driver.setVisibility(!1),e.ui.tiempo_estimado.setVisibility(!1)},searchServiceSolicitud:function(e){(new f_searchServiceSolicitud).construct(this,e)},validaServiceActive:function(e,a,o){(new f_validaServiceActive).construct(this,e,a,o)},resolveStatus:function(){(new f_resolveStatus).construct(this)},LimpiarTodo:function(){var e=this,a=(e.reziseNormalMap(),e.clearIntervaloInService(),console.log("se limpia"),e.frameChat=null,document.querySelector(".framechat"));a&&a.remove(),document.querySelector(".mapIframe")&&$(".mapIframe").remove(),document.querySelector(".btn_waze")&&$(".btn_waze").remove(),e.serviceActive=!1,nwgeo.removeAllPolyLines(),e.trazaLineaCreada=!1},htmlDataCliente:function(e,a){var o=this.data_service,i=config.domain_rpc+"/nwlib6/icons/personb1.svg",n=i,t="",r=(console.log("rrrrrrrrrrrrrrrrr",o),nw.evalueData(o.cliente_foto)&&(i=config.domain_rpc+o.cliente_foto,n=config.domain_rpc+nw.utils.getFileByType(o.cliente_foto,100),t="foto_cliente_existe"),"Pasajero"),c=(nw.evalueData(o.cliente_nombre)&&(r=o.cliente_nombre),nw.evalueData(o.vuelo_numero)&&(r+="<br /><span class='numerovuelospan'>Vuelo "+o.vuelo_numero+"</span>"),nw.evalueData(o.observaciones_servicio)&&(r+="<br /><span class='numerovuelospan'>"+o.observaciones_servicio+"</span>"),""),i=(c=(c=(c=(c=(c+="<div class='containInfoDriver'>")+"<div class='containDataForClienteContain'>"+"<div class='InfoDriverPhotoAndTitle'>")+("<div class='nameDriver'><span data='"+i+"' class='cliente_foto "+t+"' style='background-image: url("+n+");'></span>")+("<span class='namecliente'>"+r+"</span>"))+"</div>"+"<div class='containerPuntajeConductorSpan'>")+this.showStarsCliente(),"57");return nw.evalueData(config.indicativo)&&(i=config.indicativo),c=(c=(c=(c=c+"</div>"+("<div class='InfoIdService' style='color: #656363;text-align: left;font-size: 14px;'>ID: "+o.id+"</div>"))+"</div>"+"<div class='InfoDriverPlacasEtc'>")+("<div class='titleInfoDriver'>"+e+"</div>")+"</div>")+"</div>"+"<div class='containChatCallCliente'>","NO"!==main.configCliente.telefono_pasajero_visible_para_conductor&&"NO"!=main.configCliente.mostrar_telefono_a_conductor_de_pax_principal&&void 0===a&&(c=(c+="<div class='Infotel btninfo_tel'><i class='material-icons'>local_phone</i>")+"<a href='tel:+"+i+" "+o.celular+"'/></div>"),c=(c=(c+="<div class='Infotel btninfo_problem' id='novelty'>")+"<i class='material-icons'>report_problem</i>"+"</div>")+"</div>"+"</div>"},showStarsCliente:function(e){for(var a=this.data_service.puntaje,o="",i=(o+="<span class='puntajeClienteSpan'> <span style='color:#656363; margin-right: 4px;'>"+(a=a||0)+"</span>",Math.round(parseFloat(a))),n=0;n<5;n++)o+=n<i?"<i class='material-icons' style='color: #e04935;'>star</i>":"<i class='material-icons'>star_border</i>";return o+="</span>"},precio_viaje:function(){var e=this;e.ui.grupo_nueva_solicitud.setVisibility(!0),e.ui.rechazar_pedido_driver.setVisibility(!1),e.ui.aceptar_pedido_driver.setVisibility(!1),e.ui.tiempo_estimado.setVisibility(!1),e.ui.confirmar_llegada.setVisibility(!1),e.ui.confirmar_abordaje.setVisibility(!1),e.ui.precio_viaje.setVisibility(!1),e.ui.cobrar.setVisibility(!0),e.ui.finalizar_viaje.setVisibility(!1),e.ui.html_grupo_nueva_solicitud.setValue("Escriba el precio del viaje:<br /> "),e.ui.precio_viaje.setVisibility(!0),e.ui.precio_viaje.focus()},trazaLinea:function(e,a){var o=this;if(o.trazaLineaCreada&&!1===nw.evalueData(a))return!1;o.reziseMap(),e&&nwgeo.centerMap(o.map,o.marker1,o.marker2),o.pintarLinea(),o.trazaLineaCreada=!0},pintarLinea:function(e){nwgeo.centerMap(this.map,this.marker1,this.marker2),this.centerUbication()},saveAcceptService:function(e){(new f_saveAcceptService).construct(this,e)},widgetTwoHours:function(){},clearIntvHours:function(){clearInterval(this.__intvHours),this.removeStateTravel()},removeStateTravel:function(){this.ui.save_state.setVisibility(!1),this.ui.state_travel.setVisibility(!1),this.ui.state_travel.setValue(""),document.querySelector("#widget_hours").style="display: none"},sendMsgFrameCancel:function(e){var a,o=this;nw.evalueData(o.frameChat)&&(a={tipo:"send_message_ringow",message:"CANCELADO_DRIVER"},console.log("self.frameChat",o.frameChat),o.frameChat.contentWindow.postMessage(a,"*"),nw.dialog(nw.tr("Servicio cancelado, el coste de cancelación es de")+" "+e.recargo+" "+config.moneda,function(){o.userCancelaService(!0)}))},sendMsgFrame:function(){var e=this;if(null===e.frameChat)return!1;e.positionConductor.rotation=e.deviceRotation;var a=JSON.stringify(e.positionConductor),o=(console.log("msg",a),{});o.tipo="send_message_ringow",o.message=a,e.frameChat.contentWindow.postMessage(o,"*"),e.trazaLinea()},framePosition:function(){var a=this,e=nw.userPolicies.getUserData();document.querySelector(".mapIframe")||(a.serviceActive=!0,a.frameChat=document.createElement("iframe"),a.frameChat.className="mapIframe",a.frameChat.style="position:fixed;top:0;left:0;width:100%;height:150px;z-index:1000000;display:none;",a.frameChat.src="nwlib6/nwproject/modules/webrtc/v4/index.html?myID="+e.id_usuario+"&onlyChat=true&room=movilmove_number_"+a.id_service+"&domain="+config.domain_rpc,document.body.appendChild(a.frameChat),a.frameChat.onload=function(){a.sendMsgFrame(),window.addEventListener("message",function(e){a.debug&&console.log("e.data",e.data),e.data.room==="movilmove_number_"+a.id_service&&"CANCELADO"===e.data.text&&a.userCancelaService()})})},validateGpsActive:function(){return console.log("nwgeo.latitude",nwgeo.latitude),console.log("nwgeo.longitude",nwgeo.longitude),!(!nw.utils.evalueData(nwgeo.latitude)||!nw.utils.evalueData(nwgeo.longitude))||(nw.dialog("Lo sentimos, no se registró GPS latitud y/o longitud activo. Revise que tenga el GPS activo, permisos y conexión a internet. Intente cerrar la app y volver a abrirla."),!1)},sendMsgFrameConductor:function(){var e=JSON.stringify(this.positionConductor),a={tipo:"send_message_ringow"};a.message=e,this.debug&&console.log("SEND sendMsgFrameConductor ",e),this.frameConductor.contentWindow.postMessage(a,"*")},confirmarLlegada:function(){var i=this,n=nw.userPolicies.getUserData(),t=i.data_service,e=nwgeo.distance(parseFloat(t.latitudOri),parseFloat(t.longitudOri),i.positionConductor.lat,i.positionConductor.lng),a=(console.log("dddddddddddddddddddddd",e),console.log("parseInt(d)",parseInt(e)),console.log("parseInt(self.configCliente.metros_para_confirmar_llegada)",parseInt(i.configCliente.metros_para_confirmar_llegada)),!1);function o(e,a){1==i.actEnRuta&&(i.actEnRuta=!1,i.polylineRuta&&i.polylineRuta.setMap(null),delete i.polylineRuta),i.cleanMarkerTwo();i.positionConductor;var o={};o.usuario=n.usuario,o.latitudConfirmaLlegada=nwgeo.latitude,o.longitudConfirmaLlegada=nwgeo.longitude,o.id=t.id,nw.evalueData(e)&&(o.files=e),i.validateGpsActive()&&(o.dataService=i.dataByBooking("EN_SITIO"),console.log("confirmarLlegada:::sendData:::",o),(e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.exec("llegadaServicioCon",o,function(e){console.log("confirmarLlegada:::responseServer:::",e),nw.evalueData(a)&&a(),i.cleanMarkerTwo(),i.activeEnSitio(),nw.sendNotificacion({title:"Tu conductor ha llegado",body:"Dirígete al punto de origen",icon:"fcm_push_icon",sound:"default",data:"main.crearViaje('"+e.id+"')",callback:"FCM_PLUGIN_ACTIVITY",to:t.token_usuario}),main.registerServiceInFirebase(o.id)}))}0==(a="SI"==i.configCliente.usar_distancia_punto_recogida&&(a=!0,nw.evalueData(i.configCliente.metros_para_confirmar_llegada))&&parseInt(e)<=parseInt(i.configCliente.metros_para_confirmar_llegada)?!1:a)?"SI"==i.configCliente.foto_para_confirmar_llegada?i.subirImagenes(function(e){console.log("files",e),o(e,function(){nw.remove(".pruebauno_container")})}):o():nw.dialog("Estás lejos del punto de encuentro para iniciar el servicio")},confirmarAbordaje:function(){var c=this;function a(e,a){nw.utils.evalueData(c.configCliente.recargos_valor_parada_adicional)&&c.configCliente.recargos_valor_parada_adicional;var o=0,i=(nw.utils.evalueData(c.configCliente.recargos_espera_minuto_inicia_cobro)&&(o=c.configCliente.recargos_espera_minuto_inicia_cobro),0),n=(nw.utils.evalueData(c.configCliente.recargos_valor_minuto_espera)&&(i=c.configCliente.recargos_valor_minuto_espera),0),o=(c.minutosDeEspera>=o&&(n=(parseFloat(c.minutosDeEspera)-parseFloat(c.configCliente.recargos_espera_minuto_inicia_cobro))*parseFloat(i)),console.log("valor_espera",n),c.trazaLineaCreada=!1,nw.userPolicies.getUserData()),t=c.data_service,r={};c.positionConductor;r.perfil=o.perfil,r.usuario=o.usuario,r.latitudConfirmaAbordaje=nwgeo.latitude,r.longitudConfirmaAbordaje=nwgeo.longitude,r.id=t.id,r.recargo_valor_minuto_valor_espera=i,r.tiempo_espera=c.minutosDeEspera,r.valor_espera=n,nw.evalueData(e)&&(r.files=e),c.validateGpsActive()&&(r.dataService=c.dataByBooking("ABORDO"),console.log("confirmarAbordaje:::sendData:::",r),(o=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),o.exec("confirmarAbordaje",r,function(e){console.log("confirmarAbordaje:::responseServer:::",e),nw.evalueData(a)&&a(),c.activeAbordo(),nw.sendNotificacion({title:"Ha iniciado tu viaje",body:"¡Buen viaje!",icon:"fcm_push_icon",sound:"default",data:"main.crearViaje('"+e.id+"')",callback:"FCM_PLUGIN_ACTIVITY",to:t.token_usuario}),main.registerServiceInFirebase(r.id)}))}"SI"==c.configCliente.foto_para_confirmar_abordaje?c.subirImagenes(function(e){console.log("files",e),a(e,function(){nw.remove(".pruebauno_container")})}):a()},saldoRecarga:function(e,a){var o=this,i={},e=(i.id_usuario=e.id_usuario,i.usuario=e.usuario,i.empresa=e.empresa,o.debugConstruct&&(console.log("saldoRecarga::data::",i),console.log("saldoRecarga::dat::",e)),new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!1),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Consultando saldo billetera del pasajero..."});e.exec("saldoRecargaUser",i,function(e){nw.loadingRemove(),o.debugConstruct&&console.log("RESPONSE_SERVER:::saldoRecarga billetera:::r",e),a(e)})},saverecorr:function(e){var a=this;clearTimeout(a.recorridosave),a.saveRecorrido(function(){a.recorridosave=setTimeout(function(){a.saverecorr(e)},1e4)},e)},recorridoLatitud:null,recorridoLongitud:null,saveRecorrido:function(a,e){var o=this,i=(clearTimeout(o.recorridosave),document.querySelector(".grupo_nueva_solicitud"));if(console.log("element.style.display",i.style.display),i&&"none"===i.style.display)return o.cerrarNotificionMain(),o.centerUbication(),!1;var i=nw.userPolicies.getUserData(),n=o.positionConductor,t=(nw.evalueData(o.recorridoLatitud)||(o.recorridoLatitud=nwgeo.latitude),nw.evalueData(o.recorridoLongitud)||(o.recorridoLongitud=nwgeo.longitude),{}),i=(t.latitud=o.recorridoLatitud,t.longitud=o.recorridoLongitud,t.latitudEnd=nwgeo.latitude,t.longitudEnd=nwgeo.longitude,t.empresa=i.empresa,t.usuario=i.usuario,t.nombre_usuario=i.nombre,t.id_usuario=i.id_usuario,t.id_servicio=o.data_service.id,nw.utils.evalueData(o.data_service.placa)&&(t.placa=o.data_service.placa),t.tipo=e,t.speed=nwgeo.speed,o.getDistanceToCoords(t.latitud,t.longitud,t.latitudEnd,t.longitudEnd)),e=(console.log("metros",i),i=parseInt(i),console.log("metros",i),t.metros=i,console.log("saveRecorrido:::self.recorridoLatitud",o.recorridoLatitud),console.log("saveRecorrido:::gps",n),console.log("saveRecorrido:::dataSend",t),new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1);e.exec("saveRecorrido",t,function(e){o.debugConstruct&&console.log("saveRecorrido:::resposeServer:::r",e),o.recorridoLatitud=t.latitudEnd,o.recorridoLongitud=t.longitudEnd,void 0!==a&&nw.evalueData(a)&&a(e),main.updateOnlyFieldsServiceInFirebase(o.data_service.id,{latitud_actual:nwgeo.latitude,longitud_actual:nwgeo.longitude,driver_latitud:nwgeo.latitude,driver_longitud:nwgeo.longitude})})},finalizarViaje:function(){(new f_z100_finalizarViaje_valida).construct(this)},totalPorcentajes:function(e,a){return(new f_z102_finalizarViaje_traecomisiones).construct(this,e,a)},showPriceEnd:function(a){var o=this,e=(o.debugConstruct&&console.log("showPriceEnd",a),console.log("data.precio_viaje",a.precio_viaje),nw.evalueData(config.decimalesFixed)&&(a.precio_viaje=parseFloat(a.precio_viaje).toFixed(config.decimalesFixed)),console.log("data.precio_viaje",a.precio_viaje),nw.userPolicies.getUserData());a.empresa=e.empresa,a.usuario=e.usuario,a.nombre_usuario=e.nombre,a.id_usuario=e.id_usuario,a.email=e.email,a.perfil=e.perfil,"tarjeta_credito"===a.tipo_pago&&!0===nw.evalueData(a.id_tarjeta_credito)?o.cobrarConTarjeta(a):"CARGA"==o.configCliente.app_para?o.firmaConfirma(function(e){a.firma_recibido=e.firma_recibido,o.finalizarServicio(a)}):(a.firma_recibido="",o.finalizarServicio(a))},restarHoras:function(e,a,o){var i;return console.log("inicio",a),console.log("fin",o),nw.evalueData(a)&&nw.evalueData(o)?(i=parseInt(a.substr(3,2)),a=parseInt(a.substr(0,2)),i=parseInt(o.substr(3,2))-i,o=parseInt(o.substr(0,2))-a,i<0&&(o--,i=60+i),a=o.toString(),o=i.toString(),a.length<2&&(a="0"+a),"espera"==e?{horas:a,minutos:o}:void 0):""},firmaConfirma:function(a){var o=new nw.forms;o.id="generarFirma",o.html="<h1 style='text-align:center;'>Ingrese la firma de recibido</h1><br />",o.showBack=!0,o.createBase();o.setFields([{name:"firma_recibido",label:"Firma Recibido",type:"signature",required:!0}]),o.buttons=[{style:"text-shadow: none;font-weight: lighter;border: 0;",className:"btn_maxwidth",name:"aceptar",label:"Enviar",callback:function(){if(!o.validate())return!1;var e=o.getRecord();a(e)}}],o.show()},finalizarServicio:function(e){(new f_z101_finalizarViaje_guarda).construct(this,e)},cambiarFormaPago:function(e,a){var o=this,i={},e=(i.id=e,i.tipo_pago=a,new nw.rpc(o.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!0);e.exec("cambiarFormaPago",i,function(e){!0===e?(o.data_service.tipo_pago=a,nw.dialog("Forma de pago actualizada correctamente")):nw.dialog(e)})},resolveReziseMap:function(){},reziseMap:function(){this.ui.mapa.addClass("mapa_maxheight");var e,a=document.querySelector(".grupo_nueva_solicitud");a&&(a=a.offsetHeight,(e=document.createElement("style")).className="styleRootAltoMax",e.innerHTML=":root {--alto_maximo_map: "+a+"px;}",document.querySelector(".f_driver_mapa_servicios").appendChild(e))},reziseNormalMap:function(){this.ui.mapa.removeClass("mapa_maxheight"),this.ui.mapa.css({"max-height":"100%"})},cleanMarkerNotify:function(){var e=this;nw.evalueData(e.markerNotify)&&nwgeo.removeMarker(e.markerNotify),nw.evalueData(e.lineNotify)&&(nwgeo.removeLine(e.lineNotify),e.lineNotify=!1),e.removeLine(),nwgeo.removeAllPolyLines(),nwgeo.centerMap(e.map,e.marker1,!1,17)},stopSound:function(){var e=document.querySelector(".sound_nuevo_viaje");e&&e.remove()},consultaTareasAdicionales:function(e){var a=nw.userPolicies.getUserData(),o={},a=(o.empresa=a.empresa,o.id_service=this.id_service,new nw.rpc(this.getRpcUrl(),"servicios"));a.setAsync(!0),a.setLoading(!1);a.exec("populateTareasAdicionales",o,function(e){e&&nw.createNotificacionBarInter({addClass:"notifyRedirect",timeToRemove:15e3,title:"Nueva tarea",body:"Tienes una nueva tarea para este servicio revisa el etalle del servicio para mas información.",icon:!1,data:e,callback:function(){main.openHistoricoViajes()}})})},updateRechazados:function(e,a){var o=nw.userPolicies.getUserData(),i=e,e=(i.id_service=this.id_service,i.usuario=o.usuario,i.empresa=o.empresa,new nw.rpc(this.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1),console.log("updateRechazados::data",i);e.exec("updateRechazados",i,function(e){console.log("updateRechazados::responseServer",e),a(),main.registerServiceInFirebase(i.id,function(e){console.log("p.conductores_disponibles",e.conductores_disponibles);for(var a=0;a<e.conductores_disponibles.length;a++)e.conductores_disponibles[a]==o.usuario&&(e.conductores_disponibles[a]=o.usuario+"_(rechaza)");console.log("p.conductores_disponibles",e.conductores_disponibles),main.updateOnlyFieldsServiceInFirebase(i.id,{conductores_disponibles:e.conductores_disponibles})})})},userCancelaService:function(e){var a=this;a.cerrarNotificionMain(),a.reziseNormalMap(),a.actEnRuta=!1,a.polylineRuta&&a.polylineRuta.setMap(null),delete a.polylineRuta,void 0===e&&(e="","string"==typeof a.data_service.observacion_cancelado_adm&&""!=a.data_service.observacion_cancelado_adm&&(e=" Observaciones: "+a.data_service.observacion_cancelado_adm),nw.dialog("El usuario ha cancelado el servicio"+e)),a.activeNormal(),nwgeo.removeAllPolyLines(),nw.openAppToFront(),nw.turnScreenOn(),nw.turnScreenOnAndUnlocked(),document.querySelector(".cont-radar")||a.getIcon()},getIcon:function(){for(var e='<svg viewBox="0 0 370 370">',e=((e+='<g id="radar-bg">')+'<path fill="#FFFFFF" d="M185,365C85.75,365,5,284.25,5,185C5,85.75,85.75,5,185,5c99.25,0,180,80.75,180,180C365,284.25,284.25,365,185,365z"/>'+'<path id="radar-path" fill="#CC0000" d="M185,10c96.65,0,175,78.35,175,175s-78.35,175-175,175S10,281.65,10,185S88.35,10,185,10 M185,0c-24.97,0-49.2,4.89-72.01,14.54c-22.03,9.32-41.81,22.66-58.8,39.64s-30.32,36.77-39.64,58.8C4.89,135.8,0,160.03,0,185s4.89,49.2,14.54,72.01c9.32,22.03,22.66,41.81,39.64,58.8c16.99,16.99,36.77,30.32,58.8,39.64C135.8,365.11,160.03,370,185,370s49.2-4.89,72.01-14.54c22.03-9.32,41.81-22.66,58.8-39.64c16.99-16.99,30.32-36.77,39.64-58.8C365.11,234.2,370,209.97,370,185s-4.89-49.2-14.54-72.01c-9.32-22.03-22.66-41.81-39.64-58.8c-16.99-16.99-36.77-30.32-58.8-39.64C234.2,4.89,209.97,0,185,0L185,0z"/>'+"</g>"+'<path id="radar-pattern" opacity="0.2" fill="none" stroke="#CC0000" stroke-width="4" stroke-miterlimit="10" d="M308.5,185c0,68.21-55.29,123.5-123.5,123.5S61.5,253.21,61.5,185S116.79,61.5,185,61.5S308.5,116.79,308.5,185z M185,114.5c-38.94,0-70.5,31.56-70.5,70.5s31.56,70.5,70.5,70.5s70.5-31.56,70.5-70.5S223.94,114.5,185,114.5z"/>'+'<g id="radar-icons" transform="translate(44.000000, 38.000000)" fill="#CC0000" fill-rule="nonzero">'+'<path d="M94.5,1.77635684e-15 C88.7102687,1.77635684e-15 84,4.72398352 84,10.5305158 C84,17.7366039 93.3964714,28.3155625 93.7965345,28.7623935 C94.172305,29.1821353 94.8283745,29.181397 95.2034655,28.7623935 C95.6035286,28.3155625 105,17.7366039 105,10.5305158 C105,4.72398352 100.289675,1.77635684e-15 94.5,1.77635684e-15 Z M94.5000303,16.1538462 C91.3824349,16.1538462 88.8461538,13.6175317 88.8461538,10.4999697 C88.8461538,7.38240769 91.3824955,4.84615385 94.5000303,4.84615385 C97.6175651,4.84615385 100.153846,7.38246829 100.153846,10.5000303 C100.153846,13.6175923 97.6175651,16.1538462 94.5000303,16.1538462 Z" id="Shape-Copy-11"></path>'+'<path d="M27.5,62 C21.7102687,62 17,66.7239835 17,72.5305158 C17,79.7366039 26.3964714,90.3155625 26.7965345,90.7623935 C27.172305,91.1821353 27.8283745,91.181397 28.2034655,90.7623935 C28.6035286,90.3155625 38,79.7366039 38,72.5305158 C38,66.7239835 33.2896746,62 27.5,62 Z M27.5000303,78.1538462 C24.3824349,78.1538462 21.8461538,75.6175317 21.8461538,72.4999697 C21.8461538,69.3824077 24.3824955,66.8461538 27.5000303,66.8461538 C30.6175651,66.8461538 33.1538462,69.3824683 33.1538462,72.5000303 C33.1538462,75.6175923 30.6175651,78.1538462 27.5000303,78.1538462 Z" id="Shape-Copy-10"></path>'+'<path d="M77.5,89 C71.7102687,89 67,93.7239835 67,99.5305158 C67,106.736604 76.3964714,117.315562 76.7965345,117.762394 C77.172305,118.182135 77.8283745,118.181397 78.2034655,117.762394 C78.6035286,117.315562 88,106.736604 88,99.5305158 C88,93.7239835 83.2896746,89 77.5,89 Z M77.5000303,105.153846 C74.3824349,105.153846 71.8461538,102.617532 71.8461538,99.4999697 C71.8461538,96.3824077 74.3824955,93.8461538 77.5000303,93.8461538 C80.6175651,93.8461538 83.1538462,96.3824683 83.1538462,99.5000303 C83.1538462,102.617592 80.6175651,105.153846 77.5000303,105.153846 Z" id="Shape-Copy-9"></path>'+'<path d="M10.5,143 C4.71026873,143 0,147.723984 0,153.530516 C0,160.736604 9.39647139,171.315562 9.79653449,171.762394 C10.172305,172.182135 10.8283745,172.181397 11.2034655,171.762394 C11.6035286,171.315562 21,160.736604 21,153.530516 C21,147.723984 16.2896746,143 10.5,143 Z M10.5000303,159.153846 C7.38243487,159.153846 4.84615385,156.617532 4.84615385,153.49997 C4.84615385,150.382408 7.38249548,147.846154 10.5000303,147.846154 C13.6175651,147.846154 16.1538462,150.382468 16.1538462,153.50003 C16.1538462,156.617592 13.6175651,159.153846 10.5000303,159.153846 Z" id="Shape-Copy-8"></path>'+'<path d="M66.5,175 C60.7102687,175 56,179.723984 56,185.530516 C56,192.736604 65.3964714,203.315562 65.7965345,203.762394 C66.172305,204.182135 66.8283745,204.181397 67.2034655,203.762394 C67.6035286,203.315562 77,192.736604 77,185.530516 C77,179.723984 72.2896746,175 66.5,175 Z M66.5000303,191.153846 C63.3824349,191.153846 60.8461538,188.617532 60.8461538,185.49997 C60.8461538,182.382408 63.3824955,179.846154 66.5000303,179.846154 C69.6175651,179.846154 72.1538462,182.382468 72.1538462,185.50003 C72.1538462,188.617592 69.6175651,191.153846 66.5000303,191.153846 Z" id="Shape-Copy-7"></path>'+'<path d="M94.5,246 C88.7102687,246 84,250.723984 84,256.530516 C84,263.736604 93.3964714,274.315562 93.7965345,274.762394 C94.172305,275.182135 94.8283745,275.181397 95.2034655,274.762394 C95.6035286,274.315562 105,263.736604 105,256.530516 C105,250.723984 100.289675,246 94.5,246 Z M94.5000303,262.153846 C91.3824349,262.153846 88.8461538,259.617532 88.8461538,256.49997 C88.8461538,253.382408 91.3824955,250.846154 94.5000303,250.846154 C97.6175651,250.846154 100.153846,253.382468 100.153846,256.50003 C100.153846,259.617592 97.6175651,262.153846 94.5000303,262.153846 Z" id="Shape-Copy-6"></path>'+'<path d="M199.5,240 C193.710269,240 189,244.723984 189,250.530516 C189,257.736604 198.396471,268.315562 198.796534,268.762394 C199.172305,269.182135 199.828375,269.181397 200.203466,268.762394 C200.603529,268.315562 210,257.736604 210,250.530516 C210,244.723984 205.289675,240 199.5,240 Z M199.50003,256.153846 C196.382435,256.153846 193.846154,253.617532 193.846154,250.49997 C193.846154,247.382408 196.382495,244.846154 199.50003,244.846154 C202.617565,244.846154 205.153846,247.382468 205.153846,250.50003 C205.153846,253.617592 202.617565,256.153846 199.50003,256.153846 Z" id="Shape-Copy-5"></path>'+'<path d="M178.5,178 C172.710269,178 168,182.723984 168,188.530516 C168,195.736604 177.396471,206.315562 177.796534,206.762394 C178.172305,207.182135 178.828375,207.181397 179.203466,206.762394 C179.603529,206.315562 189,195.736604 189,188.530516 C189,182.723984 184.289675,178 178.5,178 Z M178.50003,194.153846 C175.382435,194.153846 172.846154,191.617532 172.846154,188.49997 C172.846154,185.382408 175.382495,182.846154 178.50003,182.846154 C181.617565,182.846154 184.153846,185.382468 184.153846,188.50003 C184.153846,191.617592 181.617565,194.153846 178.50003,194.153846 Z" id="Shape-Copy-4"></path>'+'<path d="M256.5,168 C250.710269,168 246,172.723984 246,178.530516 C246,185.736604 255.396471,196.315562 255.796534,196.762394 C256.172305,197.182135 256.828375,197.181397 257.203466,196.762394 C257.603529,196.315562 267,185.736604 267,178.530516 C267,172.723984 262.289675,168 256.5,168 Z M256.50003,184.153846 C253.382435,184.153846 250.846154,181.617532 250.846154,178.49997 C250.846154,175.382408 253.382495,172.846154 256.50003,172.846154 C259.617565,172.846154 262.153846,175.382468 262.153846,178.50003 C262.153846,181.617592 259.617565,184.153846 256.50003,184.153846 Z" id="Shape-Copy-3"></path>'+'<path d="M264.5,91 C258.710269,91 254,95.7239835 254,101.530516 C254,108.736604 263.396471,119.315562 263.796534,119.762394 C264.172305,120.182135 264.828375,120.181397 265.203466,119.762394 C265.603529,119.315562 275,108.736604 275,101.530516 C275,95.7239835 270.289675,91 264.5,91 Z M264.50003,107.153846 C261.382435,107.153846 258.846154,104.617532 258.846154,101.49997 C258.846154,98.3824077 261.382495,95.8461538 264.50003,95.8461538 C267.617565,95.8461538 270.153846,98.3824683 270.153846,101.50003 C270.153846,104.617592 267.617565,107.153846 264.50003,107.153846 Z" id="Shape-Copy-2"></path>'+'<path d="M202.5,89 C196.710269,89 192,93.7239835 192,99.5305158 C192,106.736604 201.396471,117.315562 201.796534,117.762394 C202.172305,118.182135 202.828375,118.181397 203.203466,117.762394 C203.603529,117.315562 213,106.736604 213,99.5305158 C213,93.7239835 208.289675,89 202.5,89 Z M202.50003,105.153846 C199.382435,105.153846 196.846154,102.617532 196.846154,99.4999697 C196.846154,96.3824077 199.382495,93.8461538 202.50003,93.8461538 C205.617565,93.8461538 208.153846,96.3824683 208.153846,99.5000303 C208.153846,102.617592 205.617565,105.153846 202.50003,105.153846 Z" id="Shape-Copy"></path>'+'<path d="M194.5,15 C188.710269,15 184,19.5490212 184,25.1404967 C184,32.0796927 193.396471,42.2668379 193.796534,42.6971197 C194.172305,43.1013155 194.828375,43.1006046 195.203466,42.6971197 C195.603529,42.2668379 205,32.0796927 205,25.1404967 C205,19.5490212 200.289675,15 194.5,15 Z M194.500029,31 C191.467267,31 189,28.5327009 189,25.4999705 C189,22.4672401 191.467326,20 194.500029,20 C197.532733,20 200,22.4672991 200,25.5000295 C200,28.5327599 197.532733,31 194.500029,31 Z" id="Shape"></path>'+"</g>"+'<circle id="radar-radius" opacity="0.1" fill="rgb(15, 91, 230)" cx="185" cy="185" r="45.67"/>'+'<circle id="radar-stem" fill="#CC0000" cx="185" cy="185" r="17.33"/>'+'<line id="radar-hand" fill="none" stroke="#CC0000" stroke-width="3" stroke-miterlimit="10" x1="185" y1="185" x2="185" y2="10"/>'+"</svg>",document.createElement("div")),a=(e.className="cont-radar",e.innerHTML="<p>"+nw.tr("Buscando Servicios")+'</p><svg viewBox="0 0 370 370"><g id="radar-bg"><path fill="#FFFFFF" d="M185,365C85.75,365,5,284.25,5,185C5,85.75,85.75,5,185,5c99.25,0,180,80.75,180,180C365,284.25,284.25,365,185,365z"/><path id="radar-path" fill="#CC0000" d="M185,10c96.65,0,175,78.35,175,175s-78.35,175-175,175S10,281.65,10,185S88.35,10,185,10 M185,0c-24.97,0-49.2,4.89-72.01,14.54c-22.03,9.32-41.81,22.66-58.8,39.64s-30.32,36.77-39.64,58.8C4.89,135.8,0,160.03,0,185s4.89,49.2,14.54,72.01c9.32,22.03,22.66,41.81,39.64,58.8c16.99,16.99,36.77,30.32,58.8,39.64C135.8,365.11,160.03,370,185,370s49.2-4.89,72.01-14.54c22.03-9.32,41.81-22.66,58.8-39.64c16.99-16.99,30.32-36.77,39.64-58.8C365.11,234.2,370,209.97,370,185s-4.89-49.2-14.54-72.01c-9.32-22.03-22.66-41.81-39.64-58.8c-16.99-16.99-36.77-30.32-58.8-39.64C234.2,4.89,209.97,0,185,0L185,0z"/></g><path id="radar-pattern" opacity="0.2" fill="none" stroke="#CC0000" stroke-width="4" stroke-miterlimit="10" d="M308.5,185c0,68.21-55.29,123.5-123.5,123.5S61.5,253.21,61.5,185S116.79,61.5,185,61.5S308.5,116.79,308.5,185z M185,114.5c-38.94,0-70.5,31.56-70.5,70.5s31.56,70.5,70.5,70.5s70.5-31.56,70.5-70.5S223.94,114.5,185,114.5z"/><g id="radar-icons" transform="translate(44.000000, 38.000000)" fill="#CC0000" fill-rule="nonzero"><path d="M94.5,1.77635684e-15 C88.7102687,1.77635684e-15 84,4.72398352 84,10.5305158 C84,17.7366039 93.3964714,28.3155625 93.7965345,28.7623935 C94.172305,29.1821353 94.8283745,29.181397 95.2034655,28.7623935 C95.6035286,28.3155625 105,17.7366039 105,10.5305158 C105,4.72398352 100.289675,1.77635684e-15 94.5,1.77635684e-15 Z M94.5000303,16.1538462 C91.3824349,16.1538462 88.8461538,13.6175317 88.8461538,10.4999697 C88.8461538,7.38240769 91.3824955,4.84615385 94.5000303,4.84615385 C97.6175651,4.84615385 100.153846,7.38246829 100.153846,10.5000303 C100.153846,13.6175923 97.6175651,16.1538462 94.5000303,16.1538462 Z" id="Shape-Copy-11"></path><path d="M27.5,62 C21.7102687,62 17,66.7239835 17,72.5305158 C17,79.7366039 26.3964714,90.3155625 26.7965345,90.7623935 C27.172305,91.1821353 27.8283745,91.181397 28.2034655,90.7623935 C28.6035286,90.3155625 38,79.7366039 38,72.5305158 C38,66.7239835 33.2896746,62 27.5,62 Z M27.5000303,78.1538462 C24.3824349,78.1538462 21.8461538,75.6175317 21.8461538,72.4999697 C21.8461538,69.3824077 24.3824955,66.8461538 27.5000303,66.8461538 C30.6175651,66.8461538 33.1538462,69.3824683 33.1538462,72.5000303 C33.1538462,75.6175923 30.6175651,78.1538462 27.5000303,78.1538462 Z" id="Shape-Copy-10"></path><path d="M77.5,89 C71.7102687,89 67,93.7239835 67,99.5305158 C67,106.736604 76.3964714,117.315562 76.7965345,117.762394 C77.172305,118.182135 77.8283745,118.181397 78.2034655,117.762394 C78.6035286,117.315562 88,106.736604 88,99.5305158 C88,93.7239835 83.2896746,89 77.5,89 Z M77.5000303,105.153846 C74.3824349,105.153846 71.8461538,102.617532 71.8461538,99.4999697 C71.8461538,96.3824077 74.3824955,93.8461538 77.5000303,93.8461538 C80.6175651,93.8461538 83.1538462,96.3824683 83.1538462,99.5000303 C83.1538462,102.617592 80.6175651,105.153846 77.5000303,105.153846 Z" id="Shape-Copy-9"></path><path d="M10.5,143 C4.71026873,143 0,147.723984 0,153.530516 C0,160.736604 9.39647139,171.315562 9.79653449,171.762394 C10.172305,172.182135 10.8283745,172.181397 11.2034655,171.762394 C11.6035286,171.315562 21,160.736604 21,153.530516 C21,147.723984 16.2896746,143 10.5,143 Z M10.5000303,159.153846 C7.38243487,159.153846 4.84615385,156.617532 4.84615385,153.49997 C4.84615385,150.382408 7.38249548,147.846154 10.5000303,147.846154 C13.6175651,147.846154 16.1538462,150.382468 16.1538462,153.50003 C16.1538462,156.617592 13.6175651,159.153846 10.5000303,159.153846 Z" id="Shape-Copy-8"></path><path d="M66.5,175 C60.7102687,175 56,179.723984 56,185.530516 C56,192.736604 65.3964714,203.315562 65.7965345,203.762394 C66.172305,204.182135 66.8283745,204.181397 67.2034655,203.762394 C67.6035286,203.315562 77,192.736604 77,185.530516 C77,179.723984 72.2896746,175 66.5,175 Z M66.5000303,191.153846 C63.3824349,191.153846 60.8461538,188.617532 60.8461538,185.49997 C60.8461538,182.382408 63.3824955,179.846154 66.5000303,179.846154 C69.6175651,179.846154 72.1538462,182.382468 72.1538462,185.50003 C72.1538462,188.617592 69.6175651,191.153846 66.5000303,191.153846 Z" id="Shape-Copy-7"></path><path d="M94.5,246 C88.7102687,246 84,250.723984 84,256.530516 C84,263.736604 93.3964714,274.315562 93.7965345,274.762394 C94.172305,275.182135 94.8283745,275.181397 95.2034655,274.762394 C95.6035286,274.315562 105,263.736604 105,256.530516 C105,250.723984 100.289675,246 94.5,246 Z M94.5000303,262.153846 C91.3824349,262.153846 88.8461538,259.617532 88.8461538,256.49997 C88.8461538,253.382408 91.3824955,250.846154 94.5000303,250.846154 C97.6175651,250.846154 100.153846,253.382468 100.153846,256.50003 C100.153846,259.617592 97.6175651,262.153846 94.5000303,262.153846 Z" id="Shape-Copy-6"></path><path d="M199.5,240 C193.710269,240 189,244.723984 189,250.530516 C189,257.736604 198.396471,268.315562 198.796534,268.762394 C199.172305,269.182135 199.828375,269.181397 200.203466,268.762394 C200.603529,268.315562 210,257.736604 210,250.530516 C210,244.723984 205.289675,240 199.5,240 Z M199.50003,256.153846 C196.382435,256.153846 193.846154,253.617532 193.846154,250.49997 C193.846154,247.382408 196.382495,244.846154 199.50003,244.846154 C202.617565,244.846154 205.153846,247.382468 205.153846,250.50003 C205.153846,253.617592 202.617565,256.153846 199.50003,256.153846 Z" id="Shape-Copy-5"></path><path d="M178.5,178 C172.710269,178 168,182.723984 168,188.530516 C168,195.736604 177.396471,206.315562 177.796534,206.762394 C178.172305,207.182135 178.828375,207.181397 179.203466,206.762394 C179.603529,206.315562 189,195.736604 189,188.530516 C189,182.723984 184.289675,178 178.5,178 Z M178.50003,194.153846 C175.382435,194.153846 172.846154,191.617532 172.846154,188.49997 C172.846154,185.382408 175.382495,182.846154 178.50003,182.846154 C181.617565,182.846154 184.153846,185.382468 184.153846,188.50003 C184.153846,191.617592 181.617565,194.153846 178.50003,194.153846 Z" id="Shape-Copy-4"></path><path d="M256.5,168 C250.710269,168 246,172.723984 246,178.530516 C246,185.736604 255.396471,196.315562 255.796534,196.762394 C256.172305,197.182135 256.828375,197.181397 257.203466,196.762394 C257.603529,196.315562 267,185.736604 267,178.530516 C267,172.723984 262.289675,168 256.5,168 Z M256.50003,184.153846 C253.382435,184.153846 250.846154,181.617532 250.846154,178.49997 C250.846154,175.382408 253.382495,172.846154 256.50003,172.846154 C259.617565,172.846154 262.153846,175.382468 262.153846,178.50003 C262.153846,181.617592 259.617565,184.153846 256.50003,184.153846 Z" id="Shape-Copy-3"></path><path d="M264.5,91 C258.710269,91 254,95.7239835 254,101.530516 C254,108.736604 263.396471,119.315562 263.796534,119.762394 C264.172305,120.182135 264.828375,120.181397 265.203466,119.762394 C265.603529,119.315562 275,108.736604 275,101.530516 C275,95.7239835 270.289675,91 264.5,91 Z M264.50003,107.153846 C261.382435,107.153846 258.846154,104.617532 258.846154,101.49997 C258.846154,98.3824077 261.382495,95.8461538 264.50003,95.8461538 C267.617565,95.8461538 270.153846,98.3824683 270.153846,101.50003 C270.153846,104.617592 267.617565,107.153846 264.50003,107.153846 Z" id="Shape-Copy-2"></path><path d="M202.5,89 C196.710269,89 192,93.7239835 192,99.5305158 C192,106.736604 201.396471,117.315562 201.796534,117.762394 C202.172305,118.182135 202.828375,118.181397 203.203466,117.762394 C203.603529,117.315562 213,106.736604 213,99.5305158 C213,93.7239835 208.289675,89 202.5,89 Z M202.50003,105.153846 C199.382435,105.153846 196.846154,102.617532 196.846154,99.4999697 C196.846154,96.3824077 199.382495,93.8461538 202.50003,93.8461538 C205.617565,93.8461538 208.153846,96.3824683 208.153846,99.5000303 C208.153846,102.617592 205.617565,105.153846 202.50003,105.153846 Z" id="Shape-Copy"></path><path d="M194.5,15 C188.710269,15 184,19.5490212 184,25.1404967 C184,32.0796927 193.396471,42.2668379 193.796534,42.6971197 C194.172305,43.1013155 194.828375,43.1006046 195.203466,42.6971197 C195.603529,42.2668379 205,32.0796927 205,25.1404967 C205,19.5490212 200.289675,15 194.5,15 Z M194.500029,31 C191.467267,31 189,28.5327009 189,25.4999705 C189,22.4672401 191.467326,20 194.500029,20 C197.532733,20 200,22.4672991 200,25.5000295 C200,28.5327599 197.532733,31 194.500029,31 Z" id="Shape"></path></g><circle id="radar-radius" opacity="0.1" fill="rgb(15, 91, 230)" cx="185" cy="185" r="45.67"/><circle id="radar-stem" fill="#CC0000" cx="185" cy="185" r="17.33"/><line id="radar-hand" fill="none" stroke="#CC0000" stroke-width="3" stroke-miterlimit="10" x1="185" y1="185" x2="185" y2="10"/></svg>',document.querySelector(".buttons_driver").append(e),document.querySelectorAll("#radar-icons path")),o=[],i=0,n=0;n<a.length;n++)o.push(a[n]);o=o.reverse(),setInterval(function(){var e;i<12&&((e=o[i]).style.opacity="2",e.style.transition="5s",0<i)&&(o[i-1].style.opacity="0"),13==++i&&(i=0,o[11].style.opacity="0")},1500)},calcularMinutos:function(e,a){e=this.devolverMinutos(e);return this.devolverMinutos(a)-e},devolverMinutos:function(e){return console.log("horaMinutos",e),nw.evalueData(e)?60*parseInt(e.split(":")[0])+parseInt(e.split(":")[1]):""}}}),nw.Class.define("f_vehiculo",{extend:nw.forms,construct:function(e,a){var i=this;if(i.pr=e,i.configCliente=main.configCliente,document.querySelector(".titlevehione"))return!1;var o=!1,a=void 0!==a?a:!1,a=(!0===a?(o="f_vehiculo_foo",i.canvas="#foo",i.id_form="f_vehiculo"):(i.id="f_vehiculo",i.setTitle="<span style='color:#fff;'>Vehículo</span>",i.html="<div class='vehiculo'>"+nw.tr("Vehículo")+"</div>",i.showBack=!0,i.closeBack=!1,i.colorBtnBackIOS="#ffffff;",i.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",i.createBase()),i.enabled=!0,i.tipo_vehiculo=!1,i.descripcion_carroceria=!1,i.createInHome=a,console.log("createInHome",a),i.event=new Event("cancelservice"),!1),n=!1,t=!1,r=!1,c=!1,s=!1,l=(nw.evalueData(e)&&(nw.evalueData(e.imagen_vehi)&&(a=e.imagen_vehi),nw.evalueData(e.foto_soat)&&(n=e.foto_soat),nw.evalueData(e.tarjeta_propiedad)&&(t=e.tarjeta_propiedad),nw.evalueData(e.tarjeta_propiedad_trasera)&&(r=e.tarjeta_propiedad_trasera),nw.evalueData(e.revision_tegnomecanica)&&(c=e.revision_tegnomecanica),nw.evalueData(e.rut))&&(s=e.rut),i.configCliente.revision_tegnomecanica,[]),a=(l.push({name:"vehiculo_publico_particular",label:"Vehículo público, particular o taxi",type:"selectBox",required:!0,visible:!0}),l.push({name:"id",label:"ID",placeholder:"id",type:"textField",required:!1,visible:!1},{name:"imagen_vehi",label:"Foto del vehículo <span class='textdebeserplaca'>(Mostrando la PLACA)</span>",placeholder:"Foto",type:"button",mode:"camera_files",data:a,required:!0,visible:!0,enabled:!0},{name:"tipo_vehiculo",label:"Tipo de Vehículo",type:"selectBox",required:!0,visible:!0},{name:"placa",label:"Placa",placeholder:"Placa",type:"textField",required:!0,visible:!0},{name:"descripcion_carroceria",label:"Descripción Carrocería",type:"selectBox"},{name:"capacidad_carga_kg",label:"Capacidad Carga en Kg",type:"numeric"},{name:"capacidad_volumen_m3",label:"Capacidad Volumen en M3",type:"numeric"},{name:"marca_text",label:"Marca",placeholder:"Marca",type:"search",required:!0,visible:!0},{name:"marca",label:"Marca Id",placeholder:"Marca Id",type:"textField",required:!0,visible:!1},{name:"modelo",label:"Modelo",placeholder:"Modelo",type:"selectBox",required:!0,visible:!0},{name:"color",label:"Color",placeholder:"Color",type:"textField",required:!0,visible:!0},{name:"numero_puertas",label:"Número Puertas",type:"selectBox",visible:!0},{name:"capacidad_pasajeros",label:"Capacidad Pasajeros",type:"selectBox",visible:!0},{name:"num_maletas",label:"N° Maletas",type:"selectBox",visible:!0},{name:"foto_soat",label:"Foto del SOAT",placeholder:"SOAT",type:"button",mode:"camera_files",data:n,required:!1,visible:!0},{name:"fecha_vencimiento_soat",label:"Fecha vencimiento SOAT",placeholder:"Fecha vencimiento SOAT",type:"dateField",required:!0,visible:!0},{name:"tarjeta_propiedad",label:"Tarjeta de propiedad",type:"button",mode:"camera_files",data:t,required:!0,visible:!0},{name:"tarjeta_propiedad_trasera",label:"Tarjeta de Propiedad Trasera",type:"button",mode:"camera_files",data:r},{name:"revision_tegnomecanica",label:"Revisión Tecnomecánica",type:"button",mode:"camera_files",data:c},{name:"fecha_vencimiento_tegnomecanica",label:"Fecha vencimiento Tecnomecánica",placeholder:"Fecha vencimiento Tecnomecánica",type:"dateField"},{name:"nombre_propietario",label:"Nombre Propietario",type:"textField"},{name:"identificacion_propietario",label:"Identificación Propietario",type:"textField"},{name:"rut",label:"RUT",type:"button",mode:"camera_files",data:s},{name:"direccion_proietario",label:"Dirección Propietario",type:"textField"},{name:"telefono_proietario",label:"Teléfono Propietario",type:"numeric"},{name:"numero_tarjeta_operacion",label:"Número tarjeta operación",type:"textField"},{name:"fecha_vencimiento_numero_tarjeta_operacion",label:"Fecha vencimiento Número tarjeta operación",type:"dateField"},{name:"numero_interno",label:"Número interno",type:"textField"}),l.push({name:"vehiculo_poliza_contractual",label:"Fecha vencimiento póliza contractual y extracontractual",type:"dateField",required:!1,visible:!0}),l.push({name:"vehiculo_poliza_todoriesgo",label:"Fecha vencimiento póliza todoriesgo",type:"dateField",required:!1,visible:!0}),i.setFields(main.labels(l)),i.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar btn_generic btn_generic_aceptar_vehiculo",label:"Guardar",callback:function(){i.save()}}],i.show(),nw.evalueData(o)&&nw.addClass(document.querySelector(i.canvas),o),console.log("main.configCliente.documentos_vehiculo",main.configCliente.documentos_vehiculo),void 0!==main.configCliente.documentos_vehiculo&&$.each(main.configCliente.documentos_vehiculo,function(e,a){var o;"id"!=e&&(o="NO"!==a,void 0!==i.ui[e])&&("SI_REQUIRED_FALSE"===a?(i.ui[e].setVisibility(!0),i.ui[e].setRequired(!1)):(i.ui[e].setVisibility(o),i.ui[e].setRequired(o)))}),i.ui.fecha_vencimiento_soat.addListener("change",function(){var e=i.ui.fecha_vencimiento_soat.getValue(),e=new Date(e),a=(new Date).getFullYear(),e=e.getFullYear();parseInt(e)-parseInt(a)<0&&(nw.dialog("La fecha del soat no puede ser menor a la fecha actual"),i.ui.fecha_vencimiento_soat.setValue(""))}),{});a.service="servicios_conductor",a.method="populateTokenMarcaBuscarApp",a.showsinresult=!0,i.ui.marca_text.actionSearch(a),i.ui.marca_text.addListener("clickToken",function(e){if(!e.data)return nw.cleanTokenField(),!1;console.log(e),i.ui.marca_text.data_array=e.data.row,i.ui.marca_text.setValue(e.data.row.nombre),i.ui.marca.setValue(e.data.row.id)});(v={})[""]="Seleccione";var d=parseFloat(i.configCliente.rango_modelo_vheiculo);console.log("self.configCliente",i.configCliente);for(var u=(new Date).getFullYear(),p=0;p<46&&(v[d]=d,!(u+4<(d+=1)));p++);i.ui.modelo.populateSelectFromArray(v),i.ui.modelo.setValue("");for(var v={"":"Seleccione",0:0},m=1,_=0;_<8;_++)v[m]=m,m++;i.ui.numero_puertas.populateSelectFromArray(v);for(var v={"":"Seleccione"},f=1,g=0;g<50;g++)v[f]=f,f++;i.ui.capacidad_pasajeros.populateSelectFromArray(v);for(v={"":"Seleccione"},p=1;p<=100;p++)v[p]=p.toString();i.ui.num_maletas.populateSelectFromArray(v);v={"":"Seleccione"},i.ui.tipo_vehiculo.populateSelectFromArray(v),v={"":"Seleccione",particular:"Particular",publico:"Público",publico_taxi:"Taxi"},i.ui.vehiculo_publico_particular.populateSelectFromArray(v),!0===config.vehiculo_publico_particular&&i.ui.vehiculo_publico_particular.addListener("change",function(){"particular"===i.getRecord(!0).vehiculo_publico_particular&&(nw.dialog("Lo sentimos, no puede registrar un vehículo particular"),i.ui.vehiculo_publico_particular.setValue(""))}),n=nw.userPolicies.getUserData(),t="";"SI"===i.configCliente.tipos_vehiculos_independientes_otras_empresas&&(t=" empresa="+n.empresa),i.ui.tipo_vehiculo.populateSelect("master","populate",{table:"edo_tipo_vehiculo",where:t},function(e){console.log(e),i.tipo_vehiculo&&i.ui.tipo_vehiculo.setValue(i.tipo_vehiculo)}),i.ui.descripcion_carroceria.setVisibility(!1),"SI"==i.configCliente.usar_descripcion_carroceria&&(i.ui.descripcion_carroceria.setVisibility(!0),i.ui.descripcion_carroceria.populateSelectFromArray(v={"":"Seleccione"}),v={},i.ui.descripcion_carroceria.populateSelect("master","populate",{table:"edo_descripcion_carroceria",where:" and empresa="+n.empresa},function(e){i.descripcion_carroceria&&i.ui.descripcion_carroceria.setValue(i.descripcion_carroceria)})),"SI"!=i.configCliente.pedir_datos_propietario_vehiculo&&(i.ui.nombre_propietario.setVisibility(!1),i.ui.identificacion_propietario.setVisibility(!1),i.ui.rut.setVisibility(!1),i.ui.direccion_proietario.setVisibility(!1),i.ui.telefono_proietario.setVisibility(!1)),i.addHeaderNote("<h1 class='titlevehione'>"+nw.tr("Por favor registre los datos de su vehículo")+"</h1>"),0==e?i.consultaVehiculo():void 0!==e&&0!=e&&(r=new Date,c=new Date(e.fecha_vencimiento_soat),r.setDate(r.getDate()+5),console.log(e.estado_activacion),console.log(e.servicio_activo),"1"==e.estado_activacion&&r<=c&&"1"==e.servicio_activo?(nw.utils.validateElementIfExist("#f_vehiculo .contentCenter",function(e){e&&(e.style.pointerEvents="none")}),nw.utils.validateElementIfExist("#f_vehiculo .btn_generic_aceptar_vehiculo",function(e){e&&(e.style.display="none")})):"SI"==main.configCliente.soat&&"1"==e.estado_activacion&&"1"==e.servicio_activo&&nw.dialog("Se ha vencido o esta por vencerce el SOAT de tu vehículo por favor actualiza los datos.")),console.log(i.pr)},destruct:function(){},members:{consultaVehiculo:function(){var a=this,e=nw.userPolicies.getUserData(),o=a.getRecord(!0),e=(o.usuario=e.usuario,o.empresa=e.empresa,o.usuario_text=e.nombre,o.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0);e.exec("consultaDatosVehiculo",o,function(e){console.log(e),a.populate(e)})},save:function(){var a=this;if(!a.validate())return!1;var e=nw.userPolicies.getUserData(),o=a.getRecord(!0);if(nw.evalueData(config.vehiculo_publico_particular)&&"particular"===o.vehiculo_publico_particular)return nw.dialog("Lo sentimos, no puede registrar un vehículo particular"),!1;void 0===a.pr?o.activo="NO":0==a.pr&&(o.update="SI"),o.usuario=e.usuario,o.empresa=e.empresa,o.usuario_text=e.nombre,o.id_usuario=e.id_usuario,"string"==typeof e.bodega&&""!=e.bodega&&"null"!=e.bodega&&(o.bodega=e.bodega);e=new nw.rpc(nw.getRpcUrl(),"vehiculo");e.setAsync(!0),e.setLoading(!1),nw.loading({text:"",title:"Guardando, por favor espere",addClass:"loading_fixed"});e.exec("save",o,function(e){console.log("save",e),nw.remove(".loading_fixed"),!0===e&&(e="Guardado correctamente. Debes esperar aprobación por parte del administrador.",!0===a.createInHome&&nw.dialog(e,function(){return window.location.reload(),!0}),document.dispatchEvent(a.event),a.reject(),nw.dialog(e,function(){return nw.evalueData(a.callback)?a.callback():window.location.reload(),!0}))})},populate:function(e){console.log(e),this.tipo_vehiculo=e.tipo_vehiculo,void 0!==e.descripcion_carroceria&&(this.descripcion_carroceria=e.descripcion_carroceria),this.setRecord(e)}}}),nw.Class.define("f_chat",{extend:nw.forms,construct:function(e,a){var o=this;o.id="f_chat",o.showBack=!0,o.closeBack=!1,o.textClose="Volver",nw.utils.evalueData(e.cliente_nombre)||(e.cliente_nombre="Pasajero"),o.setTitle=nw.tr("Chat con")+" "+e.cliente_nombre,o.createBase();o.setFields([{name:"frame_chat_form",label:"",type:"html",visible:!0}]),o.show(),o.retraso=a,o.datos=e,o.tokens=!1,o.id_clean=e.id,o.isParada="NO",console.log("datos.id",e.id),console.log("datos.id.indexOf(parada)",e.id.indexOf("parada")),-1!=e.id.indexOf("parada")&&(o.isParada="SI",console.log("datos.id.split(_parada_)",e.id.split("_parada_")),o.id_clean=e.id.split("_parada_")[1]),console.log("self.id_clean",o.id_clean),console.log("self.datos",o.datos),o.onAppear(function(){nw.loading({text:"Por favor espere...",title:"Cargando chat..."}),o.getTokens(function(){o.frame()})})},destruct:function(){},members:{getTokens:function(o){var i=this,e=nw.userPolicies.getUserData(),a={},e=(a.id=i.id_clean,a.es_parada=i.isParada,a.empresa=e.empresa,a.usuario=e.usuario,a.perfil=e.perfil,new nw.rpc(i.getRpcUrl(),"servicios"));console.log("getTokens:::dataSend",a),e.setAsync(!0),e.setLoading(!1);e.exec("getTokensByChat",a,function(e){var a;if(console.log("getTokens:::responseServer",e),"string"==typeof e)return nw.loadingRemove(),"pasajero_no_configurado"==e?nw.dialog("El servicio no tiene configurado un pasajero"):(a="<strong style='color:red;'>¡Importante! No podrás comunicarte por el siguiente motivo: </strong>",a+="<br />"+e,nw.dialog(a)),nw.back(),!1;i.tokens=e,o(),console.log("getTokens:::server_data",JSON.stringify(e)),window.localStorage.setItem("tokensInChat_"+i.id_clean,JSON.stringify(e))})},frame:function(){var e,a=this,o=a.datos,i=a.retraso,n=nw.userPolicies.getUserData(),t=document.querySelector(".framechat_conversation");t||(e="",e=(e=(e=(e=(e=(e+=config.domain_rpc)+"/nwlib6/nwproject/modules/webrtc/v6/chat/index.html?room="+o.id)+"&setUserName="+n.nombre+" (Driver)")+"&setUserPhoto="+n.foto_perfil)+"&setUserEmail="+n.email)+"&id_user="+n.id_usuario+"&saveToken=true&useMicroMsg=false&btnEmoji=false",nw.utils.evalueData(config.idiomaPorDefecto)&&(e+="&languaje="+config.idiomaPorDefecto),nw.utils.evalueData(main.configCliente.keyGoogleNotificacionPush)&&(e+="&keyGoogleNotificacionPush="+main.configCliente.keyGoogleNotificacionPush),nw.utils.evalueData(a.tokens)&&(n=JSON.stringify(a.tokens),console.log("tokens",n),n=btoa(n),console.log("encodedString",n),e+="&tokensAllGroup="+n),n={is_movilmove:!0,usa_firebase:(n=main.configCliente).usa_firebase,usa_firebase_modo_pruebas:n.usa_firebase_modo_pruebas},n=JSON.stringify(n),e+="&configAditional="+btoa(n),console.log("url",e),(t=document.createElement("iframe")).className="framechat_conversation framechat_conversation_"+o.id,t.id="framechat_conversation",t.src=e,t.allow="geolocation; microphone; camera",t.onload=function(){nw.loadingRemove(),i&&setTimeout(function(){var e={tipo:"send_message_ringow",message:"Me encuentro retrasado."};t.contentWindow.postMessage(e,"*")},1e3);var e={tipo:"send_message_ringow",message:"Me encuentro retrasado."};t.contentWindow.postMessage(e,"*")},a.ui.frame_chat_form.setValue(t))}}}),nw.Class.define("f_resumen_final",{extend:nw.forms,construct:function(){$(".f_resumen_final").remove();var t=this,e=(t.id="f_resumen_final",t.setTitle="<span style='color:#fff;'>Resumen</span>",t.showBack=!1,t.closeBack=!1,t.textClose="Home",t.colorBtnBackIOS="#ffffff;",t.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",t.transition="slideup",t.createBase(),t.event=new Event("calificaService"),t.configCliente=main.configCliente,t.usuario=null,t.data=null,t.setFields([{name:"id",label:"ID",type:"textField",visible:!1},{name:"label_puntaje_en_texto",label:"",type:"html"},{name:"puntaje",label:"",type:"radio",required:!0},{name:"comentarios",label:"",placeholder:"Comentarios",type:"textArea",required:!1}]),t.buttons=[],t.buttons.push({style:"background-color: #f18107;color: #ffffff;",icon:"",colorBtnBackIOS:"#ffffff",name:"aceptar",label:"Calificar",callback:function(){var e=nw.userPolicies.getUserData(),a=t.getRecord();if(void 0===a.puntaje&&(a.puntaje=1),a.usuario=t.usuario,a.usuario_califica=e.usuario,a.perfil=e.perfil,a.empresa=e.empresa,!t.validate())return!1;console.log("data",a);e=new nw.rpc(nw.getRpcUrl(),"servicios");e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Calificando..."});e.exec("calificarServicioConductor",a,function(e){console.log("f_resumen_final",e),nw.loadingRemove(),document.dispatchEvent(t.event),nw.home(),main.selfMapaDriver.activeNormal(),main.selfMapaDriver.cerrarNotificionMain(),main.selfMapaDriver.centerUbication(),main.registerServiceInFirebase(a.id)})}}),t.show(),$(t.canvas).addClass("f_calificar_estrellas"),{});e[1]="<i class='material-icons'>star_border</i>",e[2]="<i class='material-icons'>star_border</i>",e[3]="<i class='material-icons'>star_border</i>",e[4]="<i class='material-icons'>star_border</i>",e[5]="<i class='material-icons'>star_border</i>",t.ui.puntaje.populateSelectFromArray(e),t.ui.puntaje.setValue(""),t.ui.puntaje.changeValue(function(e){for(var a=e.value,o=(t.ui.label_puntaje_en_texto.setValue(t.arrayPuntaje(a)),t.ui.puntaje.find(".label_radio_nw")),i=0;i<o.length;i++){var n=o[i];$(n).removeClass("label_radio_nw_active"),n.innerHTML="<i class='material-icons'>star_border</i>"}for(i=0;i<parseInt(a);i++){n=o[i];$(n).addClass("label_radio_nw_active"),n.innerHTML="<i class='material-icons'>star</i>"}})},destruct:function(){},members:{arrayPuntaje:function(e){var a=["",nw.utils.tr("Terrible"),nw.utils.tr("Malo"),nw.utils.tr("Regular"),nw.utils.tr("Bueno"),nw.utils.tr("Excelente")];return nw.tr(a[e])},populate:function(i){var n=this,e=(n.valor_final="0",{}),a=(e.id=i.id,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0),a.setLoading(!1);a.exec("consultaSolit",e,function(e){if(nw.loadingRemove(),console.log("populate",e),!e)return nw.home(),!1;var a=0,o=(nw.evalueData(e.valor_total_servicio)&&(a=e.valor_total_servicio),n.data=e,"<div class='resumenfinaldiv'>");"SI"===n.configCliente.mostrar_valor_conductor&&(o+="<h1 class='price_see price_see_totalpagar'>"+nw.tr("Total a pagar:")+" $<span class='totalapagar'>"+nw.addNumber(a)+"</span></h1>","SI"==e.aplico_peaje&&(o+="<p class='price_see price_see_peajes'><strong>"+nw.tr("Peajes:")+"</strong> $"+nw.addNumber(e.valor_peajes)+"</p>"),nw.evalueData(e.paradas_adicional_valor_total)&&(o+="<p class='price_see price_see_recargoparadas'><strong>"+nw.tr("Recargo por paradas adicionales:")+"</strong> $"+nw.addNumber(e.paradas_adicional_valor_total)+"</p>"),nw.evalueData(e.valor_recargo_ruta_fija)&&(o+="<p class='price_see price_see_recargofijo'><strong>"+nw.tr("Recargo fijo:")+"</strong> $"+nw.addNumber(e.valor_recargo_ruta_fija)+"</p>"),nw.evalueData(e.valor_espera)&&(o+="<p class='price_see price_see_valorespera'><strong>"+nw.tr("Valor espera:")+"</strong> $"+nw.addNumber(e.valor_espera)+"</p>"),nw.evalueData(e.tiempo_espera)&&(o+="<p class='price_see price_see_tiempoespera'><strong>"+nw.tr("Minutos de espera:")+"</strong> "+e.tiempo_espera+" mins</p>"),nw.evalueData(e.saldo_user_aplicado)&&(o+="<p class='price_see price_see_saldopagouser'><strong>"+nw.tr("Pago con saldo:")+"</strong> $"+nw.addNumber(e.saldo_user_aplicado)+"</p>"),nw.evalueData(e.descuento_aplicado)&&(o+="<p class='price_see  price_see_descuento price_see_descuento_con'><strong>"+nw.tr("Descuento:")+"</strong> $"+nw.addNumber(e.descuento_aplicado)+"</p>",a=parseFloat(e.valor_total_servicio)+parseFloat(e.descuento_aplicado),o+="<p class='price_see price_see_descuento price_see_descuento_sin'><strong>"+nw.tr("Valor sin descuento:")+" </strong>$"+nw.addNumber(a)+"</p>"),nw.evalueData(e.utilidad_conductor)&&(o+="<p class='price_see price_see_utilidadconductor'><strong>"+nw.tr("Utilidad conductor:")+" </strong>$"+nw.addNumber(e.utilidad_conductor)+"</p>"),nw.evalueData(e.utilidad_empresa)&&(o+="<p class='price_see price_see_utilidadempresa'><strong>"+nw.tr("Utilidad empresa:")+" </strong>$"+nw.addNumber(e.utilidad_empresa)+"</p>"),nw.evalueData(e.comision_porcentaje)&&(o+="<p class='price_see price_see_porcentajecomision'><strong>"+nw.tr("Porcentaje comisión:")+" </strong>"+e.comision_porcentaje+"%</p>"),nw.evalueData(e.numero_referidos)&&(o+="<p class='price_see price_see_numeroreferidos'><strong>"+nw.tr("Numero de referidos:")+" </strong>"+nw.addNumber(e.numero_referidos)+"</p>"),nw.evalueData(e.valor_referido))&&(o+="<p class='price_see price_see_'utilidadreferidoempresa><strong>"+nw.tr("Utilidad referido de la utilidad empresa:")+" </strong>$"+nw.addNumber(e.valor_referido)+"</p>"),nw.evalueData(e.cliente_nombre)&&(o+="<p class='price_see price_see_cliente'><strong>"+nw.tr("Cliente:")+" </strong>"+e.cliente_nombre+"</p>"),"SI"===n.configCliente.mostrar_valor_conductor&&(o+="<p class='price_see price_see_formapago'><strong>"+nw.tr("Forma de pago:")+" </strong>"+nw.tr(e.tipo_pago)+"</p>"),nw.evalueData(i.bodega_text)&&(o+="<p class='price_see price_see_empresa'><strong>"+nw.tr("Empresa:")+" </strong>"+i.bodega_text+"</p>"),n.usuario=e.usuario,o=(o+="<p class='datosend_see price_see_origen'><strong>"+nw.tr("Origen:")+" </strong>"+e.origen+"</p>")+"<p class='datosend_see price_see_destino'><strong>"+nw.tr("Destino:")+" </strong>"+e.destino+"</p>",nw.evalueData(e.subcategoria_servicio_text)&&(o+="<p class='datosend_see price_see_servicio'><strong>"+nw.tr("Servicio:")+" </strong>"+e.subcategoria_servicio_text+"</p>"),o+="<p class='datosend_see price_see_fechaserv'><strong>"+nw.tr("Fecha del servicio:")+" </strong>"+e.fecha+" "+e.hora+"</p>",nw.evalueData(e.hora_llegada)&&(o+="<p class='datosend_see price_see_horainicio'><strong>"+nw.tr("Hora inicio:")+" </strong>"+e.hora_llegada+"</p>"),nw.evalueData(e.hora_fin_servicio)&&(o+="<p class='datosend_see price_see_horafin'><strong>"+nw.tr("Hora finalización:")+" </strong>"+e.hora_fin_servicio+"</p>"),"string"==typeof e.cancelado_notas&&""!=e.cancelado_notas&&(o+="<p class='datosend_see price_see_observacionesfinales'><strong>"+nw.tr("Observación finalización:")+" </strong>"+e.cancelado_notas+"</p>"),o+="<p class='datosend_id'><strong>#</strong>"+e.id+"</p>","CANCELADO_POR_USUARIO"==e.estado&&(o+="<p class='cancela_seeend' style='color: red; margin-top: 50px;'><strong>"+nw.tr("El usuario ha cancelado el servicio, puedes otorgar la calificación que consideres y enviar tus comentarios")+"</p>"),n.addHeaderNote(o+="</div>"),n.ui.id.setValue(e.id)})}}}),nw.Class.define("f_z102_finalizarViaje_traecomisiones",{extend:nw.lists,construct:function(e,a,o){e.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_z102_finalizarViaje_traecomisiones"),console.log("RESPONSE:::totalPorcentajes:::r",a);nw.userPolicies.getUserData();var e={comision_porcentaje:0,utilidad_conductor:0},i=0;null!=a.porcentaje&&"null"!=a.porcentaje&&""!=a.porcentaje&&"0"!=a.porcentaje&&0!=a.porcentaje&&nw.evalueData(a.porcentaje)&&(i=a.porcentaje),e.porcentaje=i,e.porcentaje_empresa=100-parseFloat(i),"0"==(e.porcentaje_proveedor=i)?(e.utilidad_interna=a.precio_viaje,e.utilidad_conductor=0):(e.utilidad_conductor=parseFloat(a.precio_viaje)*parseFloat(i)/100,e.utilidad_interna=parseFloat(a.precio_viaje)-parseFloat(e.utilidad_conductor)),e.comision_porcentaje=parseFloat(i),console.log("ga.utilidad_conductor "+e.utilidad_conductor),console.log("ga.utilidad_interna "+e.utilidad_interna),console.log("ga.comision_porcentaje "+e.comision_porcentaje),o(e)},destruct:function(){},members:{}}),nw.Class.define("f_validaSoatVigente",{extend:nw.lists,construct:function(e){e.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_validaSoatVigente");var a,o,i,n,t,r,c=e.vehiculo;c&&(a=new Date,o=new Date(c.fecha_vencimiento_soat),i=0,n=a.getMonth()+1,t=o.getMonth()+1,r=a.getFullYear(),o.getFullYear()==r)&&t==n&&(0==(i=a<=o?o.getDate()+1-a.getDate():i)&&e.inactiveVehiculo(),a.setDate(a.getDate()+5),"1"==c.estado_activacion)&&o<=a&&nw.createNotificacionBarInter({addClass:"notifiVenici",timeToRemove:59e3,title:"<span style='color:#ed5851;font-size: 21px;'>Información.</span>",body:"</br><div>el soat de tu vehiculo "+c.marca_text+" de placas "+c.placa+" esta por vencerce actualiza los datos de tu vehículo para evitar bloqueos.</div></br>\n                       <div style='text-align:center;'>Te quedan "+i+" días.</div></br>\n                       <div style='display: flex;'><button style='width:150px;'>Aceptar</button></div>",icon:!1})},destruct:function(){},members:{}}),nw.Class.define("f_z100_finalizarViaje_valida",{extend:nw.lists,construct:function(h){function a(){nwgeo.getLatitudLongitud(function(e){h.execPositionMove(e);var e={},a=(e.id=h.data_service.id,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0),a.setLoading(!0);a.exec("consultaSolit",e,function(e){var o,a,i=nw.userPolicies.getUserData(),n=(h.clearIntervaloInService(),clearTimeout(h.recorridosave),e),e=(n.usuario_cliente=e.usuario,n.nombre_cliente=e.cliente_nombre,n.precio_viaje=parseInt(e.precio_viaje),n.usuario_cliente=e.usuario_cliente,console.log("rrrrrrrrrrrrrrrrrr",e),console.log("serv",n),h.positionConductor),e={lat:parseFloat(n.latitudConfirmaAbordaje),lng:parseFloat(n.longitudConfirmaAbordaje),lat2:parseFloat(e.lat),lng2:parseFloat(e.lng)},t=(console.log("serv",n),console.log("coords",e),new Date),r=n.hora_inicio,t=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),r=h.calcularMinutos(r,t),t=(console.log("totalMinutos",r),parseInt(r)),t=parseInt(t)*parseInt(n.valor_unidad_tiempo),e=(console.log("valor_minutos",t),nwgeo.distance(e.lat,e.lng,e.lat2,e.lng2)),c=(console.log("distanceDriverMtrs",e),e=e.toFixed(0),console.log("distanceDriverMtrs fixed",e),c=(c=e/1e3)*n.valor_unidad_metros,parseFloat(c)),s=(console.log("valor_distancia",c),"tiempo_+_distancia"),l=t+c,d=("SI"===h.configCliente.precioFinalIgualInicio&&l>n.valor&&(l=parseFloat(n.valor),s="precioFinalIgualInicio"),"SI"===h.configCliente.precioMinimoIgualInicio&&parseFloat(l)<parseFloat(n.valor)&&(l=parseFloat(n.valor),s="precioMinimoIgualInicio"),"tarifa_fija"==n.tarifa&&(l=parseFloat(n.valor),s="tarifa_fija"),!1),u=(nw.utils.evalueData(n.valor_tarifa_minima)&&l<parseFloat(n.valor_tarifa_minima)&&(l=parseFloat(n.valor_tarifa_minima),d=!0,s="valor_tarifa_minima"),"NO"),p=(nw.utils.evalueData(n.valor_espera)&&(l=parseFloat(l)+parseFloat(n.valor_espera),u="SI"),nw.utils.evalueData(n.paradas_adicional_valor_total)&&(l=parseFloat(l)+parseFloat(n.paradas_adicional_valor_total)),console.log("valor_final",l),0),v=(nw.utils.evalueData(h.configCliente.comision_conductor_porcentaje)&&(p=h.configCliente.comision_conductor_porcentaje),parseFloat(l)*p/100),m=100-p,_=parseFloat(l)*m/100,f=0,g=0,i=(nw.utils.evalueData(n.iva)&&(f=n.iva),nw.utils.evalueData(n.iva_porcentaje)&&(g=n.iva_porcentaje),nw.userPolicies.getUserData()),w={};function b(){w.configCliente=main.configCliente,w.dataService=h.dataByBooking("LLEGADA_DESTINO"),w.templateEmail=main.templateMailEnd(),nw.utils.evalueData(w.dataService.otros_conductores)&&(e=JSON.parse(w.dataService.otros_conductores),console.log("conds",e),nw.utils.evalueData(w.dataService.conductor_proximo)||(e=e[0],nw.utils.evalueData(e)&&(e=nw.utils.str_replace("{","",e),e=nw.utils.str_replace("}","",e),w.duplica_viaje="SI",w.dataService.conductor_proximo=e))),console.log("finalizarServicio:::serv",n),console.log("finalizarServicio:::dataSend",w);var e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor");e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Actualizando saldos, viaje y liberando conductor..."});e.exec("llegadaServicioDestiono",w,function(e){if(nw.loadingRemove(),console.log("RESPONSE_SERVER:::finalizarServicio:::r",e),!0!==e)return nw.dialog(e),!1;void 0!==h.markerParada&&nwgeo.removeMarker(h.markerParada);e=document.querySelector(".list-paradas");e&&e.remove(),config.activesaveAllPosition=!1,config.id_servi_ubic=!1,h.reziseNormalMap(),nwgeo.removeAllPolyLines(),nw.sendNotificacion({title:"Tu viaje ha finalizado",body:"Tu viaje ha finalizado",icon:"fcm_push_icon",sound:"default",data:"nw.dialog('"+nw.utils.tr("Viaje finalizado")+"')",callback:"FCM_PLUGIN_ACTIVITY",to:n.token_usuario}),document.querySelector(".cont-radar")||h.getIcon(),h.clearIntvHours(),h.ui.finalizar_viaje.setValue("1"),nw.refreshSessionApp(function(){},"noupdate"),h.activeFinalizado(w.array1),main.registerServiceInFirebase(w.id)})}w.empresa=i.empresa,w.usuario=i.usuario,w.nombre_usuario=i.nombre,w.id_usuario=i.id_usuario,w.email=i.email,w.usuario_cliente=n.usuario_cliente,w.perfil=i.perfil,w.id=n.id,w.paradas_adicional_numero_total=n.paradas_adicional_numero_total,w.precio_viaje=parseFloat(l).toFixed(2),n.precio_viaje=w.precio_viaje,w.tiempo=r,w.total_metros_final=e,w.valor_final_distancia=parseFloat(c).toFixed(2),w.valor_final_tiempo=parseFloat(t).toFixed(2),w.latitudFinalizaServicio=nwgeo.latitude,w.longitudFinalizaServicio=nwgeo.longitude,w.descuento_aplicado=0,w.aplico_recargo=u,w.iva=f,w.iva_porcentaje=g,h.validateGpsActive()&&(w.comision_porcentaje=p,w.utilidad_conductor=parseFloat(v).toFixed(2),w.utilidad_interna=parseFloat(_).toFixed(2),w.porcentaje_proveedor=p,w.porcentaje_empresa=m,w.paradas_adicional_valor_total=n.paradas_adicional_valor_total,w.cobraMinima=d,w.formaCobroFinalAutomatico=s,w.valor_servicio_inicial=n.valor,w.tipo_pago=n.tipo_pago,w.serv=n,nw.evalueData(h.filesEnd)&&(w.files=h.filesEnd),o={},$.each(w.serv,function(e,a){o[e]=a}),$.each(w,function(e,a){o[e]=a}),w.array1=o,console.log("dataSend.array1",w.array1),console.log("DATA:::finalizarServicio:::dataSend",w),console.log("DATA:::finalizarServicio:::serv",n),console.log("serv",n),console.log("serv.tipo_pago",n.tipo_pago),console.log("serv.id_tarjeta_credito",n.id_tarjeta_credito),console.log("self.configCliente.tipo_pago",h.configCliente.tipo_pago),"CREDITO"!=h.configCliente.tipo_pago||nw.utils.evalueData(n.id_tarjeta_credito)||((a=new f_z100_finalizarViaje_paga_tarjeta_credito).construct(h,w,function(){b()}),a.cobroCardEnd({status:"Rechazada",respuesta:"El usuario no configuró una tarjeta de crédito."},n)),"tarjeta_credito"===n.tipo_pago&&!0===nw.evalueData(n.id_tarjeta_credito)?(a=new f_z100_finalizarViaje_paga_tarjeta_credito).construct(h,w,function(){b()}):"CARGA"==h.configCliente.app_para?h.firmaConfirma(function(e){w.firma_recibido=e.firma_recibido,b()}):(w.firma_recibido="",b()))})})}console.log("START_LAUNCH:::::::::::::: f_z100_finalizarViaje"),"SI"==main.configCliente.foto_para_finalizar_servicio||"Wompi"==h.data_service.tipo_pago?(h.usaRotulos="NO",h.subirImagenes(function(e){console.log("files",e),h.filesEnd=e,nw.remove(".pruebauno_container"),a()},h),"Wompi"==h.data_service.tipo_pago&&nw.dialog("El pago es con Wompi, recuerda tomar foto del comprobante de pago")):(h.filesEnd=!1,a())},destruct:function(){},members:{}}),nw.Class.define("f_searchServiceSolicitud",{extend:nw.lists,construct:function(o,i){if(console.log("main.configCliente",main.configCliente),"SI"==main.configCliente.usa_firebase&&main.getServiceInFirebase(),"NO"==o.configCliente.busca_servicios_conductor&&main.destroyRadar(),"NO"!=o.configCliente.busca_servicios_conductor&&"SI"!=main.configCliente.usa_firebase){console.log("START_LAUNCH:::::::::::::: f_searchServiceSolicitud");var e=nw.userPolicies.getUserData(),a=JSON.parse(e.servicios_activos),n={};if(n.id=e.id_usuario,n.usuario=e.usuario,n.tipo="ahora",n.empresa=e.empresa,n.configCliente=o.configCliente,"SI"===o.configCliente.usa_servicios){n.servicios_driver=a,n.servicios_driver_ids=[];for(var t=0;t<a.length;t++){var r=a[t];n.servicios_driver_ids.push(r.id)}}if(void 0!==config.tomarServiciosReservadosAutomatic&&(n.tomarServiciosReservadosAutomatic=config.tomarServiciosReservadosAutomatic),void 0!==o.configCliente.tomarServiciosReservadosAutomatic&&nw.evalueData(o.configCliente.tomarServiciosReservadosAutomatic)&&(n.tomarServiciosReservadosAutomatic=o.configCliente.tomarServiciosReservadosAutomatic),void 0!==o.configCliente.repetir_servicio_continiuamente&&"SI"==o.configCliente.repetir_servicio_continiuamente&&(n.repetir_servicio_continiuamente=!0),void 0!==o.configCliente.verServiciosReservados&&(n.verServiciosReservados=o.configCliente.verServiciosReservados),0<o.idServicesMostrados.length){console.log("self.idServicesMostrados",o.idServicesMostrados),n.id_rechazados="";for(t=0;t<o.idServicesMostrados.length;t++){var c=o.idServicesMostrados[t];console.log("rtrrrrrrrrrrrrrrrrrttttttttttttttttttttttttttttttttttttttttttttttttttttt",c),nw.evalueData(c.id)&&nw.evalueData(c.tipo_servicio)&&"reservado"!==c.tipo_servicio&&(n.id_rechazados+=c.id.toString(),t+1!=o.idServicesMostrados.length)&&(n.id_rechazados+=",")}}console.log("DATA_SEND:::f_searchServiceSolicitud::self.configCliente",o.configCliente),console.log("DATA_SEND:::f_searchServiceSolicitud::self.configCliente.minutos_de_vida_notificacion_conductores_viajes_ahora",o.configCliente.minutos_de_vida_notificacion_conductores_viajes_ahora),console.log("DATA_SEND:::f_searchServiceSolicitud",n);e=new nw.rpc(o.getRpcUrl(),"servicios_conductor");e.setAsync(!0),e.setLoading(!1);e.exec("consulta_new",n,function(e){console.log("RESPONSE_SERVER:::f_searchServiceSolicitud",e),nw.remove(".liBarEncNotify"),nw.evalueData(i)&&i(e);for(var a=0;a<e.length;a++)"CONDUCTOR_ASIGNADO"!=e[a].estado&&"CONDUCTOR_REASIGNADO"!=e[a].estado||(e[a].estado="SOLICITUD"),console.log("r[i]",e[a]),o.constructServiceSolicitud(e[a])})}},destruct:function(){},members:{}}),nw.Class.define("f_z101_finalizarViaje_guarda",{extend:nw.lists,construct:function(a,e){console.log("START_LAUNCH:::::::::::::: f_z101_finalizarViaje_valida");var o=e,e=(o.templateEmail=main.templateMailEnd(),new nw.rpc(nw.getRpcUrl(),"servicios_conductor")),i=(e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Actualizando saldos, viaje y liberando conductor..."}),function(e){if(nw.loadingRemove(),console.log("RESPONSE_SERVER:::finalizarServicio:::r",e),!0!==e)return nw.dialog(e),!1;void 0!==a.markerParada&&nwgeo.removeMarker(a.markerParada);e=document.querySelector(".list-paradas");e&&e.remove(),config.activesaveAllPosition=!1,config.id_servi_ubic=!1,a.reziseNormalMap(),nwgeo.removeAllPolyLines(),nw.sendNotificacion({title:"Tu viaje ha finalizado",body:"Tu viaje ha finalizado",icon:"fcm_push_icon",sound:"default",data:"nw.dialog('Viaje finalizado')",callback:"FCM_PLUGIN_ACTIVITY",to:o.serv.token_usuario}),document.querySelector(".cont-radar")||a.getIcon(),a.clearIntvHours(),a.ui.finalizar_viaje.setValue("1"),nw.refreshSessionApp(function(){}),a.activeFinalizado(o.array1)});e.exec("llegadaServicioDestiono",o,i)},destruct:function(){},members:{}}),nw.Class.define("f_activeChangeStatus",{extend:nw.lists,construct:function(o){console.log("1:::START_LAUNCH:::::::::::::: f_activeChangeStatus");$.each(this.members,function(e,a){o[e]=a})},destruct:function(){},members:{activeAbordo:function(){var o=this,e=o.data_service,a=("SI"==o.configCliente.paradas_adicional&&o.paradasAdicionales(),"CARGA"!=o.configCliente.app_para&&nw.evalueData(o.configCliente.permitir_tomar_servicios_ocupado)&&"SI"!=o.configCliente.permitir_tomar_servicios_ocupado&&o.clearIntervalo(),config.activesaveAllPosition=!0,config.id_servi_ubic=e.id,o.initIntervaloService(),1==o.cancela_conductor&&o.ui.cancelar_pedido.setVisibility(!1),o.ui.grupo_nueva_solicitud.setVisibility(!0),o.ui.rechazar_pedido_driver.setVisibility(!1),o.ui.aceptar_pedido_driver.setVisibility(!1),o.ui.tiempo_estimado.setVisibility(!1),o.ui.confirmar_llegada.setVisibility(!1),o.ui.confirmar_abordaje.setVisibility(!1),o.ui.precio_viaje.setVisibility(!1),o.ui.finalizar_viaje.setVisibility(!0),o.ui.precio_viaje.setVisibility(!1),o.ui.cobrar.setVisibility(!1),""),a=(a=nw.evalueData(e.bodega_text)?"<div class='infoServiceCompany'>"+nw.tr("Empresa")+": "+e.bodega_text+"</div>":a)+"<span class='infoDriverText'>"+nw.tr("Servicio en curso, al destino:")+"</span><br /> <span class='infoDriverDirec'>"+e.destino+"</span>",a=(nw.utils.evalueData(e.tipo_pago)&&(a+="<span class='infoDriverTextvisibles infoDrivertipo_pago'>"+nw.tr(e.tipo_pago)+"</span>"),a+="<span class='infoDriverEnServicioText' style='color: #000;display: block;'>"+nw.tr("Inicio del viaje...")+" <span class='infoDriverEnServicio'>0</span></span><br /> ",o.htmlDataCliente(a,!0)),i=(o.ui.html_grupo_nueva_solicitud.setValue(a),nwgeo.removeAllPolyLines(),o.serviceActive=!0,o.cleanMarkerTwo(),o.minutosDeServicio=0,"");function n(){var e=nw.getActualFullDate(),e=nw.utilsDate.calcularTiempoDosFechas(i,e),a=document.querySelector(".infoDriverEnServicio");a?(a.innerHTML=e.dateInFormat,o.minutosDeServicio=e.minutes):clearInterval(o.intervalTiempoEnServicio)}i=nw.utils.evalueData(e.fecha_inicio)?e.fecha_inicio:nw.utilsDate.getActualDate(),nw.utils.evalueData(e.hora_inicio)?i+=" "+e.hora_inicio:i+=" "+nw.utilsDate.getActualHour(),n(),o.intervalTiempoEnServicio=setInterval(function(){n()},5e3);a=new nwgeo.addMarker;a.map=o.map,a.latitude=e.latitudDes,a.longitude=e.longitudDes,a.title="",a.label="",a.icon=config.domain_rpc+"/lib_mobile/driver/img/marker_b.png",a.draggable=!1,o.marker2=a.show(),o.latitudDestino=e.latitudDes,o.longitudDestino=e.longitudDes,document.querySelector(".mapIframe")&&$(".mapIframe").remove(),o.framePosition(),o.useWaze(),o.useChat(),o.saverecorr("ABORDO_DESTINO_EN_CAMINO")},activeEnSitio:function(){var o=this,e=("EN_RUTA"==o.data_service.estado&&(o.data_service.estado="EN_SITIO"),o.data_service),a=(o.initIntervaloService(),o.ui.grupo_nueva_solicitud.setVisibility(!0),o.ui.rechazar_pedido_driver.setVisibility(!1),o.ui.aceptar_pedido_driver.setVisibility(!1),o.ui.tiempo_estimado.setVisibility(!1),o.ui.confirmar_llegada.setVisibility(!1),o.ui.confirmar_abordaje.setVisibility(!0),""),a=(nw.evalueData(e.bodega_text)&&(a="<div class='infoServiceCompany'>Empresa: "+e.bodega_text+"</div>"),console.log("rrrrrrrrrrrrrrrrrrrrrrr",e),a=(a=(a+="<span class='infoDriverText'>"+nw.tr("¡En sitio!")+"</span><br /> ")+("<span class='infoDriverWaitingText' style='color: #000;'>"+nw.tr("Llegaste...")+" <span class='infoDriverWaiting'>0</span></span><br /> "))+("<span class='infoDriverDirec'>"+e.origen+"</span>"),nw.utils.evalueData(e.tipo_pago)&&(a+="<span class='infoDriverTextvisibles infoDrivertipo_pago'>"+nw.tr(e.tipo_pago)+"</span>"),o.htmlDataCliente(a)),i=(o.ui.html_grupo_nueva_solicitud.setValue(a),nwgeo.removeAllPolyLines(),o.minutosDeEspera=0,console.log("rrrrrrrrrrrrrrrrrrrr",e),console.log("r.fecha_llegada",e.fecha_llegada),console.log("r.hora_llegada",e.hora_llegada),"");function n(){var e=nw.getActualFullDate(),e=nw.utilsDate.calcularTiempoDosFechas(i,e),a=document.querySelector(".infoDriverWaiting");a?(a.innerHTML=e.dateInFormat,o.minutosDeEspera=e.minutes):clearInterval(o.intervalTiempoEspera)}i=nw.utils.evalueData(e.fecha_llegada)?e.fecha_llegada:nw.utilsDate.getActualDate(),nw.utils.evalueData(e.hora_llegada)?i+=" "+e.hora_llegada:i+=" "+nw.utilsDate.getActualHour(),n(),o.intervalTiempoEspera=setInterval(function(){n()},5e3),o.cleanMarkerTwo();a=new nwgeo.addMarker;a.map=o.map,a.latitude=e.latitudOri,a.longitude=e.longitudOri,a.title=e.origen,a.label="",a.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",a.draggable=!1,o.marker2=a.show(),document.querySelector(".mapIframe")&&$(".mapIframe").remove(),"CARGA"!=o.configCliente.app_para&&nw.evalueData(o.configCliente.permitir_tomar_servicios_ocupado)&&"SI"!=o.configCliente.permitir_tomar_servicios_ocupado&&o.clearIntervalo(),o.framePosition(),$(".btn_waze").remove(),o.useChat(),"SI"==o.configCliente.informacion_primer_conductor&&o.useMoreInformation(),clearTimeout(o.recorridosave),o.saveRecorrido(!1,"LLEGA_SITIO_ORIGEN_ESPERA_ABORDAJE")},activeEnRuta:function(){var e=this,a=(e.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_activeEnRuta"),"SOLICITUD"==e.data_service.estado&&(e.data_service.estado="EN_RUTA"),e.data_service),o=(e.initIntervaloService(),1==e.cancela_conductor&&e.ui.cancelar_pedido.setVisibility(!0),e.ui.grupo_nueva_solicitud.setVisibility(!0),e.ui.rechazar_pedido_driver.setVisibility(!1),e.ui.aceptar_pedido_driver.setVisibility(!1),e.ui.tiempo_estimado.setVisibility(!1),e.ui.confirmar_llegada.setVisibility(!0),e.ui.confirmar_abordaje.setVisibility(!1),""),o=o=nw.evalueData(a.bodega_text)?"<div class='infoServiceCompany'>Empresa: "+a.bodega_text+"</div>":o,o=(o+="<span class='infoDriverText'>"+nw.tr("Dirígete al punto de encuentro")+"</span><br /> <span class='infoDriverDirec'>"+a.origen+"</span>",nw.utils.evalueData(a.tipo_pago)&&(o+="<span class='infoDriverTextvisibles infoDrivertipo_pago'>"+nw.tr(a.tipo_pago)+"</span>"),e.htmlDataCliente(o)),o=(e.ui.html_grupo_nueva_solicitud.setValue(o),e.cleanMarkerTwo(),"CARGA"!=e.configCliente.app_para&&nw.evalueData(e.configCliente.permitir_tomar_servicios_ocupado)&&"SI"!=e.configCliente.permitir_tomar_servicios_ocupado&&e.clearIntervalo(),new nwgeo.addMarker);o.map=e.map,o.latitude=a.latitudOri,o.longitude=a.longitudOri,o.title=a.origen,o.label="",o.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",o.draggable=!1,e.marker2=o.show(),e.latitudDestino=a.latitudOri,e.longitudDestino=a.longitudOri,document.querySelector(".mapIframe")&&$(".mapIframe").remove(),e.framePosition(),e.trazaLinea(),e.useWaze(),e.useChat(),"SI"==e.configCliente.informacion_primer_conductor&&e.useMoreInformation(),e.actEnRuta=!0,e.saverecorr("ACEPTA_SERVICIO_EN_CAMINO")},activeNormal:function(){var e=this;e.clearIntervaloInService(),e.ui.grupo_nueva_solicitud.setVisibility(!1),e.ui.rechazar_pedido_driver.setVisibility(!1),e.ui.aceptar_pedido_driver.setVisibility(!1),e.ui.tiempo_estimado.setVisibility(!1),e.ui.confirmar_llegada.setVisibility(!1),e.ui.confirmar_abordaje.setVisibility(!1),e.ui.finalizar_viaje.setVisibility(!1),e.ui.precio_viaje.setVisibility(!1),e.ui.cobrar.setVisibility(!1),e.ui.html_grupo_nueva_solicitud.setValue(""),e.zoom,e.initIntervalo()},activeFinalizado:function(e){var a=this,o=(console.log("finalizarServicio",e),a.data_service);a.clearIntervaloInService(),a.ui.grupo_nueva_solicitud.setVisibility(!0),a.ui.rechazar_pedido_driver.setVisibility(!1),a.ui.aceptar_pedido_driver.setVisibility(!1),a.ui.tiempo_estimado.setVisibility(!1),a.ui.confirmar_llegada.setVisibility(!1),a.ui.confirmar_abordaje.setVisibility(!1),a.ui.finalizar_viaje.setVisibility(!1),a.ui.precio_viaje.setVisibility(!1),a.ui.cobrar.setVisibility(!1),a.ui.html_grupo_nueva_solicitud.setValue(""),a.cleanMarkerTwo(),a.trazaLineaCreada=!1,a.LimpiarTodo(),main.resumenFinal(o,"driver",e)}}}),nw.Class.define("f_constructServiceSolicitud",{extend:nw.lists,construct:function(o,e){var a,i,n,t,r,c=nw.userPolicies.getUserData(),s=(o.debug&&(console.log("constructServiceSolicitud",e),console.log("constructServiceSolicitud estado",e.estado),console.log("constructServiceSolicitud conductor_id",e.conductor_id),console.log("UP id_usuario",c.id_usuario)),this);if(s.intervalOffer=null,(s.selfAll=o).numServicio=e,o.__subservicio=e.subservicio,console.log(e.id),console.log(e.tipo_servicio),"SI"===main.configCliente.driver_puede_ofertar_valor_servicio&&void 0===o.cancelaTodasOfertas&&(o.cancelaTodasOfertas=!0,(a={}).usuario=c.usuario,a.empresa=c.empresa,a.perfil=c.perfil,a.estado="OFERTADO",(l=new nw.rpc(nw.getRpcUrl(),"app_driver")).setAsync(!0),l.setLoading(!1),console.log("ofertarViaje:::cancelaTodasOfertas:::dataSend",a),l.exec("cancelaTodasOfertas",a,function(e){console.log("ofertarViaje:::cancelaTodasOfertas:::responseServer",e)})),console.log("START_LAUNCH:::::::::::::: f_constructServiceSolicitud",e),document.querySelector(".newServiceBar_"+e.id))return!1;if(document.querySelector(".grupo_nueva_solicitud")){var l=document.querySelector(".grupo_nueva_solicitud").style.display;if(console.log("display",l),"none"!=l)return $(".liBarEncNotify").remove(),!1}!1!==e&&(clearTimeout(o.timeContin),a=nwgeo.distance(parseFloat(e.latitudOri),parseFloat(e.longitudOri),o.positionConductor.lat,o.positionConductor.lng),console.log("nwgeo.distance",a),a=a.toFixed(0),a=parseFloat(a),console.log("self.configCliente.pedir_datos_viaje_airpot",o.configCliente.pedir_datos_viaje_airpot),console.log("r.num_maletas",e.num_maletas),console.log("self.vehiculo.num_maletas",o.vehiculo.num_maletas),console.log("r.num_personas",e.num_personas),console.log("self.vehiculo.capacidad_pasajeros",o.vehiculo.capacidad_pasajeros),l=parseFloat(o.configCliente.metros_para_aceptar_servicio),console.log("self.configCliente.metros_para_aceptar_servicio",o.configCliente.metros_para_aceptar_servicio),console.log("metros_para_aceptar_servicio",l),console.log("distanceDriverMetros",a),(a<=l||"reservado"===e.tipo_servicio&&e.conductor_id===c.id_usuario||e.conductor_id===c.id_usuario)&&(a=l=(l=a/1e3).toFixed(2),a=nwgeo.getTimeToDistanceAndSpeed(a,15),a=Math.round(a),i=59e3,nw.evalueData(o.configCliente.tiempo_notificacion_servicio)&&0<parseInt(o.configCliente.tiempo_notificacion_servicio)&&(i=60*parseInt(o.configCliente.tiempo_notificacion_servicio),i*=1e3),e.tipo_servicio,n=nw.utils.tr("Nuevo servicio")+" #"+e.id+" "+nw.utils.tr(e.tipo_servicio),t="Tomar viaje",void 0!==config.textBtnAcceptService&&(t=config.textBtnAcceptService),r="notify_ahora","reservado"===e.tipo_servicio&&(t="Confirmar",r="notify_reservado"),("reservado"===e.tipo_servicio&&e.conductor_id===c.id_usuario||e.conductor_id===c.id_usuario)&&(n=nw.tr("Te han asignado un servicio")+" #"+e.id+" "+nw.tr(e.tipo_servicio),i=9e5,t=nw.tr("Confirmar"),r="notify_reservado"),"ahora"===e.tipo_servicio&&e.conductor_id===c.id_usuario&&(i=3e5),c="<div class='containBodyNotydriver'>",c+="<div class='newservice_cont'>","SI"===o.configCliente.mostrar_valor_conductor&&nw.utils.evalueData(e.valor)&&(c+="<div><p>"+nw.tr("Tarifa")+"</p><span>$"+nw.addNumber(e.valor)+"</span></div>"),c=(c=(c+="<div><p>"+nw.tr("Distancia")+"</p><span>"+l+"km</span></div>")+"<div><p>"+nw.utils.tr("Tiempo")+"</p><span>"+a+"m</span></div></div>")+"<p class='newserv_desdehast newserv_desde'><span class='pointCircleDis pointCircleDis_a'>A</span> "+nw.tr("De:")+" "+e.origen+"</p>","SI"===o.configCliente.mostrar_direccion_destino&&(c+="<p class='newserv_desdehast newserv_destino'><span class='pointCircleDis pointCircleDis_b'>B</span>  "+nw.tr("Hasta:")+" "+e.destino+"</p>"),e.showminutesaprox=a,nw.evalueData(e.cliente_nombre)&&(c+="<span>"+e.cliente_nombre+" "+e.usuario+"</span>"),"SI"==o.configCliente.usa_subservicios&&nw.evalueData(e.subservicio_text)&&(c+="<span>"+nw.tr("Tipo servicio")+": "+e.subservicio_text+"</span>"),nw.evalueData(e.bodega_text)&&(c+="<br /><span>"+nw.tr("Empresa")+": "+e.bodega_text+"</span>"),nw.evalueData(e.descricion_carga)&&(c+="<br /><span>"+nw.tr("Descripción")+": "+e.descricion_carga+"</span>"),nw.evalueData(e.observaciones_servicio)&&(c+="<br /><span class='notas'>"+nw.tr("Notas")+": "+e.observaciones_servicio+"</span>"),nw.evalueData(e.numero_auxiliares)&&(c+="<br /><span class='notas'>"+nw.tr("Auxiliares")+": "+e.numero_auxiliares+"</span>"),nw.evalueData(e.paradas_adicionales_iniciales_creacion)&&(c+="<span>"+e.paradas_adicionales_iniciales_creacion+" "+nw.tr("paradas")+"</span><br />"),nw.evalueData(e.observacion_ultima_ubicacion)&&(c+="<br /><span class='notas'>"+nw.tr("Observación ubicación")+": "+e.observacion_ultima_ubicacion+"</span>"),c=(c=(c+="<br /><span>"+e.subcategoria_servicio_text+"</span>")+"<br /><span>"+e.fecha+" "+e.hora+"</span></div>")+"<div class='newservice_containbns'></div>",l=nw.createNotificacionBarInter({addClass:r+" newServiceBar_"+e.id,timeToRemove:i,title:n,body:c,icon:!1,data:e,callbackEndTime:function(){console.log("callbackEndTime"),main.deleteRecord(e.id),document.querySelector(".cont-radar")&&null!=typeof document.querySelector(".cont-radar")||o.getIcon(),o.cleanMarkerNotify()},callbackEnd:function(){o.cleanMarkerNotify()},createbtn:!0,callback:function(){o.cleanMarkerNotify()}}),console.log("tttttttttttttt",l),(a=document.createElement("div")).className="newservice_containbns_unit containbuttonacceptservice",a.innerHTML="<button>"+nw.utils.tr(t)+"</button>",a.data=e,a.parent_widget=l,a.onclick=function(){var e=this.data,a=this.parent_widget;s.aceptaViaje(e,a,function(e){console.log("res",e)})},l.querySelector(".newservice_containbns").appendChild(a),"SI"===main.configCliente.driver_puede_ofertar_valor_servicio&&((a=document.createElement("div")).className="newservice_containbns_unit containbuttonofertarservices",a.innerHTML="<button>"+nw.utils.tr("Ofertar")+"</button>",a.data=e,a.parent_widget=l,a.onclick=function(){if(!s.validateSaldo())return!1;var e=this.data,a=this.parent_widget;console.log("OFERTAR_SERVICE:::r",e),console.log("OFERTAR_SERVICE:::t",a),s.ofertar(e,a)},l.querySelector(".newservice_containbns").appendChild(a)),"SI"===main.configCliente.usa_informe_paradas&&((a=document.createElement("div")).className="newservice_containbns_unit containbuttonparadasservices",a.innerHTML="<button>"+nw.utils.tr("Paradas")+"</button>",a.data=e,a.parent_widget=l,a.onclick=function(){main.editaParadasAdicionales(e)},l.querySelector(".newservice_containbns").appendChild(a)),!1===config.usaRechazarServicios&&"NO"===main.configCliente.driver_puede_rechazar_servicios||((a=document.createElement("div")).className="newservice_containbns_unit containbuttoncancelservices",a.innerHTML="<button>"+nw.utils.tr("Rechazar")+"</button>",a.data=e,a.parent_widget=l,a.onclick=function(){var e=this.data,a=this.parent_widget;console.log("RECHAZA_SERVICE:::",e.id),o.cleanMarkerNotify(),o.stopSound(),o.addRechazadoServiceMostrado(e),e.bloqueo_no_aceptacion_servicios="NO",nw.evalueData(o.configCliente.bloqueo_no_aceptacion_servicios)&&0<parseInt(o.configCliente.bloqueo_no_aceptacion_servicios)&&(o.ui_servi[e.id]=!0,e.bloqueo_no_aceptacion_servicios="SI"),o.updateRechazados(e,function(){main.initBloqueoApp()}),document.querySelector(".cont-radar")&&null!=typeof document.querySelector(".cont-radar")||o.getIcon(),a.remove()},l.querySelector(".newservice_containbns").appendChild(a)),nw.playSound("SD_ALERT_44.mp3",{className:"sound_nuevo_viaje"}),nw.openAppToFront(),nw.turnScreenOn(),nw.turnScreenOnAndUnlocked(),"undefined"!=typeof navigator)&&(void 0!==navigator.vibrate&&navigator.vibrate([1e3,1e3,3e3,1e3,5e3]),void 0!==navigator.notification)&&void 0!==navigator.notification.beep&&navigator.notification.beep(5),o.timeContin=null)},destruct:function(){},members:{validateSaldo:function(){var e=nw.userPolicies.getUserData(),a=this.selfAll;return!(void 0!==a.configCliente.saldo_minimo_para_tomar_servicios_conductor&&0!=parseFloat(a.configCliente.saldo_minimo_para_tomar_servicios_conductor)&&(console.log("parseFloat(up.saldo)",parseFloat(e.saldo)),console.log("parseFloat(self.configCliente.saldo_minimo_para_tomar_servicios_conductor)",parseFloat(a.configCliente.saldo_minimo_para_tomar_servicios_conductor)),parseFloat(e.saldo)<parseFloat(a.configCliente.saldo_minimo_para_tomar_servicios_conductor))&&(nw.dialog(nw.tr("El valor mínimo para tomar servicios es de")+" "+a.configCliente.saldo_minimo_para_tomar_servicios_conductor+", "+nw.tr("Recarga saldo y sigue disfrutando de nuestros servicios.")),1))},aceptaViaje:function(e,a,o){var i=this.selfAll,n=nw.userPolicies.getUserData();if(console.log("CLICK_ACCEPT_SERVICE::::::r",e),console.log("CLICK_ACCEPT_SERVICE::::::widget",a),console.log("CLICK_ACCEPT_SERVICE::::::up.saldo",n.saldo),console.log("CLICK_ACCEPT_SERVICE::::::self.configCliente.saldo_minimo_para_tomar_servicios_conductor",i.configCliente.saldo_minimo_para_tomar_servicios_conductor),!this.validateSaldo())return!1;i.ui.finalizar_viaje.setVisibility(!1),i.cleanMarkerNotify(),i.stopSound(),i.saveAcceptService(e),a.remove(),nw.evalueData(o)&&o(!0)},confirmaValor:function(e,a){nw.userPolicies.getUserData();var o={setTitle:"Confirmar valor",id:"taskConfirmaTime",html:"<div class='titleconfirmatime'>Confirmar valor</div>",changeHash:!0,showBack:!0,closeBack:!1,destroyAutomaticOnAccept:!1},i=(nw.isMobile()&&(o.role="page",o.transition="slide"),o.fields=[],o.fields.push({label:"Confirma tu oferta",name:"valorfijargrupo",type:"startGroup"},{name:"moneda",label:"",type:"label"},{name:"valor_fijado",label:"Confirma el valor del servicio",placeholder:"Confirma el valor del servicio",type:"numeric",required:!0},{type:"endGroup"}),nw.dialog("<div id='valorfijo' class='valorfijo'></div>",function(){var e=i.getRecord();return console.log("data",e),!!i.validate()&&(nw.remove(".container_valorfijo"),a(e))},function(){return nw.remove(".container_valorfijo"),!0},{addClass:"container_valorfijo",original:!0,destroyAutomaticOnAccept:!1,iconAccept:"<i class='material-icons' style='top: 5px;position: relative;'>check_circle</i>",iconCancel:"<i class='material-icons' style='top: 5px;position: relative;'>cancel</i>"}),o.showButtons=!1,o.createInHome=!0,o.canvas="#valorfijo",o.id="valorfijo_list",o.id_form="valorfijo_list_int",nw.dialog2("",!1,!1,o));i.ui.valor_fijado.setValue(e.valor),i.ui.valor_fijado.focus(),i.ui.moneda.setValue(config.moneda),$(".valor_fijado").focus()},ofertar:function(r,c){var s=this,l=s.selfAll,d=nw.userPolicies.getUserData();s.confirmaValor(r,function(a){console.log("pr",a),console.log("up",d);var e="",o="",i=(console.log("up.datosVehiculos",d.datosVehiculos),nw.evalueData(d.datosVehiculos)&&(n=JSON.parse(d.datosVehiculos),console.log("datosVeh",n),o=n.marca_text,o+=" "+n.modelo,nw.evalueData(n.imagen_vehi))&&(e=n.imagen_vehi),console.log("up.placa_activa",d.placa_activa),console.log("conductor_marca_carro",o),{}),n=(i.conductor_nombre=d.nombre+" "+d.apellido,i.conductor_foto=d.foto_perfil,i.conductor_marca_carro=o,i.conductor_foto_carro=e,i.placa_activa=d.placa_activa,i.usuario=d.usuario,i.empresa=d.empresa,i.perfil=d.perfil,i.id_servicio=r.id,i.usuario_pasajero=r.usuario,i.oferta=a.valor_fijado,i.estado="OFERTADO",i.token=null,nw.evalueData(window.localStorage.getItem("token"))&&(i.token=window.localStorage.getItem("token")),new nw.rpc(nw.getRpcUrl(),"app_driver"));n.setAsync(!0),n.setLoading(!1),nw.loading({text:"Estamos enviando su oferta por $"+a.valor_fijado+config.moneda+" en el servicio #"+i.id_servicio+", por favor espere",title:"Enviado su oferta, por favor espere..."}),console.log("ofertarViaje:::dataSend",i);n.exec("ofertarViaje",i,function(t){console.log("ofertarViaje:::responseServer",t),nw.loadingRemove(),l.cleanMarkerNotify(),l.stopSound(),main.saveOfertaServiceInFirebase(t,function(){var e;function n(e,a){if(console.log("validaAceptaResolve:::data",e),"VIAJE_NO_DISPONIBLE"==e)return nw.dialog("Servicio no disponible (3)"),nw.remove(".form_ofertando"),nw.remove(".newServiceBar_"+r.id),!1;if(e){if("ACEPTA_CLIENTE"==e.estado)return nw.remove(".form_ofertando"),nw.dialog("¡Oferta aceptada por el cliente!"),clearTimeout(s.intervalOffer),s.aceptaViaje(r,c,function(e){console.log("res",e)}),!1;if("RECHAZADO_POR_USUARIO"==e.estado)return nw.remove(".form_ofertando"),nw.dialog("¡Oferta RECHAZADA por el cliente!"),clearTimeout(s.intervalOffer),!1}void 0!==a&&a()}0==t?(nw.dialog("Servicio no disponible (1)"),nw.remove(".newServiceBar_"+r.id),nw.remove(".form_ofertando")):(nw.evalueData(r.token_usuario)&&(e="Nueva oferta para su servicio",nw.sendNotificacion({title:e,body:e,icon:"fcm_push_icon",sound:"default",data:"main.ofertaNotificaRecibe('nueva_oferta')",callback:"FCM_PLUGIN_ACTIVITY",to:r.token_usuario})),e="",e+="<div class='loadingCenterTextIcon'><div class='cEftVf cEftVf_wtext'></div><div class='textLoading'>"+nw.utils.tr("Enviando su oferta por")+" "+a.valor_fijado+" "+nw.utils.tr("en el servicio")+" #"+i.id_servicio+", "+nw.utils.tr("por favor espere")+"</div></div>",nw.dialog(e,function(){var e={},a=(e.usuario=d.usuario,e.empresa=d.empresa,e.perfil=d.perfil,e.id_servicio=r.id,e.id_oferta=t,e.estado="CANCELA_CONDUCTOR",e.token=null,nw.evalueData(window.localStorage.getItem("token"))&&(e.token=window.localStorage.getItem("token")),new nw.rpc(nw.getRpcUrl(),"app_driver"));a.setAsync(!0),a.setLoading(!1),nw.loading({text:"Cancelando oferta, por favor espere",title:"Cancelando oferta, por favor espere..."}),console.log("ofertarViaje:::rechazar:::dataSend",e);return a.exec("ofertarViaje",e,function(e){if(console.log("ofertarViaje:::rechazar:::responseServer",e),nw.loadingRemove(),nw.remove(".form_ofertando"),0==e)return nw.dialog("Servicio no disponible (2)"),nw.remove(".newServiceBar_"+r.id),nw.remove(".form_ofertando"),!1;nw.evalueData(r.token_usuario)&&(e="Oferta cancelada",nw.sendNotificacion({title:e,body:e,icon:"fcm_push_icon",sound:"default",data:"main.ofertaNotificaRecibe('cancela_oferta')",callback:"FCM_PLUGIN_ACTIVITY",to:r.token_usuario})),main.saveOfertaServiceInFirebase(t,function(){})}),!0},!1,{original:!0,textAccept:"Cancelar oferta",addClass:"form_ofertando"}),("SI"==main.configCliente.usa_firebase?function(){main.destroyQueryOfertas();var e={table:"servicios_ofertas"};e.where_array=[],e.where_array[0]={variable:"id",operator:"==",equal:t.toString()},e.getModelData=!1,e.destroyQuery=!1,e.callback=function(e,o,a){queryGetOffers=a,console.log("r",e),console.log("snapshot",o),console.log("snapshot.empty",o.empty),o.docChanges().forEach(function(e){var a=e.doc.data();console.log("snapshot.empty",o.empty),console.log("change.type",e.type),console.log("data",a),console.log("ofertarViaje:::validaAceptacion:::responseFirebase",a),"removed"==e.type||"modified"!=e.type&&"added"!=e.type||n(a)})},nw.firebase.select(e)}:function i(){s.intervalOffer=setTimeout(function(){var e={},a=(e.usuario=d.usuario,e.empresa=d.empresa,e.perfil=d.perfil,e.id_servicio=r.id,e.id_oferta=t,new nw.rpc(nw.getRpcUrl(),"app_driver")),o=(a.setAsync(!0),a.setLoading(!0),console.log("ofertarViaje:::validaAceptacion:::dataSend",e),function(e){console.log("ofertarViaje:::validaAceptacion:::responseServer",e),n(e,function(){i()})});a.exec("validaAceptacionViaje",e,o)},5e3)})())})})})}}}),nw.Class.define("f_validaServiceActive",{extend:nw.lists,construct:function(i,n,t,e){var a;function o(e){var a,o;if(nw.evalueData(t)&&t(e),!1===e&&nw.evalueData(i.configCliente.permitirReasignarConductor)&&"SI"==i.configCliente.permitirReasignarConductor&&1==i.serviceActive&&(i.serviceActive=!1,i.userCancelaService(!0)),void 0!==i.map)if("CANCELADO_POR_ADMIN"===e.estado||"SIN_ATENDER"===e.estado||"CANCELADO_POR_USUARIO"===e.estado)nw.dialog(nw.utils.tr("El servicio fue cancelado por motivo:")+" "+nw.utils.tr(nw.utils.replace("_"," ",e.estado))),i.clearIntervalo(),i.LimpiarTodo(),main.resumenFinal(e,"cliente");else if(1==i.cancela_conductor&&("ABORDO"===e.estado?(a=document.querySelector(".parent_btn_waze"))&&a.classList.remove("parent_btn_waze"):(a=document.querySelector(".parent_btn_waze"),o=document.querySelector(".btn_waze"),!a&&o&&o.classList.add("parent_btn_waze"))),i.data_service=e,!0===n){if(!1!==e){if("EN_RUTA"!==e.estado&&"ABORDO"!==e.estado&&"EN_SITIO"!==e.estado||i.configCliente.app_para,"CANCELADO_POR_ADMIN"===e.estado||"SIN_ATENDER"===e.estado||"CANCELADO_POR_USUARIO"===e.estado)return void i.userCancelaService();if("LLEGADA_DESTINO"===e.estado&&!nw.evalueData(e.calificacion))return i.clearIntervalo(),i.LimpiarTodo(),void main.resumenFinal(e,"cliente")}}else e.type="conductor",i.id_service=e.id,i.data_service=e,i.resolveStatus()}console.log("2:::START_LAUNCH:::::::::::::: f_validaServiceActive"),"SI"==main.configCliente.usa_firebase?(console.log("datafirebase",e),o(e)):(e=nw.userPolicies.getUserData(),(a={}).usuario=e.usuario,a.id_usuario=e.id_usuario,a.empresa=e.empresa,(e=new nw.rpc(i.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),console.log("f_validaServiceActive::::::::::::::DataSend",a),e.exec("servicioActivoConductor",a,function(e){console.log("f_validaServiceActive::::::::::::::RESPONSE_SERVER",e),o(e)}))},destruct:function(){},members:{}}),nw.Class.define("f_paradas_adicionales",{extend:nw.lists,construct:function(d){d.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_paradas_adicionales");var e=document.querySelector(".list-paradas"),e=(e&&e.remove(),nw.userPolicies.getUserData()),a=(console.log("up",e),{}),e=(a.id_service=d.id_service,a.empresa=e.empresa,nw.utils.evalueData(d.data_service)&&nw.utils.evalueData(d.data_service.observacion_ultima_ubicacion)&&(d.observacion_ultima_ubicacion=d.data_service.observacion_ultima_ubicacion),console.log("paradasAdicionales:::dataService.observacion_ultima_ubicacion",d.observacion_ultima_ubicacion),console.log("paradasAdicionales:::dataSendServer:::data",a),new nw.rpc(d.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1),nw.utils.validateElementIfExist(".nw_widget_div_finalizar_viaje",function(e){e&&(nw.addClass(e,"btn_finalizar_viaje_hidden"),d.validaExistMarker(function(e){e.setVisible(!1)})),nw.utils.validateElementIfExist(".btn_waze",function(e){e&&nw.addClass(e,"btn_waze_hidden")})});e.exec("paradasAdicionalesApp",a,function(e){console.log("paradasAdicionales:::responseServer:::data",e),void(d.totalParadas=0)!==d.markerParada&&nwgeo.removeMarker(d.markerParada);var a=!1,o=e?!1:!0;if(!0===(o=0==e.length?!0:o)&&nw.utils.validateElementIfExist(".nw_widget_div_finalizar_viaje",function(e){e&&(nw.removeClass(".nw_widget_div_finalizar_viaje","btn_finalizar_viaje_hidden"),setTimeout(function(){d.validaExistMarker(function(e){e.setVisible(!0),d.pintarLinea(!0)}),nw.utils.validateElementIfExist(".btn_waze",function(e){e&&nw.removeClass(".btn_waze","btn_waze_hidden")})},1e3))}),e&&0<e.length){nw.remove(".list-paradas"),d.totalParadas=e.length,d.countParada=e.length;var i="<li class='list-paradas-count'> <i class='material-icons'>golf_course</i>",o=(i=(i=(i+="<div class='paradas-view'>"+e.length+"</div>")+("<div class='paradas-view-title'> "+nw.tr("Paradas. Iniciar servicios")+".</div>"))+"</li>"+"<li class='list-paradas-close'> <i class='material-icons'>close</i></li>",d.parada_list=document.createElement("div"),d.parada_list.className="list-paradas",d.parada_list.innerHTML=i,document.querySelector("#foo"));if(!o)return!1;o.appendChild(d.parada_list),d.containtParadaItms=document.createElement("div"),d.containtParadaItms.className="containtParadaItms",d.parada_list.appendChild(d.containtParadaItms),d.containtShade=document.createElement("div"),d.containtShade.className="containtShade",d.containtShade.innerHTML=nw.tr("Seleccione un servicio a gestionar (puede ser parada, pasajero o mercancía)"),d.parada_list.appendChild(d.containtShade);for(var n=0;n<e.length;n++){var t=e[n];console.log("parada::::::::::::::",t),nw.utils.evalueData(t.estado_origendestino)||(nw.utils.evalueData(t.origen_manual_direccion)||nw.utils.evalueData(t.origen_manual_latitud)||nw.utils.evalueData(t.origen_manual_longitud)||nw.utils.evalueData(t.origen_manual_ciudad))&&(t.direccion=t.origen_manual_direccion,t.latitud_parada=t.origen_manual_latitud,t.longitud_parada=t.origen_manual_longitud,t.ciudad_parada=t.origen_manual_ciudad);var r="<p class='titleproxpar'><span>"+(n+1)+")</span>"+t.direccion+"</p>",i=(r+="<strong>"+nw.tr("Estado")+":</strong> "+nw.tr(t.estado)+"<br />","REPARTO"!==t.estado||a||(s(t,!1),a=!0),nw.evalueData(t.nombre_pasajero)&&(r+="<strong>"+nw.tr("Nombre")+":</strong> "+t.nombre_pasajero),nw.evalueData(t.telefono)&&(r+="<br /><strong>"+nw.tr("Teléfono")+":</strong> "+t.telefono),nw.evalueData(t.descripcion_carga)&&(r+="<br /><strong>"+nw.tr("Comentarios")+":</strong> "+t.descripcion_carga),""),r=(i+="<div class='namspard'>"+r+"</div>",document.createElement("div")),c=(r.className="list-paradas-item",r.innerHTML=i,r.data=t,d.containtParadaItms.appendChild(r),document.createElement("div"));c.className="ver_parada",c.innerHTML=nw.tr("Iniciar servicio"),c.data=t,c.onclick=function(){s(this.data)},r.appendChild(c)}$(document).on("touchstart",".list-paradas-close",function(){nw.removeClass(d.parada_list,"parada_list_show",!0),nw.removeClass(d.parada_list,"parada_list_open",!0),void 0!==d.markerParada&&nwgeo.removeMarker(d.markerParada),nw.remove(".vista_parada"),nwgeo.centerMap(d.map,d.marker1,d.marker2),d.cleanParadasPoly()}),$(document).on("touchstart",".list-paradas-count",function(){nw.addClass(d.parada_list,"parada_list_show")})}function s(e,a){if(console.log("openParada:::START"),console.log("openParada:::dataParada",e),console.log("openParada:::actualizar",a),nw.utils.evalueData(e.token_usuario)&&nw.sendNotificacion({title:"Tu conductor ha iniciado tu viaje",body:"Prepárate, el conductor se dirige a tu ubicación",icon:"fcm_push_icon",sound:"default",data:"nw.dialog('"+nw.utils.tr("El conductor ha iniciado tu viaje")+"')",callback:"FCM_PLUGIN_ACTIVITY",to:e.token_usuario}),!1===a)return l(e);console.log("openParada:::CONTINUE"),d.cambiaEstadoParada(e,"REPARTO",function(){return l(e)})}function l(e){console.log("self.parada_list",d.parada_list),nw.removeClass(d.parada_list,"parada_list_show",!0),nw.addClass(d.parada_list,"parada_list_open"),main.dataServiceOpenHistory=!1;var a=e,o=(console.log("data",a),console.log("self.data_service:::data_service",d.data_service),void 0!==d.markerParada&&nwgeo.removeMarker(d.markerParada),a.id),o=(console.log("id",o),a),a=(console.log("parada",o),nw.remove(".vista_parada"),"<div class='conDetPard'>"+nw.tr("Detalles de Entrega")+"</div>"),i=(a=(a+="<div class='contdatpardopen'>")+("<strong>"+nw.tr("Dirección:")+"</strong> "+o.direccion),nw.evalueData(o.nombre_pasajero)&&(a+="</br><strong>"+nw.tr("Nombre:")+" </strong> "+o.nombre_pasajero),nw.evalueData(o.descripcion_carga)&&(a+="</br><strong>"+nw.tr("Comentarios de viaje/parada/mercancía")+": </strong> "+o.descripcion_carga),nw.evalueData(d.observacion_ultima_ubicacion)&&(a+="</br><strong>"+nw.tr("Obsevaciones Ubicación")+": </strong> "+d.observacion_ultima_ubicacion),a=(a+="</div>")+"<div class='conDetPardBtns'><div class='conDetPardBtnsEnc'></div>"+"</div>",document.createElement("div")),a=(i.className="vista_parada",i.innerHTML=a,document.querySelector(".grupo_nueva_solicitud"));if(!a)return!1;a.appendChild(i);var n,a=document.createElement("div"),a=(a.className="btn_vistcancel btn_vistapara",a.innerHTML=nw.tr("Detener"),a.data=o,a.onclick=function(){main.dataServiceOpenHistory=!1,d.cambiaEstadoParada(e,"REPARTO_DETENIDO",function(){d.resetParadasAdicionales()})},i.querySelector(".conDetPardBtnsEnc").appendChild(a),document.createElement("div")),t=(a.className="confirmar_parada_gps btn_vistapara",a.innerHTML="GPS",a.data=o,a.onclick=function(){var e=this.data,a=(console.log("da",e),{});a.latitude=e.latitud_parada,a.longitude=e.longitud_parada,a.mode="waze,googleMaps",nw.launchNavigatorUbication(a)},i.querySelector(".conDetPardBtnsEnc").appendChild(a),"NO"===main.configCliente.telefono_pasajero_visible_para_conductor||!nw.evalueData(o.telefono)&&"SI"!=main.configCliente.telefono_pasajero_visible_para_conductor||(a=o.telefono,"SI"==main.configCliente.use_telefono_principal_en_paradas&&(a=d.data_service.celular),t="57",nw.evalueData(config.indicativo)&&(t=config.indicativo),(n=document.createElement("a")).className="confirmar_parada_gps btn_vistapara",n.innerHTML="<i class='material-icons'>call</i>",n.data=o,n.href="tel:+"+t+a,i.querySelector(".conDetPardBtnsEnc").appendChild(n)),document.createElement("div")),a=(t.className="confirmar_parada_gps btn_vistapara",t.innerHTML="<i class='material-icons'>chat</i>",t.data=o,t.onclick=function(){var e=this.data,a=(console.log("da",e),{});a.id="_parada_"+e.id,a.cliente_nombre="Chat pasajero",a.all_data=e,nw.evalueData(e.nombre_pasajero)&&(a.cliente_nombre=e.nombre_pasajero),"SI"==d.configCliente.use_chat_principal_en_paradas&&(a=d.data_service),(new f_chat).construct(a),main.dataServiceOpenHistory=e},i.querySelector(".conDetPardBtnsEnc").appendChild(t),document.createElement("div")),t=(a.className="confirmar_parada_novedad btn_vistapara",a.innerHTML=nw.tr("Finalizar con novedad"),a.data=o,a.onclick=function(){var e=this.data;console.log("da",e),d.actualizaParadaNovedad(e)},i.querySelector(".conDetPardBtnsEnc").appendChild(a),"SI"==d.configCliente.informacion_primer_conductor&&((n=document.createElement("div")).className="ampliar_detalle btn_vistapara",n.innerHTML=nw.tr("Ampliar"),n.data=o,n.onclick=function(){this.data;console.log("da",d.data_service),main.ampliar(d.data_service)},i.querySelector(".conDetPardBtnsEnc").appendChild(n)),document.createElement("div"));t.className="confirmar_parada btn_vistapara",t.innerHTML=nw.tr("Finalizar servicio"),t.data=o,t.onclick=function(){var e=this.data;console.log("self.configCliente",d.configCliente),console.log("self.configCliente.parada_registro_foto",d.configCliente.parada_registro_foto),"SI"===d.configCliente.parada_registro_foto?d.actualizaParadaFoto(e):d.actualizaParada(e)},i.querySelector(".conDetPardBtns").appendChild(t),nw.evalueData(o.latitud_parada)&&nw.evalueData(o.longitud_parada)&&d.markerParadas(o)}d.createParadas=!0})},destruct:function(){},members:{}}),nw.Class.define("f_saveAcceptService",{extend:nw.lists,construct:function(i,n){if((i.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_saveAcceptService"),console.log("START:::saveAcceptService:::ra",n),"SI"===i.configCliente.pide_vehiculo_conductores)&&!nw.evalueData(i.vehiculo.id))return e={textAccept:"Ir a mis vehículos"},nw.dialog("Para continuar, debe activar un vehículo.",function(){main.misVehiculos()},!1,e),!1;"CARGA"!=i.configCliente.app_para&&nw.evalueData(i.configCliente.permitir_tomar_servicios_ocupado)&&"SI"!=i.configCliente.permitir_tomar_servicios_ocupado&&i.clearIntervalo(),i.data_service=n,i.id_service=n.id;var t=nw.userPolicies.getUserData(),r={},e=(r.id=i.id_service,r.conductor_usuario=t.usuario,r.id_usuario=t.id_usuario,r.nombre=t.nombre,r.apellido=t.apellido,r.empresa=t.empresa,!nw.utils.evalueData(n.vehiculo)&&nw.utils.evalueData(i.vehiculo.id)&&(r.vehiculo=i.vehiculo.id),!nw.utils.evalueData(n.vehiculo_text)&&nw.utils.evalueData(i.vehiculo.marca_text)&&(r.vehiculo_text=i.vehiculo.marca_text),!nw.utils.evalueData(n.placa)&&nw.utils.evalueData(i.vehiculo.placa)&&(r.placa=i.vehiculo.placa),!nw.utils.evalueData(n.color)&&nw.utils.evalueData(i.vehiculo.color)&&(r.color=i.vehiculo.color),r.foto=t.foto_perfil,r.celular=t.celular,r.domain_rpc=config.domain_rpc,""!=t.bodega&&"null"!=t.bodega&&null!==t.bodega&&(r.bodega=t.bodega),null);nw.evalueData(window.localStorage.getItem("token"))&&(e=window.localStorage.getItem("token")),i.positionConductor;if(r.latitudAceptaService=nwgeo.latitude,r.longitudAceptaService=nwgeo.longitude,!i.validateGpsActive())return!1;r.token_conductor=e,r.empresa=t.empresa,r.usuario=t.usuario,r.estado="EN_RUTA",r.estado_inicial=n.estado,"reservado"===n.tipo_servicio&&"SOLICITUD"===n.estado&&(r.estado="ACEPTADO_RESERVA"),!0===config.usaFechaVencimientoSaldo&&(r.usaFechaVencimientoSaldo="SI"),r.tiempo_estimado=i.time,r.pathDriverToOrigin=i.pathDriverToOrigin,r.dataService=i.dataByBooking("EN_RUTA"),console.log("saveAcceptService:::sendDataServer",r);e=new nw.rpc(i.getRpcUrl(),"servicios_conductor");e.setAsync(!0);e.exec("acceptSolit",r,function(e){if(console.log("saveAcceptService:::responseServer",e),i.clearIntervalo(),!1===e)return i.activeNormal(),i.initIntervalo(),nwgeo.removeAllPolyLines(),nw.dialog("El servicio no está disponible"),!1;if(!0!==e)return i.activeNormal(),i.initIntervalo(),nwgeo.removeAllPolyLines(),nw.dialog(e),!1;void 0!==n.showminutesaprox&&nw.evalueData(n.showminutesaprox)||(n.showminutesaprox=nw.utils.tr("calculando")+"...");var e=nw.utils.tr("Tu conductor")+" "+t.nombre+" "+nw.utils.tr("está en camino, llegará en")+" "+n.showminutesaprox+" "+nw.utils.tr("minutos"),a=("reservado"===n.tipo_servicio&&"ACEPTADO_RESERVA"===r.estado&&(e=nw.utils.tr("Servicio aceptado por el conductor")+" "+t.nombre+", "+nw.utils.tr("revisa tu agenda")),r.token_conductor),o="main.serviceToken('"+a+"', '"+nw.utils.tr("Servicio aceptado por el conductor")+" "+t.nombre+"')";if(nw.sendNotificacion({title:nw.utils.tr("Viaje aceptado por")+" "+t.nombre,body:e,icon:"fcm_push_icon",sound:"default",data:o,callback:"FCM_PLUGIN_ACTIVITY",to:n.token_usuario}),main.registerServiceInFirebase(r.id),"ACEPTADO_RESERVA"===r.estado)return nw.dialog("Aceptaste el servicio. Revisa tu agenda para iniciar la ruta de este servicio"),i.activeNormal(),i.initIntervalo(),nwgeo.removeAllPolyLines(),document.querySelector(".cont-radar")||i.getIcon(),!0;$(".liBarEncNotify").remove();e=new Date;i.hora_inicio_viaje=e.getHours()+":"+e.getMinutes(),i.framePosition(r,a),i.activeEnRuta()})},destruct:function(){},members:{}}),nw.Class.define("f_ponerOnOffline",{extend:nw.lists,construct:function(o,a,e){o.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_ponerOnOffline");var i="desconectado",n=nw.userPolicies.getUserData();if("online"===a?(i="conectado",document.querySelector(".cont-radar")||o.getIcon(),nw.activateBackgroundMode()):(nw.inactivateBackgroundMode(),o.stopSound()),!1===e)return t(a),!0;nw.loading({text:"Por favor espere...",title:"Validando estado"});e={},e.usuario=n.usuario,e.empresa=n.empresa,e.mode=a,e.estado_conexion=i,n=new nw.rpc(o.getRpcUrl(),"servicios_conductor");n.setAsync(!0),n.setLoading(!1);function t(e){var a;o.debugConstruct&&console.log("CHANGE_STATUS_OFFLINE_ONLINE:::::::::::::: f_ponerOnOffline::resolveModeOffOn",e),"online"===e?(o.ui.ofline.setVisibility(!0),o.ui.ofline.setVisibility(!1),o.idServicesMostrados.pop(),o.status="activo",window.localStorage.setItem("status_driver_online_offline","activo"),o.ui.mapa.setVisibility(!0),o.ui.status_driver.setVisibility(!0),o.ui.driver_online.setVisibility(!1),document.querySelector(".cont-radar")||o.getIcon(),nw.activateBackgroundMode()):(o.ui.mapa.setVisibility(!1),o.ui.status_driver.setVisibility(!1),o.ui.driver_online.setVisibility(!0),o.ui.ofline.setVisibility(!0),$(".notifyBarEnc").remove(),window.localStorage.setItem("status_driver_online_offline","inactivo"),o.status="inactivo",o.clearIntervalo(),e=document.querySelector(".ofline"),a=config.domain_rpc+"/lib_mobile/driver/img/carro-off.png",nw.evalueData(config.iconCarOffline)&&(a=config.iconCarOffline),e.innerHTML="<div class='div_ofline'><h3>Estas de manera desconectad@, cambia a conectad@ para recibir nuevos servicios</h3><img src='"+a+"'></div>",nw.inactivateBackgroundMode(),o.stopSound()),"SI"==o.configCliente.conductores_siempre_online&&(o.ui.status_driver.setVisibility(!1),o.ui.driver_online.setVisibility(!1)),$(".dataUserStatus").remove(),$(".dataUserNameMail").append("<span class='dataUser dataUserStatus'>"+nw.utils.tr(o.status)+"</span>")}n.exec("poner_onoffline",e,function(e){if(console.log("RESPONSE_SERVER:::::::::::::: f_ponerOnOffline",e),o.debugConstruct,nw.loadingRemove(),!0!==e)return!1;t(a),nw.loading({text:"Por favor espere...",title:"Actualizando"}),setTimeout(function(){window.location.reload()},2e3)})},destruct:function(){},members:{}}),nw.Class.define("f_z100_finalizarViaje_paga_tarjeta_credito",{extend:nw.lists,construct:function(e,a,o){console.log("START_LAUNCH:::::::::::::: f_z100_finalizarViaje_paga_tarjeta_credito",a);this.self=e,this.data=a,this.callback=o,this.cobrarConTarjeta()},destruct:function(){},members:{cobrarConTarjeta:function(){return"Conekta"===config.paymentStore?this.cobrarConTarjetaConekta():"epayco"===config.paymentStore?this.cobrarConTarjetaEpayco():"payu"===config.paymentStore?this.cobrarConTarjetaPayu():"Stripe"===config.paymentStore?this.cobrarConTarjetaStripe():(nw.dialog("No existe configuración de proveedor de pagos con tarjeta de crédito, consulte con el administrador del sistema."),!1)},cobrarConTarjetaEpayco:function(){var a=this,o=a.data,e=(console.log("data",o),o.app_name=config.name,o.id_relational_pay=o.serv.id,o.id_tarjeta_credito=o.serv.id_tarjeta_credito,void 0!==config.apiKeyEpayco&&""!=config.apiKeyEpayco&&(o.apiKeyEpayco=config.apiKeyEpayco),void 0!==config.privateKeyEpayco&&""!=config.privateKeyEpayco&&(o.privateKeyEpayco=config.privateKeyEpayco),o.test="NO",nw.utils.evalueData(main.configCliente.pagosPruebas)&&(o.test=main.configCliente.pagosPruebas),console.log("cobrarConTarjetaEpayco::data",o),new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Pagando con tarjeta..."});e.exec("makePagoCreditEpayco",o,function(e){nw.loadingRemove(),console.log("cobrarConTarjeta",e),a.cobroCardEnd(e,o)})},cobrarConTarjetaPayu:function(i,e){var n=this,a=(i.app_name=config.name,i.id_relational_pay=i.id,console.log("cobrarConTarjetaPayu::data",i),new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0),a.setLoading(!0);a.exec("makePagoCreditPayu",i,function(e){var a,o;console.log("cobrarConTarjetaPayu:::response",e),"pago_en_ceros_aprobada"===e?n.finalizarServicio(i):(a=nw.validateNwPayments(e.result),console.log("rta",a),a.status="OK",o="",o=(o+=a.status_description+". <br />")+a.responseCode+" <br />",nw.evalueData(a.responseMessage)&&(o+=a.responseMessage+". <br />"),a.approved&&e.APPROVED?a.ref_payco=a.orderId:a.status="Rechazada",a.respuesta=o,n.cobroCardEnd(a,i))})},cobrarConTarjetaStripe:function(){var a=this,o=a.data,e=(console.log("data",o),o.app_name=config.name,o.id_relational_pay=o.serv.id,o.id_tarjeta_credito=o.serv.id_tarjeta_credito,o.cobro=!0,o.description="Pago viaje en "+config.name,o.test="SI",nw.utils.evalueData(main.configCliente.pagosPruebas)&&(o.test=main.configCliente.pagosPruebas),console.log("cobrarConTarjetaStripe::data",o),new nw.rpc(nw.getRpcUrl(),"stripeApi"));e.setAsync(!0),e.setLoading(!1),nw.loading({text:"Por favor espere...",title:"Pagando con tarjeta..."});e.exec("saveApiStripe",o,function(e){nw.loadingRemove(),console.log("cobrarConTarjeta",e),a.cobroCardEnd(e,o)})},cobrarConTarjetaConekta:function(a){var o=this,e=(a.ruta="/app/pagos/",a.itemName="Pago de viaje ID "+a.id,a.itemDescription="Pago de viaje ID "+a.id+" dir_origen: "+a.dir_origen+" dir_destino: "+a.dir_destino,a.item_unit_price=a.precio_viaje.toString().replace(".",""),a.itemQuantity=1,a.street1="Calle 123, int 2",a.postal_code="06100",a.country="MX",a.currency="MXN",a.more_info="",a.reference="123456789",console.log("START:::cobrarConTarjetaConekta:::DATA",a),new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!0);e.exec("makePagoCreditConekta",a,function(e){console.log("RESPONSE_SERVER_CONEKTA:::cobrarConTarjetaConekta:::r",e),o.cobroCardEnd(e,a)})},cobroCardEnd:function(e,a){console.log("cobroCardEnd::: r ::: data",e,a);function o(){return!0}function i(){return t.cambiarFormaPago(a.id,"efectivo"),!0}var n,t=this.self,r={cleanHtml:!1,textCancel:"Cambiar a efectivo",textAccept:"Volver"};"Rechazada"===e.status?(n="",nw.evalueData(e.estado)&&(n+=e.estado+". "),nw.evalueData(e.respuesta)&&(n+=e.respuesta+". "),nw.evalueData(e.ref_payco)&&(n+=". Ref: "+e.ref_payco),nw.dialog(n,o,i,r)):"OK"===e.status?this.callback(a):nw.dialog(e,o,i,r)}}}),nw.Class.define("f_0_createMapa",{extend:nw.lists,construct:function(a,o){a.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_0_createMapa");var e=4.6615942,i=-74.0525647,n=(nw.evalueData(window.localStorage.getItem("nwgeo_latitude"))&&(e=window.localStorage.getItem("nwgeo_latitude")),nw.evalueData(window.localStorage.getItem("nwgeo_longitude"))&&(i=window.localStorage.getItem("nwgeo_longitude")),new nwgeo.getMap);n.canvas=document.querySelector(".mapa"),n.zoom=a.zoom,n.latitude=e,n.longitude=i,n.animate=!0,n.tilt=0,n.bearing=0,n.show(function(e){console.log("MAP_CREATE:::::::::::::: f_0_createMapa"),a.map=e,o()}),$(".containMapAndOpened").remove(),$(".container-grid-all").remove()},destruct:function(){},members:{}}),nw.Class.define("f_resolveStatus",{extend:nw.lists,construct:function(e){console.log("3:::START_LAUNCH:::::::::::::: f_resolveStatus");var a=nw.userPolicies.getUserData(),o=e.data_service;console.log("resolveStatus",o),console.log("resolveStatus estado",o.estado),console.log("resolveStatus conductor_id",o.conductor_id),console.log("UP id_usuario",a.id_usuario),e.resolveReziseMap(),!1===e.loadedFirst&&!1===o&&e.initIntervalo(),void 0!==o.id&&(e.searchServiceMostrado(o.id)||a.id_usuario===o.conductor_id||"SOLICITUD"!==o.estado?"EN_RUTA"===o.estado?e.activeEnRuta(o):"EN_SITIO"===o.estado?e.activeEnSitio(o):"ABORDO"===o.estado?e.activeAbordo(o):"LLEGADA_DESTINO"!==o.estado||nw.evalueData(o.calificacion)?(e.activeNormal(),"activo"!==e.status?e.ponerOnOffline("offline"):e.ponerOnOffline("online")):(e.clearIntervalo(),e.LimpiarTodo(),main.resumenFinal(o,"cliente")):e.constructServiceSolicitud(),e.loadedFirst=!0)},destruct:function(){},members:{}}),nw.Class.define("f_ver_viaje_mapstatic",{extend:nw.forms,construct:function(e){var a=this;a.id="f_ver_viaje_mapstatic",a.closeBack=!1,(a.showBack=!0)===main.previsualiza&&(a.showBack=!1,a.changeHash=!1,a.transition="pop"),a.createBase(),a.datos=e;a.setFields([{styleContainer:"margin:0;",style:"height:400px;margin:0;",label:"",name:"mapa",type:"startGroup"},{type:"endGroup"},{visible:!0,label:"",name:"observaciones_html",type:"html"}]),a.buttons=[]},destruct:function(){},members:{createMapa:function(e){nw.remove(".mapEmbedNw");var a=document.querySelector(this.canvas+" .mapa"),e={origen_latitud:e.latitude,origen_longitud:e.longitude,destino_latitud:e.latitudDes,destino_longitud:e.longitudDes,direccion_origen:e.direccion_origen,direccion_destino:e.direccion_destino};new nwgeo.getMapEmbed(a,e)}}}),nw.Class.define("f_soporte",{extend:nw.forms,construct:function(e){var a=this,o=(a.id="f_soporte",a.showBack=!1,a.closeBack=!0,a.closeBackCallBack=function(){nw.loadHome()},a.transition="slide",a.setTitle="",a.createBase(),a.setFields([{name:"frame_chat_form",label:"Cargando...",type:"html",visible:!0}]),nw.getPermission(["android.permission.READ_PHONE_STATE","android.permission.READ_EXTERNAL_STORAGE","android.permission.RECORD_VIDEO","android.permission.WRITE_EXTERNAL_STORAGE","android.permission.ACCESS_WIFI_STATE","android.permission.ACCESS_NETWORK_STATE","android.permission.RECORD_AUDIO","android.permission.MODIFY_AUDIO_SETTINGS","android.permission.FLASHLIGHT","android.permission.RECORD_AUDIO","android.permission.CAMERA","android.permission.MICROPHONE"],function(){console.log("Permisos concedidos")}),a.show(),"3095"),i="1510848061182",n=(nw.evalueData(config.ringowID)&&(o=config.ringowID),nw.evalueData(config.ringowApyKey)&&(i=config.ringowApyKey),nw.userPolicies.getUserData(),document.querySelector(".framechat_conversation"));n||((n=document.createElement("iframe")).className="framechat_conversation",n.id="framechat_conversation",n.src="https://app.ringow.com/ringowEmbed/"+o+"/"+i+"?onlyChat=true&callingChat=true",n.allow="geolocation; microphone; camera",n.onload=function(){},a.ui.frame_chat_form.setValue(n))},destruct:function(){},members:{}}),nw.Class.define("f_agregar_imagenes",{extend:nw.lists,construct:function(i,e){var n=this,a=(void 0!==e&&nw.utils.evalueData(e)||(e={}),n.opts=e,nw.utils.evalueData(e.usaRotulos)&&"NO"==e.usaRotulos&&(main.configCliente.usa_rotulos_en_paradas="NO"),nw.userPolicies.getUserData()),o={setTitle:"Confirmar registro fotográfico",id:"taskConfirmaTime",html:"<div class='titleconfirmatime'>Confirmar registro fotográfico</div>",changeHash:!0,showBack:!0,closeBack:!1,destroyAutomaticOnAccept:!1},t=(nw.isMobile()&&(o.role="page",o.transition="slide"),o.fields=[],o.fields.push({label:"",name:"fotoycomment",type:"startGroup"},{name:"registro_fotografico",label:"SUBIR FOTO",type:"button",mode:"camera_files",required:!1},{name:"comentarios",label:"",placeholder:"Comentarios",type:"textArea",required:!1},{type:"endGroup"},{name:"novedad",label:"",type:"selectBox"}),o.fields.push({label:"",name:"otros_documentos",type:"startGroup"},{type:"endGroup"}),nw.utils.evalueData(main.configCliente.usa_rotulos_en_paradas)&&"SI"==main.configCliente.usa_rotulos_en_paradas&&o.fields.push({label:"",name:"otros_rotulos",type:"startGroup"},{type:"endGroup"}),nw.dialog("<div id='pruebauno' class='pruebauno'></div>",function(){return r("normal")},function(){return nw.remove(".pruebauno_container_fotos"),!0},{addClass:"pruebauno_container_fotos",original:!0,destroyAutomaticOnAccept:!1,iconAccept:"<i class='material-icons' style='top: 5px;position: relative;'>check_circle</i>",iconCancel:"<i class='material-icons' style='top: 5px;position: relative;'>cancel</i>"}));function r(e){var a,o;return!!n.d.validate()&&(a=n.d.getRecord(),o={},nw.utils.evalueData(main.configCliente.usa_rotulos_en_paradas)&&"SI"==main.configCliente.usa_rotulos_en_paradas&&(o.rotulos=n.d.navTableRotulos.getAllData()),o.files=n.d.navTable.getAllData(),o.comentarios=a.comentarios,o.novedad=a.novedad,o.novedad_text=a.novedad_text,o.all_get_record=a,console.log("files",o),"normal"==e&&0==o.files.length?(nw.dialog("Seleccione por lo menos una imagen"),!1):(t.remove(),!nw.evalueData(i)||i(o)))}o.showButtons=!1,o.createInHome=!0,o.canvas="#pruebauno",o.id="pruebauno_list",o.id_form="pruebauno_list_int",n.d=nw.dialog2("",!1,!1,o),"SI"==main.configCliente.omitir_fotos_driver_en_servicio.toUpperCase()&&((o={colorBtnBackIOS:"#7f7f7f",style:"box-shadow: none;border: 0;background-color: transparent;color:#7f7f7f;"}).text=nw.tr("Continuar sin fotos"),o.className="btnpil_other ",o.type="button",o.icon="<i class='material-icons' style='top: 5px;position: relative;'>hourglass_empty</i>",o.position="center",o.callback=function(){return r("sin_fotos")},o=nw.createButton(o),$(t.querySelector(".popup_pil_btns")).prepend(o)),nw.utils.evalueData(main.configCliente.usa_rotulos_en_paradas)&&"SI"==main.configCliente.usa_rotulos_en_paradas&&(s=n.d.canvas+" .otros_rotulos",(c=new l_navtable_paradas_rotulos).construct(s,n.opts.data),n.d.navTableRotulos=c);var c,s=n.d.canvas+" .otros_documentos";return(c=new l_navtable_agregar_imagenes).construct(s),n.d.navTable=c,n.d.ui.registro_fotografico.addListener("change",function(e){var a,o=n.d.ui.registro_fotografico.getValue();console.log("self.d.ui.registro_fotografico:::data",o),nw.evalueData(o)&&((a={}).imagen=o,a.imagen_show=config.domain_rpc+o,n.d.navTable.addRow(a))}),console.log("opts",e),n.d.ui.novedad.setVisibility(!1),1==e.mostrarNovedades&&(n.d.ui.novedad.setVisibility(!0),n.d.ui.novedad.setRequired(!0),n.d.ui.novedad.populateSelectFromArray(o={"":"Seleccione la novedad"}),(o={}).terminal=a.terminal,o.empresa=a.empresa,o.usuario=a.usuario,console.log("data",o),console.log("up",a),n.d.ui.novedad.populateSelect("conductores","consultaTipologiaNovedadParada",o,function(e){n.d.ui.novedad.setValue("")},!0)),n},destruct:function(){},members:{test:function(){}}}),nw.Class.define("f_cancelar_servicio",{extend:nw.forms,construct:function(e,a){var o=this,e=(o.id="f_cancelar_servicio",o.showBack=!0,o.closeBack=!1,o.transition="slide",o.setTitle="Cancelar",o.html="<p style='text-align: center;'>"+nw.tr("Recuerde que si no cancela a tiempo se podra generear recargos.")+" </br></br> "+nw.tr("¿Está seguro de cancelar este servicio?")+"</p>",o.data_service=e,console.log(o.data_service),o.callback=null,nw.evalueData(a)&&(o.callback=a),o.createBase(),o.recargo="0",o.event=new Event("cancelServi"),o.setFields([{icon:"material-icons account_circle normal",name:"id",label:"ID",type:"textField",visible:!1},{icon:"material-icons account_circle normal",name:"cancelado_motivo",label:"Motivo",placeholder:"Motivo",type:"radio",required:!0},{icon:"material-icons account_circle normal",name:"cancelado_notas",label:"Observaciones",placeholder:"Observaciones",type:"textArea",required:!0}]),o.buttons=[{style:"",icon:"material-icons how_to_reg normal",colorBtnBackIOS:"#ffffff",position:"center",name:"aceptar",label:"Cancelar",callback:function(){if(!o.validate())return!1;o.cancelar()}}],o.show(),nw.userPolicies.getUserData()),a={};a.terminal=e.terminal,a.empresa=e.empresa,a.usuario=e.usuario,a.perfil=e.perfil,o.ui.cancelado_motivo.populateSelect("conductores","consultaTipologiaCancelacion",a,function(e){0==e.length&&o.ui.cancelado_motivo.populateSelectFromArray({cliente_pidio:"El cliente me lo ha pedido",cliente_no_llega:"El cliente no llega",no_alcanzo_a_llegar:"No alcanzo a llegar",se_encuentra_muy_lejos:"Se encuentra muy lejos",se_ha_varado_el_vehiculo:"Se ha varado el vehículo"})},!0),o.ui.id.setValue(o.data_service.id)},destruct:function(){},members:{cancelar:function(){var t=this,r=t.getRecord();if(console.log("data",r),!nw.evalueData(r.cancelado_motivo_text))return nw.dialog("Debe seleccionar un motivo de cancelación"),!1;function a(e,a){var o,i=t.data_service,n=nw.userPolicies.getUserData();r.usuario=n.usuario,r.empresa=n.empresa,r.perfil=n.perfil,r.nombre=n.nombre,r.apellido=n.apellido,r.nit=n.documento,r.domain_rpc=config.domain_rpc,r.estado="CANCELADO_POR_CONDUCTOR",nw.evalueData(config.cancelarliberaServicio)&&1==config.cancelarliberaServicio&&(r.libera_servicio="SOLICITUD"),config.cancelarliberaServicio&&!nw.evalueData(r.cancelado_motivo)?nw.dialog("Seleccione un motivo de cancelación"):((o="")!=n.nombre&&(o=n.nombre),nw.evalueData(r.cancelado_motivo)?r.cancelado_motivo=r.cancelado_motivo.replace(/_/g," "):r.cancelado_motivo="",void 0!==i&&(r.cancela="cancela_conductor",r.tiempo=i.hora,r.hora_llegada=i.hora_llegada,r.estado_service=i.estado),nw.evalueData(e)&&(r.files=e),r.texto_cancel_por_conductor=nw.utils.tr("Servicio cancelado por conductor:"),r.texto_cancel_por_cliente=nw.utils.tr("Servicio cancelado por cliente"),(n=new nw.rpc(nw.getRpcUrl(),"servicios")).setAsync(!0),n.exec("cancelarServicio",r,function(e){nw.evalueData(a)&&a(),"string"==typeof e&&(t.recargo=e),t.event.detail={recargo:t.recargo},document.dispatchEvent(t.event),nw.back(),nw.sendNotificacion({title:"Servicio cancelado",body:nw.tr("El conductor")+" "+o+" "+nw.utils.tr("ha cancelado el servicio por")+" "+nw.tr(r.cancelado_motivo),icon:"fcm_push_icon",sound:"default",callback:"FCM_PLUGIN_ACTIVITY",to:t.data_service.token_usuario}),nw.evalueData(t.callback)&&t.callback(),main.registerServiceInFirebase(r.id)}))}r.pide_fotos=r.cancelado_motivo,r.cancelado_motivo=r.cancelado_motivo_text,console.log("data",r),"SI"==r.pide_fotos?main.f_drive_mapa_servicios.subirImagenes(function(e){console.log("files",e),a(e,function(){nw.remove(".pruebauno_container")})}):a()}}}),nw.Class.define("f_tarjetas_credito",{extend:nw.forms,construct:function(e){var a=this,o=(a.id="f_tarjetas_credito",a.setTitle="<span style='color:#fff;'>Pagos</span>",a.html="",a.showBack=!0,a.closeBack=!1,a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e,nw.userPolicies.getUserData());a.setFields([{styleContainer:"width:100%;float:left;margin:0px;",name:"nombre_tarjeta",label:"Nombre como se ve en la tarjeta",visible_label:!1,placeholder:"Nombre como se ve en la tarjeta",type:"textField",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"documento",visible_label:!1,label:"Documento",placeholder:"Documento",type:"textField",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"email",visible_label:!1,label:"Correo electrónico",placeholder:"Correo electrónico",type:"textField",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"nombre_banco",visible_label:!1,label:"Banco",placeholder:"Banco",type:"selectBox",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"numero_tarjeta",visible_label:!1,label:"Número de tarjeta",placeholder:"Número de tarjeta",type:"numeric",required:!0},{styleContainer:"width:31%;float:left;margin:0px 5px 0px 0px;",style:"font-size:12px;padding-top: 10px;padding-bottom: 10px;",name:"mes_vencimiento",label:"Mes de vto",placeholder:"Mes de vto",type:"selectBox",required:!0},{styleContainer:"width:31%;float:left;margin:0px 5px 0px 0px;",style:"font-size:12px;padding-top: 10px;padding-bottom: 10px;",name:"anio_vencimiento",label:"Año de vto",placeholder:"Año de vto",type:"selectBox",required:!0},{styleContainer:"width:31%;float:left;margin:0px 5px 0px 0px;",style:"font-size:12px;padding-top: 10px;padding-bottom: 10px;",name:"codigo_seguridad",label:"CCV",visible_label:!0,placeholder:"CCV",type:"numeric",required:!0},{styleContainer:"width:100%;float:left;margin:0px 0;",name:"pais",label:"País",placeholder:"País",type:"selectBox",required:!0}]),a.buttons=[{style:"border: 0;background-color:#f18107;color:#ffffff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#ffffff",name:"aceptar",label:"Guardar",callback:function(){a.save()}}],a.show(),a.ui.nombre_banco.populateSelectFromArray(t={VISA:"VISA",MASTERCARD:"MASTERCARD",AMEX:"AMEX",DINERS:"DINERS"}),(t={})[0]="-"+nw.str("Año")+"-";for(var i=18;i<34;i++)t["20"+i]=i;a.ui.anio_vencimiento.populateSelectFromArray(t),(t={})[0]="-"+nw.str("Mes")+"-";for(i=0;i<12;i++){var n=(n=i+1).toString();console.log(n),t[n=1===n.length?"0"+n:n]=n}a.ui.mes_vencimiento.populateSelectFromArray(t);var t={"":"Seleccione"};a.ui.pais.populateSelectFromArray(t);(t={}).empresa=o.empresa,t.usuario=o.usuario,t.perfil=o.perfil,a.ui.pais.populateSelect("app_user","populatePaises",t,function(e){nw.evalueData(o.pais)&&a.ui.pais.setValue(o.pais)},!0),console.log(o);e="";nw.evalueData(o.nombre)&&(e+=o.nombre),nw.evalueData(o.apellido)&&(e+=" "+o.apellido),nw.evalueData(e)&&a.ui.nombre_tarjeta.setValue(e),nw.evalueData(o.email)&&a.ui.email.setValue(o.email),nw.evalueData(o.nit)&&a.ui.documento.setValue(o.nit),a.ui.nombre_banco.setValue("VISA"),a.ui.numero_tarjeta.setValue("4260823545422596"),a.ui.mes_vencimiento.setValue("06"),a.ui.anio_vencimiento.setValue("2019"),a.ui.codigo_seguridad.setValue("621")},destruct:function(){},members:{save:function(){if(!this.validate())return!1;var e=nw.userPolicies.getUserData(),a=this.getRecord(!0),e=(a.pais=a.pais_text,a.pais="CO",a.price=11e3,a.solo_validar=!1,a.pruebas=!0,a.fecha_vencimiento=a.anio_vencimiento+"/"+a.mes_vencimiento,a.usuario=e.usuario,a.empresa=e.empresa,a.usuario_text=e.nombre,a.id_usuario=e.id_usuario,a.type="epayco",void 0!==config.apiKeyEpayco&&""!=config.apiKeyEpayco&&(a.apiKeyEpayco=config.apiKeyEpayco),void 0!==config.privateKeyEpayco&&""!=config.privateKeyEpayco&&(a.privateKeyEpayco=config.privateKeyEpayco),a.test="NO",a.pago_unico_mensual="UNICO",a.description="Suscripción de tarjeta en "+config.name,console.log(a),new nw.rpc(nw.getRpcUrl(),"nwMaker"));e.setAsync(!0);e.exec("apiNwPayTesting",a,function(e){nw.console.log("save",e),main.misTarjetasCredito()})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_novedades",{extend:nw.forms,construct:function(){var e=this;e.id="f_novedades",e.setTitle="<span style='color:#fff;'>Reportar novedad</span>",e.html="",e.showBack=!0,e.closeBack=!1,e.colorBtnBackIOS="#ffffff;",e.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",e.transition="slide",e.createBase();e.setFields([{name:"comentario",label:"Comentarios",visible_label:!0,placeholder:"Comentarios",type:"textArea",required:!0},{name:"adjunto",label:"Soporte o Evidencia",visible_label:!0,type:"button",mode:"camera_files",required:!1}]),e.buttons=[],e.buttons.push({style:"border: 0;background-color:#f18107;color:#ffffff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#ffffff",position:"top",name:"enviar",label:"Enviar",callback:function(){e.save()}}),e.show()},destruct:function(){},members:{save:function(){if(!this.validate())return!1;var e=this.getRecord(!0),a=nw.userPolicies.getUserData(),a=(e.id_usuario=a.id_usuario,e.usuario=a.usuario,e.empresa=a.empresa,e.perfil=a.perfil,e.id_viaje=this.data.id,e.estado="CREADO_POR_CONDUCTOR",new nw.rpc(nw.getRpcUrl(),"servicios"));a.setAsync(!0),a.setLoading(!0);a.exec("reportarNovedad",e,function(e){if(!0!==e)return nw.dialog(e),!1;nw.dialog("Enviado correctamente"),nw.back()})},populate:function(e){this.data=e}}}),nw.Class.define("f_registro_rotulos",{extend:nw.lists,construct:function(a,e){var o=this,i=(nw.userPolicies.getUserData(),{setTitle:"Confirmar registro Rotulos",id:"f_registro_rotulos",html:"<div class='registro_rotulos'>Confirmar registro Rotulos</div>",changeHash:!0,showBack:!0,closeBack:!1,destroyAutomaticOnAccept:!1}),n=(nw.isMobile()&&(i.role="page",i.transition="slide"),i.fields=[],i.fields.push({label:"",name:"rotulos",type:"startGroup",mode:"grid"},{name:"num_rotulo",label:"Num Rotulo",type:"textField",enabled:!1,width:100,row:0,column:1},{name:"unidades",label:"Unidades",type:"textField",enabled:!1,width:200,row:0,column:1},{name:"estado",label:"Estado",type:"textField"},{name:"fecha_creacion",label:"Fecha Creacion",type:"textField",enabled:!1,visible:!1},{name:"fecha_hora_despacho",label:"Fecha Hora Despacho",type:"textField",enabled:!1,visible:!1},{name:"peso_real",label:"Peso",type:"textField"},{name:"alto",label:"Alto",type:"textField"},{name:"ancho",label:"Ancho",type:"textField"},{name:"largo",label:"largo",type:"textField"},{name:"peso_volumen",label:"Volumen",type:"textField"},{name:"estado_cliente",label:"Estado Cliente",type:"textField",visible:!1},{name:"valor_declarado",label:"Valor Declarado",type:"textField",visible:!1},{name:"verificado",label:"Verificado",type:"textField",visible:!1},{name:"codigo_barras",label:"Codigo Barras",type:"textField",visible:!1},{name:"unidad",label:"Unidad",type:"textField",enabled:!1},{type:"endGroup"}),i.fields.push({label:"",name:"otros_rotulos",type:"startGroup"},{type:"endGroup"}),nw.dialog("<div id='pruebaunorotulos' class='pruebaunorotulos'></div>",function(){if(!o.d.validate())return!1;var e=o.d.getRecord();console.log("SAVE::",e),e.appliFilters="NO",a.addRow(e,!1,"prepend"),a.removeRow(a.activeRow),n.remove()},function(){return nw.remove(".pruebauno_container_rotulos"),!0},{addClass:"pruebauno_container_rotulos",original:!0,destroyAutomaticOnAccept:!1,iconAccept:"<i class='material-icons' style='top: 5px;position: relative;'>check_circle</i>",iconCancel:"<i class='material-icons' style='top: 5px;position: relative;'>cancel</i>"}));return i.showButtons=!1,i.createInHome=!0,i.canvas="#pruebaunorotulos",i.id="pruebauno_rotulos_list",i.id_form="pruebauno_rotulos_list_int",o.d=nw.dialog2("",!1,!1,i),o.d.setRecord(e),o},destruct:function(){},members:{test:function(){}}}),nw.Class.define("f_preoperacional_dynamic",{extend:nw.forms,construct:function(e,a,o,t){var r=this;t?(r.canvas="#foo",r.id_form="f_preoperacional_dynamic"):(r.id="f_preoperacional",r.setTitle="<span style='color:#fff;'>Pre-operacional</span>",r.html="<div class='vehiculo'>Pre-operacional</div>",r.showBack=!0,r.closeBack=!1,r.colorBtnBackIOS="#ffffff;",r.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",r.createBase()),r.parent=e,r.callback=o,r.configCliente=main.configCliente,r.datos_vehiculo=!1,void 0!==main.vehiculo&&(r.datos_vehiculo=main.vehiculo),r.datos=a,r.firma_fonductor_inspeccion=!1,nw.evalueData(a)&&nw.evalueData(a.firma_fonductor_inspeccion)&&(r.firma_fonductor_inspeccion=a.firma_fonductor_inspeccion);r.traerPreguntas(function(e){var a=[];if(!nw.evalueData(e))return nw.dialog("Debe configurar las preguntas del preoperacional. Consulte con el administrador del sistema."),!1;a.push({name:"marca",label:"Marca",type:"textField",enabled:!1},{name:"modelo",label:"Modelo",type:"textField",enabled:!1},{name:"tipo",label:"Tipo",type:"textField",enabled:!1},{name:"placa",label:"Placa",type:"textField",enabled:!1},{name:"id",label:"ID",placeholder:"id",type:"textField",required:!1,visible:!1}),r.preguntas=e;for(var o=0;o<e.length;o++)"SI"==(n=e[o]).required&&(n.required=!0),"NO"==n.required&&(n.required=!1),"SI"==n.visible&&(n.visible=!0),"NO"==n.visible&&(n.visible=!1),a.push({name:n.name,label:n.label,palceholder:n.label,type:n.type,mode:n.mode,options:"<option value='NO'>NO</option><option value='SI'>SI</option>",required:n.required,visible:n.visible});a.push({styleContainer:"margin:0;",label:"Documentos adicionales",name:"otros_documentos",type:"startGroup"},{style:"background: #ec7c7c; color: #fff;",name:"nuevo_documento",label:"Agregar documento en el preoperacional",type:"button"},{type:"endGroup"}),r.setFields(a),r.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar btn_generic",label:"Guardar",callback:function(){r.save()}}],r.show(),t&&nw.utils.addClass(document.querySelector(r.canvas),"foo_preope"),r.datos_vehiculo&&(r.ui.marca.setValue(r.datos_vehiculo.marca_text),r.ui.modelo.setValue(r.datos_vehiculo.modelo),r.ui.tipo.setValue(r.datos_vehiculo.tipo_vehiculo_text),r.ui.placa.setValue(r.datos_vehiculo.placa)),console.log("data",e),console.log("data.length",e.length);for(o=0;o<e.length;o++){var i,n=e[o];console.log("r",n),console.log("r.type",n.type),"selectBox"!=n.type&&"radio"!=n.type||(i={"":"Seleccione"},nw.evalueData(n.op1)&&(i[n.op1]=n.op1),nw.evalueData(n.op2)&&(i[n.op2]=n.op2),nw.evalueData(n.op3)&&(i[n.op3]=n.op3),r.ui[n.name].populateSelectFromArray(i),r.ui[n.name].setValue(""))}r.createNavTableOtrosDocumentos(),r.ui.nuevo_documento.addListener("click",function(){(new f_preoperacional_documento).construct(r)})})},destruct:function(){},members:{traerPreguntas:function(a){var e=nw.userPolicies.getUserData(),o={},e=(o.empresa=e.empresa,new nw.rpc(nw.getRpcUrl(),"preoperacional"));e.setAsync(!0);e.exec("getPreopeAdminPreguntas",o,function(e){console.log("f_preoperacional:::responseServer",e),a(e)})},createNavTableOtrosDocumentos:function(){var e=this.datos,a=this.canvas+" .otros_documentos",o=new l_navtable_preoperacional_otros_documentos;o.construct(a,e),this.navTable=o},save:function(){var a=this;if(!a.validate())return!1;var e=nw.userPolicies.getUserData(),o=a.getRecord(!0),i=o;i.usuario=e.usuario,i.empresa=e.empresa,i.usuario_text=e.nombre,i.id_usuario=e.id_usuario,i.otros_documentos=a.navTable.getAllData(),i.preguntas_dinamicas={};for(var n=0;n<a.preguntas.length;n++){var t=a.preguntas[n];i.preguntas_dinamicas[t.name]=o[t.name]}a.datos_vehiculo?(i.id_vehiculo=a.datos_vehiculo.id,"string"==typeof e.bodega&&""!=e.bodega&&"null"!=e.bodega&&(i.bodega=e.bodega),console.log("f_preoperacional:::sendData",i),(e=new nw.rpc(nw.getRpcUrl(),"preoperacional")).setAsync(!0),e.setLoading(!0),e.exec("savePreopeAdmin",i,function(e){console.log("f_preoperacional:::responseServer",e),nw.dialog("¡Guardado correctamente!",function(){if(nw.evalueData(a.callback))return a.callback(e),!0;nw.evalueData(a.parent)&&a.parent.applyFilters()},!1,{original:!0}),nw.evalueData(a.callback)&&setTimeout(function(){nw.changePage(""),window.location.reload()},2e3)})):nw.dialog("sin datos del Vehículo")},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_preoperacional",{extend:nw.forms,construct:function(e,a,o,i){var n=this,a=(i?(n.canvas="#foo",n.id_form="f_preoperacional"):(n.id="f_preoperacional",n.setTitle="<span style='color:#fff;'>"+nw.tr("Pre-operacional")+"</span>",n.html="<div class='vehiculo'>"+nw.tr("Pre-operacional")+"</div>",n.showBack=!0,n.closeBack=!1,n.colorBtnBackIOS="#ffffff;",n.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",n.createBase()),n.datos=a,n.firma_fonductor_inspeccion=!1,nw.evalueData(a)&&nw.evalueData(a.firma_fonductor_inspeccion)&&(n.firma_fonductor_inspeccion=a.firma_fonductor_inspeccion),n.parent=e,n.callback=o,n.configCliente=main.configCliente,n.datos_vehiculo=!1,void 0!==main.vehiculo&&(n.datos_vehiculo=main.vehiculo),"<option value='NO'>NO</option><option value='SI'>SI</option>"),e="switch",o=[{name:"marca",label:"Marca",type:"textField",enabled:!1},{name:"modelo",label:"Modelo",type:"textField",enabled:!1},{name:"tipo",label:"Tipo",type:"textField",enabled:!1},{name:"placa",label:"Placa",type:"textField",enabled:!1},{label:"LLantas",name:"contenedor_llantas",type:"startGroup"},{name:"id",label:"ID",placeholder:"id",type:"textField",required:!1,visible:!1},{name:"presion",label:"Presión",type:e,options:a,required:!0},{name:"labrado",label:"Labrado",type:e,options:a,required:!0},{name:"tuercas_completas_aseguradas",label:"Tuercas completas y aseguradas",type:e,options:a,required:!0},{label:"Frenos",name:"contenedor_frenos",type:"startGroup"},{name:"freno_parqueo_funciona",label:"Freno de parqueo funciona",type:e,options:a,required:!0},{name:"frenos_funcionando",label:"Frenos funcionando",type:e,options:a,required:!0},{name:"liquido_frenos_dentro_limites",label:"Líquido de frenos dentro de los límites",type:e,options:a,required:!0},{type:"endGroup"},{label:"Luces",name:"contenedor_luces",type:"startGroup"},{name:"enciende_luz_reversa",label:"Enciende la luz de reversa",type:e,options:a,required:!0},{name:"encienden_luces_bajas",label:"Encienden luces bajas",type:e,options:a,required:!0},{name:"encienden_cocuyos",label:"Encienden cocuyos",type:e,options:a,required:!0},{name:"encienden_luces_freno",label:"Encienden luces de freno",type:e,options:a,required:!0},{name:"encienden_direccionales_atras_delante",label:"Encienden direccionales (adelante y atrás)",type:e,options:a,required:!0},{type:"endGroup"},{label:"Indicadores del tablero",name:"contenedor_indicadores",type:"startGroup"},{name:"nivel_combustible",label:"Nivel de combustible",type:e,options:a,required:!0},{name:"indicador_presion_aceite",label:"Indicador de presión de aceite",type:e,options:a,required:!0},{name:"indicador_nivel_bateria",label:"Indicador nivel de batería",type:e,options:a,required:!0},{type:"endGroup"},{label:"Condiciones de funcionamiento",name:"contenedor_indicadores",type:"startGroup"},{name:"espejos_retrovisores_funcionando",label:"Espejos retrovisores funcionando",type:e,options:a,required:!0},{name:"todas_puertas_cierran_ajustan",label:"Todas las puertas cierran y ajustan",type:e,options:a,required:!0},{name:"nivel_aceite_motor",label:"Nivel de aceite del motor",type:e,options:a,required:!0},{name:"nivel_liquido_direccion",label:"Nivel del líquido de la dirección",type:e,options:a,required:!0},{name:"nivel_liquido_refrigerante",label:"Nivel del líquido refrigerante",type:e,options:a,required:!0},{name:"nivel_agua_limpiabrisas",label:"Nivel del agua del limpiabrisas",type:e,options:a,required:!0},{name:"pito",label:"Pito",type:e,options:a,required:!0},{name:"limpiabrisas_funcionando",label:"Limpiabrisas funcionando",type:e,options:a,required:!0},{name:"radiador_tapa_ajustada",label:"Radiador con tapa ajustada",type:e,options:a,required:!0},{name:"correa_ventilador_tensionada",label:"Correa del ventilador tensionada",type:e,options:a,required:!0},{name:"bateria_sin_residuos",label:"Batería sin residuos",type:e,options:a,required:!0},{type:"endGroup"},{label:"Silletería",name:"contenedor_silleteria",type:"startGroup"},{name:"ajuste_horizontal_sillas_delanteras",label:"Ajuste horizontal sillas delanteras",type:e,options:a,required:!0},{name:"ajuste_vertical_sillas_delanteras",label:"Ajuste vertical sillas delanteras",type:e,options:a,required:!0},{name:"tapizado_roturas_manchas",label:"Tapizado sin roturas o manchas",type:e,options:a,required:!0},{name:"estado_salud_observaciones",label:"Indique su estado de salud. ¿Ha presentado en los últimos días fiebre, tos, gripe o alguna otra complicación?",type:"textArea"},{name:"firma_fonductor_inspeccion",label:"Firma del Conductor que hace la Inspección",type:"signature",required:!0,data:n.firma_fonductor_inspeccion},{name:"observaciones",label:"Observaciones",type:"textArea"},{type:"endGroup"},{styleContainer:"margin:0;",label:"Documentos adicionales",name:"otros_documentos",type:"startGroup"},{style:"background: #ec7c7c; color: #fff;",name:"nuevo_documento",label:"Agregar documento en el preoperacional",type:"button"},{type:"endGroup"}];n.setFields(o),n.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar btn_generic",label:"Guardar",callback:function(){n.save()}}],n.show(),i&&nw.utils.addClass(document.querySelector(n.canvas),"foo_preope"),n.datos_vehiculo&&(n.ui.marca.setValue(n.datos_vehiculo.marca_text),n.ui.modelo.setValue(n.datos_vehiculo.modelo),n.ui.tipo.setValue(n.datos_vehiculo.tipo_vehiculo_text),n.ui.placa.setValue(n.datos_vehiculo.placa)),n.ui.nuevo_documento.addListener("click",function(){(new f_preoperacional_documento).construct(n)}),n.createNavTableOtrosDocumentos()},destruct:function(){},members:{createNavTableOtrosDocumentos:function(){var e=this.datos,a=this.canvas+" .otros_documentos",o=new l_navtable_preoperacional_otros_documentos;o.construct(a,e),this.navTable=o},save:function(){var a=this;if(!a.validate())return!1;var e=nw.userPolicies.getUserData(),o=a.getRecord(!0);o.usuario=e.usuario,o.empresa=e.empresa,o.usuario_text=e.nombre,o.id_usuario=e.id_usuario,o.otros_documentos=a.navTable.getAllData(),a.datos_vehiculo?(o.id_vehiculo=a.datos_vehiculo.id,"string"==typeof e.bodega&&""!=e.bodega&&"null"!=e.bodega&&(o.bodega=e.bodega),console.log("f_preoperacional:::sendData",o),(e=new nw.rpc(nw.getRpcUrl(),"preoperacional")).setAsync(!0),e.setLoading(!0),e.exec("savePreoperacional",o,function(e){console.log("f_preoperacional:::responseServer",e),nw.dialog("¡Guardado correctamente!",function(){if(nw.evalueData(a.callback))return a.callback(e),!0;nw.evalueData(a.parent)&&a.parent.applyFilters()},!1,{original:!0}),nw.evalueData(a.callback)&&setTimeout(function(){nw.changePage(""),window.location.reload()},2e3)})):nw.dialog("sin datos del Vehículo")},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_crear_parada",{extend:nw.forms,construct:function(o,e){var i=this,e=(i.id="f_crear_parada",i.setTitle="<span style='color:#fff;'>Agregar parada</span>",i.transition="slide",i.showBack=!0,i.closeBack=!1,i.textClose="Atrás",i.colorBtnBackIOS="#ffffff;",i.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",i.map=e,i.closeBackCallBack=function(){nw.back()},i.createBase(),i.setFields([{icon:"n",name:"direccion",label:"Dirección de la parada",placeholder:"Dirección de la parada",type:"search",required:!0},{type:"textField",label:"Nombre del pasajero",placeholder:"Nombre pasajero",name:"nombre_pasajero",visible:!0,required:!0},{type:"textArea",label:"Comentarios, indicaciones",placeholder:"Comentarios, indicaciones",name:"descripcion_carga",visible:!0,required:!0},{type:"textField",label:"",placeholder:"Latitud",name:"latitud",visible:!1},{type:"textField",label:"",placeholder:"Longitud",name:"longitud",visible:!1}]),i.buttons=[{style:"background-color: green;color: #ffffff;",icon:"material-icons how_to_reg normal",position:"bottom",name:"aceptar",label:"Guardar",callback:function(){var e,a=i.getRecord();if(!i.validate())return!1;console.log("parent",o),console.log("data",a),console.log("typeof main.selfMapaDriver",typeof main.selfMapaDriver),console.log("document.querySelector(.btn_more_info_intravel)",document.querySelector(".btn_more_info_intravel")),void 0!==o.guardar_paradas?o.saveParada(a,function(){document.querySelector(".btn_more_info_intravel")&&void 0!==main.selfMapaDriver&&main.selfMapaDriver.resetParadasAdicionales()}):void 0!==o.update_paradas?o.updateParada(a):(o.navTable.addRow(a),o.arrayParadas.push(a),(e=new nwgeo.addMarker).map=o.map,e.latitude=a.latitud,e.longitude=a.longitud,e.label="",e.icon=config.domain_rpc+"/lib_mobile/driver/img/marker_v.png",e.draggable=!1,e.animation=!1,a=e.show(function(){}),o.markersParadas.push(a),o.traeTarifas.evalueContinuarPoliLyne()),nw.back()}}],i.show(),document.querySelector(i.canvas+" .direccion"));console.log("input",e),console.log("self.canvas",i.canvas),nwgeo.autocomplete(e,i.map,function(e){console.log("result.:::::::::::direction::::::::::",e);var a={};a.results=e.place,a.address=e.address,a.lat=e.place.geometry.location.lat(),a.lng=e.place.geometry.location.lng(),i.ui.latitud.setValue(a.lat),i.ui.longitud.setValue(a.lng)},main.configCliente.paises_iso_relation_autocomplete_maps)},destruct:function(){},members:{canvas:function(e){this.canvas=e}}}),nw.Class.define("f_redimir_cupon",{extend:nw.forms,construct:function(e){var a=this,e=(a.id="f_redimir_cupon",a.setTitle="<span style='color:#fff;'>"+nw.tr("Promociones")+"</span>",a.showBack=!0,a.closeBack=!1,a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e,[{label:"",style:"",name:"contenedor_promociones",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRefiereAmigos' style='background-image: url("+config.domain_rpc+"/lib_mobile/driver/img/Cupones_IMG.png); background-size: 158px;background-position: center;'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRefiereAmigos'>"+nw.tr("Redimir cupón promocional")+"</span><span class='descpRefiereAmigos'>"+nw.tr("Redime y viaja con nosotros a donde tu quieras.")+"</span>",type:"html"},{label:"",style:"",name:"contenedor_refiere_amigos_actions",mode:"div",type:"startGroup"},{name:"nombre",label:"Código",placeholder:"Código",type:"textField",required:!0,visible:!0},{label:"",style:"",name:"contenedor_refiere_amigos_buttons",mode:"div",type:"startGroup"},{name:"redimir",label:"Redimir",type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}]);a.setFields(e),a.show(),a.ui.redimir.addListener("click",function(){a.save()}),$("#f_redimir_cupon .nw_label_nombre").css("cssText","display:none!important;")},destruct:function(){},members:{save:function(){var i=this;if(!i.validate())return!1;var n=nw.userPolicies.getUserData(),e=i.getRecord(!0),a=(e.usuario=n.usuario,e.empresa=n.empresa,e.perfil=n.perfil,new nw.rpc(nw.getRpcUrl(),"vehiculo"));a.setAsync(!0);a.exec("validate_cupon",e,function(e){if(console.log(e),!1===e)return nw.dialog("El código no existe o ya fue redimido"),!1;var a={cleanHtml:!1},o=(nw.evalueData(n.saldo)||(n.saldo=0),parseFloat(n.saldo)+parseFloat(e.valor));n.saldo=o,window.localStorage.setItem("saldo",o),nw.dialog("<strong>"+nw.tr("¡Código redimido!")+"</strong><br /><br />"+e.valor+" "+nw.tr("es tu saldo para próximos viajes"),!1,!1,a),nw.evalueData(i.callback)?i.callback():(i.reject(),nw.home())})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_ver_viaje",{extend:nw.forms,construct:function(e){var a=this;a.id="f_ver_viaje",a.showBack=!0,a.closeBack=!1,a.transition="slide",a.datos=e,a.createBase();a.setFields([{styleContainer:"margin:0;",style:"height:400px;margin:0;width: 100%;",label:"Mapa",name:"mapa",type:"startGroup"},{type:"endGroup"},{visible:!0,label:"",name:"observaciones_html",type:"html"}]),a.buttons=[]},destruct:function(){},members:{createNavTableTarAdic:function(){var e=this.datos,a=(console.log(e),document.querySelector("#f_ver_viaje #observaciones_html .nav_adicion")),o=document.createElement("div"),o=(o.style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",o.innerHTML=nw.tr("Descripción de adicionales"),a.appendChild(o),console.log(a),new l_navtable_tareas_adicionales);o.construct("#f_ver_viaje #observaciones_html .nav_adicion",e),this.navTable=o},createNavTableParadas:function(){var e=this.datos,a=(console.log(e),document.querySelector("#f_ver_viaje #observaciones_html .nav_paradas")),o=document.createElement("div"),a=(o.style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",o.innerHTML=nw.tr("Paradas adicionales"),a.appendChild(o),new l_navtable_paradas);a.construct("#f_ver_viaje #observaciones_html .nav_paradas",e),this.navTable=a},createMapa:function(){var e=new nwgeo.getMap(!1);e.canvas=document.querySelector(this.canvas+" .mapa"),e.zoom=10,this.map=e.show()},createLine:function(){var a=this,o=a.map,e=new nwgeo.addMarker;e.map=o,e.latitude=a.latitude,e.longitude=a.longitude,e.title=a.direccion_origen,e.label="",e.icon="",e.draggable=!1,e.native=!1,a.marker1=e.show();(e=new nwgeo.addMarker).map=o,e.latitude=a.latitudDes,e.longitude=a.longitudDes,e.title=a.direccion_destino,e.label="",e.icon="",e.draggable=!1,e.native=!1,a.marker2=e.show();e={lat:a.latitude,lng:a.longitude,lat2:a.latitudDes,lng2:a.longitudDes};nwgeo.addLineStreet(o,e,function(e){nwgeo.centerMap(o,a.marker1,a.marker2),a.callback(e)})}}}),nw.Class.define("f_preoperacional_documento",{extend:nw.forms,construct:function(a){var o=this;o.id="f_preoperacional_documento",o.setTitle="<span style='color:#fff;'>Documento</span>",o.showBack=!0,o.closeBack=!1,o.textClose="Atrás",o.colorBtnBackIOS="#ffffff;",o.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",o.closeBackCallBack=function(){nw.back()},o.createBase();o.setFields([{icon:"n",name:"adjunto",label:"Adjunto",placeholder:"Adjunto",type:"button",mode:"camera_files",required:!0},{icon:"n",name:"observaciones",label:"Observaciones",placeholder:"Observaciones",type:"textArea",required:!1}]),o.buttons=[{style:"background-size:20px;box-shadow: none;border: 0;background-color: transparent;color: #ffffff;",icon:"material-icons how_to_reg normal",colorBtnBackIOS:"#ffffff",position:"top",name:"aceptar",label:"Listo",callback:function(){var e=o.getRecord();if(!o.validate())return!1;nw.utils.remove(a.canvas+" .showZeroRows"),e.adjunto_show=config.domain_rpc+e.adjunto,a.navTable.addRow(e),nw.back()}}],o.show()},destruct:function(){},members:{canvas:function(e){this.canvas=e}}}),nw.Class.define("l_historico_viajes",{extend:nw.lists,construct:function(){var o=this,i=(o.showContextMenu=!0,o.id="l_historico_viajes",o.setTitle="Viajes",o.html="Viajes",o.showBack=!0,o.closeBack=!1,o.textClose="Cerrar",o.estado="RESERVADO",o.acumulado=0,o.configCliente=main.configCliente,nw.userPolicies.getUserData()),e=(o.createBase(),o.event=new Event("ver_viaje"),console.log("self.configCliente",o.configCliente),["SI"===o.configCliente.mostrar_valor_conductor?{name:"valor_total_servicio",label:"",mode:"money"}:{name:"utilidad_conductor",label:"",mode:"money"},{name:"estado_atiempo",label:"<i class='material-icons' style='visibility: hidden;'>date_range</i>"},{name:"fecha_hora",label:"<i class='material-icons' style='visibility: hidden;'>date_range</i>",mode:"date_format"},{name:"origen",label:"<span class='containOrigDestPoint containOrigDestPointA'>A</span>"},{name:"destino",label:"<span class='containOrigDestPoint containOrigDestPointB'>B</span>"},{name:"paradas_adicionales_iniciales_creacion",label:"<img src='"+config.domain_rpc+"/lib_mobile/pax.svg' class='img_pax_history' /> x ",mode:"toolTip"},{name:"id",label:"<span class='id_service_historico'>№</span> ",mode:"toolTip"},{name:"nombre_empresa_cliente",label:"Empresa: "},{name:"tipo_servicio_text",label:"Tipo: "},{name:"estado_text",label:""},{name:"tipo_pago_text",label:""},{name:"vuelo_numero",label:"",mode:"toolTip"},{name:"observaciones_servicio",label:"",mode:"toolTip"},{name:"descricion_carga",label:"",mode:"toolTip"},{name:"iniciar_servicio",label:"",type:"button"}]),e=(o.setColumns(e),[{type:"dateField",label:"",placeholder:"Fecha Inicial",name:"fecha_inicial"},{type:"dateField",label:"",placeholder:"Fecha Final",name:"fecha_final"},{style:"background: red; color: #fff;",type:"button",label:"Buscar",placeholder:"",name:"buscar",enabled:!1}]);"SI"==o.configCliente.usa_informe_conductor&&e.push({style:"background: red; color: #fff;",type:"button",label:"Informe",placeholder:"",name:"informe"}),o.createFilters(e),o.buttons=[],o.buttons.push({style:"background-color: #ffffff;color:#333;font-weight: bold;border-bottom: 1px solid #ccc;",colorBtnBackIOS:"#333",icon:"material-icons playlist_add normal",position:"top",name:"programados",label:"<span class='titlehistoenc'>Reservas</span>",callback:function(e){o.action("RESERVADO",e),o.mostrar(!1)}},{style:"color:#6a6767;",colorBtnBackIOS:"#6a6767",icon:"material-icons playlist_play normal",position:"top",name:"activos",label:"<span class='titlehistoenc'>Activos</span>",callback:function(e){o.action("ACTIVOS",e),o.mostrar(!1)}},{style:"color:#6a6767;",colorBtnBackIOS:"#6a6767",icon:"material-icons playlist_add_check normal",position:"top",name:"pasados",label:"<span class='titlehistoenc'>Pasados</span>",callback:function(e){o.action("PASADOS",e),o.mostrar(!0)}}),o.show();$(o.canvas).delegate(".rowName_iniciar_servicio","click",function(e,a){$(this.parentElement).trigger({type:"click"}),o.iniciarViaje()}),o.showtarde=!1,o.tardebtn=document.createElement("div"),o.tardebtn.className="mostrarpasadostarde",o.tardebtn.onclick=function(){o.showtarde?($(".estatusatiempo_row_rojo").addClass("estatusatiempo_row_show"),o.showtarde=!1):($(".estatusatiempo_row_rojo").removeClass("estatusatiempo_row_show"),o.showtarde=!0)},document.querySelector(o.canvas).appendChild(o.tardebtn),"NO"==o.configCliente.conductor_historico_ver_viajes_tarde_en_boton&&(o.tardebtn.style.display="none"),o.ui.buscar.addListener("click",function(e){o.varsClean(),o.applyFilters()}),"SI"==o.configCliente.usa_informe_conductor&&o.ui.informe.addListener("click",function(e){var a=o.getFiltersData();main.imprimir("VER_INFORME_CONDUCTOR",i.id_usuario,a)}),o.onAppear(function(){setTimeout(function(){o.varsClean(),o.applyFilters(),"CARGA"!=o.configCliente.app_para?o.mostrar("no_aplica"):o.mostrar(!0)},100)})},destruct:function(){},members:{mostrar:function(e){"no_aplica"==e?($("#l_historico_viajes .containFilters").css("cssText","display: none"),$("#l_historico_viajes .containTable").css("cssText","padding-top: 0px;")):"CARGA"==this.configCliente.app_para&&(e?($("#l_historico_viajes .containFilters").css("cssText","display: initial"),$("#l_historico_viajes .containTable").css("cssText","padding-top: 31px!important;")):($("#l_historico_viajes .containFilters").css("cssText","display: none"),$("#l_historico_viajes .containTable").css("cssText","padding-top: 0px;")))},action:function(e,a){$(".ui-block-b .btnExec").css({"background-color":"#f6f6f6",color:"#6a6767","font-weight":"lighter","border-bottom":"none"}),$(".l_historico_viajes .material-icons").css("cssText","color: #6a6767!important;"),$(a).css({"background-color":"#ffffff",color:"#333","font-weight":"bold","border-bottom":"1px solid #ccc"}),$(a).find(".l_historico_viajes .material-icons").css("cssText","color: #333!important;"),this.estado=e,this.varsClean(),this.applyFilters()},varsClean:function(){var e=this;e.clean(),e.loadMore=!1,e.limit_pagination=10,e.limit_old=0,e.limit_new=e.limit_pagination},applyFilters:function(t){var r=this,e=(r.loadMore,r.limit_pagination=10,nw.evalueData(r.limit_old)||(r.limit_old=0),nw.evalueData(r.limit_new)||(r.limit_new=r.limit_pagination),nw.remove(".cargar_mas_list"),document.createElement("div")),e=(e.innerHTML=nw.utils.tr("Cargar más"),e.className="cargar_mas_list",e.onclick=function(){r.loadMore=!0,r.limit_old=r.limit_old+r.limit_pagination,r.limit_new=r.limit_pagination+1,r.applyFilters()},document.querySelector(r.canvas+" .containTable").appendChild(e),nw.userPolicies.getUserData()),a=(nw.loading({text:nw.tr("Consultando servicios..."),textVisible:!0,html:"",theme:"b",container:r.canvas}),{}),c=(a.usuario=e.usuario,a.id_usuario=e.id_usuario,a.empresa=e.empresa,a.perfil=e.perfil,a.estado=r.estado,a.configCliente=r.configCliente,a.limit_old=r.limit_old,a.limit_new=r.limit_new,a.filters=r.getFiltersData(),console.log("l_historico_viajes:::dataSendServer:::data",a),0),s=nw.utilsDate.getActualFullDate(),e=new nw.rpc(r.getRpcUrl(),"app_driver");e.setAsync(!0),e.setLoading(!1),nw.empty(".showZeroRows"),nw.removeClass(".mostrarpasadostarde","mostrarpasadostarde_show"),r.showtarde=!1;e.exec("consulta_historico_servicios",a,function(e){console.log("l_historico_viajes:::responseServer:::r",e),nw.loadingRemove({container:r.canvas});for(var a,o,i=0;i<e.length;i++)e[i].estado_text=nw.utils.tr(e[i].estado),e[i].tipo_pago_text=nw.utils.tr(e[i].tipo_pago),e[i].tipo_servicio_text=nw.utils.tr(e[i].tipo_servicio),nw.evalueData(e[i].paradas_adicionales_iniciales_creacion)&&(e[i].paradas_adicionales_iniciales_creacion=e[i].paradas_adicionales_iniciales_creacion),nw.evalueData(e[i].vuelo_numero)&&(e[i].vuelo_numero="Vuelo No: "+e[i].vuelo_numero),"RESERVADO"==r.estado&&"SI"==r.configCliente.conductor_historico_ver_viajes_tarde_en_boton&&(a="verde",o="<span class='estatusatiempo estatusatiempo_verde'>"+nw.tr("A tiempo")+"</span>",e[i].fecha+" "+e[i].hora<s&&(a="rojo",nw.addClass(".mostrarpasadostarde","mostrarpasadostarde_show"),r.showtarde=!0,c++,document.querySelector(".mostrarpasadostarde").innerHTML=nw.tr("Tienes")+" "+c+" "+nw.tr("servicios tarde, click para ver"),o="<span class='estatusatiempo estatusatiempo_tarde'>"+nw.tr("Tarde")+"</span>"),e[i].estado_atiempo=o,e[i].addClassNameRow="estatusatiempo_row estatusatiempo_row_"+nw.tr(a)),console.log("r[i].estado",e[i].estado),"ACEPTADO_RESERVA"==e[i].estado&&(e[i].iniciar_servicio="<i class='material-icons'>play_arrow</i> "+nw.tr("Iniciar servicio"));if(r.setModelData(e,!1,!0,!1),"PASADOS"==r.estado){if(t&&0<e.length)for(i=0;i<e.length;i++){var n=e[i];r.acumulado=r.acumulado+parseFloat(n.utilidad_conductor)}}else r.acumulado=0;r.loadMore=!1})},formatCurrency:function(e,a,o,i){return new Intl.NumberFormat(e,{style:"currency",currency:a,minimumFractionDigits:o}).format(i)},contextMenu:function(){var a=this,o=a.selectedRecord(),e=(console.log("data",o),new nw.contextmenu(this,"bottom"));e.addAction("Paradas / pasajeros","material-icons streetview normal",function(e){main.editaParadasAdicionales(o,a.estado)}),e.addAction("Ampliar","material-icons info normal",function(e){main.ampliar(o,function(){a.iniciar()})},function(){a.cancelarServicio()}),"SI"===main.configCliente.ver_voucher&&e.addAction("Ver Voucher","material-icons info normal",function(e){main.imprimir("VER_VOUCHER",o.id)}),"SI"===main.configCliente.ver_cartel_vuelo&&e.addAction("Ver Cartel de Vuelo","material-icons info normal",function(e){main.imprimir("CARTEL_VUELO",o.id)}),"SI"===main.configCliente.pide_fuec&&e.addAction("Ver FUEC","nwmaker/img/baseline-create-24px.svg",function(e){main.verFuec(o)}),"reservado"===o.tipo_servicio&&("SI"!==a.configCliente.cancela_conductor||"SOLICITUD"!==o.estado&&"ACEPTADO_RESERVA"!==o.estado||e.addAction("Cancelar","nwmaker/img/baseline-create-24px.svg",function(e){a.cancelarServicio()}),"ACEPTADO_RESERVA"===o.estado)&&e.addAction("Iniciar servicio","nwmaker/img/baseline-create-24px.svg",function(e){a.iniciarViaje()})},iniciarViaje:function(){if(void 0!==main.selfMapaDriver.serviceActive&&main.selfMapaDriver.serviceActive)return nw.dialog("Tiene un servicio en curso, debe finalizarlo para poder iniciar otro."),!1;this.iniciar()},clicRow:function(){},iniciar:function(){var o=this,i=o.selectedRecord();function a(){nw.remove(".formquest"),nw.dialog(nw.tr("¿Desea iniciar el servicio")+" # "+i.id+"?",function(){nw.loading({text:"Espere por favor... Iniciando viaje",textVisible:!0,html:"",theme:"b",container:o.canvas}),console.log("typeof main.selfMapaDriver.saveAcceptService",typeof main.selfMapaDriver.saveAcceptService),function e(){if(void 0===main.selfMapaDriver.saveAcceptService)return setTimeout(function(){e()},1e3),!1;nw.loadingRemove({container:o.canvas});main.selfMapaDriver.saveAcceptService(i);var a=nw.userPolicies.getUserData();nw.sendNotificacion({title:"Inicio recogida",body:nw.utils.tr("El conductor")+" "+a.nombre+" "+nw.utils.tr("se dirige al punto de recogida"),icon:"fcm_push_icon",sound:"default",data:"nw.dialog('"+nw.utils.tr("El conductor")+" "+a.nombre+" "+nw.utils.tr("se dirige al punto de recogida")+"',function(){main.reloadApp()})",callback:"FCM_PLUGIN_ACTIVITY",to:i.token_usuario});nw.cleanAllWindow();nw.home();return!0}()},function(){return!0},{original:!0,addClass:"formquest"})}console.log("iniciar:::data",i),"SI"===main.configCliente.pide_preoperacional?main.validaPreoperacionalRequerido(function(e){!0===e&&a()}):a()},canvas:function(e){this.canvas=e},cancelarServicio:function(){var e=this,a=e.selectedRecord(),o=(console.log("data",a),new f_cancelar_servicio);o.construct(a),o.ui.id.setValue(a.id,function(){e.varsClean(),e.applyFilters()})}}}),nw.Class.define("l_navtable_tareas_adicionales",{extend:nw.lists,construct:function(e,a){var o=this;o.id_form="l_navtable_tareas",o.setTitle="Tareas Adicionales",o.canvas=e,o.datos=a,console.log(o.datos),console.log(o.canvas);return o.setColumns([{name:"id",label:"ID",visible:!1},{name:"caracteristicas",label:"Nueva tarea"}]),o.clicRow=function(){var e=o.selectedRecord();console.log(e)},$("#l_navtable_tareas").css("cssText","width:95%;"),o.applyFilters(),o},destruct:function(){},members:{applyFilters:function(e){var a=this,o={},i=(console.log(o),o.id_service=a.datos.id,new nw.rpc(a.getRpcUrl(),"servicios_conductor"));i.setAsync(!0),i.setLoading(!1);i.exec("adicionalesServicioApp",o,function(e){console.log(e),a.setModelData(e)})}}}),nw.Class.define("l_comentarios",{extend:nw.lists,construct:function(){var e=this;e.showContextMenu=!1,e.id="l_comentarios",e.setTitle="Comentarios",e.html="Comentarios",e.showBack=!0,e.closeBack=!1,e.textClose="Atrás",e.createBase();e.setColumns([{name:"id",label:"ID",visible:!1},{name:"puntaje",label:"Puntaje"},{name:"comentarios",label:"Comentario"}]),e.applyFilters(),e.show()},destruct:function(){},members:{clicRow:function(){var e=this.selectedRecord(),a=(console.log(e),new f_vehiculo);a.construct(function(){main.misVehiculos()}),a.populate(e)},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o=(nw.loading({text:"Cargando...",textVisible:!0,html:"",theme:"b",container:a.canvas}),{}),e=(o.usuario=e.usuario,new nw.rpc(a.getRpcUrl(),"servicios"));e.setAsync(!0);e.exec("consulataMisComentarios",o,function(e){nw.loadingRemove({container:a.canvas}),a.setModelData(e)})}}}),nw.Class.define("l_navtable_paradas_rotulos",{extend:nw.lists,construct:function(e,a){var o,i,r=this;return r.id_form="l_navtable_paradas_rotulos",r.showContextMenu=!0,r.setTitle="Rótulos",r.canvas=e,r.datos=a,"NO"!=r.datos.appliFilters?r.applyFilters(function(e){for(var o=[],a=(o.push({label:"",name:"separador"}),JSON.parse(e[0].rotulos)),i=($.each(a[0],function(e,a){o.push({label:e.replace("_"," "),name:e})}),[]),n=0;n<a.length;n++){var t={};$.each(a[n],function(e,a){nw.utils.evalueData(a)&&(t[e]=a)}),i.push(t)}r.setColumns(o),i=nw.lists.addValueInModel(i,"editar","<i class='material-icons'>edit</i> Editar"),i=nw.lists.addValueInModel(i,"separador",""),r.setModelData(i)}):((o=[]).push({label:"",name:"separador"}),$.each(a,function(e,a){console.log("INDEX",e),console.log("VAL",a),a="appliFilters"!=e||(console.log("ESTNTAA IF"),!1),o.push({label:e.replace("_"," "),name:e,visible:a})}),i={},$.each(a,function(e,a){nw.utils.evalueData(a)&&(i[e]=a)}),[].push(i),r.setColumns(o)),r},destruct:function(){},members:{contextMenu:function(){var a=this,o=a.selectedRecord(),e=(console.log("data",o),new nw.contextmenu(a,"normal",!0));e.addAction("Eliminar","nwmaker/img/baseline-create-24px.svg",function(e){a.eliminar(o)}),e.addAction("Editar","nwmaker/img/baseline-create-24px.svg",function(e){a.editar(o)})},editar:function(e){console.log("editar:::data",e),(new f_registro_rotulos).construct(this,e)},eliminar:function(){var e=this.selectedRecord();console.log("data",e),this.removeRow(this.activeRow)},applyFilters:function(a){if(console.log("self.datos",this.datos),!nw.evalueData(this.datos))return!1;var e=nw.userPolicies.getUserData(),o={},e=(o.conductor=e.usuario,o.empresa=e.empresa,o.id=this.datos.id,console.log("consultaRotulosPorParada:::data",o),new nw.rpc(this.getRpcUrl(),"app_driver"));e.setAsync(!0),e.setLoading(!1);e.exec("consultaRotulosPorParada",o,function(e){console.log("consultaRotulosPorParada:::r",e),a(e)})}}}),nw.Class.define("l_navtable_paradas",{extend:nw.lists,construct:function(e,a){var o=this;o.showContextMenu=!0,o.canvas=e,o.setColumns([{name:"id",label:"ID",visible:!0},{name:"direccion",label:"Dirección"},{name:"nombre_pasajero",label:""},{name:"telefono",label:""},{name:"ciudad_parada",label:""},{name:"estado_html",label:""},{name:"novedad",label:""},{name:"novedad_observaciones",label:""},{name:"fecha_final",label:""},{name:"descripcion_carga",label:""},{name:"usuario_pasajero",label:"Usuario app: "},{name:"latitud",label:"Latitud",visible:!1},{name:"longitud",label:"Longitud",visible:!1},{name:"iniciar_chat",label:"",type:"button"}]),o.clicRow=function(){var e=o.selectedRecord();console.log(e)},a&&o.applyFilters(a.id);return $(o.canvas).delegate(".rowName_iniciar_chat","click",function(e,a){$(this.parentElement).trigger({type:"click"}),o.openChat()}),o},destruct:function(){},members:{contextMenu:function(){var a=this,e=new nw.contextmenu(a,"vertical",!1),i=a.selectedRecord();console.log(i),"NO"!==main.configCliente.telefono_pasajero_visible_para_conductor&&nw.evalueData(i.telefono)&&e.addAction("Llamar","material-icons call normal",function(e){var a="57",o="tel:",o=(o+=(a=nw.evalueData(config.indicativo)?config.indicativo:a).toString())+i.telefono.toString();window.location.href=o}),e.addAction("Chat con pasajero","material-icons chat normal",function(e){a.openChat()})},openChat:function(){var e=this.selectedRecord(),a={};a.id="_parada_"+e.id,a.cliente_nombre="Chat pasajero",nw.evalueData(e.nombre_pasajero)&&(a.cliente_nombre=e.nombre_pasajero),a.all_data=e,console.log("dsdsdsdsds",a),console.log("data",e),(new f_chat).construct(a)},applyFilters:function(e){nw.loading();var i=this,a=nw.userPolicies.getUserData(),o={},e=(o.id_service=e,o.empresa=a.empresa,console.log("applyFilters:::dataSend",o),new nw.rpc(i.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1);e.exec("paradasAdicionalesAppHistorial",o,function(e){console.log("applyFilters:::responseServer",e),nw.loadingRemove({container:i.canvas}),e=nw.lists.addValueInModel(e,"iniciar_chat","<i class='material-icons'>chat_bubble_outline</i> Chat");for(var a=[],o=0;o<e.length;o++)e[o].estado_html=nw.tr(e[o].estado),a.push(e[o]);i.setModelData(a)})}}}),nw.Class.define("l_soporte_admin",{extend:nw.lists,construct:function(){var a=this;a.showContextMenu=!1,a.id="l_soporte_admin",a.setTitle="Soporte",a.html="Soporte",a.showBack=!0,a.closeBack=!1,a.textClose="Atrás",a.createBase(),a.setColumns([{name:"id",label:"Chat"},{name:"comentario",label:"Comentarios"},{name:"estado",label:"Estado"},{name:"fecha",label:"Fecha"},{name:"hora",label:"Hora"},{name:"chat",label:"",type:"button"}]),a.buttons=[];a.buttons.push({style:"background-color: #ffffff;color:#333;font-weight: bold;border-bottom: 1px solid #ccc;",colorBtnBackIOS:"#333",icon:"material-icons playlist_add_check normal",position:"top",name:"crear",label:"Nuevo chat",callback:function(e){a.formComentarios()}}),a.show(),$(document).on("click",".qx_containButton",function(){var e=a.selectedRecord();a.chat(e.id)}),a.onAppear(function(){setTimeout(function(){a.applyFilters()},100)})},destruct:function(){},members:{formComentarios:function(){var e=this;e.detalle=new nw.forms,nw.userPolicies.getUserData(),e.detalle.id="f_pagos_empresa",e.detalle.setTitle="Comentarios",e.showBackCallBack=function(){nw.loadHome()},e.detalle.createBase();e.detalle.setFields([{label:"Bienvenido, cuentanos tu inquietud.",name:"comentarios",type:"startGroup"},{name:"comentarios",label:"",type:"textArea",required:!0},{name:"",type:"endGroup"}]),e.detalle.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"bottom",name:"aceptar_comentario",label:"Aceptar",callback:function(){e.detalle.validate()&&e.save()}}],e.detalle.show(),0==e.mostrar_group_detalle&&e.detalle.ui.detalle_servicio.setVisibility(!1)},save:function(){var a=this,e=nw.userPolicies.getUserData(),o=nw.getToken(),i=a.detalle.getRecord(),e=(i.usuario=e.usuario,i.empresa=e.empresa,i.token=o,new nw.rpc(a.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!0);e.exec("saveSalasSoporte",i,function(e){a.applyFilters(),a.chat(e)})},chat:function(e){var a=nw.userPolicies.getUserData(),o={};o.id=e,o.cliente_nombre="Soporte central",o.usuario=a.usuario,o.empresa=a.empresa,(new f_chat).construct(o)},clicRow:function(){var e=this.selectedRecord();console.log(e)},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,o.empresa=e.empresa,new nw.rpc(a.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!0);e.exec("consultaMisSalasChat",o,function(e){a.setModelData(e)})}}}),nw.Class.define("l_navtable_preoperacional_otros_documentos",{extend:nw.lists,construct:function(e,a){var o=this;o.id_form="l_navtable_preoperacional_otros_documentos",o.showContextMenu=!0,o.setTitle="Otros Documentos preoperacional",o.canvas=e,o.datos=a;return o.setColumns([{label:"ID",name:"id",visible:!1},{label:"Documento Adjunto url ",name:"adjunto",visible:!0},{style:{contenedor:"display: flex;"},label:"Documento:::  ",name:"adjunto_show",visible:!0,type:"image"}]),o.applyFilters(),o},destruct:function(){},members:{contextMenu:function(){var a=this,e=a.selectedRecord(),o=(console.log("data",e),new nw.contextmenu(this,"bottom"));nw.evalueData(e.id)||o.addAction("Quitar","nwmaker/img/baseline-create-24px.svg",function(e){a.eliminar()})},eliminar:function(){var e=this.selectedRecord();console.log("data",e),this.removeRow(this.activeRow)},applyFilters:function(){var i=this;if(console.log("self.datos",i.datos),!nw.evalueData(i.datos))return!1;var e=nw.userPolicies.getUserData(),a={},e=(a.conductor=e.usuario,a.empresa=e.empresa,a.id=i.datos.id,console.log("data",a),new nw.rpc(i.getRpcUrl(),"preoperacional"));e.setAsync(!0),e.setLoading(!1);e.exec("consultaPreoperacionalDocumentos",a,function(e){console.log("documentos",e);for(var a=0;a<e.length;a++){var o=e[a];o.adjunto=config.domain_rpc+o.adjunto}i.setModelData(e)})}}}),nw.Class.define("l_navtable_agregar_imagenes",{extend:nw.lists,construct:function(e,a,o){var i=this;i.id_form="l_navtable_agregar_imagenes",i.showContextMenu=!0,i.setTitle="Otras imágenes",i.canvas=e,i.datos=a,i.type=o;return i.setColumns([{label:"",name:"imagen",visible:!1},{label:"",name:"imagen_show",visible:!0,type:"image"}]),nw.evalueData(i.type)&&"ADJUNTOS_VIAJE"==i.type&&(i.showContextMenu=!1,i.applyFilters()),i},destruct:function(){},members:{contextMenu:function(){var a=this,e=a.selectedRecord(),o=(console.log("data",e),new nw.contextmenu(this,"bottom"));nw.evalueData(e.id)||o.addAction("Quitar","nwmaker/img/baseline-create-24px.svg",function(e){a.eliminar()})},eliminar:function(){var e=this.selectedRecord();console.log("data",e),this.removeRow(this.activeRow)},applyFilters:function(){var i=this;if(console.log("self.datos",i.datos),!nw.evalueData(i.datos))return!1;var e=nw.userPolicies.getUserData(),a={},e=(a.conductor=e.usuario,a.empresa=e.empresa,a.id=i.datos.id,a.id_service_initial=i.datos.id_service_initial,console.log("data",a),"preoperacional"),o="consultaPreoperacionalDocumentos",e=(nw.evalueData(i.type)&&"ADJUNTOS_VIAJE"==i.type&&(e="addPhotos",o="consultaFotosViaje"),new nw.rpc(i.getRpcUrl(),e));e.setAsync(!0),e.setLoading(!1);e.exec(o,a,function(e){for(var a=0;a<e.length;a++){var o=e[a];o.imagen_show=config.domain_rpc+o.imagen}console.log("documentos",e),i.setModelData(e)})}}}),nw.Class.define("l_vehiculos",{extend:nw.lists,construct:function(e){var o=this,a=!(o.showContextMenu=!0),e=(!0===(a=void 0!==e?e:a)?(o.canvas="#foo",o.id_form="l_vehiculos"):(o.id="l_vehiculos",o.setTitle=nw.tr("Mis vehículos"),o.html=nw.tr("Mis vehículos"),o.showBack=!0,o.closeBack=!1,o.textClose="Volver",o.colorBtnBackIOS="#ffffff;",o.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",o.createBase()),!1),a=[{name:"imagen_vehi_show",label:"",type:"image",visible:!0},{name:"id",label:"ID",visible:!0},{name:"mostrar_vehi",label:"",visible:!0},{name:"placa",label:"Placa"},{name:"vehiculo_publico_particular_text",label:"Vehículo público, particular o taxi",visible:!0},{name:"tipo_vehiculo",label:"Tipo Vehículo",visible:!1},{name:"capacidad_pasajeros",label:"Capacidad Pasajeros",visible:!1},{name:"numero_puertas",label:"Número Puertas",visible:!1},{name:"marca_text",label:"Marca",mode:"Marca",visible:!0},{name:"usuario_usando",label:"Usuario usando"},{name:"color",label:"Color",visible:!0},{name:"modelo",label:"Modelo",visible:!1},{name:"fecha_vencimiento_soat",label:"SOAT fecha vencimiento",mode:"date_format",visible:e="SI"===main.configCliente.soat?!0:e},{name:"tarjeta_propiedad",label:"Tarjeta de propiedad",visible:!1},{name:"no_licencia",label:"Numero de licencia",visible:!0},{name:"lic_conductor1",label:"Imagen de licencia frontal",visible:!1},{name:"lic_conductor2",label:"Imagen de licencia trasera",visible:!1},{name:"selfie_licencia",label:"Selfi de conductor y licencia",visible:!1},{name:"hoja_vida",label:"Hoja de vida",visible:!1},{name:"antecedentes_judiciales",label:"Antecedentes",visible:!1},{name:"foto_perfil",label:"Foto perfil",visible:!1},{name:"estado_activacion_text_text",label:"Estado"},{name:"activacion_cliente_text",label:"Activado cliente"},{name:"usar_vehiculo",label:"",type:"button"}];o.setColumns(a),o.buttons=[],o.buttons.push({icon:"material-icons add normal",position:"top",name:"nuevo",label:"",callback:function(){(new f_vehiculo).construct()}}),o.show();$(o.canvas).delegate(".rowName_usar_vehiculo","click",function(e,a){$(this.parentElement).trigger({type:"click"}),o.activarVehiculo()}),o.onAppear(function(){setTimeout(function(){o.applyFilters()},100)})},destruct:function(){},members:{contextMenu:function(){var a=this,o=(nw.userPolicies.getUserData(),a.selectedRecord()),e=new nw.contextmenu(this,"bottom");e.addAction("Ver","material-icons create normal",function(e){var a=new f_vehiculo;a.construct(o),a.populate(o),console.log(o)}),e.addAction("Usar Vehículo","material-icons create normal",function(e){a.activarVehiculo()})},clicRow:function(){},canvas:function(e){this.canvas=e},eliminar:function(a){var o=this;nw.dialog("¿Desea eliminar este vehículo?",function(){nw.loading({text:"Eliminando...",textVisible:!0,html:"",theme:"b",container:o.canvas});var e=new nw.rpc(o.getRpcUrl(),"vehiculo");e.setAsync(!0);e.exec("eliminarVehiculo",a,function(e){nw.loadingRemove({container:o.canvas}),nw.dialog("Eliminado correctamente"),main.misVehiculos()})},function(){})},activarVehiculo:function(){var e=nw.userPolicies.getUserData(),a=this.selectedRecord(),o=(console.log("up",e),console.log("selectedRecord",a),new Date),i=new Date(a.fecha_vencimiento_soat);i.setDate(i.getDate()+1),console.log(i),console.log(o),i<=o&&"SI"==main.configCliente.soat?nw.dialog("Se ha vencido o esta por vencer el SOAT de tu vehículo por favor actualiza los datos para poder continuar."):((i={}).usuario=e.usuario,i.id_usuario=e.id_usuario,i.empresa=e.empresa,i.id_vehiculo=a.id,i.placa=a.placa,(o=new nw.rpc(this.getRpcUrl(),"vehiculo")).setAsync(!0),o.exec("activarVehiculo",i,function(e){console.log(e),"NO"==e?nw.dialog("Lo sentimos. El vehículo aún no está activo, comunícate con el administrador"):nw.dialog("¡Vehículo en uso! Ahora podrás iniciar servicios con este vehículo.",function(){window.location.reload()})}))},applyFilters:function(){var c=this,s=nw.userPolicies.getUserData(),e={},l=(e.empresa=s.empresa,e.usuario=s.usuario,e.id_usuario=s.id_usuario,[]),d=[],u=[],a=(console.log("applyFilters:::sendData:::data",e),new nw.rpc(c.getRpcUrl(),"vehiculo"));a.setAsync(!0);a.exec("consulataVehiculos",e,function(e){console.log("applyFilters:::responseServer:::r",e),nw.loadingRemove({container:c.canvas}),c.clean();for(var a=0;a<e.length;a++){var o=e[a],i=(o.vehiculo_publico_particular_text=nw.tr(o.vehiculo_publico_particular),config.domain_rpc+nw.utils.getFileByType(o.imagen_vehi,100)),i=(e[a].imagen_vehi_show=i,o.estado_activacion_text=o.estado_activacion_text.replace("_"," ").toUpperCase(),o.estado_activacion_text_text=nw.tr(o.estado_activacion_text),o.activacion_cliente_text=nw.tr(o.activacion_cliente),new Date),n=new Date(o.fecha_vencimiento_soat);i.setDate(i.getDate()+5),n<=i?l.push({vencido:a}):"1"==o.estado_activacion?o.usuario_usando==s.usuario_cliente?d.push({activo_uso:a}):u.push({activo:a}):"2"==o.estado_activacion&&l.push({vencido:a}),e[a].usar_vehiculo="<i class='material-icons'>play_arrow</i> "+nw.tr("Usar para servicios")}if(c.setModelData(e),0<d.length&&($("#rowlist_"+d[0].activo_uso).css("cssText","background:rgb(47, 236, 145);"),$("#rowlist_"+d[0].activo_uso).append("<div style='width: 58%;position: absolute;bottom: 5px;right: 0;text-align: center;display: flex;justify-content: center;align-items: center;color: #1f1c1c;text-shadow: 0px 0px'> <i class='material-icons' style='margin-right: 6px;'>offline_pin</i>  "+nw.tr("En uso.")+"</div>")),0<u.length)for(var t=0;t<u.length;t++)$("#rowlist_"+u[t].activo).css("cssText","background:rgba(243, 184, 52, 0.42);"),$("#rowlist_"+u[t].activo).append("<div style='width: 58%;position: absolute;bottom: 5px;right: 0;text-align: center;display: flex;justify-content: center;align-items: center;color: #1f1c1c;text-shadow: 0px 0px'> <i class='material-icons' style='margin-right: 6px;'>highlight_off</i>    "+nw.tr("Sin usar.")+"</div>");if(0<l.length)for(var r=0;r<l.length;r++)$("#rowlist_"+l[r].vencido).css("cssText","background:#ff00006b;"),$("#rowlist_"+l[r].vencido).append("<div style='width: 69%;position: absolute;bottom: 5px;right: 0;text-align: center;display: flex;justify-content: center;align-items: center;color: red;text-shadow: 0px 0px'> <i class='material-icons' style='margin-right: 0px;'>priority_high</i>"+nw.tr("Revisa este vehículo.")+"</div>")})}}}),nw.Class.define("l_tarjetas_credito",{extend:nw.lists,construct:function(e){var a=this;a.showContextMenu=!0,a.id="l_tarjetas_credito",a.setTitle="Pagos",a.html="Mis tarjetas de crédito",a.showBack=!0,a.closeBack=!1,a.textClose="Atrás",a.createBase(),a.callback=e;a.setColumns([{name:"nombre",label:""}]),a.buttons=[],a.buttons.push({icon:"material-icons add_circle normal",position:"top",name:"nuevo",label:"Añadir nuevo",callback:function(){(new f_tarjetas_credito).construct()}}),a.applyFilters(),a.show()},destruct:function(){},members:{contextMenu:function(){var a=this,o=(nw.userPolicies.getUserData(),a.selectedRecord()),e=new nw.contextmenu(this,"bottom");nw.evalueData(a.callback)||e.addAction("Eliminar","material-icons delete normal",function(e){a.eliminar(o)})},clicRow:function(){var e=this.selectedRecord();nw.evalueData(this.callback)&&this.callback(e)},eliminar:function(a){var o=this;nw.dialog("¿Desea eliminar este registro?",function(){nw.loading({text:"Eliminando...",textVisible:!0,html:"",theme:"b",container:o.canvas});var e=new nw.rpc(o.getRpcUrl(),"nwMaker");e.setAsync(!0);e.exec("eliminarCreditCard",a,function(e){nw.loadingRemove({container:o.canvas}),nw.dialog("Eliminado correctamente"),(new l_tarjetas_credito).construct()})},function(){})},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o=(nw.loading({text:"Cargando visitas...",textVisible:!0,html:"",theme:"b",container:a.canvas}),{}),e=(o.usuario=e.usuario,new nw.rpc(a.getRpcUrl(),"nwMaker"));e.setAsync(!0);e.exec("myCreditsCards",o,function(e){console.log(e),nw.loadingRemove({container:a.canvas}),a.setModelData(e)})}}}),nw.Class.define("l_navtable_otros_documentos",{extend:nw.lists,construct:function(e,a){var o=this;o.id_form="l_navtable_otros_documentos",o.showContextMenu=!0,o.setTitle="Otros Documentos",o.canvas=e,o.datos=a,console.log(o.canvas);return o.setColumns([{label:"ID",name:"id",visible:!1},{style:{contenedor:"display: flex;"},label:"Documento Adjunto: ",name:"adjunto",visible:!0,type:"image"},{label:"Nombre Documento",name:"nombre",visible:!0},{label:"Fecha",name:"fecha",visible:!0},{label:"Usuario",name:"usuario"}]),o.clicRow=function(){var e=o.selectedRecord();console.log(e)},o.applyFilters(),o},destruct:function(){},members:{contextMenu:function(){var a=this;new nw.contextmenu(this,"bottom").addAction("Eliminar","nwmaker/img/baseline-create-24px.svg",function(e){a.eliminar()})},eliminar:function(){var o=this;nw.dialog("¿Esta seguro de eliminar este documento?",function(){var e=nw.userPolicies.getUserData(),a=o.selectedRecord(),e=(a.conductor=e.usuario,a.empresa=e.empresa,new nw.rpc(o.getRpcUrl(),"vehiculo"));e.setAsync(!0);e.exec("borrarDocumento",a,function(e){o.applyFilters(e)})},function(){})},applyFilters:function(){var i=this,e=nw.userPolicies.getUserData(),a={},e=(console.log(e),a.conductor=e.usuario,a.empresa=e.empresa,new nw.rpc(i.getRpcUrl(),"vehiculo"));e.setAsync(!0),e.setLoading(!1);e.exec("populateDocumentos_otros",a,function(e){console.log(e);for(var a=0;a<e.length;a++){var o=e[a];o.adjunto=config.domain_rpc+o.adjunto}i.setModelData(e)})}}}),nw.Class.define("l_preoperacional",{extend:nw.lists,construct:function(){var e=this;e.configCliente=main.configCliente,e.showContextMenu=!0,e.id="l_preoperacional",e.setTitle=nw.tr("Pre-operacional"),e.html=nw.tr("Pre-operacional"),e.showBack=!0,e.closeBack=!1,e.textClose="Volver",e.createBase();e.setColumns([{name:"id",label:"ID",visible:!1},{name:"fecha",label:"Fecha"},{name:"marca",label:"Marca"},{name:"tipo",label:"Tipo"},{name:"placa",label:"Placa"},{name:"modelo",label:"Modelo"},{name:"observaciones",label:"Observaciones"}]),e.show(),e.onAppear(function(){setTimeout(function(){e.applyFilters()},100)})},destruct:function(){},members:{contextMenu:function(){var o=this,i=(nw.userPolicies.getUserData(),o.selectedRecord());new nw.contextmenu(this,"bottom").addAction("Ver Pre-operacional","material-icons create normal",function(e){var a=new f_preoperacional;a.construct(o,i),a.populate(i),a.disabledAll(),setTimeout(function(){document.querySelector(".f_preoperacional .aceptar").remove()},1e3)})},clicRow:function(){},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,o.empresa=e.empresa,new nw.rpc(a.getRpcUrl(),"preoperacional"));e.setAsync(!0),e.setLoading(!0);e.exec("consultaPreoperacionalApp",o,function(e){console.log(e),a.setModelData(e)})}}}),nw.Class.define("main",{extend:nw.menu,construct:function(){var a=this,o=(a.androidMinVersionPermissions=13,console.log("device",device),nw.console.log("device",device),"undefined"!=typeof newRouteRelease?a.carpet_files_extern=newRouteRelease+"/driver/":a.carpet_files_extern="/lib_mobile/driver/",console.log("self.carpet_files_extern:::",a.carpet_files_extern),config.addTextInAccountOtherData="",config.addButtonsInAccountOtherData=[],main.sumAddbtns=-1,"undefined"!=typeof device&&void 0!==device.version&&(config.addTextInAccountOtherData+="<br />Versión OS: "+device.version),nw.userPolicies.getUserData()),e=nw.utils.getMobileOperatingSystem();console.log("os",e),a.debugConstruct=!1,a.show_services=[],a.configCliente=[],main.selfMapaDriver={},main.selfMapaDriver.serviceActive=!1,main.selfMapaDriver.serviceActive=!1,main.selfMapaDriver.data_service=!1,"IOS"===e&&(e=parseInt(config.version_in_this_device),e=config.domain_rpc+a.carpet_files_extern+"css/iphone.css?v="+e,console.log("styles:::",e),(n=document.createElement("link")).rel="stylesheet",n.type="text/css",n.href=e,document.getElementsByTagName("head")[0].appendChild(n));nw.isOnline()||nw.dialog("Por favor verifique su conexión a internet");e=document.createElement("style");if(e.innerHTML=".InfoIdService, .infoServiceCompany{color: #656363; text-align: left; font-size: 14px;}",document.body.appendChild(e),nw.evalueData(o.servicios_activos)&&"NO"!==o.servicios_activos){var i=JSON.parse(o.servicios_activos),n=document.createElement("div"),t=(n.className="dataServicesEnc","");nw.utils.evalueData(o.placa_activa)&&(t+="<div class='placaActivaSpan'><i class='material-icons'>directions_car</i> "+nw.tr("Placa en uso")+": <span class='placaActivaSpanText'>"+o.placa_activa+"</span></div>"),t+="<i class='material-icons'>room_service</i> "+nw.tr("Servicios activos")+": ";for(var r=0;r<i.length;r++){var c=i[r];t+="<span class='serviceSpan'>"+c.nombre+" ("+c.id+")</span>, "}n.innerHTML=t,document.querySelector(".dataUserLeft").appendChild(n)}a.configuracionServi(function(){if(("SI"===a.configCliente.usa_bloqueo_conductores&&a.initBloqueoApp(),"SI"===a.configCliente.pide_documentos_conductores)&&(!1===nw.evalueData(o.foto_perfil)||"false"===o.foto_perfil))return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".containMapAndOpened").remove(),(new f_documentos_conductor).construct(!1,!0),nw.dialog("<h1 class='titlevehione'>"+nw.tr("Por favor ingrese los documentos de conducción")+"</h1>"),main.removeLoadingInitial(),!1;"SI"===a.configCliente.pide_vehiculo_conductores||"SI"===o.rechazado?a.datosVehiculos(function(e){if(console.log("initVehiculo:::d",e),!1===e||!0===e&&"SI"===o.rechazado)return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".containMapAndOpened").remove(),(new f_vehiculo).construct(!1,!0),nw.dialog(nw.tr("Para continuar debe registrar un vehículo.")),main.removeLoadingInitial(),!1;if(!nw.evalueData(a.vehiculo.id)||"1"!=e.estado_activacion.toString())return $(".containMapAndOpened").remove(),nw.tr("Ir a mis vehículos"),nw.dialog(nw.tr("Lo sentimos, para continuar, debe tener activo y aprobado un vehículo.")),(e=new l_vehiculos).construct(!0),main.removeLoadingInitial(),e;a.initHome()}):a.initHome(),"SI"===a.configCliente.usa_banners_promo&&setTimeout(function(){nw.getPromotionsApp()},5e3)})},destruct:function(){},members:{selfCrearViaje:null,selfMapaDriver:null,id_service_active:null,vehiculo:{id:null,marca_text:null,placa:null,color:null},configCliente:null,cobro_con:null,addBtnAccount:function(a,o,i,n){main.sumAddbtns=main.sumAddbtns+1,config.addButtonsInAccountOtherData[main.sumAddbtns]=function(){var e="material-icons "+i+" normal false",e=nw.generateLink(nw.tr(a),n,"center",0,nw.tr(o),e,"lists_simple","btn_others_account");nw.appendLinkMenu(e,".menuProfile")}},permissionsInDevice:function(i){var n,e,t=this;console.log("device",device),nw.console.log("device",device),console.log("parseInt(device.version)",parseInt(device.version)),t.allPermissionGranted=!0,void 0!==nw.permissions&&parseInt(device.version)>=t.androidMinVersionPermissions?(nw.remove(".div_container_skips_notificacions"),nw.remove(".popup_intered_permissions"),(n=document.createElement("div")).className="div_container_skips_notificacions",document.body.appendChild(n),nw.permissions.get("ACCESS_FINE_LOCATION","Por favor activa la ubicación precisa para poder ubicarte en el mapa",function(e,a){console.log("response",e),console.log("text",a);var o="<span style='color: green;'>"+nw.tr("Permiso concedido ubicación precisa.")+"</span>";"rejected"!==e&&"skip"!==e||(t.allPermissionGranted=!1,o="<span style='color: red;'>"+nw.tr("Denegaste/omitiste la ubicación precisa, podrías presentar problemas de ubicación.")+"</span>",(e=document.createElement("div")).className="popup_intered_permissions",e.innerHTML=nw.tr("La ubicación precisa está actualmente desactivada, toca para activarla."),e.onclick=function(){this.remove(),window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})},n.appendChild(e)),config.addTextInAccountOtherData+="<br />"+o,t.addBtnAccount("Ubicación","Configurar permisos de ubicación","edit_location",function(){window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})}),t.savePerm(a),nw.permissions.get("POST_NOTIFICATIONS",nw.tr("Por favor activa las notificaciones para recibir mensajes de chat, nuevos servicios y otros"),function(e,a){console.log("response",e),console.log("text",a);var o="<span style='color: green;'>"+nw.tr("Permiso concedido notificaciones.")+"</span>";"rejected"!==e&&"skip"!==e||(t.allPermissionGranted=!1,o="<span style='color: red;'>"+nw.tr("Denegaste las notificaciones, podrías presentar problemas de comunicación.")+"</span>",(e=document.createElement("div")).className="popup_intered_permissions",e.innerHTML=nw.tr("Las notificaciones están actualmente desactivadas, toca para activarlas."),e.onclick=function(){this.remove(),window.cordova.plugins.settings.open("notification_id",function(){console.log("opened settings")},function(){console.log("failed to open settings")})},n.appendChild(e)),config.addTextInAccountOtherData+="<br />"+o,t.addBtnAccount("Notificaciones","Configurar permisos de notificaciones","notifications",function(){window.cordova.plugins.settings.open("notification_id",function(){console.log("opened settings")},function(){console.log("failed to open settings")})}),t.savePerm(a),nw.permissions.get("ACCESS_BACKGROUND_LOCATION",nw.tr("Por favor activa la ubicación en segundo plano"),function(e,a){console.log("response",e),console.log("text",a);var o="<span style='color: green;'>"+nw.tr("Permiso concedido ubicación en segundo plano.")+"</span>";"rejected"!==e&&"skip"!==e||(t.allPermissionGranted=!1,o="<span style='color: red;'>"+nw.tr("Denegaste/omitiste la ubicación en segundo plano, podrías presentar problemas de ubicación.")+"</span>",(e=document.createElement("div")).className="popup_intered_permissions",e.innerHTML=nw.tr("La ubicación en segundo plano está actualmente desactivada, toca para activarla."),e.onclick=function(){this.remove(),window.cordova.plugins.settings.open("location",function(){console.log("opened settings")},function(){console.log("failed to open settings")})},n.appendChild(e)),void 0!==app.startBackgroundQuestion&&app.startBackgroundQuestion(),config.addTextInAccountOtherData+="<br />"+o,t.addBtnAccount("Ubicación segundo plano","Configurar permisos de ubicación en segundo plano","edit_location",function(){window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})}),t.savePerm(a),void 0!==i&&i(),console.log("self.allPermissionGranted",t.allPermissionGranted),t.allPermissionGranted},function(){window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})})},function(){window.cordova.plugins.settings.open("notification_id",function(){console.log("opened settings")},function(){console.log("failed to open settings")})})},function(){window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})})):(void 0!==app.startBackgroundQuestion&&app.startBackgroundQuestion(),e=nw.userPolicies.getUserData(),"IOS"!=nw.utils.getMobileOperatingSystem()&&void 0!==cordova.plugins&&void 0!==cordova.plugins.diagnostic&&(cordova.plugins.diagnostic.requestRuntimePermissions(function(e){for(var a in console.log("statuses",e),e)switch(e[a]){case cordova.plugins.diagnostic.permissionStatus.GRANTED:console.log("Permission granted to use "+a);break;case cordova.plugins.diagnostic.permissionStatus.NOT_REQUESTED:console.log("Permission to use "+a+" has not been requested yet");break;case cordova.plugins.diagnostic.permissionStatus.DENIED:console.log("Permission denied to use "+a+" - ask again?");break;case cordova.plugins.diagnostic.permissionStatus.DENIED_ALWAYS:console.log("Permission permanently denied to use "+a+" - guess we won't be using it then!")}t.savePerm(JSON.stringify(e))},function(e){console.log("The following error occurred: ",e),t.savePerm(e)},[cordova.plugins.diagnostic.permission.RECEIVE_WAP_PUSH,cordova.plugins.diagnostic.permission.MANAGE_EXTERNAL_STORAGE,cordova.plugins.diagnostic.permission.READ_MEDIA_IMAGES,cordova.plugins.diagnostic.permission.READ_MEDIA_VIDEO,cordova.plugins.diagnostic.permission.WRITE_EXTERNAL_STORAGE,cordova.plugins.diagnostic.permission.ACCESS_COARSE_LOCATION,cordova.plugins.diagnostic.permission.ACCESS_FINE_LOCATION,cordova.plugins.diagnostic.permission.ACCESS_MEDIA_LOCATION,cordova.plugins.diagnostic.permission.ACCESS_BACKGROUND_LOCATION,cordova.plugins.diagnostic.permission.POST_NOTIFICATIONS,cordova.plugins.diagnostic.permission.CAMERA,cordova.plugins.diagnostic.permission.READ_EXTERNAL_STORAGE,cordova.plugins.diagnostic.permission.SAVE_TO_ALBUM_SEC,cordova.plugins.diagnostic.permission.READ_PHONE_STATE]),cordova.plugins.diagnostic.requestCameraAuthorization(function(e){console.log("Authorization request for camera use was "+(e==cordova.plugins.diagnostic.permissionStatus.GRANTED?"granted":"denied"))},function(e){console.error("The following error occurred: "+e)},!1),cordova.plugins.diagnostic.isRemoteNotificationsEnabled(function(){},function(){}),cordova.plugins.diagnostic.requestExternalStorageAuthorization(function(e){var a=e==cordova.plugins.diagnostic.permissionStatus.GRANTED?"granted":"denied";console.log("requestExternalStorageAuthorization:::estado",a),console.log("Authorization request for external storage use was "+(e==cordova.plugins.diagnostic.permissionStatus.GRANTED?"granted":"denied"))},function(e){console.error("cordova.plugins.diagnostic.requestExternalStorageAuthorization",e)}),cordova.plugins.diagnostic.getExternalStorageAuthorizationStatus(function(e){e===cordova.plugins.diagnostic.permissionStatus.GRANTED&&console.log("External storage use is authorized")},function(e){console.error("The following error occurred: "+e)}),cordova.plugins.diagnostic.isExternalStorageAuthorized(function(e){console.log("App is "+(e?"authorized":"denied")+" access to the external storage")},function(e){console.error("The following error occurred: "+e)})),void 0!==cordova.plugins&&void 0!==cordova.plugins.firebase&&void 0!==cordova.plugins.firebase.messaging&&cordova.plugins.firebase.messaging.requestPermission({forceShow:!1}).then(function(e){console.log("Push messaging is allowed",e)}).catch(function(e){console.log("Error: "+e)}),nw.getPermission(["android.permission.POST_NOTIFICATIONS","android.permission.RECEIVE_WAP_PUSH","android.permission.READ_MEDIA_IMAGES","android.permission.READ_MEDIA_VIDEO","android.permission.ACTIVITY_RECOGNITION","android.permission.ACCESS_FINE_LOCATION","android.permission.ACCESS_COARSE_LOCATION","android.permission.READ_PHONE_STATE","android.permission.READ_EXTERNAL_STORAGE","android.permission.SAVE_TO_ALBUM_SEC","android.permission.RECORD_VIDEO","android.permission.WRITE_EXTERNAL_STORAGE","android.permission.ACCESS_WIFI_STATE","android.permission.ACCESS_NETWORK_STATE","android.permission.RECORD_AUDIO","android.permission.MODIFY_AUDIO_SETTINGS","android.permission.FLASHLIGHT","android.permission.RECORD_AUDIO","android.permission.CAMERA","android.permission.MICROPHONE"],function(){console.log("Permisos concedidos")}),nw.getPermission(["android.permission.POST_NOTIFICATIONS"],function(e){e?console.log("Permisos concedidos noti"):console.log("NO Permisos concedidos noti"),nw.getPermission(["android.permission.ACCESS_FINE_LOCATION"],function(){console.log("Permisos concedidos"),void 0!==i&&i()})}),void 0!==cordova.plugins&&void 0!==cordova.plugins.notification&&(cordova.plugins.notification.local.setDummyNotifications(),cordova.plugins.notification.local.hasPermission(function(e){}),cordova.plugins.notification.local.requestPermission(function(e){}),cordova.plugins.notification.local.schedule({title:"¡Bienvenido!",text:"Hola "+e.nombre,foreground:!0})),void 0!==i&&i())},savePerm:function(a){var e=nw.userPolicies.getUserData(),o=nw.utils.getMobileOperatingSystem(),i="NO",n=(nw.utils.evalueData(window.localStorage.getItem("userPermissionsSet"))&&(console.log("text",a),console.log("window.localStorage.getItem(userPermissionsSet)",window.localStorage.getItem("userPermissionsSet")),window.localStorage.getItem("userPermissionsSet")==a)&&(i="SI"),{}),e=(n.usuario=e.usuario,n.empresa=e.empresa,n.perfil=e.perfil,n.os=o,n.text=a,n.actualizar=i,n.token=null,nw.evalueData(window.localStorage.getItem("token"))&&(n.token=window.localStorage.getItem("token")),new nw.rpc(nw.getRpcUrl(),"app_user"));e.setAsync(!0),e.setLoading(!1),console.log("savePermisos:::dataSend",n);e.exec("savePermisos",n,function(e){window.localStorage.setItem("userPermissionsSet",a),console.log("savePermisos:::responseServer",e)})},loadInitFirebase:function(){var e=this,a=(nw.userPolicies.getUserData(),"NO"),o=("SI"==main.configCliente.usa_firebase&&(a="SI"),!1),i=config.domain_rpc,i=nw.utils.str_replace("/","",i),n=(i=nw.utils.str_replace("//","",i),i=nw.utils.str_replace(":","",i),i=nw.utils.str_replace("https","",i),i=nw.utils.str_replace("http","",i),console.log("domain",i),!1);if("app.movilmove.com"!=i&&"app.transfershcy.com"!=i||(o=nw.tr("PRODUCCIÓN"),n={apiKey:"AIzaSyCANJzxDNeSj-MFeOdEtOEmapAiR0r5Yvw",authDomain:"movilmove-services.firebaseapp.com",projectId:"movilmove-services",storageBucket:"movilmove-services.appspot.com",messagingSenderId:"766196491813",appId:"1:766196491813:web:9f1e67fa80f885094d01cc"}),"test.movilmove.com"!=i&&"ultimamilla.sitca.co"!=i&&"eu.movilmove.com"!=i&&"192.168.1.45"!=i&&"movilmove.loc"!=i&&"192.168.1.7"!=i||(o=nw.tr("PRUEBAS"),n={apiKey:"AIzaSyDficCW6wxBnN_9uuwrp7yUBQVukXmhMBg",authDomain:"movilmove-services-test.firebaseapp.com",projectId:"movilmove-services-test",storageBucket:"movilmove-services-test.appspot.com",messagingSenderId:"496616900417",appId:"1:496616900417:web:13ae352d745983daed03c0"}),!o||!n)return nw.utils.dialog("NO puede activar Firebase en este dominio "+i+". No autorizado."),!1;config.addTextInAccountOtherData+="<br />"+("¡Realtime active (LoadServices: "+a+") in mode "+o+"! "+i),nw.firebase.load(n,function(){"SI"==main.configCliente.usa_firebase&&e.getServiceInFirebase(),e.getNotificationsInFirebase()})},readNotificationsInFirebase:function(e){var a=nw.userPolicies.getUserData(),o=(console.log("datarow",e),{});o.collection=e.collection,o.document=e.document,o.fields={},o.fields["open_"+nw.utils.cleanUserNwC(a.usuario)]="SI",o.fields["count_"+nw.utils.cleanUserNwC(a.usuario)]=0,nw.firebase.update(o)},getNotificationsInFirebase:function(){var r=this,c=(nw.utils.createContainerNotifications(),app.readNotificationsInFirebase=r.readNotificationsInFirebase,nw.userPolicies.getUserData()),e={table:"chats"};e.where_array=[],e.where_array[0]={variable:"empresa",operator:"==",equal:c.empresa},e.where_array[1]={variable:"usuarios",operator:"array-contains",equal:c.usuario},e.limit=20,e.order=!0,e.orderField="date",e.orderAscDesc="desc",e.getModelData=!1,e.destroyQuery=!1,e.callback=function(e,a,o){a.docChanges().forEach(function(e){for(var a,o=e.doc.data(),i=(console.warn("getNotificationsInFirebase:::data:::change.type",e.type,o),document.querySelector(".framechat_conversation_"+o.room)),n=0;n<o.usuarios_more_data.length;n++){var t=o.usuarios_more_data[n];t.usuario!=c.usuario&&(o.title=t.nombre,o.envia_foto=t.foto)}for(a in o.others="Servicio#"+o.id_viaje+" para el "+o.id_servicio_fecha+" "+o.id_servicio_hora+" (Room "+o.room+")",nw.utils.evalueData(o.all_data_travel)&&nw.utils.evalueData(o.all_data_travel.placa)&&(o.others+=" - Placa "+o.all_data_travel.placa),o)a=="count_"+nw.utils.cleanUserNwC(c.usuario)&&(o.count=o["count_"+nw.utils.cleanUserNwC(c.usuario)]),a=="total_"+nw.utils.cleanUserNwC(c.usuario)&&(o.total=o["total_"+nw.utils.cleanUserNwC(c.usuario)]),a=="open_"+nw.utils.cleanUserNwC(c.usuario)&&(o.open=o["open_"+nw.utils.cleanUserNwC(c.usuario)]);i?r.readNotificationsInFirebase(o):nw.utils.addBellNewNotification(o,e.type),o.callback=function(e){var a;console.log("da",e),"chat_principal"==e.type?main.contextMenuServiceFirebase({id:e.id_viaje}):((a={}).id=e.room,a.cliente_nombre=e.title,(new f_chat).construct(a))},nw.utils.addNewNotification(o)})},nw.firebase.select(e)},getServiceInFirebase:function(){if("SI"==main.configCliente.usa_firebase){if("NO"==main.configCliente.usa_firebase_account)return!1;var i=this,n=main.driver,e=nw.userPolicies.getUserData(),a=(nw.utilsDate.getActualFullDate(),{table:"servicios"}),o=0;if(a.where_array=[],a.where_array[o]={variable:"empresa",operator:"==",equal:e.empresa},a.where_array[o+=1]={variable:"estado",operator:"==",equal:"SOLICITUD"},"SI"==main.configCliente.tomarServiciosReservadosAutomatic)a.where_array[o+=1]={variable:"conductor_usuario",operator:"==",equal:e.usuario};else{if(nw.utils.evalueData(e.servicios_activos)){for(var t=JSON.parse(e.servicios_activos),r=[],c=0;c<t.length;c++)r.push(t[c].id);console.log("servs",r)}a.where_array[o+=1]={variable:"conductores_disponibles",operator:"array-contains",equal:e.usuario}}a.limit=10,a.order=!0,a.orderField="fecha",a.orderAscDesc="desc",a.orderField2=["hora","desc"],a.getModelData=!1,a.destroyQuery=!1,a.callback=function(e,a,o){console.log("snapshot.empty",a.empty),a.docChanges().forEach(function(e){var a=e.doc.data(),o=document.querySelector(".newServiceBar_"+a.id);o&&nw.remove(o),"added"!=e.type&&"modified"!=e.type||(console.log("%c<<<<FIREBASE_GET_SERVICES_SOLICITUD::: change.type "+e.type+" - ID: "+a.id+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("change.type:::data",e.type,a),"CONDUCTOR_ASIGNADO"!=a.estado&&"CONDUCTOR_REASIGNADO"!=a.estado||(a.estado="SOLICITUD"),i.validaRechazados(a)&&n.constructServiceSolicitud(a))})},nw.firebase.select(a)}},validaServicioActivoFirebase:function(){if("SI"==main.configCliente.usa_firebase){if("NO"==main.configCliente.usa_firebase_account)return!1;var i=main.driver,e=nw.userPolicies.getUserData(),a={table:"servicios"};a.where_array=[],a.where_array[0]={variable:"empresa",operator:"==",equal:e.empresa},a.where_array[1]={variable:"conductor_id",operator:"==",equal:e.id_usuario},a.where_array[2]={variable:"estado",operator:"in",equal:["EN_RUTA","ABORDO","EN_SITIO","CANCELADO_POR_USUARIO"]},a.where_array[3]={variable:"calificacion_cliente",operator:"==",equal:null},a.limit=1,a.order=!0,a.orderField="id",a.orderAscDesc="desc",a.getModelData=!1,a.destroyQuery=!1,a.callback=function(e,a,o){a.docChanges().forEach(function(e){var a=e.doc.data();console.log("%c<<<<FIREBASE_GET_SERVICES_ACTIVES::: change.type "+e.type+" - ID: "+a.id+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("change.type:::data",e.type,a),i.validaServiceActive(!1,function(){},a)})},nw.firebase.select(a)}},validaRechazados:function(e){if(!main.driver.searchServiceMostrado(e.id))return!1;if(!nw.utils.evalueData(window.localStorage.getItem("addRechazadoServiceMostrado")))return!0;for(var a=window.localStorage.getItem("addRechazadoServiceMostrado"),a=JSON.parse(a),o=!0,i=0;i<a.length;i++)a[i].id==e.id&&(o=!1);return o},registerServiceInFirebase:function(e,t){if("NO"==main.configCliente.usa_firebase_account)return!1;var a=nw.userPolicies.getUserData(),o=(e=e.toString(),{}),e=(o.ids=e.split("#"),o.empresa=a.empresa,console.log("registerInFirebase:::sendData",o),new nw.rpc(nw.getRpcUrl(),"servicios_admin"));e.setAsync(!0),e.setLoading(!1);e.exec("getTravelsForFirebase",o,function(e){console.log("registerInFirebase:::responseServer",e);for(var a=0;a<e.length;a++){var o,i=e[a],n=(console.log("ra",i),{});for(o in n.collection="servicios",n.document=i.id,i)n[o]=i[o];nw.firebase.set(n),console.log("%c<<<<FIREBASE_REGISTER_SERVICE::: ID: "+i.id+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("p:::data",n),void 0!==t&&t(n)}})},updateOnlyFieldsServiceInFirebase:function(e,a){if("NO"==main.configCliente.usa_firebase_account)return!1;var o,i={collection:"servicios"};for(o in i.document=e,i.fields={},a)i.fields[o]=a[o];nw.firebase.update(i),console.log("%c<<<<FIREBASE_UPDATE_ONLY_FIELD_SERVICE::: ID: "+e+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("ra:::data",a)},saveOfertaServiceInFirebase:function(i,n){if("NO"==main.configCliente.usa_firebase_account)return!1;var e=nw.userPolicies.getUserData(),a={},e=(a.id=i,a.empresa=e.empresa,console.log("saveOfertaServiceInFirebase:::sendData",a),new nw.rpc(nw.getRpcUrl(),"servicios_admin"));e.setAsync(!0),e.setLoading(!1);e.exec("getOffersByTravelsForFirebase",a,function(e){console.log("saveOfertaServiceInFirebase:::responseServer",e);var a,o={collection:"servicios_ofertas"};for(a in o.document=i.toString(),e)o[a]=e[a];nw.firebase.set(o),setTimeout(function(){n()},1e3),console.log("%c<<<<FIREBASE_SAVE_OFERTA::: ID: "+i+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("p:::data",o)})},destroyQueryOfertas:function(){"undefined"!=typeof queryGetOffers&&queryGetOffers()},destroyRadar:function(){var e;document.querySelector(".stylenoradar")||((e=document.createElement("style")).innerHTML=".cont-radar{display:none!important;}",e.className="stylenoradar",document.body.appendChild(e))},contextMenuServiceFirebase:function(a){var o=this,e=(console.log("data",a),new nw.contextmenu(this,"bottom"));e.addAction("Paradas o pasajeros adicionales","material-icons streetview normal",function(e){main.editaParadasAdicionales(a)}),e.addAction("Ampliar","material-icons info normal",function(e){main.ampliar(a,function(){o.iniciar()})},function(){o.cancelarServicio()}),"SI"===main.configCliente.ver_voucher&&e.addAction("Ver Voucher","material-icons info normal",function(e){main.imprimir("VER_VOUCHER",a.id)}),"SI"===main.configCliente.ver_cartel_vuelo&&e.addAction("Ver Cartel de Vuelo","material-icons info normal",function(e){main.imprimir("CARTEL_VUELO",a.id)}),"SI"===main.configCliente.pide_fuec&&e.addAction("Ver FUEC","nwmaker/img/baseline-create-24px.svg",function(e){main.verFuec(a)}),"reservado"===a.tipo_servicio&&("SI"!==o.configCliente.cancela_conductor||"SOLICITUD"!==a.estado&&"ACEPTADO_RESERVA"!==a.estado||e.addAction("Cancelar","nwmaker/img/baseline-create-24px.svg",function(e){o.cancelarServicio()}),"ACEPTADO_RESERVA"===a.estado)&&e.addAction("Iniciar servicio","nwmaker/img/baseline-create-24px.svg",function(e){o.iniciarViaje()})},onBackgroundModeNew:function(){if(console.log("typeof BackgroundGeolocation",typeof BackgroundGeolocation),"undefined"==typeof BackgroundGeolocation)return!1;var o=nw.userPolicies.getUserData(),e=new nw.geolocationBackground;e.construct(),e.optionsDefault={},e.optionsDefault.debug=!1,e.optionsDefault.interval=5e3,e.optionsDefault.fastestInterval=1e3,e.optionsDefault.activitiesInterval=1e4,e.optionsDefault.locationProvider=BackgroundGeolocation.DISTANCE_FILTER_PROVIDER,e.optionsDefault.desiredAccuracy=BackgroundGeolocation.HIGH_ACCURACY,e.optionsDefault.stationaryRadius=0,e.optionsDefault.distanceFilter=0,e.optionsDefault.stopOnStillActivity=!1,e.optionsDefault.notificationsEnabled=!0,e.optionsDefault.stopOnTerminate=!1,e.optionsDefault.startOnBoot=!0,e.optionsDefault.startForeground=!0,e.optionsDefault.notificationTitle=config.name+" Seguimiento en segundo plano",e.optionsDefault.notificationText=config.name+" Seguimiento en segundo plano",e.configure(),console.log("%cBackgroundGeolocation.headlessTask","background: #ff3366; color: #fff"),console.log("event",event),e.http_authorization(function(){}),e.abort_requested(function(){}),e.onForeground(function(){}),e.onBackground(function(){}),e.onAuthorization(function(){});e.onLocation(!1,function(e){console.log("%cBackgroundGeolocation.location","background: #ff3366; color: #fff"),console.log("%cBackgroundGeolocation.location:::location",e),console.log("main.selfMapaDriver.serviceActive",main.selfMapaDriver.serviceActive),console.log("main.selfMapaDriver.data_service",main.selfMapaDriver.data_service),console.log("up",o);var e={lat:"@latitude",lon:"@longitude"},a=(e.fecha=nw.utilsDate.getActualFullDate(),e.perfil=o.perfil,e.empresa=o.empresa,e.id_usuario=o.id_usuario,e.usuario=o.usuario,nw.utils.evalueData(main.selfMapaDriver.data_service)&&0!=main.selfMapaDriver.serviceActive?(e.serviceActive=main.selfMapaDriver.serviceActive,e.data_service=main.selfMapaDriver.data_service,e.tipo=main.selfMapaDriver.data_service.estado,nw.utils.evalueData(main.selfMapaDriver.data_service.placa)&&(e.placa=main.selfMapaDriver.data_service.placa)):nw.utils.evalueData(o.placa_activa)&&(e.placa=o.placa_activa),console.log("data",e),console.log("%cBackgroundGeolocation.location","background: #ff3366; color: #fff"),new nw.rpc(nw.getRpcUrl(),"locationBackground"));a.setAsync(!0),a.setLoading(!1);a.exec("saveLocation",e,function(e){console.log("main.selfMapaDriver.responseServer",e)})}),e.checkStatus(function(){}),e.onStationary(function(){}),e.onStart(function(){}),e.onError(function(){}),e.onStop(function(){})},resolvePreoperacional:function(){var a=nw.utilsDate.getActualDate(),o=nw.utils.replace("-","",a);if(nw.utils.evalueData(main.configCliente.usar_preoperacional_dynamic)&&"SI"==main.configCliente.usar_preoperacional_dynamic)return void(new f_preoperacional_dynamic).construct(!1,!1,function(e){window.localStorage.setItem("preoperacional_hoy_"+o,a),nw.changePage(""),window.location.reload()},!0);(new f_preoperacional).construct(!1,!1,function(e){window.localStorage.setItem("preoperacional_hoy_"+o,a),nw.changePage(""),window.location.reload()},!0)},configuracionServi:function(a){var o=this;if(nw.utils.evalueData(window.localStorage.getItem("configurationInitAccountMovilmove"))&&nw.utils.evalueData(window.localStorage.getItem("lastVersionCacheCloud"))){var e=window.localStorage.getItem("configurationInitAccountMovilmove"),e=JSON.parse(e),i=window.localStorage.getItem("version_in_this_device"),n=window.localStorage.getItem("lastVersionCacheCloud");if(console.log("versionCache",n),console.log("cacheStorage",i),console.log("cacheStorage.split(-)[0]",i.split("-")[0]),i.split("-")[0]==n)return console.log("configuracionServi:::responseServer",e),o.configuracionServiContinue(e,a),console.log("configuracionServi local"),config.addTextInAccountOtherData+="<br />Configuration Movilmove from cache. ",!0}config.addTextInAccountOtherData+="<br />Configuration Movilmove from Cloud. ";i=nw.userPolicies.getUserData(),n={},n.empresa=i.empresa,e=new nw.rpc(nw.getRpcUrl(),"servicios");e.setAsync(!0),e.setLoading(!0),console.log("configuracionServi:::dataSendServer",n);e.exec("consultaConfiguracion",n,function(e){console.log("configuracionServi:::responseServer",e),console.log("configuracionServi cloud"),window.localStorage.setItem("configurationInitAccountMovilmove",JSON.stringify(e)),o.configuracionServiContinue(e,a)})},configuracionServiContinue:function(e,a){nw.userPolicies.getUserData();main.cobro_con=e.cobro_con,main.configCliente=e,nw.utils.evalueData(main.configCliente.paymentStore)&&(config.paymentStore=main.configCliente.paymentStore),nw.utils.evalueData(main.configCliente.privateKeyEpayco)&&(config.privateKeyEpayco=main.configCliente.privateKeyEpayco),nw.utils.evalueData(main.configCliente.apiKeyEpayco)&&(config.apiKeyEpayco=main.configCliente.apiKeyEpayco),nw.utils.evalueData(main.configCliente.keyGoogleNotificacionPush)&&(config.keyGoogleNotificacionPush=main.configCliente.keyGoogleNotificacionPush),void 0!==a&&a(),nw.evalueData(e.css_app_driver)&&((a=document.createElement("style")).className="css_app_driver",a.innerHTML=e.css_app_driver,document.body.appendChild(a))},initHome:function(){var n=this,t=nw.userPolicies.getUserData();if(nw.utils.evalueData(window.localStorage.getItem("userDriverActive"))&&"SI"==window.localStorage.getItem("userDriverActive"))return r(),!0;function r(){"SI"===main.configCliente.pide_preoperacional?main.validaPreoperacionalRequerido(function(e){!0===e&&main.cargaHome()}):main.cargaHome()}n.myEstado(function(e){var a=config.domain_rpc+"/lib_mobile/driver/img/carro-off.png";if(nw.evalueData(config.iconCarOffline)&&(a=config.iconCarOffline),t.estado_activacion=e.estado_activacion,"2"===t.estado_activacion)return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".containMapAndOpened").remove(),o="",o+="<div class='div_ofline'><h3>Su estado es Inactivo, por favor espere a ser activado por el administrador de la sucursal</h3><img src='"+a+"'></div>",(i=document.createElement("div")).innerHTML=o,document.body.appendChild(i),n.intervalDatos=setInterval(function(){n.datosConductor()},15e3),!1;if("6"===t.estado_activacion)return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".containMapAndOpened").remove(),o="",o+="<div class='div_ofline'><h3>Su estado es bloqueado, por tardanzas, incumplimiento o rechazo de servicios, por favor comuníquese con el administrador</h3><img src='"+a+"'></div>",(i=document.createElement("div")).innerHTML=o,document.body.appendChild(i),n.intervalDatos=setInterval(function(){n.datosConductor()},15e3),!1;if("3"===t.estado_activacion||!nw.evalueData(t.estado_activacion))return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".containMapAndOpened").remove(),o="",o+="<div class='div_ofline'><h3>Su estado es Pre-Registrado, por favor espere a ser activado por el administrador de la sucursal</h3><img src='"+a+"'></div>",(i=document.createElement("div")).innerHTML=o,document.body.appendChild(i),n.intervalDatos=setInterval(function(){n.datosConductor()},15e3),!1;if("SI"===n.configCliente.usa_servicios){var o,i,e=!1;if(!1===(e=nw.evalueData(t.servicios_activos)&&"NO"!==t.servicios_activos&&(a=JSON.parse(t.servicios_activos),nw.evalueData(a))&&0<a.length?!0:e))return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".containMapAndOpened").remove(),o="",o+="<div class='div_ofline'><h3>"+nw.tr("No tiene servicios activos, consulte con el administrador del sistema")+"</h3><br /></div>",(i=document.createElement("div")).innerHTML=o,document.body.appendChild(i),n.intervalServices=setInterval(function(){n.datosServicios()},15e3),!0}window.localStorage.setItem("userDriverActive","SI"),r()})},cargaHome:function(){var i=this;nw.remove(".main_loading_initial_without_lib"),nw.remove(".loading_home_localiz"),i.permissionsInDevice(function(){i.addInProfile(),nw.evalueData(config.fechaLanzamiento)&&nw.utils.conteoRegresivoPorFechaHora(config.fechaLanzamiento,"Para el gran lanzamiento");void 0!==navigator.splashscreen&&navigator.splashscreen.hide();nw.loading({text:"",title:nw.tr("Ubicando por GPS, por favor espere"),addClass:"loading_home_localiz"});setTimeout(function(){os="IOS",nw.evalueData(window.localStorage.getItem("updategpsfirsttime_ios"))||(window.localStorage.setItem("updategpsfirsttime_ios","SI"),nw.remove(".main_loading_initial_without_lib"),nw.remove(".loading_home_localiz"))},1e4),main.position_initial=!1;var a=1e3,o=0;setTimeout(function(){!function e(){console.log("main.position_initial",main.position_initial);if(nw.utils.evalueData(window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION"))&&("rejected"==window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")||"skip"==window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")))return nw.remove(".loading_home_localiz"),nw.remove(".loading_home_localiz_2"),void nw.remove(".main_loading_initial_without_lib");if(!1!==main.position_initial)return;nw.loading({text:"",title:nw.tr("Buscando tu ubicación, por favor espera"),addClass:"loading_home_localiz_2"});setTimeout(function(){if(!1===main.position_initial){if(console.log("maxintentos",5),console.log("intentos",o),5<o)return window.location.reload(),!1;o++,nw.remove(".loading_home_localiz_2"),nw.remove(".main_loading_initial_without_lib"),e()}else nw.remove(".main_loading_initial_without_lib"),nw.remove(".loading_home_localiz_2")},a);a=1e3}()},5e3),!nw.utils.evalueData(window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION"))||"rejected"!=window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")&&"skip"!=window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")||(nw.remove(".loading_home_localiz"),nw.remove(".loading_home_localiz_2"),nw.remove(".main_loading_initial_without_lib"));nwgeo.getMapLocation(function(e){console.log("STAR::nwgeo.getMapLocation:::position",e),main.position_initial=e,nwgeo.native?(setTimeout(function(){nw.remove(".loading_home_localiz"),nw.remove(".main_loading_initial_without_lib")},1e3),nwgeo.initialize(function(){console.log("STAR::nwgeo.initialize:::position",e)},!0,""),i.driverMapaServicios()):nwgeo.initialize(function(){console.log("STAR::nwgeo.initialize:::position",e),setTimeout(function(){nw.remove(".loading_home_localiz"),nw.remove(".main_loading_initial_without_lib")},1e3),i.driverMapaServicios()},!0,"")},!1,!0)})},slotRecargas:function(){(new f_recargas).construct()},reloadApp:function(){var e=(e=parseInt(config.version_in_this_device)+1).toString();window.localStorage.setItem("version_in_this_device",e),config.version_in_this_device=e,nw.changePage(""),window.location.reload()},misComentarios:function(){(new l_comentarios).construct()},resumenFinal:function(e){if("NO"===main.configCliente.driver_mostrar_califica_viaje)return window.location.reload(),!1;var a=new f_resumen_final;a.construct(),a.populate(e)},addInProfile:function(){var o=this;nw.addProfile=function(e){var e="."+e.id,a=nw.tr("Comentarios que me han realizado"),a=nw.generateLink("Comentarios",function(){o.misComentarios()},"center",0,a,"material-icons email normal false","lists_simple","btn_correo");nw.appendLinkMenu(a,e)}},timeEsperaConfirmationUser:function(){return 3e3},timeLlegadaDelConductor:function(){return 3e3},preOperacional:function(){(new l_preoperacional).construct()},misDocumentos:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.id_usuario=e.id_usuario,a.empresa=e.empresa,a.usuario=e.usuario,a.perfil=e.perfil,new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0),e.setLoading(!1),nw.loading({text:nw.tr("Por favor espere..."),title:nw.tr("Consultando documentos...")});e.exec("consultaDatosConductor",a,function(e){nw.loadingRemove(),console.log(e);var a=new f_documentos_conductor;return a.construct(e,!1),a.actualizar=!0,a.populate(e),a})},myEstado:function(a){var e=nw.userPolicies.getUserData(),o={},e=(o.id_usuario=e.id_usuario,o.empresa=e.empresa,o.usuario=e.usuario,o.perfil=e.perfil,new nw.rpc(nw.getRpcUrl(),"conductores"));e.setAsync(!0),e.setLoading(!1);e.exec("myEstado",o,function(e){a(e)})},misVehiculos:function(e){var a=new l_vehiculos;return a.construct(e),a},driverMapaServicios:function(e){var a=this;if(void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),nw.isOnline()){if("undefined"==typeof google)return setTimeout(function(){a.driverMapaServicios(e)},300),!1}else nw.dialog(nw.tr("La API de mapas no cargó debido a que no cuenta con conexión a internet, red deficiente o nula."));if(nw.evalueData(a.selfCrearViaje)&&nw.evalueData(e))return void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),a.selfCrearViaje.validaServiceActive(),!0;main.driver=new f_driver_mapa_servicios,main.driver.construct(),a.loadInitFirebase()},cerrarNotificacion:function(){main.driver.cerrarNotificionMain(),nw.dialog("El usuario a cancelado el servicio")},serviceDriveCancelInterval:function(){clearTimeout(main.interval),main.interval=setTimeout(function(){main.serviceDriveCancelExec()},5e3)},serviceDriveCancelExec:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1);e.exec("servicioActivoConductor",a,function(e){return!1!==e&&("CANCELADO_POR_USUARIO"===e.estado?(nw.cleanAllWindow(),nw.home(),nw.dialog("El cliente canceló el servicio"),!1):void main.serviceDriveCancelInterval())})},validaPreoperacionalRequerido:function(a){var o=this,i=nw.utilsDate.getActualDate(),n=nw.utils.replace("-","",i),e=window.localStorage.getItem("preoperacional_hoy_"+n);if(nw.evalueData(e)&&e==i)return a(!0),!0;var e=nw.userPolicies.getUserData(),t={},e=(t.usuario=e.usuario,t.empresa=e.empresa,new nw.rpc(nw.getRpcUrl(),"servicios_conductor")),r=(e.setAsync(!0),"preoperacional_hoy");"SI"==o.configCliente.usar_preoperacional_dynamic&&(r="preoperacional_hoy_nuevo");e.exec(r,t,function(e){if(console.log("r",e),!0===e)return a(!0),window.localStorage.setItem("preoperacional_hoy_"+n,i),!0;nw.utils.menuResetInitial(),nw.dialog("Debe registrar el formato preoperacional"),main.removeLoadingInitial(),o.resolvePreoperacional()})},removeLoadingInitial:function(){nw.remove(".main_loading_initial_without_lib")},datosConductor:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.usuario=e.usuario,a.empresa=e.empresa,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0);e.exec("datosConductor",a,function(e){if(!1===e)return!1;clearInterval(main.intervalDatos),nw.setUserInfo(e,function(){window.location.reload()})})},datosServicios:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.usuario=e.usuario,a.empresa=e.empresa,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0);e.exec("datosServicios",a,function(e){if(console.log("datosServicios",e),!1===e)return!1;clearInterval(main.intervalServices),nw.setUserInfo(e,function(){window.location.reload()})})},statusDriver:function(){var a=this,e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0);e.exec("conductorActivo",o,function(e){if(!1===e)return nw.dialog("Su usuario no se encuentra activo para iniciar servicios de socio conductor."),!1;a.conductorStatus=!0})},conductorStatus:!1,openHistoricoViajes:function(){var e=new l_historico_viajes;return e.construct(),e},datosVehiculos:function(a){var o=this,e=nw.userPolicies.getUserData(),i={},e=(i.usuario=e.usuario,i.empresa=e.empresa,i.id_usuario=e.id_usuario,console.log("datosVehiculos:::up",e),console.log("datosVehiculos:::dataSendServer",i),new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0);e.exec("datosVehiculos",i,function(e){console.log("datosVehiculos:::responseServer",e),window.localStorage.setItem("datosVehiculos",JSON.stringify(e)),o.vehiculo=e,a(e)})},readMessage:function(e){var a=nw.userPolicies.getUserData(),a=(e.usuario=a.usuario,e.empresa=a.empresa,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0);a.exec("readMessage",e,function(e){})},initDataBaseLocal:function(){nw.bd_offline.create_or_read_database("prueba7",1,function(e){var e=e.db,a={};a.db=e,a.name="show_services",a.key="id",a.fields=[{name:"id",unique:!1}],nw.bd_offline.createTable(a)},function(e){main.db=e.db,main.consultaServicio(),nw.loadingRemove()},function(e,a){console.log("error",e,a)})},guardaServicio:function(e){var a={},o={};nw.userPolicies.getUserData();a.db=main.db,a.table="show_services",o.id=e,a.fields=o,a.callback=function(e){console.log("insert",e)},nw.bd_offline.insert(a)},consultaArrayServicio:function(e,a){var o=this.show_services;a(o=-1!==o.indexOf(e)&&(a=o.indexOf(e),console.log(a),o[a]))},consultaServicio:function(){var i=this,e={};e.db=main.db,e.table="show_services",e.callback=function(e){if(console.log("consultaServicioActivo::responseServer",e),0<e.length)for(var a=0;a<e.length;a++){var o=e[a];i.show_services.push(o.id)}},nw.bd_offline.select(e)},deleteRecord:function(e){var a={};a.db=main.db,a.table="show_services",a.id=e,a.callback=function(e){console.log("deleteRecord:::update",e)},nw.bd_offline.deleteRecord(a)},initBloqueoApp:function(){var e,a=this,o=nw.userPolicies.getUserData(),i={};i.usuario=o.usuario,i.empresa=o.empresa,"6"!=o.estado_activacion&&(nw.evalueData(a.configCliente.bloqueo_incumplimiento)&&0<parseInt(a.configCliente.bloqueo_incumplimiento)&&((e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),e.exec("consultaIncumplimiento",i,function(e){console.log("servicios",e);var e=e.length;a.configCliente.bloqueo_incumplimiento<=e&&(i.motivo_bloqueo="INCUMPLIMIENTO SERVICIOS",(e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),e.exec("actualizaEstadoConductor",i,function(e){a.reloadApp(),clearInterval(a.intervalBloqueo)}))}),void 0===a.intervalBloqueo)&&(a.intervalBloqueo=setInterval(function(){a.initBloqueoApp()},3e5)),nw.evalueData(a.configCliente.bloqueo_tardanzas)&&0<parseInt(a.configCliente.bloqueo_tardanzas)&&(0<parseInt(a.configCliente.minutos_adicionar_tardanzas)&&(i.minutos_adicionar_tardanzas=a.configCliente.minutos_adicionar_tardanzas),(e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),e.exec("consultaTardanzas",i,function(e){console.log("servicios tardanzas",e);var e=e.length;a.configCliente.bloqueo_tardanzas<=e&&(i.motivo_bloqueo="TARDANZAS SERVICIOS",(e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),e.exec("actualizaEstadoConductor",i,function(e){a.reloadApp(),clearInterval(a.intervalBloqueo)}))}),void 0===a.intervalBloqueo)&&(a.intervalBloqueo=setInterval(function(){a.initBloqueoApp()},3e5)),nw.evalueData(a.configCliente.bloqueo_no_aceptacion_servicios))&&0<parseInt(a.configCliente.bloqueo_no_aceptacion_servicios)&&((e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),e.exec("consultaRechazados",i,function(e){if(console.log("servicios no aceptado",e),0==e)return!1;var e=e.numero_rechazados;a.configCliente.bloqueo_no_aceptacion_servicios<=e&&(i.motivo_bloqueo="NO ACEPTACIÓN SERVICIOS",(e=new nw.rpc(nw.getRpcUrl(),"servicios_conductor")).setAsync(!0),e.setLoading(!1),e.exec("actualizaEstadoConductor",i,function(e){a.reloadApp(),clearInterval(a.intervalBloqueo)}))}),void 0===a.intervalBloqueo)&&(a.intervalBloqueo=setInterval(function(){a.initBloqueoApp()},3e5))},labels:function(e){if(nw.evalueData(config.labels))for(var a=config.labels,o=0;o<e.length;o++)for(var i=0;i<a.length;i++)a[i].name==e[o].name&&(nw.evalueData(a[i].label)&&(e[o].label=a[i].label,e[o].placeholder=a[i].label),void 0!==a[i].placeholder&&(e[o].placeholder=a[i].placeholder),void 0!==a[i].required&&(e[o].required=a[i].required),void 0!==a[i].car_min&&(e[o].car_min=a[i].car_min),void 0!==a[i].car_max&&(e[o].car_max=a[i].car_max),void 0!==a[i].visible)&&(e[o].visible=a[i].visible);return e},tipoDoc:function(){var e={"":"Seleccione",CC:"Cédula de ciudadanía",CE:"Cédula de extranjería",NI:"Nit",PP:"Pasaporte"};return nw.evalueData(config.tipo_doc)?config.tipo_doc:e},llamarCelular:function(e){var a="57";nw.evalueData(config.indicativo)&&(a=config.indicativo),window.open("tel:+"+a+e,"_BLANK")},actualizarApp:function(){var e=(e=parseInt(config.version_in_this_device)+1).toString();window.localStorage.setItem("version_in_this_device",e),config.version_in_this_device=e,nw.loading({text:"Actualizando... Por favor espere."}),setTimeout(function(){window.location.reload()},3e3)},verFuec:function(a){var e={},o=(e.id=a.vehiculo,console.log("verFuec:::dataSend",e),new nw.rpc(nw.getRpcUrl(),"servicios"));o.setAsync(!0),o.setLoading(!0);o.exec("validaFuecPorTipo",e,function(e){if(console.log("verFuec:::responseServer",e),"publico_taxi"==e.vehiculo_publico_particular)return nw.dialog("Este vehículo tipo taxi no maneja FUEC"),!1;e=config.domain_rpc+"/app/fuec_2021.php?service="+a.id;nw.utils.openIframe(e)})},imprimir:function(e,a,o=null){o="VER_INFORME_CONDUCTOR"==e?config.domain_rpc+"/app/plantilla_impresiones.php?id_service="+a+"&tipo="+e+"&fecha_inicio="+o.fecha_inicial+"&fecha_final="+o.fecha_final:config.domain_rpc+"/app/plantilla_impresiones.php?id_service="+a+"&tipo="+e,nw.utils.openIframe(o)},ampliar:function(a,e,o){var i,n,t,r=new f_ver_viaje_mapstatic,c=(r.setTitle="<span style='color:#fff;'>Viaje</span>",r.construct(a),"SOLICITUD"!==a.estado&&"LLEGADA_DESTINO"!==a.estado&&r.buttons.push({style:"",icon:"",colorBtnBackIOS:"#ffffff",position:"top",name:"problema",label:"Reportar problema",callback:function(){var e=new f_novedades;e.construct(),e.populate(a)}}),!nw.evalueData(o)||"EN_RUTA"!==a.estado&&"ACEPTADO_RESERVA"!==a.estado||r.buttons.push({style:"",icon:"",colorBtnBackIOS:"#ffffff",position:"top",name:"cancelar",label:"Cancelar",callback:function(){o()}}),!main.selfMapaDriver.serviceActive&&nw.evalueData(e)&&"ACEPTADO_RESERVA"===a.estado&&r.buttons.push({style:"",icon:"",colorBtnBackIOS:"#ffffff",position:"top",name:"start",label:"Iniciar viaje",callback:function(){e()}}),r.show(),console.log(a),""),c=(c+="<div class='separatorLine'></div>")+("<p><strong>"+nw.tr("Estado:")+"</strong> "+nw.tr(a.estado)+"</p>");if(nw.evalueData(a.fecha_hora)&&(c+="<p><strong>"+nw.tr("Fecha:")+"</strong> "+a.fecha_hora+"</p>"),nw.evalueData(a.valor_total_servicio)&&"SI"===main.configCliente.mostrar_valor_conductor&&(c+="<p><strong>"+nw.tr("Valor estimado:")+"</strong> $"+nw.addNumber(a.valor)+"</p>",nw.evalueData(a.valor_total_servicio))&&(c+="<p><strong>"+nw.tr("Valor final:")+"</strong> $"+nw.addNumber(a.valor_total_servicio)+"</p>"),nw.evalueData(a.subcategoria_servicio_text)&&(c+="<p><strong>"+nw.tr("Tipo servicio:")+" </strong>"+a.subcategoria_servicio_text+"</p>"),c=(c+="<p><strong>"+nw.tr("De:")+" </strong> "+a.ciudad_origen+" "+a.origen+"</p>")+("<p><strong>"+nw.tr("Hasta:")+" </strong> "+a.ciudad_destino+" "+a.destino+"</p>"),nw.evalueData(a.cliente_nombre)&&(c+="<p><strong>"+nw.tr("Cliente:")+" </strong> <br />"+a.cliente_nombre,"NO"!==main.configCliente.telefono_pasajero_visible_para_conductor)&&nw.evalueData(a.celular)&&(c+=", "+nw.tr("Celular:")+" <a href='tel:+57 "+a.celular+"'>"+a.celular+"</a></p>"),nw.evalueData(a.total_metros)&&(c+="<p><strong>"+nw.tr("Distancia (metros):")+" </strong>"+a.total_metros+"</p>"),nw.evalueData(a.hora_inicio)&&(c+="<p><strong>"+nw.tr("Inicio:")+" </strong>"+a.hora_inicio+"</p>"),nw.evalueData(a.hora_fin_servicio)&&(c+="<p><strong>"+nw.tr("Llegada:")+" </strong>"+a.hora_fin_servicio+"</p>"),"SI"===main.configCliente.mostrar_valor_conductor&&(c+="<p><strong>"+nw.tr("Descuento aplicado:")+" </strong>$"+nw.addNumber(a.descuento_aplicado)+"</p>"),nw.evalueData(a.datos_vehiculo_elegido)&&(c+="<p><strong>"+nw.tr("Datos vehículo elegido:")+" </strong>"+a.datos_vehiculo_elegido+"</p>"),c+="<p><strong>ID: </strong>"+a.id+"</p>","CARGA"==main.configCliente.app_para&&(nw.evalueData(a.numero_auxiliares)&&(c+="<p><strong>"+nw.tr("Numero Auxiliares:")+" </strong>"+a.numero_auxiliares+"</p>"),nw.evalueData(a.salida_periferia)&&(c+="<p><strong>"+nw.tr("Salida periferia:")+" </strong>"+a.salida_periferia+"</p>"),nw.evalueData(a.despacho)&&(c+="<p><strong>"+nw.tr("Despacho:")+" </strong>"+a.despacho+"</p>"),nw.evalueData(a.retorno)&&(c+="<p><strong>"+nw.tr("Retorno:")+" </strong>"+a.retorno+"</p>"),nw.evalueData(a.cargue)&&(c+="<p><strong>"+nw.tr("Cargue:")+" </strong>"+a.cargue+"</p>"),nw.evalueData(a.descargue)&&(c+="<p><strong>"+nw.tr("Descargue:")+" </strong>"+a.descargue+"</p>"),nw.evalueData(a.observaciones_servicio)&&(c+="<p><strong>"+nw.tr("Observaciones servicio:")+" </strong>"+a.observaciones_servicio+"</p>"),nw.evalueData(a.contacto_recogida)&&(c+="<p><strong>"+nw.tr("Contacto recogida:")+" </strong>"+a.contacto_recogida+"</p>"),nw.evalueData(a.telefono_recogida)&&(c+="<p><strong>"+nw.tr("Telefono recogida:")+" </strong>"+a.telefono_recogida+"</p>"),nw.evalueData(a.observaciones_recogida)&&(c+="<p><strong>"+nw.tr("Observaciones recogida:")+" </strong>"+a.observaciones_recogida+"</p>"),nw.evalueData(a.contacto_entrega)&&(c+="<p><strong>"+nw.tr("Contacto entrega:")+" </strong>"+a.contacto_entrega+"</p>"),nw.evalueData(a.telefono_entrega)&&(c+="<p><strong>"+nw.tr("Telefono entrega:")+" </strong>"+a.telefono_entrega+"</p>"),nw.evalueData(a.observaciones_entrega)&&(c+="<p><strong>"+nw.tr("Observaciones entrega:")+" </strong>"+a.observaciones_entrega+"</p>"),nw.evalueData(a.cantidad)&&(c+="<p><strong>"+nw.tr("cantidad:")+" </strong>"+a.cantidad+"</p>"),nw.evalueData(a.volumen)&&(c+="<p><strong>"+nw.tr("Volumen:")+" </strong>"+a.volumen+"</p>"),nw.evalueData(a.peso)&&(c+="<p><strong>"+nw.tr("Peso:")+" </strong>"+a.peso+"</p>"),nw.evalueData(a.empaque)&&(c+="<p><strong>"+nw.tr("Empaque:")+" </strong>"+a.empaque+"</p>"),nw.evalueData(a.valor_declarado))&&(c+="<p><strong>"+nw.tr("Valor declarado:")+" </strong>"+a.valor_declarado+"</p>"),nw.evalueData(a.observacion_ultima_ubicacion)&&(c+="<p><strong>"+nw.tr("Observación ubicación:")+" </strong>"+a.observacion_ultima_ubicacion+"</p>"),nw.evalueData(a.firma_recibido)&&(c+="<p style='margin-top: 38px;margin-bottom: 48px;'><strong>"+nw.tr("Firma recibido:")+" </strong><span \n                    style='background-image: url("+config.domain_rpc+a.firma_recibido+");padding: 27px 42px;background-size: contain;left: 11px;position: relative;' \n                    class='fotoFirma'></span></p>"),nw.evalueData(a.calificacion_conductor)){for(var s=parseInt(a.calificacion_conductor),l="<p><strong style='top: -8px;position: relative;'>"+nw.tr("Calificación:")+" </strong>",d=0;d<5;d++)l+=d<s?"<i class='ico_1 material-icons' style='color: #e04935;'>star</i>":"<i class='ico_1 material-icons'>star_border</i>";c+=l+="</p>"}r.ui.observaciones_html.setValue(c=(c+="<div class='nav_paradas'></div>")+"<div class='nav_adicion'></div>"+"<div class='otros_adjuntos'></div>"),r.direccion_origen=a.origen,r.direccion_destino=a.destino,r.latitude=a.latitudOri,r.longitude=a.longitudOri,r.latitudDes=a.latitudDes,r.longitudDes=a.longitudDes,r.createMapa(r),c=a,n=r.canvas+" #observaciones_html .nav_adicion",i=document.querySelector(r.canvas+" #observaciones_html .nav_adicion"),(t=document.createElement("div")).style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",t.innerHTML=nw.tr("Descripción de adicionales"),i.appendChild(t),(i=new l_navtable_tareas_adicionales).construct(n,c),r.navTable=i,t=a,n=r.canvas+" #observaciones_html .nav_paradas",c=document.querySelector(r.canvas+" #observaciones_html .nav_paradas"),(i=document.createElement("div")).style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",i.innerHTML=nw.tr("Paradas adicionales"),c.appendChild(i),(c=new l_navtable_paradas).construct(n,t),r.navTable=c,i=a,n=r.canvas+" #observaciones_html .otros_adjuntos",t=document.querySelector(r.canvas+" #observaciones_html .otros_adjuntos"),(c=document.createElement("div")).style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",c.innerHTML="",t.appendChild(c),(t=new l_navtable_agregar_imagenes).construct(n,i,"ADJUNTOS_VIAJE"),r.navTable=t},editaParadasAdicionales:function(i,e){var n=new nw.forms,t=nw.userPolicies.getUserData();n.id="f_padas_add",n.setTitle="Paradas / Pasajeros",n.showBackCallBack=function(){nw.back()},n.createBase();n.setFields([{label:"",name:"paradas_group",type:"startGroup",visible:!0},{type:"endGroup"}]),n.buttons=[],"PASADOS"!==e&&n.buttons.push({style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar_detalle_servicio",label:"Nuevo",callback:function(){n.guardar_paradas=!0,(new f_crear_parada).construct(n)}}),n.show(),n.saveParada=function(e,a){console.log(e);e.empresa=t.empresa,e.perfil=t.perfil,e.usuario=t.usuario,e.id_servicio_edit=i.id,console.log(e);var o=new nw.rpc(nw.getRpcUrl(),"servicios");o.setAsync(!0),o.setLoading(!1);o.exec("saveParada",e,function(e){n.navTable.applyFilters(i.id),nw.dialog("Parada creada correctamente."),void 0!==a&&a()})},n.createNavTableParadas=function(){var e=new l_navtable_paradas;e.construct("#f_padas_add .paradas_group",i),n.navTable=e},n.createNavTableParadas()},ofertaNotificaRecibe:function(e){console.log("estado",e)},newServiceRutaCliente:function(){},nueva_recarga:function(){nw.dialog("Tienes una nueva recarga.",function(){window.location.reload()})},newNotificationChat:function(e,a,o){e=nw.utils.tr(e)+" "+a+": "+o;nw.utils.toast({html:e,timeRemove:5e3,addClass:"toast-enviado"})},templateMailEnd:function(){return{asunto_viaje_finalizado:nw.utils.tr("Tu viaje ha finalizado"),tipo_pago:nw.utils.tr("Tipo pago:"),origen:nw.utils.tr("Origen:"),destino:nw.utils.tr("Destino:"),fecha:nw.utils.tr("Fecha:"),gracias:nw.utils.tr("gracias por preferirnos"),esperamos_viaje:nw.utils.tr("Esperamos que hayas disfrutado tu viaje")}}}});