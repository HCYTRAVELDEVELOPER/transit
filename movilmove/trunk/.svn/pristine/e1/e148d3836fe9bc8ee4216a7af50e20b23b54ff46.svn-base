nw.Class.define("f_referidos",{extend:nw.forms,construct:function(e){console.log("FORMULARIO REFERIDOS");var a=this,i=(a.id="f_referidos",a.setTitle="<span style='color:#fff;'>Referidos</span>",a.html="",a.showBack=!0,a.closeBack=!1,a.textClose="Volver",a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e,a.configCliente=main.configCliente,nw.userPolicies.getUserData()),e=[],o={},o=(o.id_ref=i.id_usuario,o.perf=i.perfil,nw.evalueData(i.code_referido)&&nw.evalueData(a.configCliente.numero_referidos)&&0<(e=JSON.parse(i.code_referido)).length&&e.length==a.configCliente.numero_referidos&&e.shift(),e.push(o),e=JSON.stringify(e),domainExternConfigName.replace("user","")),e=(o+=o+"driver",console.log("nameconfig",o),a.link=config.domain_rpc+"/lib_mobile/user/index.html?empresa="+i.empresa+"&createAccount=true&code_referido="+e+"&conf="+domainExternConfigName,a.link_driver=config.domain_rpc+"/lib_mobile/driver/index.html?empresa="+i.empresa+"&createAccount=true&code_referido="+e+"&conf="+o,[]);e.push({label:"",style:"",name:"contenedor_refiere_amigos",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRefiereAmigos' style='background-image: url("+config.domain_rpc+"/lib_mobile/user/img/imagen_referido_amigo.png);'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRefiereAmigos'>Refiere amigos</span><span class='descpRefiereAmigos'>Este es tu link, puedes copiarlo y compartirlo para que tus contactos se registren como usuario</span>",type:"html"},{label:"",style:"",name:"contenedor_refiere_amigos_actions",mode:"div",type:"startGroup"},{name:"my_link",label:"",placeholder:a.link,type:"textField",required:!0,visible:!0},{label:"",style:"",name:"contenedor_refiere_amigos_buttons",mode:"div",type:"startGroup"},{name:"my_link_copy",label:'<i class="material-icons">content_copy</i>',type:"button"},{name:"my_link_shared",label:"Compartir <i class='material-icons'>share</i>",type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}),e.push({label:"",style:"",name:"contenedor_refiere_conductores",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRefiereAmigos'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRefiereAmigos'>Refiere conductores</span><span class='descpRefiereAmigos'>Cópialo y compártelo con tus amigos conductores</span>",type:"html"},{label:"",style:"",name:"contenedor_refiere_amigos_actions",mode:"div",type:"startGroup"},{name:"my_link_driver",label:"",placeholder:a.link,type:"textField",required:!0,visible:!0},{label:"",style:"",name:"contenedor_refiere_amigos_buttons",mode:"div",type:"startGroup"},{name:"my_link_copy_driver",label:'<i class="material-icons">content_copy</i>',type:"button"},{name:"my_link_shared_driver",label:"Compartir <i class='material-icons'>share</i>",type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}),console.log("PASAJERO REFIERE CONDUCTOR::: ",a.configCliente.pasajero_refiere_conductor),"NO"==a.configCliente.pasajero_refiere_conductor?$(a.canvas).append("<style>.contentCenter .contenedor_refiere_conductores{background-image: url("+config.domain_rpc+"/lib_mobile/user/img/Referido_amigo_conductor.jpg);display: none;}</style>"):$(a.canvas).append("<style>.contentCenter .contenedor_refiere_conductores{background-image: url("+config.domain_rpc+"/lib_mobile/user/img/Referido_amigo_conductor.jpg);}</style>"),a.setFields(e),a.show(),a.onAppear(function(){setTimeout(function(){a.getUrl(function(o){a.ui.my_link.setValue(o.link),a.ui.my_link_driver.setValue(o.link_driver),a.ui.my_link_copy.addListener("click",function(){document.querySelector(".my_link").select(),document.execCommand("copy")}),a.ui.my_link_shared.addListener("click",function(){var e="¡Gana más con "+config.name+"!",a="¡Gana más con "+config.name+"! "+i.nombre+" te refirió para que te unas como usuario a "+config.name+", la línea de transporte única en Colombia, enlace: "+o.link;nw.evalueData(config.titleReferidoUser)&&(e=config.titleReferidoUser.replace("{link}",o.link)),nw.evalueData(config.bodyReferidoUser)&&(a=config.bodyReferidoUser.replace("{link}",o.link)),nw.shareSocial(a,e)}),a.ui.my_link_copy_driver.addListener("click",function(){document.querySelector(".my_link_driver").select(),document.execCommand("copy")}),a.ui.my_link_shared_driver.addListener("click",function(){var e="¡Gana más con "+config.name+"!",a="¡Gana más con "+config.name+"! "+i.nombre+" te refirió para que te unas como conductor a "+config.name+", la línea de transporte única en Colombia, enlace: "+o.link_driver;nw.evalueData(config.titleReferidoDriver)&&(e=config.titleReferidoDriver.replace("{link}",o.link_driver)),nw.evalueData(config.bodyReferidoDriver)&&(a=config.bodyReferidoDriver.replace("{link}",o.link_driver)),nw.shareSocial(a,e)})})},100)})},destruct:function(){},members:{getUrl:function(a){var e=this,o=nw.userPolicies.getUserData(),i=e.getRecord(!0),o=(i.usuario=o.usuario,i.empresa=o.empresa,i.perfil=o.perfil,i.domain=config.domain_rpc,i.link_driver=e.link_driver,i.link=e.link,new nw.rpc(nw.getRpcUrl(),"conductores"));o.setAsync(!0),o.setLoading(!0);o.exec("getUrlShort",i,function(e){console.log(e),a(e)})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_recargas",{extend:nw.forms,construct:function(e){var l=this,c=(nw.userPolicies.getUserData(),l.id="f_recargas",l.setTitle="<span style='color:#fff;'>Recargas</span>",l.showBack=!0,l.closeBack=!1,l.colorBtnBackIOS="#ffffff;",l.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",l.createBase(),l.callback=e,l.configCliente=main.configCliente,"");nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(c=".00"),l.consultaPlanes(function(s){l.consultaSaldo(function(e){for(var a=0,o=(nw.evalueData(e.saldo)&&(a=e.saldo),console.log(a),[{label:"",style:"",name:"contenedor_recargas",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRecargas' style='background-image: url("+config.domain_rpc+"/lib_mobile/driver/img/recargas.png);'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRecargas'>Recarga saldo</span><span class='descpRecargas'>Te quedaste sin saldo recarga y sigue disfrutando de nuestros servicios.</span>",type:"html"},{label:"",style:"",name:"contenedor_service_recargas",mode:"div",type:"startGroup"},{name:"my_link_description_saldo",label:"<div class='titleSaldo'>Tu saldo es <strong class='saldo_tit_tot'> $"+nw.addNumber(a)+c+"</strong></div>",type:"html"},{name:"my_link_saldo",label:"<span class='iconRecargas'><i class='material-icons'>attach_money</i></span><span class='contSaldo'>Recargar Saldo</span>",type:"html"},{label:"",style:"",name:"contenedor_recargas_actions",mode:"div",type:"startGroup"},{name:"valor_recarga",label:"",placeholder:"Ingresa el valor",type:"integer",visible:!0},{label:"",style:"",name:"contenedor_recargas_buttons_actions",mode:"div",type:"startGroup"},{name:"recargar",label:"Enviar",type:"button"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}]),i=0;i<s.length;i++){console.log(s[i]);var t={name:"my_link_planes",label:"<span class='iconContPlanes'><i class='material-icons'>library_add</i></span><span class='contPlanes' data='"+s[i].valor_recarga+"' data_id='"+s[i].id+"' data_recarga='"+s[i].total_recarga+"' data_tiempo='"+(void 0===s[i].tiempo_vencimiento||void 0!==s[i].tiempo_vencimiento&&null==s[i].tiempo_vencimiento?0:s[i].tiempo_vencimiento)+"'>"+s[i].nombre+"</span>",type:"html"};o.push(t)}for(var n=[{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"}],r=0;r<n.length;r++)o.push(n[r]);l.setFields(o),l.show(),nw.evalueData(l.configCliente.usar_recarga_libre_driver)&&"NO"==l.configCliente.usar_recarga_libre_driver&&(l.ui.my_link_saldo.setVisibility(!1),l.ui.valor_recarga.setVisibility(!1),$("#f_recargas .nw_widget_div_my_link_planes").css("cssText","margin-top: 51px;")),$("#f_recargas .nw_label_valor_recarga").css("cssText","display:none!important;"),l.ui.recargar.addListener("click",function(){var e,a,o=l.ui.valor_recarga.getValue(),i=(nw.evalueData(o)||(o="0"),300);console.log(l.configCliente),nw.evalueData(l.configCliente.valor_minimo_recarga)&&(i=l.configCliente.valor_minimo_recarga),parseFloat(o)<parseFloat(i)?(nw.dialog("El valor debe ser superior a $"+i),l.ui.valor_recarga.setValue("")):parseFloat(o)>parseFloat(1e4)?(nw.dialog("El valor maximo de recarga es de $"+1e4),l.ui.valor_recarga.setValue("")):(nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(e=l.ui.valor_recarga.getValue(),o+="00"),i=nw.userPolicies.getUserData(),console.log(i),(a={}).valor_plan=o,a.id_plan=0,a.total_recarga=o,a.email=i.email,a.usuario=i.usuario,a.empresa=i.empresa,a.nombre=i.nombre+" "+i.apellido,a.perfil=i.perfil,a.tipo="recarga",a.name_empresa=config.name,nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(a.valor_formato=e),l.pago(a))}),$(".nw_widget_div_my_link_planes").bind("click",function(){var e=nw.userPolicies.getUserData(),a={},o=(a.valor_plan=this.querySelector(".contPlanes").getAttribute("data"),nw.evalueData(a.valor_plan)||(a.valor_plan="0"),300);console.log(l.configCliente),nw.evalueData(l.configCliente.valor_minimo_recarga)&&(o=l.configCliente.valor_minimo_recarga),parseFloat(a.valor_plan)<parseFloat(o)?(nw.dialog("El valor debe ser superior a $"+o),l.ui.valor_recarga.setValue("")):parseFloat(a.valor_plan)>parseFloat(1e6)?(nw.dialog("El valor maximo de recarga es de $"+1e6),l.ui.valor_recarga.setValue("")):(nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore&&(a.valor_plan=a.valor_plan.slice(0,-2)),console.log(a.valor_plan),a.id_plan=this.querySelector(".contPlanes").getAttribute("data_id"),a.total_recarga=this.querySelector(".contPlanes").getAttribute("data_recarga"),a.total_tiempo=this.querySelector(".contPlanes").getAttribute("data_tiempo"),a.email=e.email,a.usuario=e.usuario,a.empresa=e.empresa,a.nombre=e.nombre+" "+e.apellido,a.perfil=e.perfil,a.name_empresa=config.name,a.tipo="plan",l.pago(a))})})}),console.log(config)},destruct:function(){},members:{consultaSaldo:function(a){var e=nw.userPolicies.getUserData(),o={},e=(console.log(e),o.id=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"nwMaker"));e.setAsync(!0);e.exec("consultaSaldoUserApp",o,function(e){console.log(e),a(e)})},pago:function(t){console.log(t);var e=new nw.rpc(nw.getRpcUrl(),"servicios");e.setAsync(!0);e.exec("saveRecarga",t,function(o){var i;nw.evalueData(config.paymentStore)&&"Conekta"==config.paymentStore?(nw.createNotificacionBarInter({addClass:"notifyRedirect",timeToRemove:1500,title:"Cargando...",body:"En segundos serás redireccionado a la pasarela de pagos.",icon:!1,data:o,callbackEndTime:function(){}}),setTimeout(function(){var e={ruta:"/app/pagos/"},a=(e.name=t.nombre,e.email=t.email,e.usuario=t.usuario,e.itemName="Recarga saldo "+t.name_empresa,e.itemDescription="Recarga saldo "+t.name_empresa,e.item_unit_price=t.total_recarga,e.itemQuantity=1,e.street1="Calle 123, int 2",e.postal_code="06100",e.country="MX",e.callBackEnd=function(e){console.log(e);var a={},e=(a.id=o,a.checkoutRequestId=e.checkoutRequestId,console.log(a),new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0);e.exec("updatecheckout",a,function(e){console.log("actualizado")})},e.callBackClose=function(e){console.log(e),nw.dialog("Finalizar",function(){nw.activateBackgroundMode(),nw.refreshSessionApp(function(){main.reloadApp()})})},{total_recarga:t.valor_plan,tipo:t.tipo,descripcion:"Recarga saldo "+t.name_empresa,total_tiempo:t.total_tiempo});nw.evalueData(t.valor_formato)&&(a.valor_formato=t.valor_formato),e.extra=JSON.stringify(a),main.debugConstruct&&console.log("SAVE::f_recargas:::d",e),nw.payConekta.start(e)},1e3)):(nw.createNotificacionBarInter({addClass:"notifyRedirect",timeToRemove:15e3,title:"Cargando...",body:"En segundos serás redireccionado a la pasarela de pagos.",icon:!1,data:o,callbackEndTime:function(){nw.dialog("Finalizar",function(){nw.activateBackgroundMode(),nw.refreshSessionApp(function(){main.reloadApp()})})}}),i="f3566b13f1e134574b53e67121b5a588",void 0!==config.apiKeyEpayco&&""!==config.apiKeyEpayco&&(i=config.apiKeyEpayco),setTimeout(function(){nw.inactivateBackgroundMode(),nw.loadJs("https://checkout.epayco.co/checkout.js",function(){var e=ePayco.checkout.configure({key:i,test:!1}),a={name:"Recarga saldo "+t.name_empresa,description:"Recarga saldo "+t.name_empresa,invoice:o,currency:"cop",amount:t.valor_plan,tax_base:"0",tax:"0",country:"CO",lang:"es",external:"false",extra1:t.usuario,extra2:t.empresa,extra3:t.perfil,extra4:t.total_recarga,extra5:t.tipo,confirmation:config.domain_rpc+"/app/confirmacionPayco.php?type=false",response:config.domain_rpc+"/app/confirmacionPayco.php?type=true",name_billing:"",address_billing:"",type_doc_billing:"",mobilephone_billing:"",number_doc_billing:""};e.open(a)})},1e3))})},consultaPlanes:function(a){var e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,o.empresa=e.empresa,o.perfil=e.perfil,new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!0);e.exec("consultaSaldo",o,function(e){console.log(e),a(e)})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_reprograma",{extend:nw.forms,construct:function(e,i){var t=this,n=nw.userPolicies.getUserData();t.id="f_reprograma",t.setTitle="Reprogramar",t.showBack=!0,t.closeBack=!1,t.createBase(),t.parent=e,t.data=i,console.log("self.data",t.data);t.setFields([{label:"",name:"detalle_repro",type:"startGroup"},{styleContainer:"",style:"",type:"dateField",label:"Fecha",required:!0,placeholder:"Fecha",visible_label:!1,name:"fecha"},{styleContainer:"",style:"",type:"time",label:"Hora",required:!0,placeholder:"Hora",visible_label:!1,name:"hora"},{name:"",type:"endGroup"}]),t.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"bottom",name:"aceptar_detalle_servicio",label:"Aceptar",callback:function(){var e,a,o;t.validate()&&(o=nw.getActualDate(),(e={}).empresa=n.empresa,e.perfil=n.perfil,e.usuario=n.usuario,e.nombre=n.nombre,e.id_servicio_edit=i.id,e.fecha=t.ui.fecha.getValue(),e.hora=t.ui.hora.getValue(),e.tipo="user",nw.evalueData(t.data.conductor_usuario)&&"Sin asignar"!==t.data.conductor_usuario&&(e.conductor_usuario=t.data.conductor_usuario),a=o,console.log("hoy",o),console.log("datos.fecha",e.fecha),e.fecha<a?nw.dialog("La fecha no puede menor a la actual"):(console.log("datos",e),console.log("self.data",t.data),(o=new nw.rpc(t.getRpcUrl(),"servicios")).setAsync(!0),o.setLoading(!0),o.exec("updateServiceFecha",e,function(e){console.log("ra",e),nw.back(),nw.dialog("Se ha reprogramado correctamente."),t.parent.applyFilters()})))}}],t.show(),t.ui.fecha.setValue(t.data.fecha),t.ui.hora.setValue(t.data.hora)},destruct:function(){},members:{}}),nw.Class.define("f_vehiculo",{extend:nw.forms,construct:function(e){var a=this;a.id="f_vehiculo",a.setTitle="<span style='color:#fff;'>Vehículo</span>",a.html="Crear / editar vehículo",a.showBack=!0,a.closeBack=!1,a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e;a.setFields([{name:"id",label:"ID",placeholder:"id",type:"textField",required:!1,visible:!1},{name:"imagen_vehi",label:"Foto",placeholder:"Foto",type:"uploader",required:!1,visible:!0},{name:"placa",label:"Placa",placeholder:"Placa",type:"textField",required:!0,visible:!0},{name:"marca_text",label:"Marca",placeholder:"Marca",type:"textField",required:!0,visible:!0},{name:"modelo",label:"Modelo",placeholder:"Modelo",type:"textField",required:!0,visible:!0},{name:"color",label:"Color",placeholder:"Color",type:"textField",required:!0,visible:!0},{name:"fecha_vencimiento_soat",label:"Fecha vencimiento SOAT",placeholder:"Fecha vencimiento SOAT",type:"dateField",required:!0,visible:!0}]),a.buttons=[{style:"border: 0;background-color:#ffffff;color:#f18107;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#f18107",position:"top",name:"aceptar",label:"Guardar",callback:function(){a.save()}}],a.show()},destruct:function(){},members:{save:function(){var a=this;if(!a.validate())return!1;var e=nw.userPolicies.getUserData(),o=a.getRecord(!0),e=(o.usuario=e.usuario,o.empresa=e.empresa,o.usuario_text=e.nombre,o.id_usuario=e.id_usuario,console.log(o),new nw.rpc(nw.getRpcUrl(),"vehiculo"));e.setAsync(!0);e.exec("save",o,function(e){if(console.log("save",e),!0===e)return a.reject(),nw.dialog("Vehículo guardado correctamente"),nw.evalueData(a.callback)?a.callback():nw.home(),!0;nw.dialog(e)})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_metodo_pago",{extend:nw.forms,construct:function(e){var a=this;a.id="f_metodo_pago",a.setTitle="<span style='color:#fff;'>Métodos de pago</span>",a.html="",a.showBack=!0,a.closeBack=!1,a.textClose="Volver",a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e,a.id_tarjeta_credito_metodo=null,a.name_tarjeta_credito_metodo=null,nw.userPolicies.getUserData();a.setFields([{name:"metodo",label:"",visible_label:!0,placeholder:"",type:"radio",required:!0}]),a.buttons=[],void 0===e&&((e=!0)===(e=void 0!==main.configCliente&&nw.evalueData(main.configCliente)&&"EFECTIVO"===main.configCliente.tipo_pago?!1:e)&&a.buttons.push({style:"border: 0;background-color:#f18107;color:#ffffff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#ffffff",name:"nuevo_metodo",label:"Agregar tarjeta crédito",callback:function(){(new f_tarjetas_credito).construct(function(e){a.populateMetodo(e.numero_tarjeta)})}}),a.buttons.push({style:"border: 0;background-color:gray;color:#ffffff;margin:10px 0;",icon:"material-icons edit normal",colorBtnBackIOS:"#ffffff",name:"editar",label:"Editar",callback:function(){main.misTarjetasCredito(function(){nw.back(),a.populateMetodo()})}})),a.show(),a.onAppear(function(){setTimeout(function(){a.populateMetodo()},100)})},destruct:function(){},members:{populateMetodo:function(e){var o=this,a=(o.ui.metodo.html(""),nw.userPolicies.getUserData()),i="efectivo",e=(nw.evalueData(a.metodo_de_pago)&&(i=a.metodo_de_pago),nw.evalueData(a.id_tarjeta_credito_metodo)&&"efectivo"!==i&&(i=a.id_tarjeta_credito_metodo),nw.evalueData(e)&&(i=e),{});e.usuario=a.usuario,e.empresa=a.empresa,e.perfil=a.perfil,o.ui.metodo.populateSelect("nwMaker","myCreditsCards",e,function(e){var a={};nw.evalueData(main.configCliente)&&"CREDITO"!==main.configCliente.tipo_pago&&(a.efectivo="Efectivo",o.ui.metodo.populateSelectFromArray(a)),o.ui.metodo.populateSelect("app_user","formasDePago",a,function(e){console.log("eeee"),o.setValueMetodo(i,!0),o.ui.metodo.changeValue(function(e){nw.loading(),setTimeout(function(){console.log("e",e),console.log("e.value",e.value),o.setValueMetodo(e.value),o.save()},1e3)})},!0,!1)},!0,!1)},setValueMetodo:function(e,a){var o=this;console.log("setValueMetodo::met::initial",e,a),o.metodo=e,"efectivo"!==o.metodo&&(o.metodo="credito",o.id_tarjeta_credito_metodo=e),0!=a&&(a=o.getRecord(!0),console.log("data",a),console.log("data",a.metodo_text),void 0!==a.metodo_text)&&(o.metodo=a.metodo_text,console.log("data.metodo_text.indexOf(***)",a.metodo_text.indexOf("***")),-1!==a.metodo_text.indexOf("***")?(o.metodo="credito",o.id_tarjeta_credito_metodo=a.metodo):"efectivo"!=o.metodo&&(o.metodo=a.metodo_text,o.id_tarjeta_credito_metodo=a.metodo)),o.ui.metodo.setValue(e)},save:function(){var a=this;if(!a.validate())return!1;var o=a.getRecord(!0),e=nw.userPolicies.getUserData(),e=(o.usuario=e.usuario,o.empresa=e.empresa,o.perfil=e.perfil,o.metodo=a.metodo,o.id_tarjeta_credito_metodo=a.id_tarjeta_credito_metodo,o.name_tarjeta_credito_metodo=o.metodo_text,console.log("f_metodo_pago:::dataSendServer:::data",o),new nw.rpc(nw.getRpcUrl(),"nwMaker"));e.setAsync(!0),e.setLoading(!1);e.exec("changeMetodoPagoUser",o,function(e){if(console.log("f_metodo_pago:::responseServer:::r",e),nw.loadingRemove(),!0!==e)return nw.dialog(e),!1;nw.dialog("Forma de pago cambiada correctamente a "+a.metodo+"."),a.resolveEnd(o)})},resolveEnd:function(e){console.log(e),window.localStorage.setItem("metodo_de_pago",e.metodo),nw.evalueData(e.id_tarjeta_credito_metodo)&&(window.localStorage.setItem("id_tarjeta_credito_metodo",e.id_tarjeta_credito_metodo),window.localStorage.setItem("name_tarjeta_credito_metodo",e.name_tarjeta_credito_metodo),window.localStorage.setItem("metodo_de_pago",e.metodo)),nw.evalueData(this.callback)&&(nw.back(),this.callback(e))},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_chat",{extend:nw.forms,construct:function(e){var a=this;a.id="f_chat",a.showBack=!0,a.closeBack=!1,a.textClose="Volver",a.setTitle="Chat / "+e.conductor,a.createBase();a.setFields([{name:"frame_chat_form",label:"Cargando ...",type:"html",visible:!0}]),a.show(),a.datos=e,a.tokens=!1,a.id_clean=e.id,a.isParada="NO",console.log("datos.id",e.id),console.log("datos.id.indexOf(parada)",e.id.indexOf("parada")),-1!=e.id.indexOf("parada")&&(a.isParada="SI",console.log("datos.id.split(_parada_)",e.id.split("_parada_")),a.id_clean=e.id.split("_parada_")[1]),console.log("self.id_clean",a.id_clean),console.log("self.datos",a.datos),a.onAppear(function(){nw.loading({text:"Por favor espere...",title:"Cargando chat..."}),a.getTokens(function(){a.frame()})})},destruct:function(){},members:{getTokens:function(o){var i=this,e=nw.userPolicies.getUserData(),a={},e=(a.id=i.id_clean,a.es_parada=i.isParada,a.empresa=e.empresa,a.usuario=e.usuario,a.perfil=e.perfil,new nw.rpc(i.getRpcUrl(),"servicios"));console.log("getTokens:::dataSend",a),e.setAsync(!0),e.setLoading(!1);e.exec("getTokensByChat",a,function(e){var a;if(console.log("getTokens:::responseServer",e),"string"==typeof e)return nw.loadingRemove(),"pasajero_no_configurado"==e?nw.dialog("El servicio no tiene configurado un pasajero"):(a="<strong style='color:red;'>¡Importante! No podrás comunicarte por el siguiente motivo: </strong>",a+="<br />"+e,nw.dialog(a)),nw.back(),!1;i.tokens=e,o(),console.log("getTokens:::server_data",JSON.stringify(e)),window.localStorage.setItem("tokensInChat_"+i.id_clean,JSON.stringify(e))})},frame:function(){var e,a=this.datos,o=nw.userPolicies.getUserData(),i=document.querySelector(".framechat_conversation");i||(e="",e=(e=(e=(e=(e=(e+=config.domain_rpc)+"/nwlib6/nwproject/modules/webrtc/v6/chat/index.html?room="+a.id)+"&setUserName="+o.nombre+" (Pasajero)")+"&setUserPhoto="+o.foto_perfil)+"&setUserEmail="+o.email)+"&id_user="+o.id_usuario+"&saveToken=true&useMicroMsg=false",nw.utils.evalueData(main.configCliente.keyGoogleNotificacionPush)&&(e+="&keyGoogleNotificacionPush="+main.configCliente.keyGoogleNotificacionPush),nw.utils.evalueData(this.tokens)&&(o=JSON.stringify(this.tokens),console.log("tokens",o),o=btoa(o),console.log("encodedString",o),e+="&tokensAllGroup="+o),o={is_movilmove:!0,usa_firebase:(o=main.configCliente).usa_firebase,usa_firebase_modo_pruebas:o.usa_firebase_modo_pruebas},o=JSON.stringify(o),e+="&configAditional="+btoa(o),console.log("url",e),(i=document.createElement("iframe")).className="framechat_conversation framechat_conversation_"+a.id,i.id="framechat_conversation",i.src=e,i.allow="geolocation; microphone; camera",i.onload=function(){nw.loadingRemove()},this.ui.frame_chat_form.setValue(i))}}}),nw.Class.define("f_resumen_final",{extend:nw.forms,construct:function(){nw.userPolicies.getUserData();var n=this,e=(n.id="f_resumen_final",n.setTitle="<span style='color:#fff;'>Resumen</span>",n.showBack=!1,n.closeBack=!1,n.textClose="Home",n.changeHash=!0,n.colorBtnBackIOS="#ffffff;",n.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",n.createBase(),n.event=new Event("calificaFin"),n.usuario=null,n.data=null,n.setFields([{name:"id",label:"ID",type:"textField",visible:!1},{name:"label_puntaje_en_texto",label:"",type:"html"},{name:"puntaje",label:"Calificación",type:"radio",required:!0},{name:"comentarios",label:"",placeholder:"Comentarios",type:"textArea",required:!1}]),n.buttons=[],n.buttons.push({style:"background-color: #f18107;color: #ffffff;",icon:"",colorBtnBackIOS:"#ffffff",name:"aceptar",label:"Calificar",callback:function(){if(!n.validate())return!1;var e=nw.userPolicies.getUserData(),a=n.getRecord(),e=(a.usuario=n.usuario,a.usuario_califica=e.usuario,a.empresa=e.empresa,a.perfil=e.perfil,a.service=n.data,nw.utils.evalueData(n.dataPopulate.id_parada)&&(a.id_parada=n.dataPopulate.id_parada),console.log("data",a),new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!0);e.exec("calificarServicio",a,function(e){if(document.dispatchEvent(n.event),void 0===e.saldo)return nw.dialog("Error inesperado, "+e),!1;window.localStorage.setItem("saldo",e.saldo),nw.home(),main.selfCrearViaje.activeNormal(),main.registerServiceInFirebase(a.id)})}}),n.show(),nw.addClass(nw.getElement(n.canvas),"f_calificar_estrellas"),{});e[1]="<i class='material-icons'>star_border</i>",e[2]="<i class='material-icons'>star_border</i>",e[3]="<i class='material-icons'>star_border</i>",e[4]="<i class='material-icons'>star_border</i>",e[5]="<i class='material-icons'>star_border</i>",n.ui.puntaje.populateSelectFromArray(e),n.ui.puntaje.setValue(""),n.ui.puntaje.changeValue(function(e){for(var a=e.value,o=(n.ui.label_puntaje_en_texto.setValue(n.arrayPuntaje(a)),n.ui.puntaje.find(".label_radio_nw")),i=0;i<o.length;i++){var t=o[i];$(t).removeClass("label_radio_nw_active"),t.innerHTML="<i class='material-icons'>star_border</i>"}for(i=0;i<parseInt(a);i++){t=o[i];$(t).addClass("label_radio_nw_active"),t.innerHTML="<i class='material-icons'>star</i>"}})},destruct:function(){},members:{arrayPuntaje:function(e){return["","Terrible","Malo","Regular","Bueno","Excelente"][e]},populate:function(i,t){var n=this,e=(console.log("populate:::pr",i),n.valor_final="0",{}),a=(e.id=i.id,n.dataPopulate=i,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0),a.setLoading(!1);a.exec("consultaSolit",e,function(e){if(console.log("populate",e),!e)return nw.home(),!1;void 0!==t&&t(),n.ui.id.setValue(i.id);var a=0,o=(nw.evalueData(e.valor_total_servicio)&&(a=e.valor_total_servicio),n.data=e,"<div class='resumenfinaldiv'>");o+="<h1 class='price_see'>Total a pagar: $<span class='totalapagar'>"+nw.addNumber(a)+"</span></h1>","SI"==e.aplico_peaje&&(o+="<p class='price_see'><strong>Peajes:</strong> $"+nw.addNumber(e.valor_peajes)+"</p>"),"SI"==e.aplico_recargo&&(o+="<p class='price_see'><strong>Recargo:</strong> $"+nw.addNumber(e.valor_recargo_ruta_fija)+"</p>"),nw.evalueData(e.valor_espera)&&(o+="<p class='price_see'><strong>Valor espera:</strong> $"+nw.addNumber(e.valor_espera)+"</p>"),nw.evalueData(e.saldo_user_aplicado)&&(o+="<p class='price_see'><strong>Pago con saldo:</strong> $"+nw.addNumber(e.saldo_user_aplicado)+"</p>"),nw.evalueData(e.descuento_aplicado)&&(o+="<p class='price_see'><strong>Descuento:</strong> $"+nw.addNumber(e.descuento_aplicado)+"</p>",a=parseFloat(e.valor_total_servicio)+parseFloat(e.descuento_aplicado),o+="<p class='price_see'><strong>Valor sin descuento: </strong>$"+nw.addNumber(a)+"</p>"),o=(o+="<p class='price_see'><strong>Tipo pago: </strong>"+e.tipo_pago+"</p>")+"<p class='datafindrivres'><strong>Conductor: </strong> <span class='fotodrivresumenfin' style='background-image: url("+config.domain_rpc+e.conductor_foto+")'></span><span class='datadrivresumenfin'>"+e.conductor+" "+e.placa+"</span></p>",n.usuario=e.conductor_usuario,o=(o=(o=(o+="<p><strong>Origen: </strong>"+e.origen+"</p>")+"<p><strong>Destino: </strong>"+e.destino+"</p>")+"<p><strong>Servicio: </strong>"+e.subcategoria_servicio_text+"</p>")+"<p><strong>Fecha del servicio: </strong>"+e.fecha+" "+e.hora+"</p>",nw.evalueData(e.hora_llegada)&&(o+="<p><strong>Hora inicio: </strong>"+e.hora_llegada+"</p>"),nw.evalueData(e.hora_fin_servicio)&&(o+="<p><strong>Hora finalización: </strong>"+e.hora_fin_servicio+"</p>"),nw.evalueData(i.bodega_text)&&(o+="<p><strong>Empresa: </strong>"+i.bodega_text+"</p>"),o+="<p><strong>Servicio #: </strong>"+i.id+"</p>",nw.utils.evalueData(i.id_parada)&&(o+="<p><strong>Parada / pasajero #: </strong>"+i.id_parada+"</p>"),"CANCELADO_POR_CONDUCTOR"==e.estado&&(o+="<p class='cancela_seeend' style='color: red; margin-top: 50px;'><strong>El conductor ha cancelado el servicio, puedes otorgar la calificación que consideres y enviar tus comentarios</p>"),n.addHeaderNote(o+="</div>")})}}}),nw.Class.define("f_ver_viaje_mapstatic",{extend:nw.forms,construct:function(e){var a=this;a.id="f_ver_viaje_mapstatic",a.closeBack=!1,(a.showBack=!0)===main.previsualiza&&(a.showBack=!1,a.changeHash=!1,a.transition="pop"),a.createBase(),a.datos=e;a.setFields([{styleContainer:"margin:0;",style:"height:400px;margin:0;",label:"",name:"mapa",type:"startGroup"},{type:"endGroup"},{visible:!0,label:"",name:"observaciones_html",type:"html"}]),a.buttons=[]},destruct:function(){},members:{createMapa:function(e){console.log("createMapa:::d",e),nw.remove(".mapEmbedNw");var a=document.querySelector(this.canvas+" .mapa"),o={origen_latitud:e.latitude,origen_longitud:e.longitude,destino_latitud:e.latitudDes,destino_longitud:e.longitudDes};nw.utils.evalueData(e.direccion_origen)&&(o.direccion_origen=e.direccion_origen),nw.utils.evalueData(e.direccion_destino)&&(o.direccion_destino=e.direccion_destino),new nwgeo.getMapEmbed(a,o)}}}),nw.Class.define("f_soporte",{extend:nw.forms,construct:function(e){var a=this,o=(a.id="f_soporte",a.showBack=!1,a.closeBack=!0,a.closeBackCallBack=function(){nw.loadHome()},a.transition="pop",a.setTitle="",a.createBase(),a.setFields([{name:"frame_chat_form",label:"Cargando...",type:"html",visible:!0}]),nw.getPermission(["android.permission.READ_PHONE_STATE","android.permission.READ_EXTERNAL_STORAGE","android.permission.RECORD_VIDEO","android.permission.WRITE_EXTERNAL_STORAGE","android.permission.ACCESS_WIFI_STATE","android.permission.ACCESS_NETWORK_STATE","android.permission.RECORD_AUDIO","android.permission.MODIFY_AUDIO_SETTINGS","android.permission.FLASHLIGHT","android.permission.RECORD_AUDIO","android.permission.CAMERA","android.permission.MICROPHONE"],function(){console.log("Permisos concedidos")}),a.show(),"3095"),i="1510848061182",t=(nw.evalueData(config.ringowID)&&(o=config.ringowID),nw.evalueData(config.ringowApyKey)&&(i=config.ringowApyKey),nw.userPolicies.getUserData(),document.querySelector(".framechat_conversation"));t||((t=document.createElement("iframe")).className="framechat_conversation",t.id="framechat_conversation",t.src="https://app.ringow.com/ringowEmbed/"+o+"/"+i+"?onlyChat=true&callingChat=true",t.allow="geolocation; microphone; camera",t.onload=function(){},a.ui.frame_chat_form.setValue(t))},destruct:function(){},members:{}}),nw.Class.define("f_mapa",{extend:nw.forms,construct:function(e,a){var o=this;o.id="f_mapa",o.setTitle="<span>Mapa</span>",o.showBack=!0,o.closeBack=!1,o.data_service=e,o.poly={},o.geo={},o.geoDestino={},o.callback=a,o.createBase(),o.markerMove=null,o.add=!1,o.mapType="hybrid",o.markersCalor=[];o.setFields([{styleContainer:"margin:0;",style:"",label:"",name:"mapa_edit",mode:"div",type:"startGroup"},{mode:"div",type:"endGroup"},{style:"",label:"",mode:"div",name:"contenedor_btn_fijar",type:"startGroup"},{styleContainer:"margin: 0;",style:"",icon:"material-icons location_on normal",type:"search",label:"Origen",visible_label:!1,name:"address",required:!0,enabled:!1,placeholder:"Mi ubicación actual"},{styleContainer:"margin: 0;",style:"",icon:"material-icons near_me normal",type:"search",label:"Destino",visible_label:!1,name:"address_destino",required:!0,placeholder:"Destino"},{mode:"div",type:"endGroup"}]),o.buttons=[],o.buttons.push({icon:"",position:"bottom",name:"cancelar",label:"Cancelar",callback:function(e){nw.back()}},{icon:"",position:"bottom",name:"guardar",label:"Guardar",callback:function(e){o.updateService()}}),o.show(),o.createMapa(),o.createActionsInputsSearchDirections(),console.log("datos",e),o.ui.address.setValue(e.origen)},destruct:function(){},members:{createMapa:function(e){var a=nwgeo.latitude,o=nwgeo.longitude,i=(!nw.evalueData(a)&&nw.evalueData(window.localStorage.getItem("nwgeo_latitude"))&&(a=parseFloat(window.localStorage.getItem("nwgeo_latitude"))),!nw.evalueData(o)&&nw.evalueData(window.localStorage.getItem("nwgeo_longitude"))&&(o=parseFloat(window.localStorage.getItem("nwgeo_longitude"))),new nwgeo.getMap);i.mapType="roadmap",i.zoomControl=!0,i.mapTypeControl=!0,i.animate=!0,i.bearing=0,i.tilt=0,i.durationAnimation=2e3,i.iconMarker="img/pin_negro_44.png",nw.evalueData(config.iconDriverPuntoB)&&(i.iconMarker=config.iconDriverPuntoB),i.canvas=document.querySelector(this.canvas+" .mapa_edit"),i.latitude=a,i.longitude=o,i.zoom=16,this.map=i.show(function(){}),this.newMarker(),nwgeo.dragMap("drag",this.map,function(e){})},createActionsInputsSearchDirections:function(){var a=this,e=document.querySelector("#f_mapa .address_destino");nwgeo.autocomplete(e,a.map,function(e){a.pointMapDestino(e)},main.configCliente.paises_iso_relation_autocomplete_maps)},updateService:function(e){var a=this,a=this,o=nw.userPolicies.getUserData(),i=a.nuevos_datos,o=(i.empresa=o.empresa,i.perfil=o.perfil,i.usuario=o.usuario,i.id_servicio_edit=a.data_service.id,console.log(i),new nw.rpc(a.getRpcUrl(),"servicios"));o.setAsync(!0),o.setLoading(!1);o.exec("updateServiceDirOrigen",i,function(e){a.callback(),nw.dialog("Se guardo correctamente."),nw.back()})},pointMapDestino:function(e){var a=this,o=(nwgeo.removeAllPolyLines(),a.markerDestino&&nwgeo.removeMarker(a.markerDestino),{});a.debug&&console.log("pointMapDestino()",e),o.lat=e.place.geometry.location.lat(),o.lng=e.place.geometry.location.lng(),o.name=e.results.address,o.icon=e.place.icon,o.name_place=e.place.name,o.ciudad=e.results.ciudad,a.dataDestino=o,!nw.evalueData(o.ciudad)&&nw.evalueData(o.name_place)&&(o.ciudad=o.name_place),a.pointMapDestinoExec(o)},pointMapDestinoExec:function(e){var a=this,o=(nw.evalueData(e.ciudad)&&(a.ciudad_destino=e.ciudad),console.log(e),nw.evalueData(e.name_place)&&(a.name_place_destino=e.name_place,a.name_place_destino_text=e.name_place),nw.evalueData(e.name)&&(a.name_place_destino=e.name),new nwgeo.addMarker);o.map=a.map,o.latitude=e.lat,o.longitude=e.lng,nw.evalueData(e.name)&&(o.title=e.name),o.label="",o.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin_negro_44.png",nw.evalueData(config.iconDriverPuntoB)&&(o.icon=config.iconDriverPuntoB),o.draggable=!1,o.animation=!1,a.markerDestino=o.show(function(){}),nw.evalueData(e.name)&&(a.ui.address_destino.setValue(e.name),a.dataGeoTwo=e,a.dataGeoTwoName=e.name,a.geoDestino.latitudDes=e.lat,a.geoDestino.longitudDes=e.lng,a.geoDestino.ciudad_destino=e.ciudad,a.continuar())},continuar:function(){var n=this,r={total:0,paradas:0};nw.loading(),n.recargosConsult(function(e){if(0<e.length)for(var a=0;a<e.length;a++){var o=e[a].valor;"parada adicional"==e[a].nombre.toLowerCase()?r.paradas=o:r.total=parseFloat(r.total)+parseFloat(o)}var i=nw.userPolicies.getUserData(),t={},i=(t.empresa=i.empresa,t.ciudad_origen=n.data_service.ciudad_origen,t.name_place_origen=n.data_service.origen,t.ciudad_destino=n.ciudad_destino,t.name_place_destino=n.name_place_destino,t.name_place_destino_text=n.name_place_destino_text,n.name_place_origen=t.name_place_origen,nw.evalueData(nwgeo.type)&&(t.type=nwgeo.type),new nw.rpc(n.getRpcUrl(),"servicios"));i.setAsync(!0),i.setLoading(!1);i.exec("consultaTarifasAllApp",t,function(a){if(console.log(a),0===a.length)return nw.loadingRemove(),nw.dialog("Lo sentimos, no tenemos cobertura para el sitio indicado"),!1;var e=n.map,o=(console.log(e),{lat:parseFloat(n.data_service.latitudOri),lng:parseFloat(n.data_service.longitudOri),lat2:n.geoDestino.latitudDes,lng2:n.geoDestino.longitudDes}),e=(console.log(o),n.line=nwgeo.addLineStreet(e,o,function(e){console.log(e),n.pathOriginToDestiny=JSON.stringify(e.pathOnetoOne),n.poly.tiempo=e[0].legs[0].duration_in_traffic.value,n.poly.tiempo_text=e[0].legs[0].duration_in_traffic.text,n.poly.total_metros=e[0].legs[0].distance.value,n.poly.total_metros_text=e[0].legs[0].distance.text,n.mostrarServicios(a,r),n.__recargos=r},main.colorPolyLine,!1,"animate",!0),[{lat:parseFloat(n.data_service.latitudOri),lng:parseFloat(n.data_service.longitudOri)},{lat:n.geoDestino.latitudDes,lng:n.geoDestino.longitudDes}]);nwgeo.centerMap(n.map,n.markerMove,n.markerDestino,!1,e,!0),nw.loadingRemove()})})},mostrarServicios:function(e,a){for(var o=this,i=nw.userPolicies.getUserData(),t=(o.datosServicio={r:e,recargos:a},a.total),n=e.length,r=0,s=0;s<n;s++){var l=e[s],c={},d=0,d=(console.log(o.poly.total_metros),console.log(l.metros),console.log(o.poly.tiempo),console.log(l.tiempo),void 0!==l.metros&&""!=l.metros&&0<parseFloat(l.metros)&&(d=parseFloat(o.poly.total_metros)/parseFloat(l.metros)),console.log(d),parseFloat(d)*parseFloat(l.valor_unidad_metros)),u=(isNaN(d)&&(d=0),console.log(d),0),p=(void 0!==l.tiempo&&""!=l.tiempo&&0<parseFloat(l.tiempo)&&(u=parseFloat(o.poly.tiempo)/parseFloat(l.tiempo)),console.log(u),parseFloat(u)*parseFloat(l.valor_unidad_tiempo)),_=(isNaN(p)&&(p=0),console.log(p),parseFloat(d)+parseFloat(p)+parseFloat(l.valor_banderazo)+parseFloat(t)),g=parseFloat(l.minima);if(console.log(a),c.recargos=t,c.valorbase=l.valor_banderazo,c.totaluniminutos=parseInt(u),c.valorminutos=p,c.totalunimetros=parseInt(o.poly.total_metros),c.valordistancia=parseFloat(d),c.unidad_metros=l.metros,c.valor_unidad_metros=l.valor_unidad_metros,c.unidad_tiempo=l.tiempo,c.valor_unidad_tiempo=l.valor_unidad_tiempo,c.valor_metros_add=l.valor_metros_add,c.inicia_metros_add=l.inicia_metros_add,c.concepto_recargo="",c.metros_cobro_recargo=0,c.valor_recargo=0,console.log(l.valor_recargo),nw.evalueData(l.valor_recargo)&&(c.metros_cobro_recargo=l.metros_cobro_recargo,c.valor_recargo=l.valor_recargo,c.concepto_recargo=l.concepto_recargo),_=parseFloat(_)+parseFloat(c.valor_recargo),console.log(_),c.valor_peajes=0,c.metros_cobro_peaje=0,nw.evalueData(l.valor_peajes)&&(c.valor_peajes=l.valor_peajes,c.metros_cobro_peaje=l.metros_cobro_peaje),(_=parseFloat(_)+parseFloat(c.valor_peajes))<g&&(_=g),"LIBRE"===o.cobro&&(_=0),"SI"!==l.solo_para_mujeres||"hombre"!==i.genero){if(nw.evalueData(l.ciudad_o_lugar_origen)&&nw.evalueData(l.ciudad_o_lugar_destino)){u=new RegExp(o.name_place_destino_text).test(l.ciudad_o_lugar_destino);if(console.log(o.data_service.ciudad_origen),console.log(l.ciudad_o_lugar_origen),console.log("yy"),console.log(o.ciudad_destino),console.log(l.ciudad_o_lugar_destino),console.log(o.name_place_origen),console.log(l.ciudad_o_lugar_origen),console.log("yy"),console.log(o.name_place_destino),console.log(l.ciudad_o_lugar_destino),console.log(o.data_service.ciudad_origen),console.log(l.ciudad_o_lugar_origen),console.log("yy"),console.log(u),console.log(o.name_place_destino_text),console.log("ee"),!(o.data_service.ciudad_origen===l.ciudad_o_lugar_origen&&o.ciudad_destino===l.ciudad_o_lugar_destino||o.data_service.ciudad_origen===l.ciudad_o_lugar_origen&&o.name_place_destino===l.ciudad_o_lugar_destino||o.name_place_origen===l.ciudad_o_lugar_origen&&o.name_place_destino===l.ciudad_o_lugar_destino||o.name_place_origen===l.ciudad_o_lugar_origen&&o.ciudad_destino===l.ciudad_o_lugar_destino||o.data_service.ciudad_origen===l.ciudad_o_lugar_origen&&u))continue;"trayecto"!==l.valor_tarija_fija&&l.valor_tarija_fija,r++}p={};if(p.valor_estimado=_,p.iva=parseInt(l.iva),p.ptm=o.poly.total_metros_text,p.pt=o.poly.tiempo_text,p.total_metros=o.poly.total_metros,p.tiempo=Math.round(o.poly.tiempo/60),p.servi=l,p.others=c,p.id_servi=l.id,p.id_tarifa=l.id_service_tarifa_fija,p.iva=_*p.iva/100,p.valor_estimado=_+p.iva,p.valor_estimado=Math.round(p.valor_estimado),console.log(o.dataDestino),p.destino=o.dataDestino.name,p.ciudad_destino=o.dataDestino.ciudad,p.latitudDes=o.dataDestino.lat,p.longitudDes=o.dataDestino.lng,console.log(p),"trayecto"!=o.data_service.tarifa&&(p.valor_estimado=o.data_service.valor),l.id===o.data_service.servicio){o.nuevos_datos=p;break}}}if(0===r)return nw.loadingRemove(),nw.dialog("Lo sentimos, no hay cobertura para tu zona"),!1},recargosConsult:function(a){var o=this,e=nw.userPolicies.getUserData(),i={},e=(i.empresa=e.empresa,i.perfil=e.perfil,i.usuario=e.usuario,new nw.rpc(o.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("populateRecargos",i,function(e){if(o.debug&&console.log("recargosConsult",e),"USUARIO_NO_EXISTE"===e)return nw.dialog("El usuario no existe o está inactivo"),!1;e=e.recargos;a(e)})},newMarker:function(){var e=this,a=(e.add=!0,console.log(e.map),new nwgeo.addMarker);a.map=e.map,a.latitude=parseFloat(e.data_service.latitudOri),a.longitude=parseFloat(e.data_service.longitudOri),a.title="",a.label="",a.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",nw.evalueData(config.iconDriverPuntoA)&&(a.icon=config.iconDriverPuntoA),a.draggable=!1,a.animation=!1,console.log(a),e.markerMove=a.show()},removeMarkersMap:function(){for(var e=this.markersCalor.length,a=0;a<e;a++)nwgeo.removeMarker(this.markersCalor[a]);return!0},getPosCenterMap:function(){var e,a=0,o=0;return o=nwgeo.native?(a=(e=this.map.getCameraTarget()).lat,e.lng):(a=this.map.center.lat(),this.map.center.lng()),{lat:a,lng:o}}}}),nw.Class.define("f_cancelar_servicio",{extend:nw.forms,construct:function(e){var a=this,o=(a.id="f_cancelar_servicio",a.showBack=!0,a.closeBack=!1,a.transition="slide",a.setTitle="Cancelar","<p style='text-align: center;'>"+nw.utils.tr("Recuerde que si no cancela a tiempo se podrán generar recargos")+"."),e=(o+=" </br>"+nw.utils.tr("Seleccione el motivo de la cancelación"),a.parent=e,nw.evalueData(a.parent)&&nw.evalueData(a.parent.dataServiceActive)&&(o+="<span style='display: block; font-size: 12px; font-style: italic; color: gray;'>"+nw.utils.tr("Servicio: ")+a.parent.dataServiceActive.id,nw.evalueData(a.parent.dataServiceActive.id_parada)&&(o+=" - "+nw.utils.tr("Parada / Pasajero: ")+a.parent.dataServiceActive.id_parada),o+="</span>"),a.html=o+="</p>",a.createBase(),a.recargo="0",a.event=new Event("cancelServi"),a.setFields([{icon:"material-icons account_circle normal",name:"id",label:"ID",type:"textField",visible:!1},{icon:"material-icons account_circle normal",name:"cancelado_motivo",label:"Motivo",placeholder:"Motivo",type:"radio",required:!0},{icon:"material-icons account_circle normal",name:"cancelado_notas",label:"Observaciones",placeholder:"Observaciones",type:"textArea",required:!0}]),a.buttons=[{style:"",icon:"material-icons how_to_reg normal",colorBtnBackIOS:"#ffffff",position:"top",name:"aceptar",label:"Cancelar",callback:function(){a.cancelar()}}],a.show(),console.log("self.canvas",a.canvas),document.createElement("style")),o=(e.className="css_cancel",e.innerHTML=".ofertas_container{display: none!important;}",document.querySelector(a.canvas).appendChild(e),nw.userPolicies.getUserData()),e={};e.terminal=o.terminal,e.empresa=o.empresa,e.usuario=o.usuario,e.perfil=o.perfil,a.ui.cancelado_motivo.populateSelect("conductores","consultaTipologiaCancelacion",e,function(e){0==e.length&&a.ui.cancelado_motivo.populateSelectFromArray({conductor_pidio:"El conductor me lo ha pedido",tarda_mucho:"Está tardando demasiado",tengo_otro_coche:"Ya tengo otro coche",estoy_probando:"Solo estoy probando"})},!0),a.ui.id.setValue(main.id_service_active)},destruct:function(){},members:{cancelarParada:function(a){var o=this,e=new nw.rpc(o.getRpcUrl(),"app_user");e.setAsync(!0),e.setLoading(!1);e.exec("cancelarParada",a,function(e){return console.log("ra",e),nw.dialog("Parada cancelada correctamente."),main.registerServiceInFirebase(a.id),o.cancelarEnd()})},cancelar:function(){var a,e,o,i,t=this,n=t.getRecord();return nw.evalueData(t.parent)&&nw.evalueData(t.parent.dataServiceActive)&&nw.evalueData(t.parent.dataServiceActive.id_parada)&&(n.id_parada=t.parent.dataServiceActive.id_parada),console.log("self.parent",t.parent),console.log("self.parent.dataServiceActive",t.parent.dataServiceActive),console.log("data",n),!!t.validate()&&(nw.evalueData(n.cancelado_motivo_text)?(n.pide_fotos=n.cancelado_motivo,n.cancelado_motivo=n.cancelado_motivo_text,nw.utils.evalueData(n.id_parada)?t.cancelarParada(n):(a=n=void 0,e=t.parent.datos_servicio_activo,console.log("data_parent",e),(o=t.getRecord()).pide_fotos=o.cancelado_motivo,o.cancelado_motivo=o.cancelado_motivo_text,i=nw.userPolicies.getUserData(),nw.evalueData(o.cancelado_motivo)?(console.log(i),void 0!==e&&(o.cancela="cancela_usuario",o.tiempo=e.hora,o.hora_llegada=e.hora_llegada,o.estado_service=e.estado),o.empresa=i.empresa,o.perfil=i.perfil,o.usuario=i.usuario,o.nombre=i.nombre,o.apellido=i.apellido,o.terminal=i.terminal,o.nit=i.documento,o.domain_rpc=config.domain_rpc,o.estado="CANCELADO_POR_USUARIO",nw.evalueData(n)&&(o.files=n),0<o.recargo&&nw.dialog("Servicio cancelado,  el coste de cancelación es de "+o.recargo+" "+config.moneda),(e=new nw.rpc(nw.getRpcUrl(),"servicios")).setAsync(!0),e.setLoading(!0),void e.exec("cancelarServicio",o,function(e){return main.registerServiceInFirebase(o.id),t.cancelarEnd(e,a)})):void nw.dialog("Seleccione un motivo de cancelación"))):(nw.dialog("Seleccione un motivo de cancelación"),!1))},cancelarEnd:function(e,a){var o=this;nw.remove(".ofertas_container"),nw.evalueData(a)&&a(),"string"==typeof e&&(o.recargo=e),o.event.detail={recargo:o.recargo},document.dispatchEvent(o.event),nw.back(),o.parent.cancelservice()}}}),nw.Class.define("f_favoritos",{extend:nw.forms,construct:function(e){var o=this,e=(o.id="f_favoritos",o.setTitle="<span style='color:#fff;'>Ubicaciones</span>",o.html="Crear / editar lugar",o.showBack=!0,o.closeBack=!1,o.textClose="Volver",o.colorBtnBackIOS="#ffffff;",o.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",o.transition="slide",o.createBase(),o.callback=e,o.results="",o.orden="100",o.tipo="favorite",o.event=new Event("loadApply"),o.setFields([{name:"id",label:"ID",placeholder:"id",type:"textField",required:!1,visible:!1},{name:"nombre",label:"Personalizar nombre de lugar",placeholder:"Personalizar nombre de lugar",type:"textField",required:!0,visible:!0},{name:"direccion",label:"Dirección",placeholder:"Dirección",type:"textField",required:!0,enabled:!0,visible:!0}]),o.buttons=[{style:"border: 0;background-color:#ffffff;color:#f18107;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#f18107",name:"aceptar",label:"Guardar",callback:function(){o.save()}}],o.show(),document.querySelector(".direccion"));nwgeo.autocomplete(e,!1,function(e){var a={lat:e.place.geometry.location.lat(),lng:e.place.geometry.location.lng(),name:e.place.name,icon:e.place.icon,name_place:e.place.name,ciudad:e.results.ciudad};"favorite"===o.tipo&&(o.ui.nombre.setVisibility(!0),o.ui.nombre.setValue(e.place.name)),a.type=e.results.type,console.log("dataresult",e),console.log(a),console.log(o.tipo),o.results=JSON.stringify(a)},main.configCliente.paises_iso_relation_autocomplete_maps)},destruct:function(){},members:{save:function(){var a=this;if(!a.validate())return!1;var e=nw.userPolicies.getUserData(),o=a.getRecord(!0),e=(o.usuario=e.usuario,o.empresa=e.empresa,nw.evalueData(a.results)&&(o.results=a.results),o.orden=a.orden,o.tipo=a.tipo,console.log(o),new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0);e.exec("savePreferidos",o,function(e){if(console.log("save",e),!0===e)return nw.back(),console.log("self.callback",a.callback),nw.evalueData(a.callback)&&a.callback(),!0;nw.dialog(e)})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_tarjetas_credito",{extend:nw.forms,construct:function(e){var o=this,a=(o.id="f_tarjetas_credito",o.setTitle="<span style='color:#fff;'>Registrar tarjeta</span>",o.html="",o.showBack=!0,o.closeBack=!1,o.textClose="Volver",o.colorBtnBackIOS="#ffffff;",o.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",o.createBase(),o.callback=e,nw.userPolicies.getUserData()),e=[];e.push({label:"",name:"card-form",modeForm:"form",type:"startGroup"},{styleContainer:"width:50%;float:left;margin:0px;",name:"price",label:"Price",visible_label:!0,placeholder:"Price",type:"textField",required:!0,enabled:!1,visible:!1},{styleContainer:"width:50%;float:left;margin:0px;",name:"cuotas",label:"Cuotas",visible_label:!0,placeholder:"Cuotas",type:"selectBox",required:!0,enabled:!1,visible:!1},{styleContainer:"width:100%;float:left;margin:0px;",name:"nombre_tarjeta",car_min:"3",car_max:"100",label:"Nombre títular tarjeta",placeholder:"Nombre títular tarjeta",visible_label:!1,type:"textField",required:!0}),"epayco"===config.paymentStore&&e.push({styleContainer:"width:100%;float:left;margin:0px;",name:"apellido_tarjeta",car_min:"3",car_max:"100",label:"Apellido",visible_label:!1,placeholder:"Apellido",type:"textField",required:!1}),e.push({styleContainer:"width:100%;float:left;margin:0px;",name:"tipo_documento",visible_label:!1,label:"Tipo Documento",placeholder:"Tipo Documento",type:"selectBox",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"documento",visible_label:!1,label:"Documento",placeholder:"Documento",type:"numeric",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"email",visible_label:!1,label:"Correo electrónico",placeholder:"Correo electrónico",type:"textField",mode:"email",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"nombre_banco",visible_label:!1,label:"Banco",placeholder:"Banco",type:"radio",required:!0},{styleContainer:"width:100%;float:left;margin:0px;",name:"numero_tarjeta",visible_label:!1,label:"Número de tarjeta",placeholder:"Número de tarjeta",type:"numeric",required:!0},{styleContainer:"width:31%;float:left;margin:0px 5px 0px 0px;",style:"font-size:12px;padding-top: 10px;padding-bottom: 10px;",name:"mes_vencimiento",label:"Mes",placeholder:"Mes de vto",type:"selectBox",required:!0},{styleContainer:"width:31%;float:left;margin:0px 5px 0px 0px;",style:"font-size:12px;padding-top: 10px;padding-bottom: 10px;",name:"anio_vencimiento",label:"Año",placeholder:"Año de vto",type:"selectBox",required:!0},{styleContainer:"width:31%;float:left;margin:0px 5px 0px 0px;",style:"font-size:12px;padding-top: 10px;padding-bottom: 10px;",name:"codigo_seguridad",label:"CCV",visible_label:!0,placeholder:"CCV",type:"numeric",required:!0},{styleContainer:"width:100%;float:left;margin:0px 0;",name:"pais",label:"País",placeholder:"País",type:"selectBox",required:!0},{modeForm:"form",type:"endGroup"}),o.setFields(e),o.buttons=[{style:"border: 0;background-color:#f18107;color:#ffffff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#ffffff",name:"aceptar",label:"Guardar",callback:function(){"Conekta"===config.paymentStore?o.submitConekta():o.save()}}],o.show(),o.ui.pais.populateSelectFromArray(t={"":"Seleccione"}),o.ui.tipo_documento.populateSelectFromArray(t={"":"Tipo documento",CC:"Cédula de ciudadanía",PP:"Pasaporte"}),o.ui.tipo_documento.setValue(""),o.ui.nombre_banco.populateSelectFromArray(t={VISA:"<div class='creditscards visa'></div>",MASTERCARD:"<div class='creditscards mastercard'></div>",AMEX:"<div class='creditscards amex'></div>",DINERS:"<div class='creditscards diners'></div>"}),(t={})[0]="-"+nw.str("Año")+"-";for(var i=21;i<34;i++)t["20"+i]=i;o.ui.anio_vencimiento.populateSelectFromArray(t),o.ui.anio_vencimiento.setValue("0");for(var t={},i=1;i<13;i++)t[i]=i;o.ui.cuotas.populateSelectFromArray(t),o.ui.cuotas.setValue("1"),(t={})[0]="-"+nw.str("Mes")+"-";for(i=0;i<12;i++){var n=i+1;t[n=1===(n=n.toString()).length?"0"+n:n]=n}o.ui.mes_vencimiento.populateSelectFromArray(t),o.ui.mes_vencimiento.setValue("0"),o.ui.pais.changeValue(function(e){e=e.value;console.log("d",e),console.log("self.ui.pais.getValue",o.ui.pais.getValue())});(t={}).empresa=a.empresa,t.usuario=a.usuario,t.perfil=a.perfil,o.ui.pais.populateSelect("app_user","populatePaises",t,function(e){nw.evalueData(a.pais)&&o.ui.pais.setValue(a.pais)},!0);var r,e="",e=(nw.evalueData(a.nombre)&&(e+=a.nombre),nw.evalueData(a.apellido)&&(e+=" "+a.apellido),nw.evalueData(e),nw.evalueData(a.email),nw.evalueData(a.nit),o.ui.nombre_banco.changeValue(function(e){o.setValueBanco(e.value)}),o.ui.numero_tarjeta.changeValue(function(e){e=e.value,e=o.detectCardType(e);nw.evalueData(e)?(o.ui.nombre_banco.setValue(e),o.setValueBanco(e)):(o.setValueBanco(!1),o.ui.nombre_banco.setValue(""))}),"5000");nw.utils.evalueData(main.configCliente.valor_minimo_activacion_tarjeta_credito)&&(e=main.configCliente.valor_minimo_activacion_tarjeta_credito),o.ui.price.setValue(e),o.testing=!1,o.testing&&(o.ui.nombre_banco.setValue("VISA"),o.ui.numero_tarjeta.setValue("4122761896646819"),o.ui.mes_vencimiento.setValue("12"),o.ui.anio_vencimiento.setValue("2025"),o.ui.codigo_seguridad.setValue("123"),o.ui.documento.setValue("1096957503"),o.ui.tipo_documento.setValue("CC"),o.setValueBanco("VISA")),o.conektaLoad=!1,o.conektaToken=!1,"Conekta"===config.paymentStore&&(r=nw.loading2(),console.log("lo",r),nw.require("https://cdn.conekta.io/js/latest/conekta.js",function(){r.remove();var e="key_YqdyrbWJrh6aqoPGwvzPrxA";!0===config.paymentStorePruebas&&(e="key_Bks5AsVrZxP5ro3G79YaHzg"),Conekta.setPublicKey(e),o.conektaSuccessResponseHandler=function(e){console.log("token",e),console.log("token.id",e.id),o.conektaToken=e.id,o.saveConekta()},o.conektaErrorResponseHandler=function(e){console.log("ERROR:::",e),nw.dialog(e.message_to_purchaser)},$(function(){$("#card-form").submit(function(e){var a=$(this);return Conekta.Token.create(a,o.conektaSuccessResponseHandler,o.conektaErrorResponseHandler),!1})}),o.ui.tipo_documento.setVisibility(!1),o.ui.pais.setVisibility(!1),document.querySelector(".nombre_tarjeta").setAttribute("data-conekta","card[name]"),document.querySelector(".numero_tarjeta").setAttribute("data-conekta","card[number]"),document.querySelector(".codigo_seguridad").setAttribute("data-conekta","card[cvc]"),document.querySelector(".mes_vencimiento").setAttribute("data-conekta","card[exp_month]"),document.querySelector(".anio_vencimiento").setAttribute("data-conekta","card[exp_year]"),o.conektaLoad=!0},!0))},destruct:function(){},members:{submitConekta:function(){return!!this.validate()&&(this.conektaLoad?void $("#card-form").submit():(nw.dialog("Un momento, la API no ha cargado"),!1))},saveConekta:function(){var a,e,o,i=this;return!!i.validate()&&(i.conektaLoad?(o=nw.userPolicies.getUserData(),a=i.getRecord(),(e=i.getRecord()).token_id=i.conektaToken,e.payment_method_type="card",e.more_info="",e.reference="123456789",e.ruta="/app/pagos/",e.name=a.nombre_tarjeta,e.email=a.email,e.usuario=o.usuario,e.perfil=o.perfil,e.empresa=o.empresa,e.terminal=o.terminal,e.phone=o.celular,e.itemName="Inscripción tarjeta",e.itemDescription="Inscripción tarjeta",e.item_unit_price=300,e.itemQuantity=1,e.street1="Calle 123, int 2",e.postal_code="06100",e.country="MX",console.log("data",a),console.log("d",e),(o=new nw.rpc(nw.getRpcUrl(),"nwMaker")).setAsync(!0),o.setLoading(!0),void o.exec("validaCardConektaByApi",e,function(e){if(console.log("SAVE:::saveConekta:::r",e),!0===e)return nw.dialog("Creada correctamente"),nw.evalueData(i.callback)&&(nw.back(),i.callback(a)),!0;nw.dialog(e)})):(nw.dialog("Un momento, la API no ha cargado"),!1))},save:function(){var e,i,a,t=this;return!!t.validate()&&(e=nw.userPolicies.getUserData(),i=t.getRecord(),console.log("data",i),nw.evalueData(i.nombre_banco)?(a=t.ui.pais.getValue(),console.log("pais",a),i.pais=a.data_array.alias,i.currency=a.data_array.moneda,i.fecha_vencimiento=i.anio_vencimiento+"/"+i.mes_vencimiento,i.usuario=e.usuario,i.empresa=e.empresa,i.perfil=e.perfil,i.usuario_text=e.nombre,i.id_usuario=e.id_usuario,i.type=config.paymentStore,void 0!==config.apiKeyEpayco&&""!=config.apiKeyEpayco&&(i.apiKeyEpayco=config.apiKeyEpayco),void 0!==config.privateKeyEpayco&&""!=config.privateKeyEpayco&&(i.privateKeyEpayco=config.privateKeyEpayco),i.test="NO",nw.utils.evalueData(main.configCliente.pagosPruebas)&&(i.test=main.configCliente.pagosPruebas),i.pago_unico_mensual="UNICO",i.description="Suscripción de tarjeta en "+config.name,console.log("send:::",i),(a=new nw.rpc(nw.getRpcUrl(),"nwMaker")).setAsync(!0),a.setLoading(!0),void a.exec("apiNwPayTesting",i,function(e){if(console.log("save",e),"epayco"===config.paymentStore)return"Rechazada"===e.status?(a="",a+=e.estado+". "+e.respuesta+". Referencia de seguimiento #"+e.ref_payco,void nw.dialog(a)):"OK"===e.status?(nw.dialog("Creada correctamente"),nw.evalueData(t.callback)&&(nw.back(),t.callback(i)),!0):(nw.dialog(e),!1);if("payu"===config.paymentStore){var a=nw.validateNwPayments(e.result);if(console.log(a),!a.approved)return o="",o=(o+=a.status_description+". <br />")+a.responseCode+" <br />",nw.evalueData(a.responseMessage)&&(o+=a.responseMessage+". <br />"),o+=a.status+". <br />",nw.dialog(o),!1;var o="";o=(o=(o+=a.status_description+". <br />")+(a.responseCode+". <br />"))+(a.responseMessage+". <br />");nw.dialog(o,function(){nw.evalueData(t.callback)&&(nw.back(),t.callback(i))}),nw.evalueData(t.callback)&&(nw.back(),t.callback(i))}})):(nw.dialog("Debe seleccionar un banco"),!1))},setValueBanco:function(e){var a=this;a.ui.numero_tarjeta.removeClass("selected_tarjet_input_VISA"),a.ui.numero_tarjeta.removeClass("selected_tarjet_input_MASTERCARD"),a.ui.numero_tarjeta.removeClass("selected_tarjet_input_AMEX"),a.ui.numero_tarjeta.removeClass("selected_tarjet_input_DINERS"),nw.evalueData(e)&&a.ui.numero_tarjeta.addClass("selected_tarjet_input_"+e)},populate:function(e){this.setRecord(e)},detectCardType:function(e){var a,o={VISA:/^4[0-9]{12}(?:[0-9]{3})?$/,MASTERCARD:/^5[1-5][0-9]{14}$/,AMEX:/^3[47][0-9]{13}$/,DINERS:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,electron:/^(4026|417500|4405|4508|4844|4913|4917)\d+$/,maestro:/^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/,dankort:/^(5019)\d+$/,interpayment:/^(636)\d+$/,unionpay:/^(62|88)\d+$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/};for(a in o)if(o[a].test(e))return a;return!1}}}),nw.Class.define("f_novedades",{extend:nw.forms,construct:function(){var e=this;e.id="f_novedades",e.setTitle="<span style='color:#fff;'>Reportar novedad</span>",e.html="",e.showBack=!0,e.closeBack=!1,e.colorBtnBackIOS="#ffffff;",e.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",e.transition="slideup",e.createBase(),e.data=null;e.setFields([{name:"comentario",label:"Comentarios",visible_label:!0,placeholder:"Comentarios",type:"textArea",required:!0},{name:"adjunto",label:"Adjunto (opcional)",visible_label:!0,type:"button",mode:"camera_files",required:!1}]),e.buttons=[],e.buttons.push({style:"border: 0;background-color:#f18107;color:#ffffff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#ffffff",position:"top",name:"enviar",label:"Enviar",callback:function(){e.save()}}),e.show()},destruct:function(){},members:{save:function(){if(!this.validate())return!1;var e=this.getRecord(!0),a=nw.userPolicies.getUserData(),a=(console.log(a),e.id_usuario=a.id_usuario,e.usuario=a.usuario,e.empresa=a.empresa,e.perfil=a.perfil,e.id_viaje=this.data.id,console.log(e),new nw.rpc(nw.getRpcUrl(),"servicios"));a.setAsync(!0),a.setLoading(!0);a.exec("reportarNovedad",e,function(e){if(console.log(e),!0!==e)return nw.dialog(e),!1;nw.dialog("Enviado correctamente"),nw.back()})},populate:function(e){this.data=e}}}),nw.Class.define("f_crear_parada",{extend:nw.forms,construct:function(o,e){var i=this,e=(i.id="f_crear_parada",i.setTitle="<span style='color:#fff;'>Agregar parada</span>",i.transition="slide",i.showBack=!0,i.closeBack=!1,i.textClose="Atrás",i.colorBtnBackIOS="#ffffff;",i.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",i.map=e,i.closeBackCallBack=function(){nw.back()},i.createBase(),i.setFields([{icon:"n",name:"direccion",label:"Dirección de la parada",placeholder:"Dirección de la parada",type:"search",required:!0},{type:"textField",label:"Nombre del pasajero (opcional)",placeholder:"Nombre pasajero (opcional)",name:"nombre_pasajero",visible:!0},{type:"textArea",label:"Comentarios, indicaciones (opcional)",placeholder:"Comentarios, indicaciones (opcional)",name:"descripcion_carga",visible:!0},{type:"textField",label:"",placeholder:"Latitud",name:"latitud",visible:!1},{type:"textField",label:"",placeholder:"Longitud",name:"longitud",visible:!1}]),i.buttons=[{style:"background-color: var(--color_verde);color: #ffffff;",icon:"material-icons how_to_reg normal",position:"bottom",name:"aceptar",label:"Aceptar",callback:function(){var e,a=i.getRecord();if(!i.validate())return!1;void 0!==o.guardar_paradas?o.saveParada(a):void 0!==o.update_paradas?o.updateParada(a):(console.log("parent.arrayParadas",o.arrayParadas),console.log("parent.arrayParadas.length",o.arrayParadas.length),console.log("parent.markersParadas",o.markersParadas),console.log("parent.markersParadas.length",o.markersParadas.length),a.index_arrayParadas=o.arrayParadas.length,a.index_markersParadas=o.markersParadas.length,console.log("data",a),o.navTable.addRow(a),o.arrayParadas.push(a),(e=new nwgeo.addMarker).map=o.map,e.latitude=a.latitud,e.longitude=a.longitud,e.label="",e.icon=config.domain_rpc+"/lib_mobile/driver/img/marker_v.png",e.draggable=!1,e.animation=!1,a=e.show(function(){}),o.markersParadas.push(a),o.traeTarifas.evalueContinuarPoliLyne()),nw.back()}}],i.show(),document.querySelector(i.canvas+" .direccion"));nwgeo.autocomplete(e,i.map,function(e){var a={};a.results=e.place,a.address=e.address,a.lat=e.place.geometry.location.lat(),a.lng=e.place.geometry.location.lng(),i.ui.latitud.setValue(a.lat),i.ui.longitud.setValue(a.lng)},main.configCliente.paises_iso_relation_autocomplete_maps)},destruct:function(){},members:{canvas:function(e){this.canvas=e}}}),nw.Class.define("f_crear_viaje",{extend:nw.forms,construct:function(o){var i=this,e=(i.canvas="#foo",i.id_form="l_visitantes",i.stepValue=500,i.valor_total=0,i.data_carga=!1,i.numeroAuxiliares=0,i.arrayParadas=[],i.markersParadas=[],i.data_aeropuerto_servicio=!1,i.__vl_services=[],i.orienta=!1,i.markersCalor=[],i.createDataDriver=!1,i.__show=!1,i.puntajeDriver=!1,i.shotFirstUbicationDriver=!1,i.moveInter=null,i.animations3D=!0,i.debugConstruct=main.debugConstruct,i.debug=!1,i.hoyDate=nw.getActualDate(),i.servicioTomado=!1,i.serviceActive=!1,i.recibeGeoDriver=!1,i.timeNoRecibeGeoDriver=0,i.ciudad_destino=!1,i.name_place_destino=!1,i.name_place_destino_text=!1,i.subcategoria_servicio_text="",i.descuento_maximo=0,i.configCliente={},i.dragMap=!1,i.latitudMapaDrag=0,i.longitudMapaDrag=0,i.activeWatchPosition=!1,i.dataHtmlConductor=!1,i.timeIntervalo=13e3,i.loadedInitialMyUbication=!1,i.loadedFirst=!1,i.cobro=!1,i.num_mascota=0,i.interval=null,i.infoWindow=null,i.fram=!1,i.servicioAllData=!1,i.servicio_nom=!1,i.markerMyPosition=!1,i.markerDestino=!1,i.marker3=!1,i.markerDriver=!1,i.markerSelected=!1,i.inte="",i.initAbordo=!1,i.initservice=!1,i.campo="address",i.tipo="",i.fin=!1,i.line=!1,i.lineRutaFinal=!1,i.launch=!0,i.circu=!1,i.activeNormalV=!1,i.actEnRuta=!1,i.positionConductor=!1,i.conductorLlegaASitio=!1,i.datosServicio=!1,i.mostrar_group_detalle=!0,i.cancela_conductor=!1,i.minutos_agregar_hora=60,i.poly={},i.geo={},i.geoDestino={},i.heightMap=$("body").height(),[{label:"",name:"contenedor_adondevamos",type:"startGroup"},{type:"html",label:"",visible_label:!0,name:"labelname_adondevas"},{icon:"material-icons location_on normal",type:"button",label:"¿A dónde vas?",visible_label:!0,name:"button_adondevas"},{type:"endGroup"},{label:"",style:"",name:"contenedor_address",type:"startGroup",visible:!0},{type:"button",name:"backAdondevamos",label:'<i class="material-icons">arrow_back</i>'},{label:"",name:"contenedor_direcciones_enc",type:"startGroup"},{styleContainer:"margin: 0;",style:"",icon:"material-icons location_on normal",type:"search",label:"Origen",visible_label:!1,name:"address",required:!0,placeholder:"Lugar o dirección de recogida",visible:!0},{styleContainer:"margin: 0;",style:"",icon:"material-icons near_me normal",type:"search",label:"Destino",visible_label:!1,name:"address_destino",required:!0,placeholder:"¿A dónde vamos?",visible:!0},{styleContainer:"margin: 0;",style:"",icon:"material-icons check_circle normal",type:"button",label:"Confirmar ubicación de origen",name:"confirmar_ub",visible:!1},{styleContainer:"",style:"",icon:"material-icons person_pin_circle normal",type:"button",label:"Fijar en el mapa",visible_label:!1,visible:!1,name:"fijar_en_mapa_origen"},{styleContainer:"",style:"",icon:"material-icons person_pin_circle normal",type:"button",label:"Fijar en el mapa",visible_label:!1,visible:!1,name:"fijar_en_mapa_destino"},{type:"endGroup"},{label:"",name:"favoritos_group",type:"startGroup",visible:!0},{type:"endGroup"},{type:"endGroup"},{styleContainer:"margin:0;",label:"",name:"mapa",type:"startGroup"},{type:"endGroup"},{style:"",label:"",name:"contenedor_btn_fijar",type:"startGroup"},{type:"html",label:"Mueve el mapa para ubicar tu destino",visible:!1,name:"listo_fijar_label"},{styleContainer:"",style:"",icon:"",type:"button",label:"Listo",visible_label:!1,visible:!1,name:"listo_fijar"},{type:"endGroup"},{style:"",label:"",name:"pago_group",type:"startGroup"},{styleContainer:"",style:"",icon:"material-icons card_giftcard normal",type:"button",label:"Mis cupones",visible_label:!1,placeholder:"",name:"codigo_promo"},{styleContainer:"",type:"switch",label:"Tipo",name:"tipo_servicio",options:"<option value='ahora'>"+nw.utils.tr("Inmediato")+"</option><option value='reservado'>"+nw.utils.tr("Programado")+"</option>",visible:!1},{styleContainer:"",type:"switch",label:"Forma",name:"forma",options:"<option value='trayecto'>Trayecto</option><option value='horas'>Horas</option>",visible:!1},{styleContainer:"",type:"radio",label:"Pago",name:"tipo_pago",visible:!1},{type:"textField",label:"Tarjeta ID",name:"tarjeta_id",visible:!1},{styleContainer:"",style:"",type:"textField",visible_label:!1,label:"Tarjeta",placeholder:"Sin tarjeta",enabled:!1,name:"tarjeta",visible:!1},{label:"",name:"fechas_group",type:"startGroup",visible:!1},{styleContainer:"",style:"",type:"dateField",label:"Fecha",placeholder:"Fecha",visible_label:!1,name:"fecha",visible:!0},{styleContainer:"",style:"",type:"time",label:"Hora",placeholder:"Hora",visible_label:!1,name:"hora",visible:!0},{type:"endGroup"},{label:"",name:"des_carga",type:"startGroup",visible:!1},{type:"textArea",label:"",placeholder:"Observaciones, indicaciones",name:"descricion_carga",visible:!1},{type:"endGroup"},{label:"",name:"contenedor_azul",type:"startGroup"},{type:"selectBox",label:"Total pax",placeholder:"Total pax",name:"paradas_adicionales_iniciales_creacion",visible:!1},{styleContainer:"width:98%;float:left;margin:5px -2px",style:"font-size: 13px;margin: 0px;width:100%;",type:"button",icon:"material-icons golf_course normal",label:"Agregar parada",name:"add_parada"},{type:"endGroup"},{label:"",name:"paradas_group",type:"startGroup",visible:!0},{type:"endGroup"},{type:"textArea",label:"Ingresa placa y color del vehículo",placeholder:"Ingresa placa y color del vehículo",visible_label:!1,car_min:"10",name:"datos_vehiculo_elegido",visible:!1},{type:"button",label:"Confirmar",name:"pedir"},{type:"endGroup"},{label:"",style:"",name:"buscando_driver",type:"startGroup"},{type:"html",label:"<span class='countWait' style='display:block;'>1</span>"+nw.utils.tr("Buscando conductor, por favor espera")+"...",name:"html_buscando"},{label:"",style:"",name:"actualizar_precio",mode:"div",type:"startGroup",visible:!1},{type:"button",label:"-",name:"bajar_precio"},{type:"numeric",label:"Precio actual",name:"actual_precio"},{type:"button",label:"+",name:"aumentar_precio"},{type:"button",label:"Confirmar precio",name:"confirmar_precio"},{mode:"div",type:"endGroup"},{type:"button",label:"Cancelar",name:"cancelar_pedido"},{type:"endGroup"},{style:"",label:"",name:"driver_en_camino",type:"startGroup"},{type:"html",label:"",name:"html_driver_en_camino"},{type:"button",label:"Cancelar",name:"cancelar_pedido_en_ruta"},{type:"endGroup"}]),e=(i.setFields(e),i.buttons=[],i.buttons.push({icon:"material-icons my_location mi_ubication_pin_geo",position:"top",name:"centrar_mapa",label:"",callback:function(){i.centrarMapaGPS()}}),i.show(),!1===config.usaCupones&&i.ui.codigo_promo.setVisibility(!1),document.querySelector(".headerHome")),a=document.querySelector(".nw_widget_div_codigo_promo"),t=(e.appendChild(a),i.ui.des_carga.setVisibility(!1),nw.addClass(document.querySelector(i.canvas),"f_crear_viaje"),i.setDataPago(),nw.userPolicies.getUserData());i.__up=t,i.ui.labelname_adondevas.setValue(nw.utils.tr("Hola")+", "+t.nombre),i.ui.contenedor_btn_fijar.setVisibility(!1),i.ui.contenedor_azul.setVisibility(!1),i.ui.paradas_group.setVisibility(!1),i.backInShowServices=document.createElement("div"),i.backInShowServices.innerHTML='<i class="material-icons">arrow_back</i>',i.backInShowServices.className="backInShowServices",i.backInShowServices.onclick=function(){nw.back(),i.loadInitial(),i.activeNormal(),i.resetValuesHome()},$(".btnMenuHeader").after(i.backInShowServices),i.ui.backAdondevamos.addListener("click",function(){nw.back(),i.muestraAdondeVamos()}),i.ui.button_adondevas.addListener("click",function(){i.openAdondeVamosButton()}),i.ui.address_destino.changeValue(function(){var e=i.ui.address_destino.getValue();if(!nw.evalueData(e))return i.ui.favoritos_group.addClass("favoritos_group_show"),!1;i.ui.favoritos_group.removeClass("favoritos_group_show")}),i.ui.listo_fijar.addListener("click",function(){function e(){console.log("position",a),i.setPositionTwo(a),i.ui.pago_group.addClass("buttons_group_fix_pago_group"),document.querySelector(".nw_widget_div_codigo_promo").classList.add("visibe_promo"),i.continuar()}var a;i.launch=!0,nwgeo.removeAllPolyLines(),i.ui.listo_fijar.setVisibility(!1),2===i.markerSelected?(a=i.marker3.getPosition(),"CARGA"==i.configCliente.app_para?i.formDatosCarga(function(){e()}):e()):1===i.markerSelected&&i.setPositionOne(i.marker3.getPosition()),i.markerSelected=!1,nwgeo.removeMarker(i.marker3)}),i.ui.fijar_en_mapa_destino.addListener("click",function(){i.cleanMarkerDestino(),nwgeo.removeAllPolyLines(),i.removeLine(),i.ui.pago_group.removeClass("buttons_group_fix_pago_group"),document.querySelector(".nw_widget_div_codigo_promo").classList.remove("visibe_promo"),i.ui.favoritos_group.removeClass("favoritos_group_show"),i.campo="address_destino",i.ui.contenedor_address.removeClass("contenedor_address_show"),i.ui.listo_fijar_label.setVisibility(!0),i.launch=!1,i.createMarker3(),i.markerSelected=2}),i.ui.fijar_en_mapa_origen.addListener("click",function(){i.cleanMarkerOne(),nwgeo.removeAllPolyLines(),i.removeLine(),i.ui.pago_group.removeClass("buttons_group_fix_pago_group"),document.querySelector(".nw_widget_div_codigo_promo").classList.remove("visibe_promo"),i.ui.favoritos_group.removeClass("favoritos_group_show"),i.ui.contenedor_address.removeClass("contenedor_address_show"),i.ui.listo_fijar_label.setVisibility(!0),i.launch=!1,i.createMarker3(),i.markerSelected=1}),i.ui.address.changeValue(function(){var e=i.getRecord(!0);nw.evalueData(e.address)?i.ui.fijar_en_mapa_origen.setVisibility(!0):i.ui.fijar_en_mapa_origen.setVisibility(!1)}),i.ui.address_destino.changeValue(function(){var e=i.getRecord(!0);nw.evalueData(e.address_destino)?i.ui.fijar_en_mapa_destino.setVisibility(!0):i.ui.fijar_en_mapa_destino.setVisibility(!1)}),i.ui.fecha.changeValue(function(){i.validaFecha("fecha","Recuerde que la fecha del servicio no puede ser menor a la actual")}),i.ui.fecha.focusout(function(){i.validaFecha("fecha","Recuerde que la fecha del servicio no puede ser menor a la actual")}),i.ui.hora.changeValue(function(){i.validaHora()}),i.ui.address.addListener("click",function(){i.ui.address_destino.focus(),i.activeNormalV=!0,i.campo="address",i.ui.favoritos_group.addClass("favoritos_group_show"),i.ui.fijar_en_mapa_origen.setVisibility(!0),i.ui.address_destino.setVisibility(!1),i.ui.fijar_en_mapa_destino.setVisibility(!1)}),i.ui.address_destino.addListener("click",function(){i.campo="address_destino",i.activeNormalV=!0,i.ui.favoritos_group.addClass("favoritos_group_show"),i.ui.fijar_en_mapa_destino.setVisibility(!0),i.ui.fijar_en_mapa_origen.setVisibility(!1),i.ui.contenedor_btn_fijar.setVisibility(!0)}),i.ui.address_destino.addListener("focusout",function(){console.log("ACTION:::FOCUS"),i.ui.favoritos_group.removeClass("favoritos_group_show"),i.ui.fijar_en_mapa_destino.setVisibility(!1)}),i.ui.add_parada.addListener("click",function(){(new f_crear_parada).construct(i)}),i.pedirVar=!1,i.ui.pedir.addListener("click",function(){var e=i.getRecord();return console.log("data",e),console.log("main.configCliente",main.configCliente),console.log("main.configCliente.tipo_pago",main.configCliente.tipo_pago),!!i.validate()&&("CREDITO"!=main.configCliente.tipo_pago||nw.utils.evalueData(e.tarjeta_id)?void(0==i.pedirVar&&(i.pedirVar=!0,i.pedir())):(nw.dialog("Debe registrar una tarjeta de crédito para continuar. Vaya a Menú - Métodos de pago - Agregar tarjeta."),!1))},!1),document.addEventListener("calificaFin",function(e){i.ui.address.setVisibility(!0),i.ui.address_destino.setValue("");var a=[{lat:i.geo.latitude,lng:i.geo.longitude}];nwgeo.centerMap(i.map,i.markerMyPosition,!1,17,a,!1,!1),i.servicio_nom=!1,i.num_mascota=0,i.campo="address",i.initAbordo=!1}),i.ui.cancelar_pedido.addListener("click",function(){(new f_cancelar_servicio).construct(i)}),i.ui.cancelar_pedido_en_ruta.addListener("click",function(){(new f_cancelar_servicio).construct(i)}),i.ui.codigo_promo.addListener("click",function(){main.redimirCupon(function(){i.mostrarServicios(!1,"undefined","undefined",!0),nw.back()})}),i.ui.confirmar_ub.addListener("click",function(){i.continuar()}),i.actionButtonsNegociar(),i.setHours(0),i.changeForma(),i.changeServicio(),i.reziseNormalMap(),(new f_00_markers).construct(i),i.configuracionServi(function(){console.log("main.configCliente",main.configCliente),console.log("up",t),console.log("up.foto",t.foto);var e=!1,a=(nw.utils.evalueData(t.foto)&&(e=t.foto),nw.utils.evalueData(t.foto_perfil)&&(e=t.foto_perfil),!1);(a=!nw.evalueData(i.configCliente.foto_usuario_app)||nw.evalueData(e)||"SI"!=i.configCliente.foto_usuario_app?a:!0)?(nw.dialog("Por favor completa tu perfil"),nw.addClass(nw.getElement("body"),"foo_editprofile"),nw.utils.empty("#foo .contentCenter"),nw.account.editProfile(!0),nw.remove(".loadingNwChat")):(setTimeout(function(){!function e(){var a=document.querySelector("#mapa");if(a.offsetWidth<100||a.offsetHeight<100)return void setTimeout(function(){e()},500);i.createMapa()}()},1),"NO"!=i.configCliente.usa_favoritos_app_user&&setTimeout(function(){i.createNavTableFavoritos()},3e3),"SI"==i.configCliente.paradas_adicional&&setTimeout(function(){i.createNavTableParadas()},3e3),nw.evalueData(i.configCliente.tarifas_fijas_usa_valor_por_paradas)&&"SI"==i.configCliente.tarifas_fijas_usa_valor_por_paradas&&i.actionInPaxTotal(),nw.utils.evalueData(i.configCliente.ofertar_valor_salto_mas_menos)&&(i.stepValue=parseFloat(i.configCliente.ofertar_valor_salto_mas_menos)),"SI"==main.configCliente.cod_promocional&&setTimeout(function(){main.cuponInUse(),nw.getPromotionsApp()},2e3),void 0!==o&&o(),nw.utils.evalueData(main.configCliente.btn_adondevamos_texto)&&(document.querySelector(".button_adondevas").innerHTML=main.configCliente.btn_adondevamos_texto))}),main.selfCrearViaje=i},destruct:function(){},members:{openAdondeVamosButton:function(){var a=this;a.debugConstruct&&console.log("CLICK::::::self.ui.button_adondevas"),"SI"===a.configCliente.btn_adondevamos_abre_historico?main.openHistoricoViajes():(a.data_aeropuerto_servicio=!1,a.hoursAttention(void 0,function(e){a.muestraAddressInit(),window.location.hash="searchDirections"}))},resetValuesHome:function(){var e=this;if(document.querySelector(".nw_widget_div_backAdondevamos_show"))return!1;for(var a=0;a<e.markersParadas.length;a++)nwgeo.removeMarker(e.markersParadas[a]);e.arrayParadas=[],e.markersParadas=[],e.numeroAuxiliares=0,e.data_carga=!1,$(".pac-container").addClass("pac-container-hidde"),console.log("resetValuesHome!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")},actionButtonsNegociar:function(){var o=this;o.ui.confirmar_precio.setVisibility(!1),o.precioInicialSinConfirmar=!1,o.ui.actual_precio.addListener("keyup",function(e){var a=o.ui.actual_precio.getValue();console.log("e",e),console.log("val",a),nw.utils.evalueData(o.precioInicialSinConfirmar)||(o.precioInicialSinConfirmar=o.valor_total),o.valor_total=parseFloat(a),o.ui.confirmar_precio.setVisibility(!0)}),o.ui.bajar_precio.addListener("click",function(){return!(!nw.utils.evalueData(o.precioInicialSinConfirmar)||o.valor_total<=o.precioInicialSinConfirmar)&&(o.valor_total=parseFloat(o.valor_total)-o.stepValue,o.ui.actual_precio.setValue(o.valor_total),void o.ui.confirmar_precio.setVisibility(!0))}),o.ui.aumentar_precio.addListener("click",function(){nw.utils.evalueData(o.precioInicialSinConfirmar)||(o.precioInicialSinConfirmar=o.valor_total),o.valor_total=parseFloat(o.valor_total)+o.stepValue,o.ui.actual_precio.setValue(o.valor_total),o.ui.confirmar_precio.setVisibility(!0)}),o.ui.confirmar_precio.addListener("click",function(){o.precioInicialSinConfirmar=!1,o.updatePrice(o.valor_total)})},updatePrice:function(e){console.log("value",e);var a=nw.userPolicies.getUserData(),o={},e=(o.id=main.id_service_active,o.value=e,o.empresa=a.empresa,o.usuario=a.usuario,new nw.rpc(this.getRpcUrl(),"app_user"));e.setAsync(!0),e.setLoading(!0),console.log("updatePrice:::RESPONSE_SERVER::data",o);e.exec("actualizarPrecioViaje",o,function(e){console.log("updatePrice:::RESPONSE_SERVER::r",e),main.registerServiceInFirebase(main.id_service_active)})},centrarMapaGPS:function(){var e,a=this;a.debug&&console.log("self.serviceActive",a.serviceActive),!0===a.serviceActive?(console.log("self.initAbordo",a.initAbordo),e=[],e=!0===a.initAbordo?[{lat:a.geo.latitude,lng:a.geo.longitude},{lat:a.geoDestino.latitudDes,lng:a.geoDestino.longitudDes}]:[{lat:a.geo.latitude,lng:a.geo.longitude},{lat:a.positionConductor.lat,lng:a.positionConductor.lng}],nwgeo.centerMap(a.map,a.markerMyPosition,a.markerDriver,!1,e,!0,"center")):a.initialMyUbication(!0)},hoursAttention:function(e,a){var o,i=this,t=(i.debugConstruct&&console.log("START:::hoursAttention:::self.configCliente",i.configCliente),new Date),n=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),t=i.configCliente.hora_inicio_atencion,r=i.configCliente.hora_fin_atencion;void 0===t||void 0===r||!nw.evalueData(t)||!nw.evalueData(r)||null===t||null===r||"00:00:00"==t&&"00:00:00"==r?a(!0):(o=t.split(":"),o=parseInt(o[0])+parseInt(1)+":"+o[1]+":"+o[2],void 0!==e?e.hora>=o?a(!0):(nw.dialog("la hora del servicio tiene que ser igual o mayor a "+o),i.pedirVar=!1):n<t||r<n?nw.dialog("Nuestro horario de atención es de "+t+" hasta "+r+" solo se podrán reservar servicios una hora despues de la hora inicio de atención",function(){i.__hourAttention=n,a(!0)},function(){},{textCancel:"Cancelar",textAccept:"Continuar"}):a(!0))},createActionsInputsSearchDirections:function(){(new f_2_createActionsInputsSearchDirections).construct(this)},cancelservice:function(){var e=this,a=(clearInterval(e.inte),e.circu=!1,e.servicio_nom=!1,e.num_mascota=0,e.ui.address.setVisibility(!0),e.ui.address_destino.setValue(""),[{lat:e.geo.latitude,lng:e.geo.longitude}]);nwgeo.centerMap(e.map,e.markerMyPosition,!1,17,17,a,!1),e.activeNormal(),e.hiddenWaitingDriver(),e.loadInitial(),e.campo="address",e.initservice=!1,1==e.actEnRuta&&(void 0!==e.polylineRuta&&null!==e.polylineRuta&&(e.polylineRuta.setMap(null),delete e.polylineRuta),e.actEnRuta=!1),!1!==e.markerDriver&&e.markerDriver.setMap(null),e.fram=document.querySelector(".iframe"),e.fram&&e.fram.remove()},iniciarWatchPosition:function(){var o=this;nwgeo.watchMapPosition(function(e){var a;o.debug&&console.log("self.serviceActive",o.serviceActive),!0===o.serviceActive&&(o.debug&&console.log("PPPPP position",e),(a={}).lat=e.coords.latitude,a.lng=e.coords.longitude,o.geo.latitude=a.lat,o.geo.longitude=a.lng,o.debug&&console.log("self.markerMyPosition",o.markerMyPosition),nw.evalueData(o.markerMyPosition))&&nwgeo.setPositionMarker(o.markerMyPosition,a.lat,a.lng),o.activeWatchPosition=!0})},configuracionServi:function(e){(new f_0_configuracionServi).construct(this,e)},setHours:function(e){var a=this.ui.fecha.getValue(),o=this.ui.hora.getValue(),e=nw.addMinutesToDate(nw.getActualFullDate(),e),i=e.split("T")[0],e=e.split("T")[1],t=!0,a=(nw.utils.evalueData(a)&&nw.utils.str_replace("-","",a)>=nw.utils.str_replace("-","",i)&&(t=!1),!0);nw.utils.evalueData(o)&&nw.utils.str_replace(":","",o)+":00">=nw.utils.str_replace(":","",e)&&(a=!1),t&&this.ui.fecha.setValue(i),a&&this.ui.hora.setValue(e)},createNavTableFavoritos:function(){var e=this.canvas+" .favoritos_group",a=new l_navtable_favoritos;a.construct(e,this),this.navTableFavoritos=a,main.navTableFavoritos=this.navTableFavoritos},createNavTableParadas:function(){var e=this.canvas+" .paradas_group",a=new l_navtable_paradas;a.construct(e,!1,this),this.navTable=a},actionInPaxTotal:function(){for(var o=this,e=(o.ui.paradas_adicionales_iniciales_creacion.setVisibility(!0),10),a=(nw.utils.evalueData(o.configCliente.tarifas_fijas_usa_valor_por_paradas_pax_maximos)&&(e=parseInt(o.configCliente.tarifas_fijas_usa_valor_por_paradas_pax_maximos)),{}),i=0;i<e;i++)a[i+1]=i+1;o.ui.paradas_adicionales_iniciales_creacion.populateSelectFromArray(a),o.ui.paradas_adicionales_iniciales_creacion.setValue(1),o.ui.paradas_adicionales_iniciales_creacion.change(function(){var e,a;return!!document.querySelector(".buttons_group_fix_pago_group")&&(a=o.ui.paradas_adicionales_iniciales_creacion.getValue(),e="10",nw.utils.evalueData(o.configCliente.tarifas_fijas_usa_valor_por_paradas_pax_maximos)&&(e=o.configCliente.tarifas_fijas_usa_valor_por_paradas_pax_maximos),console.log("val",a),console.log("val.val",a.val),console.log("valMax",e),parseInt(a.val)>=parseInt(e)?(a="Lo sentimos, ha excedido el límite de pasajeros, póngase en contacto con la central.",nw.utils.evalueData(o.configCliente.tarifas_fijas_usa_valor_por_paradas_mensaje_maximo)&&(a=o.configCliente.tarifas_fijas_usa_valor_por_paradas_mensaje_maximo),nw.dialog(a),o.ui.paradas_adicionales_iniciales_creacion.setValue(parseInt(e)-1),!1):void o.traeTarifas.evalueContinuarPoliLyne())})},changeForma:function(){var e=this;e.ui.forma.change(function(){"horas"===e.ui.forma.getValue()?(e.tipo="horas",e.ui.address_destino.setVisibility(!1),e.ui.address_destino.setRequired(!1),nwgeo.removeMarker(e.markerDestino),nwgeo.centerMap(e.map,e.markerMyPosition,!1,17),nwgeo.removeAllPolyLines()):(e.campo="address_destino",e.cleanPre(),e.setPositionTwo(),e.ui.confirmar_ub.setVisibility(!1),e.ui.address_destino.setVisibility(!0),e.ui.address_destino.setRequired(!0))})},setDataPago:function(e){var a=this,o=nw.userPolicies.getUserData(),e=(void 0!==e&&(o=e),"efectivo"),i=(a.ui.tipo_pago.html(""),{});i.efectivo="Efectivo",a.ui.tipo_pago.populateSelectFromArray(i),a.ui.tipo_pago.setValue("efectivo"),nw.evalueData(o.metodo_de_pago)||(o.metodo_de_pago="efectivo"),"credito"===o.metodo_de_pago?(a.ui.tipo_pago.html(""),e="tarjeta_credito",a.ui.tipo_pago.populateSelectFromArray(i={tarjeta_credito:"Tarjeta Crédito"}),a.ui.tipo_pago.setValue("tarjeta_credito"),a.ui.tarjeta_id.setValue(o.id_tarjeta_credito_metodo),a.ui.tarjeta.setValue(o.name_tarjeta_credito_metodo)):"credito"!=o.metodo_de_pago&&"efectivo"!=o.metodo_de_pago&&(a.ui.tipo_pago.html(""),e="tarjeta_credito",(i={})[o.metodo_de_pago]=o.metodo_de_pago,a.ui.tipo_pago.populateSelectFromArray(i),a.ui.tipo_pago.setValue(o.metodo_de_pago),a.ui.tarjeta_id.setValue(o.id_tarjeta_credito_metodo),a.ui.tarjeta.setValue(o.name_tarjeta_credito_metodo)),a.changePago(e),a.ui.tipo_pago.changeValue(function(e){(new f_metodo_pago).construct(function(e){e.metodo_de_pago=e.metodo,a.setDataPago(e)})})},changePago:function(e){var a=this,o=(nw.removeErrorField(),a.ui.tipo_pago.getValue());"tarjeta_credito"===(o=void 0!==e?e:o)?(a.ui.tarjeta.setVisibility(!0),a.ui.tarjeta.setRequired(!0)):(a.ui.tarjeta.setVisibility(!1),a.ui.tarjeta.setRequired(!1)),a.reziseMap()},reziseMap:function(e){this.ui.mapa.addClass("mapa_maxheight");var a=0,a=nw.evalueData(e)?e:this.ui.pago_group.height();this.debug&&(console.log("height",e),console.log("reziseMap h",a)),this.ui.mapa.css({"max-height":"calc(100% - "+a+"px)"})},reziseNormalMap:function(){this.ui.mapa.removeClass("mapa_maxheight"),this.ui.mapa.css({"max-height":"100%"})},pedir:function(){var a=this,e=a.getRecord();console.log("data",e),a.debugConstruct&&console.log("START:::pedir"),void(a.segundosespera=0)!==a.__hourAttention?a.hoursAttention(e,function(e){a.save()}):a.save(),document.querySelector(".countWait").innerHTML="0"},noHayServicios:function(){var e=this;nw.remove(".ofertas_container"),e.notService(function(){e.segundosespera=0,e.reziseNormalMap();nw.dialog("Lo sentimos, no hemos encontrado un conductor para su destino.",function(){e.pedir()},function(){nw.loadHome(),e.loadInitial(),e.activeNormal(),e.servicesNotAttended()},{textAccept:"Volver a intentar",textCancel:"Cancelar viaje"}),nw.remove(".ofertas_container"),main.destroyQueryOfertas()})},servicesNotAttended:function(){console.log("START_LAUNCH:::::::::::::: servicesNotAttended");var e=nw.userPolicies.getUserData(),a={},e=(a.id=main.id_service_active,a.nombre=e.nombre,a.apellido=e.apellido,a.email=e.email,a.celular=e.celular,a.empresa=e.empresa,a.domain_rpc=config.domain_rpc,new nw.rpc(this.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1);e.exec("sendEmailNotAttended",a,function(e){console.log("RESPONSE_SERVER:::::::::::::: servicesNotAttended",e),console.log("servicesNotAttended",e)})},notService:function(a){var o=this,e=(nw.remove(".ofertas_container"),o.reziseNormalMap(),clearInterval(o.inte),o.circu=!1,o.clearIntervalo(),o.ui.address_destino.setVisibility(!0),o.ui.address.setVisibility(!0),nw.userPolicies.getUserData()),i={},e=(i.id=main.id_service_active,i.usuario=e.usuario,new nw.rpc(o.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("notService",i,function(e){main.registerServiceInFirebase(main.id_service_active),nwgeo.removeAllPolyLines(),o.hiddenWaitingDriver(),nw.remove(".ofertas_container"),a()})},changeServicio:function(){var a=this;a.ui.tipo_servicio.change(function(){var e=a.ui.tipo_servicio.getValue();console.log("self.ui.tipo_servicio",e),"reservado"===e?(e=a.minutos_agregar_hora,console.log(a.minutos_agregar_hora),console.log(e),a.minutos_agregar_hora&&(e=a.minutos_agregar_hora),a.showHiddenDate(!0,e)):a.showHiddenDate(a.__show,0)})},validaFecha:function(e,a){var o=this.ui[e].getValue();if(nw.evalueData(o)){var i=nw.getActualDate();if(o<i)return this.ui[e].setValue(i),void nw.dialog(a)}this.validaHora()},validaHora:function(){var e,a=this.ui.hora.getValue(),o=this.getRecord();"reservado"==o.tipo_servicio&&nw.evalueData(a)&&(e=this.revHora().toString().split("/")[1],1==(a=a.split(":"))[0].toString().length&&(a[0]="0"+a[0]),1==a[1].toString().length&&(a[1]="0"+a[1]),"00"==a[0]&&a[0],(a=a[0]+":"+a[1]+":00")<e)&&(a=o.fecha,nw.evalueData(a))&&a<nw.getActualDate()&&(nw.dialog("Debe seleccionar una Hora mayor o igual a la actual para reservar.Verifique por favor"),this.ui.hora.setValue(e))},revHora:function(){var e=new Date,e=new Date(e.getTime()+6e4*this.minutos_agregar_hora);return Date.prototype.toString=function(){var e=(this.getMonth()+1).toString(),a=(1==e.length&&(e="0"+e),this.getHours().toString()),o=this.getMinutes().toString(),i=this.getSeconds().toString();return 1==a.length&&(a="0"+a),1==o.length&&(o="0"+o),1==i.length&&0,this.getFullYear()+"-"+e+"-"+this.getDate()+"/"+a+":"+o+":00"},e},showHiddenDate:function(e,a){(new f_showHiddenDate).construct(this,e,a)},clearCircul:function(){},createMapa:function(){(new f_1_createMapa).construct(this)},enableOrientationArrow:function(){},continuar:function(e){(new f_traeTarifasContinua).construct(this,e)},mostrarServicios:function(e,a,o,i){(new f_pedir_0_mostrarServicios).construct(this,e,a,o,i)},recargosConsult:function(a){var o=this,e=nw.userPolicies.getUserData(),i={},e=(i.empresa=e.empresa,i.perfil=e.perfil,i.usuario=e.usuario,new nw.rpc(o.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("populateRecargos",i,function(e){if(o.debug&&console.log("recargosConsult",e),"USUARIO_NO_EXISTE"===e)return nw.dialog("El usuario no existe o está inactivo"),!1;window.localStorage.setItem("saldo",e.saldo.saldo);e=e.recargos;a(e)})},showPrecioSubservice:function(e,a,o,i,t,n,r){(new f_showPrecioSubservice).construct(this,e,a,o,i,t,n,r)},showPrice:function(e,a,o,i,t,n,r,s){(new f_showPrice).construct(this,e,a,o,i,t,n,r,s)},getMaxDiscount:function(e,a){var o=0,i=nw.userPolicies.getUserData().saldo;return 0<parseInt(i)&&(i=parseInt(i),(i=(e=parseInt(e))-(a=i<=(a=parseInt(a))?i:a))<0?o=e:0<=i&&(o=a)),o},cleanPre:function(){$(".estimado").remove(),$(".mapa").removeClass("mapa_fix"),this.ui.pago_group.removeClass("buttons_group_fix_pago_group"),document.querySelector(".nw_widget_div_codigo_promo").classList.remove("visibe_promo"),this.ui.contenedor_azul.removeClass("containBtnFooter_group_fix"),this.ui.paradas_group.removeClass("containBtnFooter_group_fix"),$(".btnMenuHeader").removeClass("btnMenuHeader_hidden"),nwgeo.removeAllPolyLines()},generateCodeVerifi:function(e,a){return Math.floor(Math.random()*(a-e))+e},confirmaValor:function(e){return(new f_confirmar_valor_negociacion).construct(this,e)},save:function(){var e=this;function a(){(new f_save_pedir_servicio).construct(e)}"SI"===main.configCliente.user_confirma_valor_pedir_service?e.confirmaValor(function(){a()}):a()},initIntervalo:function(){var e,a=this;"SI"!=main.configCliente.usa_firebase&&(clearTimeout(a.interval),clearInterval(a.interval),a.debugConstruct&&console.log("START::::: initIntervalo"),e=a.timeIntervalo,a.interval=setInterval(function(){if(document.querySelector(".backInShowServices_show"))return!1;console.log("EJECUTA::::initIntervalo::::validaServiceActive::time",e),a.execFuncInterval()},e))},execFuncInterval:function(){"SI"!=main.configCliente.usa_firebase&&this.validaServiceActive(!1,function(e){console.log("RESULT::::execFuncInterval::::validaServiceActive::",e)})},clearIntervalo:function(){clearTimeout(this.interval),this.debugConstruct&&console.log("START_CLEAR_INTERVAL::::clearIntervalo")},updateVencidos:function(e){if(this.debugConstruct&&console.log("START::::updateVencidos"),e.length<1)return!1;var a=nw.userPolicies.getUserData(),o={},e=(o.vencidos=e,o.usuario=a.usuario,new nw.rpc(this.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1),console.log("updateVencidos:::sendDataServer",o);e.exec("actualizaVencidos",o,function(e){console.log("updateVencidos:::responseServer",e)})},validaServiceActive:function(e,a,o,i){(new f_3_validaServiceActive).construct(this,e,a,o,i)},resolveStatus:function(e){(new f_4_resolveStatus).construct(this,e)},showActualizarPrecio:function(){var e=this;e.ui.actualizar_precio.setVisibility(!0),console.log("showActualizarPrecio:::self.valor_total",e.valor_total),nw.evalueData(e.valor_total)||setTimeout(function(){e.showActualizarPrecio()},5e3),e.ui.actual_precio.setValue(e.valor_total)},showWaitingDriver:function(e,a){var i=this,o=(i.debugConstruct&&console.log("START:::showWaitingDriver"),i.ui.actual_precio.setValue(""),i.ui.actualizar_precio.setVisibility(!1),0==i.serviceActive&&"SI"===i.configCliente.driver_puede_ofertar_valor_servicio&&i.showActualizarPrecio(),i.ui.address_destino.setVisibility(!1),i.ui.address.setVisibility(!1),$(".backInShowServices").removeClass("backInShowServices_show"),document.querySelector(".centrar_mapa").style.display="block",i.ui.buscando_driver.addClass("buscando_driver_show"),[{lat:i.geo.latitude,lng:i.geo.longitude}]),t=(nwgeo.centerMap(i.map,i.markerMyPosition,!1,17,o,!1,!0),clearInterval(i.interCount),60),o=1,n=(nw.evalueData(i.configCliente.tiempo_notificacion_servicio)&&0<parseFloat(i.configCliente.tiempo_notificacion_servicio)&&(t=60*parseFloat(i.configCliente.tiempo_notificacion_servicio),o=i.configCliente.tiempo_notificacion_servicio),(e=nw.evalueData(e)?e:0).toString().split(".")[0]),e=e.toString().split(".")[1],r="";nw.utils.evalueData(main.id_service_active)&&(r=main.id_service_active),nw.utils.remove(".titleesperaviaje"),nw.utils.after(".countWait","<span class='titleesperaviaje'>"+nw.utils.tr("Minutos de espera máximo")+": <span class='spantimewait'>"+o+" (mins)</span> #"+r+" </span> "),void 0===i.segundosespera&&(i.segundosespera=0),e<=0&&e<=1&&(i.segundosespera=0),2==e&&(i.segundosespera=10),3<=e&&e<=4&&(i.segundosespera=20),5<=e&&e<=6&&(i.segundosespera=30),7<=e&&e<=8&&(i.segundosespera=40),9<=e&&e<=10&&(i.segundosespera=50),i.interCount=setInterval(function(){var e,a=document.querySelector(".countWait"),o=(i.segundosespera++,i.segundosespera);o<=t&&(e=o.toString(),59<=o&&(i.segundosespera=0),1==(e=e.toString()).length&&(e="0"+e),a.innerHTML=n+":"+e)},1e3),document.querySelector(".cont-radar")||i.getIcon()},hiddenWaitingDriver:function(){this.ui.buscando_driver.removeClass("buscando_driver_show");var e=document.querySelector(".cont-radar");e&&e.remove()},activeNormal:function(){(new f_activeNormal).construct(this)},activeAbordoCenterFirsTime:!1,activeAbordo:function(e){(new f_activeAbordo).construct(this,e)},activeEnSitio:function(e){(new f_activeEnSitio).construct(this,e)},activeEnRuta:function(e){(new f_activeEnRuta).construct(this,e)},useChat:function(i){var e=this,t=nw.userPolicies.getUserData();e.datos_servicio_activo=i;document.querySelector(".containBtnsShareWarn")||(n=document.querySelector(".f_crear_viaje"),(a=document.createElement("div")).className="containBtnsShareWarn",n&&n.appendChild(a),document.querySelector(".btn_share_travel")||((o=document.createElement("button")).innerHTML='<i class="material-icons">share</i>',o.className="btn_share_travel btn_sharetravel_initservice",o.onclick=function(){var e=config.domain_rpc+config.carpet_files_extern+"index.html?conf="+domainExternConfigName+"&service="+i.id+"#f_ver_viaje",a="Te comparto mi viaje en "+config.name,o="Hola! Soy "+t.nombre+", te estoy compartiendo mi viaje en "+config.name+", abre el siguiente link "+e;nw.shareSocial(o,a)||nw.utils.openLink(e,"_BLANK")},a&&a.appendChild(o)),document.querySelector(".btn_warning"))||((o=document.createElement("button")).innerHTML='<i class="material-icons">report_problem</i>',o.className="btn_warning btn_warning_initservice",o.onclick=function(){var e={iconAccept:"<i class='material-icons' style='top: 5px;position: relative;'>report</i>",iconCancel:"<i class='material-icons' style='top: 5px;position: relative;'>access_time</i> ",useDialogNative:!1,closeEnc:!0,autocierre:!0,cleanHtml:!1,textAccept:"Problema",textCancel:"Retraso"};nw.dialog("¿Qué desea reportar?",function(){var e=new f_novedades;e.construct(),e.populate(i)},function(){var e;(new f_chat).construct(i),nw.evalueData(i.token_conductor)&&(e=nw.userPolicies.getUserData(),nw.sendNotificacion({title:"Nuevo mensaje de "+e.nombre,body:e.nombre+": Me encuentro retrasado.",icon:"fcm_push_icon",sound:"default",data:"nw.dialog('Nuevo mensaje: Me encuentro retrasado')",callback:"FCM_PLUGIN_ACTIVITY",to:i.token_conductor}))},e)},a&&a.appendChild(o)),nw.remove(".btn_chat");var a,o=document.createElement("button"),n=(o.innerHTML='<i class="material-icons">chat_bubble</i>',o.className="btn_chat btn_chat_initservice",o.onclick=function(){console.log("datos",i),nw.evalueData(i.id_parada)&&(i.id="_parada_"+i.id_parada),(new f_chat).construct(i)},document.querySelector(".InfoDriverPlacasEtc"));n?n.appendChild(o):setTimeout(function(){e.useChat()},2e3)},framePositionConductor:function(e){},userCancelaService:function(e){var a=this;a.cancela_conductor=!0,nw.dialog("El conductor ha cancelado el servicio"),a.ui.address.setVisibility(!0),a.ui.address_destino.setValue(""),nwgeo.centerMap(a.map,a.markerMyPosition,!1,17),a.activeNormal(),a.servicio_nom=!1,a.num_mascota=0,a.campo="address",a.initAbordo=!1,a.loadInitial(),a.campo="address",a.initservice=!1,a.removeMarker4(),a.fram=document.querySelector(".iframe"),a.fram&&a.fram.remove()},htmlDatosConductor:function(e,a,o){var o=void 0!==o?"titleInfoColor":"",i=(i=(i=(i="")+"<div class='containInfoDriver'>"+"<div class='InfoDriverPhotoAndTitle '>")+("<div class='photoDriver' style='background-image: url("+config.domain_rpc+e.conductor_foto+")'></div>")+"<div class='nameDriver'>")+("<span class='nameDriverSpan'>"+e.conductor+"</span>")+"<div class='containerPuntajeDriverSpan'>",o=(nw.evalueData(this.puntajeDriver)&&(i+=this.showStarsDriver()),i=(i=i+"</div>"+("<div class='titleInfoDriver "+o+"'>"+a+"</div>"))+"</div>"+"</div>","57");return nw.evalueData(config.indicativo)&&(o=config.indicativo),i=(i+="<div class='InfoDriverPlacasEtc'>")+"<div class='placaDriver'>"+("<strong>"+e.placa+"</strong>"),nw.evalueData(e.vehiculo_text)&&(i+="</br><span class='infovehicle_inservice'>"+e.vehiculo_text+"</span>"),nw.evalueData(e.vehiculo_color)&&(i+="</br><span class='infovehicle_inservice'>"+e.vehiculo_color+"</span>"),i+="</div>","NO"!==main.configCliente.telefono_conductor_visible_para_pasajero&&(i=(i+="<button class='Infotel'><i class='material-icons'>local_phone</i>")+"<a href='tel:+"+o+" "+e.conductor_celular+"'></button>"),i=(i+="<div class='tiempoEstimadoDriver'>Tiempo estimado de llegada en "+e.tiempo_estimado+" minutos</div>")+"</div>"+"</div>",this.createDataDriver=!0,i},showStarsDriver:function(){for(var e=this.puntajeDriver,a="",o=(a+="<span class='puntajeDriverSpan'><span style='color:#656363; margin-right: 4px;'>"+(e=e||0)+"</span>",Math.round(parseFloat(e))),i=0;i<5;i++)a+=i<o?"<i class='material-icons' style='color: #e04935;'>star</i>":"<i class='material-icons'>star_border</i>";return a+="</span>"},pedirDataAirpot:function(e){(new f_pedirDataAirpot).construct(this,e)},formDatosCarga:function(e){(new f_formDatosCarga).construct(this,e)},loadInitial:function(){var e=this,a=(e.resetValuesHome(),e.getRecord()),a=($(".backInShowServices").removeClass("backInShowServices_show"),$(".nw_widget_div_backAdondevamos").removeClass("nw_widget_div_backAdondevamos_show"),$(".btnMenuHeader").removeClass("btnMenuHeader_hidden"),e.ui.contenedor_adondevamos.removeClass("contenedor_adondevamos_hidden"),e.ui.contenedor_address.removeClass("contenedor_address_show"),e.reziseNormalMap(),e.clean(),nw.utils.evalueData(a.address)&&e.ui.address.setValue(a.address),e.clearIntervalo(),e.cleanMarkerDestino(),e.removeMarker4(),e.fin=!1,e.showHiddenDate(!1,0),e.ui.datos_vehiculo_elegido.setVisibility(!1),e.ui.datos_vehiculo_elegido.setRequired(!1),"CARGA"!=e.configCliente.app_para&&(e.ui.descricion_carga.setVisibility(!1),e.ui.descricion_carga.setRequired(!1)),e.lineRutaFinal=!1,e.activeWatchPosition=!1,e.line=!1,e.markerDriver=!1,e.serviceActive=!1,e.servicioTomado=!1,e.ciudad_destino=!1,e.name_place_destino=!1,e.name_place_destino_text=!1,e.__typeOrigin=!1,e.__typeOriginOne=!1,e.hiddenWaitingDriver(),document.querySelector(".centrar_mapa").style.display="block",nw.remove(".containBtnsShareWarn"),nwgeo.cleartWatchPostion(),document.querySelector(".iframechat")),a=(a&&document.body.removeChild(a),e.ui.pago_group.removeClass("buttons_group_fix_pago_group_hidden"),e.ui.driver_en_camino.removeClass("driver_en_camino_show"),e.cleanPre(),[{lat:e.geo.latitude,lng:e.geo.longitude}]);nwgeo.centerMap(e.map,e.markerMyPosition,!1,19,a,!1,!1),nw.loadHome(),e.muestraAdondeVamos(),nw.evalueData(e.configCliente.tarifas_fijas_usa_valor_por_paradas)&&"SI"==e.configCliente.tarifas_fijas_usa_valor_por_paradas&&e.ui.paradas_adicionales_iniciales_creacion.setValue(1)},getIcon:function(){for(var e='<svg viewBox="0 0 370 370">',e=((e+='<g id="radar-bg">')+'<path fill="#FFFFFF" d="M185,365C85.75,365,5,284.25,5,185C5,85.75,85.75,5,185,5c99.25,0,180,80.75,180,180C365,284.25,284.25,365,185,365z"/>'+'<path fill="#CC0000" d="M185,10c96.65,0,175,78.35,175,175s-78.35,175-175,175S10,281.65,10,185S88.35,10,185,10 M185,0c-24.97,0-49.2,4.89-72.01,14.54c-22.03,9.32-41.81,22.66-58.8,39.64s-30.32,36.77-39.64,58.8C4.89,135.8,0,160.03,0,185s4.89,49.2,14.54,72.01c9.32,22.03,22.66,41.81,39.64,58.8c16.99,16.99,36.77,30.32,58.8,39.64C135.8,365.11,160.03,370,185,370s49.2-4.89,72.01-14.54c22.03-9.32,41.81-22.66,58.8-39.64c16.99-16.99,30.32-36.77,39.64-58.8C365.11,234.2,370,209.97,370,185s-4.89-49.2-14.54-72.01c-9.32-22.03-22.66-41.81-39.64-58.8c-16.99-16.99-36.77-30.32-58.8-39.64C234.2,4.89,209.97,0,185,0L185,0z"/>'+"</g>"+'<path id="radar-pattern" opacity="0.2" fill="none" stroke="#CC0000" stroke-width="4" stroke-miterlimit="10" d="M308.5,185c0,68.21-55.29,123.5-123.5,123.5S61.5,253.21,61.5,185S116.79,61.5,185,61.5S308.5,116.79,308.5,185z M185,114.5c-38.94,0-70.5,31.56-70.5,70.5s31.56,70.5,70.5,70.5s70.5-31.56,70.5-70.5S223.94,114.5,185,114.5z"/>'+'<image overflow="visible" opacity="0.9" width="100%" height="100%" id="radar-gradient" xlink:href="https://raw.githubusercontent.com/fladireis/fladireis.github.io/master/angle-gradient2.png" >'+"</image>"+'<g id="radar-icons" transform="translate(44.000000, 38.000000)" fill="#CC0000" fill-rule="nonzero">'+'<path d="M94.5,1.77635684e-15 C88.7102687,1.77635684e-15 84,4.72398352 84,10.5305158 C84,17.7366039 93.3964714,28.3155625 93.7965345,28.7623935 C94.172305,29.1821353 94.8283745,29.181397 95.2034655,28.7623935 C95.6035286,28.3155625 105,17.7366039 105,10.5305158 C105,4.72398352 100.289675,1.77635684e-15 94.5,1.77635684e-15 Z M94.5000303,16.1538462 C91.3824349,16.1538462 88.8461538,13.6175317 88.8461538,10.4999697 C88.8461538,7.38240769 91.3824955,4.84615385 94.5000303,4.84615385 C97.6175651,4.84615385 100.153846,7.38246829 100.153846,10.5000303 C100.153846,13.6175923 97.6175651,16.1538462 94.5000303,16.1538462 Z" id="Shape-Copy-11"></path>'+'<path d="M27.5,62 C21.7102687,62 17,66.7239835 17,72.5305158 C17,79.7366039 26.3964714,90.3155625 26.7965345,90.7623935 C27.172305,91.1821353 27.8283745,91.181397 28.2034655,90.7623935 C28.6035286,90.3155625 38,79.7366039 38,72.5305158 C38,66.7239835 33.2896746,62 27.5,62 Z M27.5000303,78.1538462 C24.3824349,78.1538462 21.8461538,75.6175317 21.8461538,72.4999697 C21.8461538,69.3824077 24.3824955,66.8461538 27.5000303,66.8461538 C30.6175651,66.8461538 33.1538462,69.3824683 33.1538462,72.5000303 C33.1538462,75.6175923 30.6175651,78.1538462 27.5000303,78.1538462 Z" id="Shape-Copy-10"></path>'+'<path d="M77.5,89 C71.7102687,89 67,93.7239835 67,99.5305158 C67,106.736604 76.3964714,117.315562 76.7965345,117.762394 C77.172305,118.182135 77.8283745,118.181397 78.2034655,117.762394 C78.6035286,117.315562 88,106.736604 88,99.5305158 C88,93.7239835 83.2896746,89 77.5,89 Z M77.5000303,105.153846 C74.3824349,105.153846 71.8461538,102.617532 71.8461538,99.4999697 C71.8461538,96.3824077 74.3824955,93.8461538 77.5000303,93.8461538 C80.6175651,93.8461538 83.1538462,96.3824683 83.1538462,99.5000303 C83.1538462,102.617592 80.6175651,105.153846 77.5000303,105.153846 Z" id="Shape-Copy-9"></path>'+'<path d="M10.5,143 C4.71026873,143 0,147.723984 0,153.530516 C0,160.736604 9.39647139,171.315562 9.79653449,171.762394 C10.172305,172.182135 10.8283745,172.181397 11.2034655,171.762394 C11.6035286,171.315562 21,160.736604 21,153.530516 C21,147.723984 16.2896746,143 10.5,143 Z M10.5000303,159.153846 C7.38243487,159.153846 4.84615385,156.617532 4.84615385,153.49997 C4.84615385,150.382408 7.38249548,147.846154 10.5000303,147.846154 C13.6175651,147.846154 16.1538462,150.382468 16.1538462,153.50003 C16.1538462,156.617592 13.6175651,159.153846 10.5000303,159.153846 Z" id="Shape-Copy-8"></path>'+'<path d="M66.5,175 C60.7102687,175 56,179.723984 56,185.530516 C56,192.736604 65.3964714,203.315562 65.7965345,203.762394 C66.172305,204.182135 66.8283745,204.181397 67.2034655,203.762394 C67.6035286,203.315562 77,192.736604 77,185.530516 C77,179.723984 72.2896746,175 66.5,175 Z M66.5000303,191.153846 C63.3824349,191.153846 60.8461538,188.617532 60.8461538,185.49997 C60.8461538,182.382408 63.3824955,179.846154 66.5000303,179.846154 C69.6175651,179.846154 72.1538462,182.382468 72.1538462,185.50003 C72.1538462,188.617592 69.6175651,191.153846 66.5000303,191.153846 Z" id="Shape-Copy-7"></path>'+'<path d="M94.5,246 C88.7102687,246 84,250.723984 84,256.530516 C84,263.736604 93.3964714,274.315562 93.7965345,274.762394 C94.172305,275.182135 94.8283745,275.181397 95.2034655,274.762394 C95.6035286,274.315562 105,263.736604 105,256.530516 C105,250.723984 100.289675,246 94.5,246 Z M94.5000303,262.153846 C91.3824349,262.153846 88.8461538,259.617532 88.8461538,256.49997 C88.8461538,253.382408 91.3824955,250.846154 94.5000303,250.846154 C97.6175651,250.846154 100.153846,253.382468 100.153846,256.50003 C100.153846,259.617592 97.6175651,262.153846 94.5000303,262.153846 Z" id="Shape-Copy-6"></path>'+'<path d="M199.5,240 C193.710269,240 189,244.723984 189,250.530516 C189,257.736604 198.396471,268.315562 198.796534,268.762394 C199.172305,269.182135 199.828375,269.181397 200.203466,268.762394 C200.603529,268.315562 210,257.736604 210,250.530516 C210,244.723984 205.289675,240 199.5,240 Z M199.50003,256.153846 C196.382435,256.153846 193.846154,253.617532 193.846154,250.49997 C193.846154,247.382408 196.382495,244.846154 199.50003,244.846154 C202.617565,244.846154 205.153846,247.382468 205.153846,250.50003 C205.153846,253.617592 202.617565,256.153846 199.50003,256.153846 Z" id="Shape-Copy-5"></path>'+'<path d="M178.5,178 C172.710269,178 168,182.723984 168,188.530516 C168,195.736604 177.396471,206.315562 177.796534,206.762394 C178.172305,207.182135 178.828375,207.181397 179.203466,206.762394 C179.603529,206.315562 189,195.736604 189,188.530516 C189,182.723984 184.289675,178 178.5,178 Z M178.50003,194.153846 C175.382435,194.153846 172.846154,191.617532 172.846154,188.49997 C172.846154,185.382408 175.382495,182.846154 178.50003,182.846154 C181.617565,182.846154 184.153846,185.382468 184.153846,188.50003 C184.153846,191.617592 181.617565,194.153846 178.50003,194.153846 Z" id="Shape-Copy-4"></path>'+'<path d="M256.5,168 C250.710269,168 246,172.723984 246,178.530516 C246,185.736604 255.396471,196.315562 255.796534,196.762394 C256.172305,197.182135 256.828375,197.181397 257.203466,196.762394 C257.603529,196.315562 267,185.736604 267,178.530516 C267,172.723984 262.289675,168 256.5,168 Z M256.50003,184.153846 C253.382435,184.153846 250.846154,181.617532 250.846154,178.49997 C250.846154,175.382408 253.382495,172.846154 256.50003,172.846154 C259.617565,172.846154 262.153846,175.382468 262.153846,178.50003 C262.153846,181.617592 259.617565,184.153846 256.50003,184.153846 Z" id="Shape-Copy-3"></path>'+'<path d="M264.5,91 C258.710269,91 254,95.7239835 254,101.530516 C254,108.736604 263.396471,119.315562 263.796534,119.762394 C264.172305,120.182135 264.828375,120.181397 265.203466,119.762394 C265.603529,119.315562 275,108.736604 275,101.530516 C275,95.7239835 270.289675,91 264.5,91 Z M264.50003,107.153846 C261.382435,107.153846 258.846154,104.617532 258.846154,101.49997 C258.846154,98.3824077 261.382495,95.8461538 264.50003,95.8461538 C267.617565,95.8461538 270.153846,98.3824683 270.153846,101.50003 C270.153846,104.617592 267.617565,107.153846 264.50003,107.153846 Z" id="Shape-Copy-2"></path>'+'<path d="M202.5,89 C196.710269,89 192,93.7239835 192,99.5305158 C192,106.736604 201.396471,117.315562 201.796534,117.762394 C202.172305,118.182135 202.828375,118.181397 203.203466,117.762394 C203.603529,117.315562 213,106.736604 213,99.5305158 C213,93.7239835 208.289675,89 202.5,89 Z M202.50003,105.153846 C199.382435,105.153846 196.846154,102.617532 196.846154,99.4999697 C196.846154,96.3824077 199.382495,93.8461538 202.50003,93.8461538 C205.617565,93.8461538 208.153846,96.3824683 208.153846,99.5000303 C208.153846,102.617592 205.617565,105.153846 202.50003,105.153846 Z" id="Shape-Copy"></path>'+'<path d="M194.5,15 C188.710269,15 184,19.5490212 184,25.1404967 C184,32.0796927 193.396471,42.2668379 193.796534,42.6971197 C194.172305,43.1013155 194.828375,43.1006046 195.203466,42.6971197 C195.603529,42.2668379 205,32.0796927 205,25.1404967 C205,19.5490212 200.289675,15 194.5,15 Z M194.500029,31 C191.467267,31 189,28.5327009 189,25.4999705 C189,22.4672401 191.467326,20 194.500029,20 C197.532733,20 200,22.4672991 200,25.5000295 C200,28.5327599 197.532733,31 194.500029,31 Z" id="Shape"></path>'+"</g>"+'<circle id="radar-radius" opacity="0.1" fill="rgb(15, 91, 230)" cx="185" cy="185" r="45.67"/>'+'<circle id="radar-stem" fill="#CC0000" cx="185" cy="185" r="17.33"/>'+'<line id="radar-hand" fill="none" stroke="#CC0000" stroke-width="3" stroke-miterlimit="10" x1="185" y1="185" x2="185" y2="10"/>'+"</svg>",document.createElement("div")),a=(e.className="cont-radar",e.innerHTML="<p>"+nw.utils.tr("Buscando")+'...</p><svg viewBox="0 0 370 370"><g id="radar-bg"><path fill="#FFFFFF" d="M185,365C85.75,365,5,284.25,5,185C5,85.75,85.75,5,185,5c99.25,0,180,80.75,180,180C365,284.25,284.25,365,185,365z"/><path fill="#CC0000" d="M185,10c96.65,0,175,78.35,175,175s-78.35,175-175,175S10,281.65,10,185S88.35,10,185,10 M185,0c-24.97,0-49.2,4.89-72.01,14.54c-22.03,9.32-41.81,22.66-58.8,39.64s-30.32,36.77-39.64,58.8C4.89,135.8,0,160.03,0,185s4.89,49.2,14.54,72.01c9.32,22.03,22.66,41.81,39.64,58.8c16.99,16.99,36.77,30.32,58.8,39.64C135.8,365.11,160.03,370,185,370s49.2-4.89,72.01-14.54c22.03-9.32,41.81-22.66,58.8-39.64c16.99-16.99,30.32-36.77,39.64-58.8C365.11,234.2,370,209.97,370,185s-4.89-49.2-14.54-72.01c-9.32-22.03-22.66-41.81-39.64-58.8c-16.99-16.99-36.77-30.32-58.8-39.64C234.2,4.89,209.97,0,185,0L185,0z"/></g><path id="radar-pattern" opacity="0.2" fill="none" stroke="#CC0000" stroke-width="4" stroke-miterlimit="10" d="M308.5,185c0,68.21-55.29,123.5-123.5,123.5S61.5,253.21,61.5,185S116.79,61.5,185,61.5S308.5,116.79,308.5,185z M185,114.5c-38.94,0-70.5,31.56-70.5,70.5s31.56,70.5,70.5,70.5s70.5-31.56,70.5-70.5S223.94,114.5,185,114.5z"/><image overflow="visible" opacity="0.9" width="100%" height="100%" id="radar-gradient" xlink:href="https://raw.githubusercontent.com/fladireis/fladireis.github.io/master/angle-gradient2.png" ></image><g id="radar-icons" transform="translate(44.000000, 38.000000)" fill="#CC0000" fill-rule="nonzero"><path d="M94.5,1.77635684e-15 C88.7102687,1.77635684e-15 84,4.72398352 84,10.5305158 C84,17.7366039 93.3964714,28.3155625 93.7965345,28.7623935 C94.172305,29.1821353 94.8283745,29.181397 95.2034655,28.7623935 C95.6035286,28.3155625 105,17.7366039 105,10.5305158 C105,4.72398352 100.289675,1.77635684e-15 94.5,1.77635684e-15 Z M94.5000303,16.1538462 C91.3824349,16.1538462 88.8461538,13.6175317 88.8461538,10.4999697 C88.8461538,7.38240769 91.3824955,4.84615385 94.5000303,4.84615385 C97.6175651,4.84615385 100.153846,7.38246829 100.153846,10.5000303 C100.153846,13.6175923 97.6175651,16.1538462 94.5000303,16.1538462 Z" id="Shape-Copy-11"></path><path d="M27.5,62 C21.7102687,62 17,66.7239835 17,72.5305158 C17,79.7366039 26.3964714,90.3155625 26.7965345,90.7623935 C27.172305,91.1821353 27.8283745,91.181397 28.2034655,90.7623935 C28.6035286,90.3155625 38,79.7366039 38,72.5305158 C38,66.7239835 33.2896746,62 27.5,62 Z M27.5000303,78.1538462 C24.3824349,78.1538462 21.8461538,75.6175317 21.8461538,72.4999697 C21.8461538,69.3824077 24.3824955,66.8461538 27.5000303,66.8461538 C30.6175651,66.8461538 33.1538462,69.3824683 33.1538462,72.5000303 C33.1538462,75.6175923 30.6175651,78.1538462 27.5000303,78.1538462 Z" id="Shape-Copy-10"></path><path d="M77.5,89 C71.7102687,89 67,93.7239835 67,99.5305158 C67,106.736604 76.3964714,117.315562 76.7965345,117.762394 C77.172305,118.182135 77.8283745,118.181397 78.2034655,117.762394 C78.6035286,117.315562 88,106.736604 88,99.5305158 C88,93.7239835 83.2896746,89 77.5,89 Z M77.5000303,105.153846 C74.3824349,105.153846 71.8461538,102.617532 71.8461538,99.4999697 C71.8461538,96.3824077 74.3824955,93.8461538 77.5000303,93.8461538 C80.6175651,93.8461538 83.1538462,96.3824683 83.1538462,99.5000303 C83.1538462,102.617592 80.6175651,105.153846 77.5000303,105.153846 Z" id="Shape-Copy-9"></path><path d="M10.5,143 C4.71026873,143 0,147.723984 0,153.530516 C0,160.736604 9.39647139,171.315562 9.79653449,171.762394 C10.172305,172.182135 10.8283745,172.181397 11.2034655,171.762394 C11.6035286,171.315562 21,160.736604 21,153.530516 C21,147.723984 16.2896746,143 10.5,143 Z M10.5000303,159.153846 C7.38243487,159.153846 4.84615385,156.617532 4.84615385,153.49997 C4.84615385,150.382408 7.38249548,147.846154 10.5000303,147.846154 C13.6175651,147.846154 16.1538462,150.382468 16.1538462,153.50003 C16.1538462,156.617592 13.6175651,159.153846 10.5000303,159.153846 Z" id="Shape-Copy-8"></path><path d="M66.5,175 C60.7102687,175 56,179.723984 56,185.530516 C56,192.736604 65.3964714,203.315562 65.7965345,203.762394 C66.172305,204.182135 66.8283745,204.181397 67.2034655,203.762394 C67.6035286,203.315562 77,192.736604 77,185.530516 C77,179.723984 72.2896746,175 66.5,175 Z M66.5000303,191.153846 C63.3824349,191.153846 60.8461538,188.617532 60.8461538,185.49997 C60.8461538,182.382408 63.3824955,179.846154 66.5000303,179.846154 C69.6175651,179.846154 72.1538462,182.382468 72.1538462,185.50003 C72.1538462,188.617592 69.6175651,191.153846 66.5000303,191.153846 Z" id="Shape-Copy-7"></path><path d="M94.5,246 C88.7102687,246 84,250.723984 84,256.530516 C84,263.736604 93.3964714,274.315562 93.7965345,274.762394 C94.172305,275.182135 94.8283745,275.181397 95.2034655,274.762394 C95.6035286,274.315562 105,263.736604 105,256.530516 C105,250.723984 100.289675,246 94.5,246 Z M94.5000303,262.153846 C91.3824349,262.153846 88.8461538,259.617532 88.8461538,256.49997 C88.8461538,253.382408 91.3824955,250.846154 94.5000303,250.846154 C97.6175651,250.846154 100.153846,253.382468 100.153846,256.50003 C100.153846,259.617592 97.6175651,262.153846 94.5000303,262.153846 Z" id="Shape-Copy-6"></path><path d="M199.5,240 C193.710269,240 189,244.723984 189,250.530516 C189,257.736604 198.396471,268.315562 198.796534,268.762394 C199.172305,269.182135 199.828375,269.181397 200.203466,268.762394 C200.603529,268.315562 210,257.736604 210,250.530516 C210,244.723984 205.289675,240 199.5,240 Z M199.50003,256.153846 C196.382435,256.153846 193.846154,253.617532 193.846154,250.49997 C193.846154,247.382408 196.382495,244.846154 199.50003,244.846154 C202.617565,244.846154 205.153846,247.382468 205.153846,250.50003 C205.153846,253.617592 202.617565,256.153846 199.50003,256.153846 Z" id="Shape-Copy-5"></path><path d="M178.5,178 C172.710269,178 168,182.723984 168,188.530516 C168,195.736604 177.396471,206.315562 177.796534,206.762394 C178.172305,207.182135 178.828375,207.181397 179.203466,206.762394 C179.603529,206.315562 189,195.736604 189,188.530516 C189,182.723984 184.289675,178 178.5,178 Z M178.50003,194.153846 C175.382435,194.153846 172.846154,191.617532 172.846154,188.49997 C172.846154,185.382408 175.382495,182.846154 178.50003,182.846154 C181.617565,182.846154 184.153846,185.382468 184.153846,188.50003 C184.153846,191.617592 181.617565,194.153846 178.50003,194.153846 Z" id="Shape-Copy-4"></path><path d="M256.5,168 C250.710269,168 246,172.723984 246,178.530516 C246,185.736604 255.396471,196.315562 255.796534,196.762394 C256.172305,197.182135 256.828375,197.181397 257.203466,196.762394 C257.603529,196.315562 267,185.736604 267,178.530516 C267,172.723984 262.289675,168 256.5,168 Z M256.50003,184.153846 C253.382435,184.153846 250.846154,181.617532 250.846154,178.49997 C250.846154,175.382408 253.382495,172.846154 256.50003,172.846154 C259.617565,172.846154 262.153846,175.382468 262.153846,178.50003 C262.153846,181.617592 259.617565,184.153846 256.50003,184.153846 Z" id="Shape-Copy-3"></path><path d="M264.5,91 C258.710269,91 254,95.7239835 254,101.530516 C254,108.736604 263.396471,119.315562 263.796534,119.762394 C264.172305,120.182135 264.828375,120.181397 265.203466,119.762394 C265.603529,119.315562 275,108.736604 275,101.530516 C275,95.7239835 270.289675,91 264.5,91 Z M264.50003,107.153846 C261.382435,107.153846 258.846154,104.617532 258.846154,101.49997 C258.846154,98.3824077 261.382495,95.8461538 264.50003,95.8461538 C267.617565,95.8461538 270.153846,98.3824683 270.153846,101.50003 C270.153846,104.617592 267.617565,107.153846 264.50003,107.153846 Z" id="Shape-Copy-2"></path><path d="M202.5,89 C196.710269,89 192,93.7239835 192,99.5305158 C192,106.736604 201.396471,117.315562 201.796534,117.762394 C202.172305,118.182135 202.828375,118.181397 203.203466,117.762394 C203.603529,117.315562 213,106.736604 213,99.5305158 C213,93.7239835 208.289675,89 202.5,89 Z M202.50003,105.153846 C199.382435,105.153846 196.846154,102.617532 196.846154,99.4999697 C196.846154,96.3824077 199.382495,93.8461538 202.50003,93.8461538 C205.617565,93.8461538 208.153846,96.3824683 208.153846,99.5000303 C208.153846,102.617592 205.617565,105.153846 202.50003,105.153846 Z" id="Shape-Copy"></path><path d="M194.5,15 C188.710269,15 184,19.5490212 184,25.1404967 C184,32.0796927 193.396471,42.2668379 193.796534,42.6971197 C194.172305,43.1013155 194.828375,43.1006046 195.203466,42.6971197 C195.603529,42.2668379 205,32.0796927 205,25.1404967 C205,19.5490212 200.289675,15 194.5,15 Z M194.500029,31 C191.467267,31 189,28.5327009 189,25.4999705 C189,22.4672401 191.467326,20 194.500029,20 C197.532733,20 200,22.4672991 200,25.5000295 C200,28.5327599 197.532733,31 194.500029,31 Z" id="Shape"></path></g><circle id="radar-radius" opacity="0.1" fill="rgb(15, 91, 230)" cx="185" cy="185" r="45.67"/><circle id="radar-stem" fill="#CC0000" cx="185" cy="185" r="17.33"/><line id="radar-hand" fill="none" stroke="#CC0000" stroke-width="3" stroke-miterlimit="10" x1="185" y1="185" x2="185" y2="10"/></svg>',document.querySelector(this.canvas).append(e),document.querySelectorAll("#radar-icons path")),o=[],i=0,t=0;t<a.length;t++)o.push(a[t]);o=o.reverse(),setInterval(function(){var e;i<12&&((e=o[i]).style.opacity="2",e.style.transition="5s",0<i)&&(o[i-1].style.opacity="0"),13==++i&&(i=0,o[11].style.opacity="0")},1500)},muestraAdondeVamos:function(){$(".nw_widget_div_backAdondevamos").removeClass("nw_widget_div_backAdondevamos_show"),$(".btnMenuHeader").removeClass("btnMenuHeader_hidden"),this.ui.contenedor_adondevamos.removeClass("contenedor_adondevamos_hidden"),this.ui.contenedor_address.removeClass("contenedor_address_show"),this.ui.favoritos_group.removeClass("favoritos_group_show")},muestraAddressInit:function(){var e=this;$(".nw_widget_div_backAdondevamos").addClass("nw_widget_div_backAdondevamos_show"),$(".btnMenuHeader").addClass("btnMenuHeader_hidden"),e.ui.contenedor_adondevamos.addClass("contenedor_adondevamos_hidden"),e.ui.contenedor_address.addClass("contenedor_address_show"),e.ui.address_destino.setVisibility(!0),e.ui.address_destino.click(),"ANDROID"===nw.getMobileOperatingSystem()&&(e.ui.address_destino.blur(),e.ui.address_destino.focus()),setTimeout(function(){e.ui.favoritos_group.addClass("favoritos_group_show")},300)},activeReceivedMsgFrame:function(){var o=this;window.addEventListener("message",function(e){console.log("ReceivedMsgFrame",e);var a=main.id_service_active;e.data.room==="movilmove_number_"+a?"CANCELADO"===e.data.text&&o.userCancelaService():"message"===e.type&&(5<o.countShotNumPosDriver?(clearTimeout(o.intervalEsperaFirame),o.debug&&console.log("create createMarkerDriver in framePositionConductor"),o.createMarkerDriver(e),o.countShotNumPosDriver=0):o.intervalEsperaFirame=setTimeout(function(){o.debug&&console.log("create createMarkerDriver in framePositionConductor"),o.createMarkerDriver(e),o.countShotNumPosDriver=0},5e3))}),o.debugConstruct&&console.log("activeReceivedMsgFrame created")},validateDataSolicitudService:function(e){this.debug&&console.log("dta",e);return!0}}}),nw.Class.define("f_0_configuracionServi",{extend:nw.lists,construct:function(a,o){var i=this,e=(console.log("START_LAUNCH:::::::::::::: f_0_configuracionServi"),main.getConfigCache());if(0!=e)return i.continuaConfig(e,o,a);config.addTextInAccountOtherData+="<br />Configuration Movilmove from Cloud. ";var e=nw.userPolicies.getUserData(),t={},e=(t.empresa=e.empresa,new nw.rpc(a.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!0),console.log("f_0_configuracionServi:::dataSendServer",t);e.exec("consultaConfiguracion",t,function(e){return console.log("f_0_configuracionServi:::responseServer",e),console.log("configuracionServi cloud"),window.localStorage.setItem("configurationInitAccountMovilmove",JSON.stringify(e)),i.continuaConfig(e,o,a)})},destruct:function(){},members:{continuaConfig:function(e,a,o){var i;"string"==typeof e.texto_boton_a_donde_vas&&""!=e.texto_boton_a_donde_vas&&"0"!=e.texto_boton_a_donde_vas&&e.texto_boton_a_donde_vas.length<=25&&(i=document.querySelector("#button_adondevas"))&&(i.innerHTML="<i class='material-icons normal elinicon_form'>location_on</i>"+e.texto_boton_a_donde_vas),o.debug&&console.log("self.configCliente",e),o.configCliente=e,main.configCliente=e,nw.utils.evalueData(main.configCliente.paymentStore)&&(config.paymentStore=main.configCliente.paymentStore),nw.utils.evalueData(main.configCliente.privateKeyEpayco)&&(config.privateKeyEpayco=main.configCliente.privateKeyEpayco),nw.utils.evalueData(main.configCliente.apiKeyEpayco)&&(config.apiKeyEpayco=main.configCliente.apiKeyEpayco),nw.utils.evalueData(main.configCliente.keyGoogleNotificacionPush)&&(config.keyGoogleNotificacionPush=main.configCliente.keyGoogleNotificacionPush),o.cobro=e.cobro_con,nw.evalueData(o.configCliente.valor_minimo_retiro)&&(config.valor_minimo_retiro=o.configCliente.valor_minimo_retiro),"AMBOS"===o.configCliente.tipo_pago?o.ui.tipo_pago.setVisibility(!0):"EFECTIVO"===o.configCliente.tipo_pago?o.ui.tipo_pago.setValue("efectivo"):"CREDITO"===o.configCliente.tipo_pago?o.ui.tipo_pago.setValue("tarjeta_credito"):nw.dialog("No ha configurado la forma de pago. Consulte con el administrador del sistema"),"CARGA"==o.configCliente.app_para&&(o.ui.des_carga.setVisibility(!0),o.ui.descricion_carga.setVisibility(!0),o.ui.descricion_carga.setRequired(!0)),"SI"==o.configCliente.paradas_adicional&&(o.ui.contenedor_azul.setVisibility(!0),o.ui.paradas_group.setVisibility(!0),"CARGA"==o.configCliente.app_para)&&document.querySelector(".des_carga").classList.add("des_carga_con_paradas"),"AMBOS"==o.configCliente.servicios_para&&o.ui.tipo_servicio.setVisibility(!0),"AHORA"==o.configCliente.servicios_para&&(o.ui.tipo_servicio.setVisibility(!1),o.ui.tipo_servicio.setValue("ahora")),"RESERVA"==o.configCliente.servicios_para&&(o.ui.tipo_servicio.setVisibility(!1),o.ui.tipo_servicio.setValue("reservado")),nw.evalueData(a)&&a()}}}),nw.Class.define("f_showPrecioSubservice",{extend:nw.lists,construct:function(e,a,o,i,t,n,r,s){var l=a+(o=a*o/100),c=nw.userPolicies.getUserData().saldo;nw.evalueData(a)||(o="",l=a="Por demanda"),"LIBRE"!==e.cobro?(o=l,a=e.getMaxDiscount(l,n.descuento_maximo),(e.descuento=0)<a&&(e.descuento=a),r.descuento=a,l=o=parseInt(o)):e.valor_total="Por demanda"!==l&&c<l?l-c:l,nw.evalueData(n.valor_mascota)&&nw.evalueData(e.num_mascota)?l=parseFloat(l)+parseInt(e.num_mascota)*parseInt(n.valor_mascota):e.num_mascota=0,"CARGA"==e.configCliente.app_para&&(r=e.detalle.ui.retorno.getValue(),nw.evalueData(n.retorno)&&nw.evalueData(r)&&("true"==r||1==r)&&(l=parseFloat(l)+parseInt(n.retorno)),a=e.detalle.ui.cargue.getValue(),nw.evalueData(n.cargue)&&nw.evalueData(a)&&("true"==a||1==a)&&(l=parseFloat(l)+parseInt(n.cargue)),o=e.detalle.ui.descargue.getValue(),nw.evalueData(n.descargue)&&nw.evalueData(o)&&("true"==o||1==o)&&(l=parseFloat(l)+parseInt(n.descargue)),c=e.detalle.ui.valor_declarado.getValue(),nw.evalueData(n.porcentaje_valor_declarado))&&nw.evalueData(c)&&""!=c&&(r=parseInt(n.porcentaje_valor_declarado)*parseInt(c)/100,l=parseFloat(l)+parseInt(r)),e.valor_total=l},destruct:function(){},members:{}}),nw.Class.define("f_activeEnRuta",{extend:nw.lists,construct:function(e,a){e.debugConstruct&&console.log("LAUNCH:::f_activeEnRuta",a),e.pathDriverToOrigin=a.pathDriverToOrigin,e.cleanPre(),e.ui.cancelar_pedido_en_ruta.setVisibility(!0),document.querySelector(".centrar_mapa").style.display="block",e.hiddenWaitingDriver(),e.ui.contenedor_address.removeClass("contenedor_address_show"),e.ui.driver_en_camino.addClass("driver_en_camino_show");var o="calculando...",i="calculando...",t=(void 0!==e.polyti&&(o=e.polyti.tiempo_text,i=e.polyti.distance_text),"<span class='infoDriverText'>"+nw.utils.tr("Tu conductor está en camino")+"</span>"),i=(nw.utils.evalueData(a.id_parada)&&(t+="</br><span class='titlepaxintravel' style='    font-weight: bold;'>"+nw.utils.tr("Pasajero / Parada")+": <span>#"+a.id_parada+"</span></span>"),t=(t=(t+="</br>"+nw.utils.tr("Tiempo estimado")+": <span class='tiempo_es'>"+o+"</span>")+("</br>"+nw.utils.tr("Distancia")+": <span class='distancia_es'>"+i+"</span>"))+("</br>"+nw.utils.tr("Servicio #")+"<span class='servicionum_es'>"+a.id+"</span>"),e.htmlDatosConductor(a,t)),t=(e.ui.html_driver_en_camino.setValue(i),e.useChat(a),e.ui.driver_en_camino.height());e.reziseMap(t),e.debugConstruct&&console.log("CREATE:::f_activeEnRuta:::HTML_EN_CAMINO_POLYLINE"),console.log("getDistanceMatrix::self.geo.latitudOri",a.latitudOri),console.log("getDistanceMatrix::self.geo.longitudOri",a.longitudOri),console.log("getDistanceMatrix::r.driver_latitud",a.driver_latitud),console.log("getDistanceMatrix::r.driver_longitud",a.driver_longitud),nw.evalueData(a.latitudOri)&&nw.evalueData(a.longitudOri)&&nw.evalueData(a.driver_latitud)&&nw.evalueData(a.driver_longitud)&&(i=nwgeo.distance(parseFloat(e.geo.latitudOri),parseFloat(e.geo.longitudOri),parseFloat(a.driver_latitud),parseFloat(a.driver_longitud)),console.log("nwgeo.distance",i),i=i.toFixed(0),a=(t=parseFloat(i))/1e3,console.log("distance_metros",t),console.log("distance_km",a),(i=document.querySelector(".distancia_es"))&&(i.innerHTML=a+" Km"),o=a/10,console.log("tiempo",o),o=o.toFixed(2),t=parseFloat(o),console.log("distance_tiempo_horas",t),a=60*t,console.log("distance_tiempo_minutos",a),i=document.querySelector(".tiempo_es"))&&(i.innerHTML=a.toFixed(2)+" mins"),e.actEnRuta=!0},destruct:function(){},members:{}}),nw.Class.define("f_1_createMapa",{extend:nw.lists,construct:function(t){nw.userPolicies.getUserData();t.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_1_createMapa"),nw.console.log("START_LAUNCH:::::::::::::: f_1_createMapa"),(this.selfparent=t).geo.latitude=nwgeo.latitude,t.geo.longitude=nwgeo.longitude;var e=new nwgeo.getMap;e.animate=!1,e.bearing=0,e.tilt=0,e.durationAnimation=2e3,e.iconMarker=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",nw.evalueData(config.iconDriverPuntoA)&&(e.iconMarker=config.iconDriverPuntoA),e.canvas=document.querySelector(t.canvas+" .mapa"),e.latitude=nwgeo.latitude,e.longitude=nwgeo.longitude,e.zoom=16,t.map=e.show(function(){nw.loadingRemove()}),void 0!==navigator.splashscreen&&navigator.splashscreen.hide(),$(".gm-style").remove(),$(".containMapAndOpened").remove(),$(".container-grid-all").remove(),nw.loadingRemove(),nwgeo.initialize(function(e){t.createActionsInputsSearchDirections()},!0),t.markerMyUbication(),t.initialMyUbication(),nwgeo.dragMap("drag",t.map,function(e){var a,o,i;nw.evalueData(t.marker3)&&(i=o=0,i=nwgeo.native?(o=(a=t.map.getCameraTarget()).lat,a.lng):(o=t.map.center.lat(),t.map.center.lng()),t.latitudMapaDrag=o,t.longitudMapaDrag=i,nwgeo.setPositionMarker(t.marker3,o,i)),t.dragMap=!0}),nwgeo.dragMap("dragstart",t.map,function(e){2===t.markerSelected?(t.ui.listo_fijar_label.setVisibility(!0),t.ui.listo_fijar.setVisibility(!1),nwgeo.removeAllPolyLines(),t.cleanMarkerDestino()):1===t.markerSelected&&(nwgeo.removeAllPolyLines(),t.cleanMarkerOne()),t.dragMap=!0}),nwgeo.dragMap("dragend",t.map,function(e){2!==t.markerSelected&&1!==t.markerSelected||(t.ui.listo_fijar_label.setVisibility(!1),t.ui.listo_fijar.setVisibility(!0)),setTimeout(function(){t.dragMap=!1},2e4);var a=nwgeo.getCenterMap(t.map);console.log("center",a)})},destruct:function(){},members:{}}),nw.Class.define("f_enableOrientationArrow",{extend:nw.lists,construct:function(i){window.addEventListener("devicemotion",function(e){console.log(e),console.log("event.rotationRate",e.rotationRate)},!0),FULLTILT.getDeviceOrientation({type:"world"}).then(function(o){o.listen(function(){var e=o.getScreenAdjustedEuler(),a=360-e.alpha;console.log("currentOrientation.alpha",e.alpha),console.log("compassHeading",a),i.deviceRotation=a,nw.evalueData(i.markerMyPosition)&&i.markerMyPosition.setRotation(i.deviceRotation)})}).catch(function(e){console.log(e)}),window.DeviceOrientationEvent&&(window.addEventListener("compassneedscalibration",function(e){console.log("Your compass needs calibrating! Wave your device in a figure-eight motion"),e.preventDefault()},!0),window.addEventListener("deviceorientation",function(e){var a=null,a=e.webkitCompassHeading||e.alpha;i.deviceRotation=360-a,console.log("compassdir",a),console.log("self.deviceRotation",i.deviceRotation),nw.evalueData(i.markerMyPosition)&&i.markerMyPosition.setRotation(a)},!1)),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(e){var a;e.webkitCompassHeading?a=360-(a=e.webkitCompassHeading):(a=e.alpha,window.chrome||(a-=270)),console.log("alpha",a),nw.evalueData(i.markerMyPosition)&&i.markerMyPosition.setRotation(a)},!1);navigator.compass.watchHeading(function(e){console.log("obtenerOrientacion",e)},function(e){console.log("errorBrujula",e)},{frequency:1500})},destruct:function(){},members:{}}),nw.Class.define("f_save_pedir_servicio",{extend:nw.lists,construct:function(a){console.log("START:::f_save_pedir_servicio");var e=nw.userPolicies.getUserData(),o=a.getRecord(!0),i=(a.pedirSelf=this,a.pedirSelf.selfDocument=a,void 0!==e.centro_costo&&""!=e.centro_costo&&"null"!=e.centro_costo&&null!=e.centro_costo&&(o.centro_costo=e.centro_costo),o.code_verifi_service=a.generateCodeVerifi(1e3,9999),o.code_verifi_service_fin=a.generateCodeVerifi(1e3,9999),null!=o.tipo_servicio&&null!=o.tipo_servicio||(o.tipo_servicio="ahora"),a.cleanPre(),a.ui.favoritos_group.removeClass("favoritos_group_show"),a.ui.fijar_en_mapa_destino.setVisibility(!1),a.ui.fijar_en_mapa_origen.setVisibility(!1),o.descuento_maximo=a.descuento_maximo,o.cliente_nombre=e.nombre,o.celular=e.celular,o.email=e.email,o.nombre=e.nombre,o.apellido=e.apellido,o.id_usuario=e.id_usuario,o.usuario=e.usuario,o.foto_perfil=e.foto_perfil,o.empresa=e.empresa,o.terminal=e.terminal,o.nom_terminal=e.nom_terminal,o.domain_rpc=config.domain_rpc,"string"==typeof e.cupon&&""!=e.cupon&&(i=JSON.parse(e.cupon),t=!0,1==(t=nw.evalueData(i.servicio)&&null!=i.servicio&&""!=i.servicio&&i.servicio!=a.servicio_nom?!1:t))&&(o.datos_cupon=e.cupon),o.subservicio=a.__subservice,o.paradas=[],void 0!==a.navTable&&(o.paradas=a.navTable.getAllData()),o.geo=a.geo,o.geoDestino=a.geoDestino,o.localidad_dataorigen=a.geo.localidad_origen,o.barrio_origen=a.geo.barrio_origen,o.ciudad=a.geo.ciudad,o.ciudad_origen=a.geo.ciudad_origen,!nw.utils.evalueData(o.ciudad_origen)&&nw.utils.evalueData(o.ciudad)&&(o.ciudad_origen=o.ciudad),o.pais_origen=a.geo.pais_origen,o.latitude=a.geo.latitude,o.longitude=a.geo.longitude,o.latitudOri=a.geo.latitudOri,o.longitudOri=a.geo.longitudOri,o.ciudad_destino=a.geoDestino.ciudad_destino,o.latitudDes=a.geoDestino.latitudDes,o.longitudDes=a.geoDestino.longitudDes,o.subcategoria_servicio=a.servicio_nom,o.subcategoria_servicio_text=a.subcategoria_servicio_text,o.tiempo=Math.round(a.poly.tiempo/60),o.tiempo_text=a.poly.tiempo_text,o.total_metros=a.poly.total_metros,o.total_metros_text=a.poly.total_metros_text,o.valor=a.valor_total.toFixed(2),o.servicio_nom=a.servicio_nom,o.servicio_array=a.servicio_array,o.num_mascota=a.num_mascota,JSON.stringify(a.dataGeoTwo)),t=(o.dataGeoTwo=i,o.dataGeoTwoName=a.dataGeoTwoName,o.reservado_text="NO",null);if(nw.evalueData(window.localStorage.getItem("token"))&&(t=window.localStorage.getItem("token")),o.token_usuario=t,"ahora"===o.tipo_servicio&&(o.reservado_text="SI"),"EFECTIVO"===a.configCliente.tipo_pago?o.tipo_pago="efectivo":"CREDITO"===a.configCliente.tipo_pago?o.tipo_pago="tarjeta_credito":""==o.tipo_pago&&(o.tipo_pago="efectivo"),"tarjeta_credito"===o.tipo_pago&&(o.id_tarjeta_credito=o.tarjeta_id),!1!==a.servicioAllData.reservar&&"SI"===a.configCliente.usa_servicios&&"SI"===a.servicioAllData.reservar&&(o.tipo_servicio="reservado",o.reservado_text="SI",textLoading="Programando viaje..."),o.sentido="EJECUTIVO",o.concepto_recargo_ruta_fija=a.concepto_recargo_ruta_fija,o.valor_recargo_ruta_fija=a.valor_recargo_ruta_fija,o.metros_cobro_recargo=a.metros_cobro_recargo,o.valor_peajes=a.valor_peajes,o.metros_cobro_peaje=a.metros_cobro_peaje,o.valor_metros_add=a.valor_metros_add,o.inicia_metros_add=a.inicia_metros_add,o.valorbase=a.valorbase,o.valorminutos=a.valorminutos,o.valordistancia=a.valordistancia,o.valor_unidad_tiempo=a.valor_unidad_tiempo,o.valor_unidad_metros=a.valor_unidad_metros,"tarjeta_credito"===o.tipo_pago&&nw.evalueData(a.configCliente.valor_minimo_pago_credito)&&parseFloat(o.valor)<parseFloat(a.configCliente.valor_minimo_pago_credito))return nw.dialog("El valor del servicio ($"+nw.addNumber(o.valor)+") supera el mínimo ($"+nw.addNumber(a.configCliente.valor_minimo_pago_credito)+") en pagos con tarjeta de crédito, vuelva a intentarlo por favor."),a.loadInitial(),a.activeNormal(),a.pedirVar=!1,a.debugConstruct&&console.log("VALOR_SERVICE_SUPERA_MINIMO_CREDITO:::f_save_pedir_servicio::DATA, self.configCliente",o,a.configCliente),!1;"ahora"===o.tipo_servicio&&a.showWaitingDriver(),nw.evalueData(e.bodega)&&(o.bodega=e.bodega,o.cliente_empresa_id=e.bodega),o.pathOriginToDestiny=a.pathOriginToDestiny,console.log("self.data_aeropuerto_servicio",a.data_aeropuerto_servicio),nw.evalueData(a.data_aeropuerto_servicio)&&(o.num_personas=a.data_aeropuerto_servicio.num_maletas,o.num_maletas=a.data_aeropuerto_servicio.num_maletas,o.vuelo_numero=a.data_aeropuerto_servicio.vuelo_numero),console.log("self.configCliente.app_para",a.configCliente.app_para),console.log("self.detalle",a.detalle),console.log("self.data_carga",a.data_carga),"CARGA"==a.configCliente.app_para&&(o.carga="SI",nw.utils.evalueData(a.data_carga)?(o.numero_auxiliares=a.data_carga.numero_auxiliares,o.salida_periferia=a.data_carga.salida_periferia,o.despacho=a.data_carga.despacho,o.retorno=a.data_carga.retorno,o.cargue=a.data_carga.cargue,o.descargue=a.data_carga.descargue,o.observaciones_servicio=a.data_carga.observaciones_servicio,o.contacto_recogida=a.data_carga.contacto_recogida,o.telefono_recogida=a.data_carga.telefono_recogida,o.observaciones_recogida=a.data_carga.observaciones_recogida,o.contacto_entrega=a.data_carga.contacto_entrega,o.telefono_entrega=a.data_carga.telefono_entrega,o.observaciones_entrega=a.data_carga.observaciones_entrega,o.descripcion_carga=a.data_carga.descripcion_carga,o.cantidad=a.data_carga.cantidad,o.volumen=a.data_carga.volumen,o.peso=a.data_carga.peso,o.empaque=a.data_carga.empaque,o.valor_declarado=a.data_carga.valor_declarado):void 0!==a.dataServiceActive&&(console.log(a.dataServiceActive.numero_auxiliares),a.num_mascota=a.dataServiceActive.numero_auxiliares,o.numero_auxiliares=a.dataServiceActive.numero_auxiliares,o.salida_periferia=a.dataServiceActive.salida_periferia,o.despacho=a.dataServiceActive.despacho,o.retorno=a.dataServiceActive.retorno,o.cargue=a.dataServiceActive.cargue,o.descargue=a.dataServiceActive.descargue,o.observaciones_servicio=a.dataServiceActive.observaciones_servicio,o.contacto_recogida=a.dataServiceActive.contacto_recogida,o.telefono_recogida=a.dataServiceActive.telefono_recogida,o.observaciones_recogida=a.dataServiceActive.observaciones_recogida,o.contacto_entrega=a.dataServiceActive.contacto_entrega,o.telefono_entrega=a.dataServiceActive.telefono_entrega,o.observaciones_entrega=a.dataServiceActive.observaciones_entrega,o.descripcion_carga=a.dataServiceActive.descripcion_carga,o.cantidad=a.dataServiceActive.cantidad,o.volumen=a.dataServiceActive.volumen,o.peso=a.dataServiceActive.peso,o.empaque=a.dataServiceActive.empaque,o.valor_declarado=a.dataServiceActive.valor_declarado)),o.id_tarifa=a.__id_tarifa,o.domain_rpc=config.domain_rpc,"SI"===main.configCliente.driver_puede_ofertar_valor_servicio&&(o.ofertado="SI");i=document.querySelector(".nw_widget_div_backAdondevamos_show"),i&&nw.utils.removeClass(i,"nw_widget_div_backAdondevamos_show",!0),t=new nw.rpc(a.getRpcUrl(),"servicios");t.setAsync(!0),t.setLoading(!0),console.log("PRE_SEND_SERVER_DATA:::f_save_pedir_servicio::DATA",o);t.exec("save",o,function(e){return console.log("RESULT_SERVER_DATA:::f_save_pedir_servicio::r",e),("object"!=typeof e||!nw.evalueData(e.error)||!nw.evalueData(e.error.message))&&("SI"===a.configCliente.notifica_admin_por_correo&&a.pedirSelf.notificaAdminNewService(o,e),a.pedirSelf.notificaConductoresCerca(o,e,function(){main.registerServiceInFirebase(e)}),a.pedirVar=!1,nw.loadingRemove(),main.id_service_active=e,a.cleanMarkerDestino(),nwgeo.removeAllPolyLines(),"reservado"===o.tipo_servicio?(a.ui.tipo_servicio.setValue("ahora"),a.reziseNormalMap(),nw.loading({text:"Finalizando",title:"Terminando de programar su viaje..."}),setTimeout(function(){nw.loadingRemove(),nw.dialog(nw.utils.tr("Servicio programado")+" #"+e+", "+nw.utils.tr("fecha")+" "+o.fecha+" "+o.hora),a.loadInitial(),a.activeNormal(),a.debugConstruct&&console.log("END_PROGRAMAR_VIAJE:::f_save_pedir_servicio"),"SI"==main.configCliente.driver_puede_ofertar_valor_servicio&&window.location.reload()},3e3),!0):(0==a.circu&&(a.clearCircul(),a.circu=!0),void a.initIntervalo()))})},destruct:function(){},members:{notificaAdminNewService:function(e,a){e.id=a,console.log("notificaAdminNewService:::data",e);this.selfDocument;var o=new nw.rpc(this.getRpcUrl(),"app_user");o.setAsync(!0),o.setLoading(!1),console.log("sendData:::notificaAdminNewService::data",e),console.log("sendData:::notificaAdminNewService::r_serv",a);o.exec("notificaAdminNewService",e,function(e){console.log("responseServer:::notificaAdminNewService::r",e)})},notificaConductoresCerca:function(s,l,c){var d=this,u=d.selfDocument,e=new nw.rpc(d.getRpcUrl(),"app_user");e.setAsync(!0),e.setLoading(!1),console.log("sendData:::notificaConductoresCerca::data:::r_serv",l,s);e.exec("traeConductoresCerca",s,function(e){if(console.log("responseServer:::notificaConductoresCerca::r",e),!e)return c(),!1;for(var a=[],o=0;o<e.length;o++){var i,t,n=e[o];nw.utils.evalueData(n.token)&&nw.utils.evalueData(n.latitud)&&nw.utils.evalueData(n.longitud)&&(i=(i=nwgeo.distance(parseFloat(s.latitudOri),parseFloat(s.longitudOri),parseFloat(n.latitud),parseFloat(n.longitud))).toFixed(0),i=parseFloat(i),t=parseFloat(u.configCliente.metros_para_aceptar_servicio),console.log("ra",n),t<i||(console.log("NOTIFICA_A_DRIVER::::ra",n),nw.sendNotificacion({title:"¡Nuevo viaje cerca en "+config.name+"!",body:"Solicitud de nuevo viaje !Abre la app "+config.name+" ahora! Y no pierdas servicios.",icon:"fcm_push_icon",sound:"default",data:"",callback:"FCM_PLUGIN_ACTIVITY",to:n.token}),a.push(n)))}console.log("drivers",a),s.drivers=JSON.stringify(a),s.id_servicio=l;var r=new nw.rpc(d.getRpcUrl(),"app_user");r.setAsync(!0),r.setLoading(!1),console.log("sendData:::guardaConductoresCerca::data",s);r.exec("guardaConductoresCerca",s,function(e){console.log("responseServer:::guardaConductoresCerca::r",e),c()})})}}}),nw.Class.define("f_00_markers",{extend:nw.lists,construct:function(o){o.debugConstruct&&console.log("START_LAUNCH:::::::::::::: f_00_markers");$.each(this.members,function(e,a){o[e]=a})},destruct:function(){},members:{setMyUbication:function(e,a){var o=this;console.log("%c<<<<DEBUG: START:::f_00_markers:::setMyUbication>>>>","background: #33A51F; color: #2B0902"),console.log("START:::f_00_markers:::setMyUbication",e),nw.console.log("START:::f_00_markers:::setMyUbication:::gps",e),console.log("GPS results::::::::::::",e),void 0!==e.address_components&&(nw.evalueData(e.address_components.sublocality)?o.geo.localidad_origen=e.address_components.sublocality:nw.evalueData(e.address_components.route)&&(o.geo.localidad_origen=e.address_components.route),o.geo.barrio_origen="N/A",nw.evalueData(e.address_components.neighborhood)?o.geo.barrio_origen=e.address_components.neighborhood:nw.evalueData(e.address_components.route)&&(o.geo.barrio_origen=e.address_components.route),e.address_components.locality?(o.geo.ciudad_origen=e.address_components.locality,o.geo.ciudad=e.address_components.locality):e.address_components.sublocality?(o.geo.ciudad_origen=e.address_components.sublocality,o.geo.ciudad=e.address_components.sublocality):(o.geo.ciudad_origen=e.address_components.administrative_area_level_1,o.geo.ciudad=e.address_components.administrative_area_level_1),o.geo.pais_origen=e.address_components.country),e.geometry={lat:function(){return e.lat},lng:function(){return e.lng}},"string"==typeof(o.results=e)&&(o.results=JSON.stringify(e)),o.address=e.address,o.geo.dir=e.direccion,o.geo.localidad_origen="N/A",o.geo.ciudad=e.ciudad,o.geo.latitude=e.lat,o.geo.longitude=e.lng,o.geo.latitudOri=e.lat,o.geo.longitudOri=e.lng,o.name_place_origen=o.geo.ciudad,nw.evalueData(e.allData)&&(nw.evalueData(e.allData.name)?o.name_place_origen=e.allData.name:nw.evalueData(e.allData.formatted_address)&&(o.name_place_origen=e.allData.formatted_address)),console.log("self.ciudad_origen",o.ciudad_origen),o.ciudad_origen=o.geo.ciudad,console.log("self.ciudad_origen",o.ciudad_origen),o.address_cord={},o.address_cord.latitud=e.lat,o.address_cord.longitud=e.lng,o.pos={lat:e.lat,lng:e.lng},!0!==a&&(o.cleanMarkerOne(),o.markerMyUbication(!0)),console.log("gps.address",e.address),nw.console.log("setMyUbication:::gps",e),nw.console.log("setMyUbication:::gps.address",e.address),o.ui.address.setValue(e.address),o.debugConstruct&&console.log("SET_DATA:::f_00_markers:::setMyUbication:::gps",e)},yaFueUbicadoInicial:!1,initialMyUbication:function(e){var o,i,t,n,r=this;r.debugConstruct&&console.log("START:::f_00_markers:::initialMyUbication"),nw.console.log("START:::f_00_markers:::initialMyUbication"),nw.console.log("START:::f_00_markers:::initialMyUbication typeof main.gps",typeof main.gps),!0===e&&(e=[{lat:r.geo.latitude,lng:r.geo.longitude}],nwgeo.centerMap(r.map,r.markerMyPosition,!1,!1,e,!1),nwgeo.setPositionMarker(r.markerMyPosition,r.geo.latitude,r.geo.longitude),r.debugConstruct)&&console.log("CENTER_SET_POSITION:::f_00_markers:::initialMyUbication"),void 0!==main.gps?(r.debugConstruct&&console.log("START_GET_GPS_INFO_NATIVE:::f_00_markers:::initialMyUbication",main.gps),r.execInitMyUb(main.gps,!0)):(o=main.position_initial,n=t=i=!1,nw.utils.evalueData(o.coords)&&(i=o.coords.latitude,t=o.coords.longitude,n=o.coords),nw.utils.evalueData(o.latLng)&&(i=o.latLng.lat,t=o.latLng.lng,n=o.latLng),console.log("eeeeeeeeeeeeeeeeeeeeeeeee",o),nw.console.log("START:::f_00_markers:::initialMyUbication:::eeeeeeeeeee",o),nwgeo.api_geocodeInverse(nwgeo.latitude,nwgeo.longitude,function(e,a){nw.console.log("START:::f_00_markers:::initialMyUbication:::results",e),!1!==e&&(nw.console.log("START:::f_00_markers:::initialMyUbication:::results[0]",e[0]),console.log("getLocation:::nwgeo.api_geocodeInverse:::results",e),e=nwgeo.extraerDataResult(e[0],e),nw.console.log("START:::f_00_markers:::initialMyUbication:::d",e),e.lat=i,e.lng=t,e.coords=n,e.responseAll=o,main.gps=e,r.execInitMyUb(e,!1))}))},execInitMyUb:function(e,a){var o=this;console.log("START:::f_00_markers:::execInitMyUb"),nw.console.log("START:::f_00_markers:::execInitMyUb:::gps",e),o.loadedInitialMyUbication||(a=!0),nw.console.log("START:::f_00_markers:::execInitMyUb:::pasa SI"),o.setMyUbication(e,a),o.loadedInitialMyUbication||(o.debugConstruct&&console.log("VALIDA_SERVICES_ACTIVES:::f_00_markers:::validaServiceActive"),"SI"!=main.configCliente.usa_firebase&&o.validaServiceActive(!0)),o.loadedInitialMyUbication=!0},centerMarkerOne:function(){var e=this.geo.latitude,a=this.geo.longitude;this.map.setCenter(new google.maps.LatLng(e,a),16)},cleanMarkerOne:function(){nw.evalueData(this.markerMyPosition)&&nwgeo.removeMarker(this.markerMyPosition),this.debugConstruct&&console.log("CLEAR_MARKER_ONE:::f_00_markers:::cleanMarkerOne")},cleanMarkerDestino:function(){nw.evalueData(this.markerDestino)&&(nwgeo.removeMarker(this.markerDestino),this.debug)&&console.log("cleanMarkerDestino")},setPositionOne:function(e){var t=this,n=!1,r=!1;r=nw.evalueData(e)?(n="function"==typeof e.lat?e.lat():e.lat,"function"==typeof e.lng?e.lng():e.lng):(e=t.markerMyPosition.getPosition(),n=e.lat(),e.lng()),console.log("%c<<<<DEBUG: START:::f_00_markers:::setPositionOne>>>>","background: #33A51F; color: #2B0902"),console.log("lat",n),console.log("lng",r),nwgeo.api_geocodeInverse(n,r,function(e,a){var o,i;!1!==e&&(o=nwgeo.extraerDataResult(e[0],e),(i={}).results=e[0],i.address=o.address,i.lat=n,i.lng=r,console.log("%c<<<<DEBUG: START:::f_00_markers:::setUbicOne 2>>>>","background: #33A51F; color: #2B0902"),t.setUbicOne(i))})},setUbicOne:function(e,a){var o=this,i=(console.log("%c<<<<DEBUG: START:::f_00_markers:::setUbicOne>>>>","background: #33A51F; color: #2B0902"),console.log("START:::f_00_markers:::setUbicOne",e),o.cleanMarkerOne(),!1);(i=nw.evalueData(a)?a:nwgeo.extraerDataResult(e.results)).address=e.address,i.lat=e.lat,i.lng=e.lng,o.setMyUbication(i,!1),o.ui.fijar_en_mapa_origen.setVisibility(!1),document.querySelector(".buttons_group_fix_pago_group")||0==o.circu&&o.muestraAddressInit()},markerMyUbication:function(e){var a=this,o=(a.debugConstruct&&console.log("START:::f_00_markers:::markerMyUbication"),nw.console.log("START:::f_00_markers:::markerMyUbication"),new nwgeo.addMarker);o.map=a.map,o.latitude=a.geo.latitude,o.longitude=a.geo.longitude,o.label="",o.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",nw.evalueData(config.iconDriverPuntoA)&&(o.icon=config.iconDriverPuntoA),nw.evalueData(config.iconUserMap)&&(o.icon=config.iconUserMap),o.draggable=!1,o.animation=!0,a.markerMyPosition=o.show(function(){nw.loadingRemove(),a.orienta||(setTimeout(function(){a.enableOrientationArrow()},1e4),a.orienta=!0),a.debugConstruct&&console.log("CREATE_MARKER:::f_00_markers:::markerMyUbication")}),!0===e&&(a.debugConstruct&&console.log("CENTER:::f_00_markers:::markerMyUbication"),nwgeo.centerMap(a.map,a.markerMyPosition,!1))},removeMarker3:function(){var e=this;nw.evalueData(e.marker3)&&(nwgeo.removeMarker(e.marker3),nwgeo.centerMap(e.map,e.marker3)),e.debugConstruct&&console.log("START_REMOVE_MARKER3:::f_00_markers:::removeMarker3")},createMarker3:function(){var e=this,a=(e.removeMarker3(),e.latitudMapaDrag),o=e.longitudMapaDrag,i=new nwgeo.addMarker(!1);i.map=e.map,i.latitude=a,i.longitude=o,i.title="",i.label="",i.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",nw.evalueData(config.iconDriverPuntoA)&&(i.icon=config.iconDriverPuntoA),nw.evalueData(config.iconUserMap)&&(i.icon=config.iconUserMap),i.draggable=!1,i.animation=!1,e.marker3=i.show(),e.debugConstruct&&console.log("START_CREATE_MARKER3:::f_00_markers:::createMarker3")},removeMarker4:function(){nw.evalueData(this.markerDriver)&&(nwgeo.removeMarker(this.markerDriver),this.markerDriver=!1),this.debugConstruct&&console.log("START_REMOVE_MARKER4:::f_00_markers:::removeMarker4")},positionDriverPass:null,createMarkerDriver:function(e,a){var o=this,i=!1;if(o.debugConstruct&&(console.log("START:::f_00_markers:::createMarkerDriver:::posSend",e),console.log("START:::f_00_markers:::createMarkerDriver:::posInArray",a)),void 0!==a)i=a;else{if(void 0===e.data.text||void 0===e.data.tipo)return;o.debug&&console.log("posSend",e),"add_msg"!==e.data.tipo&&(i=JSON.parse(e.data.text))}if(o.debug&&console.log("pos driver",i),!1===i)return!1;var t,a=(o.positionConductor=i).lat,e=i.lng;!1===o.markerDriver?(o.removeMarker4(),(t=new nwgeo.addMarker(!1)).map=o.map,t.latitude=a,t.longitude=e,t.title="",t.label="",t.icon=config.domain_rpc+config.carpet_files_extern+"/img/ubicacion-carro.png",nw.evalueData(config.iconDriverPuntoDriver)&&(t.icon=config.iconDriverPuntoDriver),nw.evalueData(config.iconDriverMap)&&(t.icon=config.iconDriverMap),t.draggable=!1,t.animation=!1,void 0!==i.rotation&&(t.rotation=i.rotation),o.markerDriver=t.show(),o.debugConstruct&&console.log("CREATE:::createMarkerDriver:::self.markerDriver")):(nwgeo.setPositionMarker(o.markerDriver,a,e),o.debugConstruct&&console.log("MOVED_POSITION_WEB:::createMarkerDriver:::self.markerDriver")),o.recibeGeoDriver=!0,o.timeNoRecibeGeoDriver=0,o.positionDriverPass=i},markerPolylineActiveEnRuta:function(e){},centerMapByGeo:function(e,a,o,i){var t=[{lat:e,lng:a},{lat:o,lng:i}];nw.evalueData(e)&&nw.evalueData(a)&&nw.evalueData(o)&&nw.evalueData(i)?(nwgeo.centerMap(this.map,this.markerMyPosition,this.markerDestino,!1,t,!0,!0,!1,!1),this.debugConstruct&&console.log("CHANGE:::centerMapByGeo:::CENTERMAP::lt1, lg1, lt2, lg2:::"+e+" "+a+" "+o+" "+i)):console.log("ERROR:::centerMapByGeo::: lat/lng de driver/origen desconocido, relanzando:::lt1, lg1, lt2, lg2:::"+e+" "+a+" "+o+" "+i)},removeCarsMap:function(){for(var e=this.markersCalor.length,a=0;a<e;a++)nwgeo.removeMarker(this.markersCalor[a]);return!0},createCarsMap:function(){var r=this,e=(r.removeCarsMap(),nw.userPolicies.getUserData()),a={},e=(a.empresa=e.empresa,a.perfil=e.perfil,a.usuario=e.usuario,new nw.rpc(r.getRpcUrl(),"conductores"));e.setAsync(!0),e.setLoading(!1),r.markersCalor=[];e.exec("getConductoresCerca",a,function(e){r.debug&&console.log("createMapa get conductores",e);for(var a,o,i=0;i<e.length;i++){var t=e[i],n=(a=0,o=360,Math.round(Math.random()*(o-a)+a));!function e(a,o){if("undefined"==typeof google)return setTimeout(function(){e(a,o)},300),!1;{var i,t;if(!nwgeo.native)return i={path:"M29.395,0H17.636c-3.117,0-5.643,3.467-5.643,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759   c3.116,0,5.644-2.527,5.644-5.644V6.584C35.037,3.467,32.511,0,29.395,0z M34.05,14.188v11.665l-2.729,0.351v-4.806L34.05,14.188z    M32.618,10.773c-1.016,3.9-2.219,8.51-2.219,8.51H16.631l-2.222-8.51C14.41,10.773,23.293,7.755,32.618,10.773z M15.741,21.713   v4.492l-2.73-0.349V14.502L15.741,21.713z M13.011,37.938V27.579l2.73,0.343v8.196L13.011,37.938z M14.568,40.882l2.218-3.336   h13.771l2.219,3.336H14.568z M31.321,35.805v-7.872l2.729-0.355v10.048L31.321,35.805",scale:.5,offset:"15%",strokeColor:"#000000",strokeWeight:.3,fillColor:"#f15228",fillOpacity:1,anchor:new google.maps.Point(0,5),rotation:a.val().angle},t={lat:a.val().lat,lng:a.val().lng},t=new google.maps.Marker({position:t,icon:i,map:r.map}),r.markersCalor[o]=t;i=config.domain_rpc+config.carpet_files_extern+"/img/normal1.png",config.iconCarsMap&&(i=config.iconCarsMap),r.markersCalor[o]=r.map.addMarker({position:{lat:a.val().lat,lng:a.val().lng},icon:{url:i},scale:.5,offset:"15%",strokeColor:"#000000",strokeWeight:.3,fillColor:"#f15228",fillOpacity:1,anchor:new google.maps.Point(0,5),rotation:a.val().angle})}}({val:function(){var e={};return e.angle=n,e.lat=parseFloat(t.latitud),e.lng=parseFloat(t.longitud),e}},i)}})},removeLine:function(){nw.evalueData(this.line)&&(nwgeo.removeLine(this.line),this.line=!1)},setPositionTwo:function(e){var i=this,t=!1,n=!1;nw.evalueData(e)?(t="function"==typeof e.lat?e.lat():e.lat,n="function"==typeof e.lng?e.lng():e.lng):nw.evalueData(i.markerDestino)&&(e=i.markerDestino.getPosition(),t=e.lat,n=e.lng),console.log("lat",t),console.log("lng",n),nwgeo.api_geocodeInverse(t,n,function(e,a){var o;!1!==e&&(o=nwgeo.extraerDataResult(e[0],e),i.dataMarkerDestino=e,(e={}).lat=t,e.lng=n,e.ciudad=o.ciudad,e.name=o.direccion,e.name_place=o.ciudad,i.pointMapDestinoExec(e),"address_destino"===i.campo)&&(i.ui.listo_fijar_label.setVisibility(!1),i.ui.listo_fijar.setVisibility(!0))})},pointMapDestino:function(e){var a={};this.debug&&console.log("pointMapDestino()",e),a.lat=e.place.geometry.location.lat(),a.lng=e.place.geometry.location.lng(),a.name=e.results.address,a.icon=e.place.icon,a.name_place=e.place.name,a.ciudad=e.results.ciudad,a.type=e.results.type,!nw.evalueData(a.ciudad)&&nw.evalueData(a.name_place)&&(a.ciudad=a.name_place),this.debug&&console.log("pointMapDestino",e),this.pointMapDestinoExec(a)},pointMapDestinoExec:function(e){var a,o=this,i=(console.log("CREATE::pointMapDestinoExec",e),o.__typeOrigin=e.type,o.getRecord());if(console.log("dataform",i),console.log("dataform.address",i.address),console.log("dataform.address_destino",i.address_destino),console.log("self.campo",o.campo),"address_destino"!=o.campo||nw.utils.evalueData(i.address)){if(!0!==o.serviceActive)if("address"===o.campo)return o.campo="address_destino",i={lat:e.lat,lng:e.lng},o.launch=!0,nwgeo.removeAllPolyLines(),o.ui.listo_fijar.setVisibility(!1),o.markerSelected=!1,nwgeo.removeMarker(o.marker3),o.ui.fijar_en_mapa_origen.setVisibility(!1),o.ui.address_destino.setVisibility(!0),o.ui.fijar_en_mapa_destino.setVisibility(!0),o.ui.address_destino.focus(),nw.utils.evalueData(e.ciudad)||nw.utils.evalueData(e.lat)||nw.utils.evalueData(e.lng)||nw.utils.evalueData(e.name)||nw.utils.evalueData(e.name_place)?((a={}).address=e.name,a.direccion=e.name,a.ciudad=e.ciudad,a.lat=e.lat,a.lng=e.lng,o.setUbicOne(a,a)):o.setPositionOne(i),!1;o.cleanMarkerDestino(),o.fijaMarkerMapDestino(e)}else $(".address").click(),$(".address").trigger("click"),$(".address").trigger("touch"),$(".address").focus(),nw.dialog("Ingresa la dirección de partida")},fijaMarkerMapDestino:function(e){var a=this,o=(a.resetValuesHome(),console.log("fijaMarkerMapDestino:::START",e),nw.evalueData(e.ciudad)&&(a.ciudad_destino=e.ciudad),nw.evalueData(e.name_place)&&(a.name_place_destino=e.name_place,a.name_place_destino_text=e.name_place),nw.evalueData(e.name)&&(a.name_place_destino=e.name),new nwgeo.addMarker);o.map=a.map,o.latitude=e.lat,o.longitude=e.lng,nw.evalueData(e.name)&&(o.title=e.name),e.type=a.__typeOrigin,o.label="",o.icon=config.domain_rpc+config.carpet_files_extern+"/img/pin_negro_44.png",nw.evalueData(config.iconDriverPuntoB)&&(o.icon=config.iconDriverPuntoB),o.draggable=!1,o.animation=!1,a.markerDestino=o.show(function(){}),a.debugConstruct&&console.log("fijaMarkerMapDestino::CREATE::MARKER",o),nw.evalueData(e.name)&&(a.ui.address_destino.setValue(e.name),a.dataGeoTwo=e,a.dataGeoTwoName=e.name,a.geoDestino.latitudDes=e.lat,a.geoDestino.longitudDes=e.lng,a.geoDestino.ciudad_destino=e.ciudad,document.querySelector(".driver_en_camino_show")||(a.debugConstruct&&console.log("CREATE::fijaMarkerMapDestino::create services continuar"),a.continuar()))}}}),nw.Class.define("f_pedir_0_mostrarServicios",{extend:nw.lists,construct:function(e,a,o,i,t){console.log("f_pedir_0_mostrarServicios:::START::::no_line : "+a+", r, recargos, no_data:"+t,o,i),window.location.hash="showResultsServices",void 0===t&&(t=!1);var n=nw.userPolicies.getUserData(),r=(t?(o=e.datosServicio.r,i=e.datosServicio.recargos):e.datosServicio={r:o,recargos:i},0),s=(void 0!==e.navTable&&(r=e.navTable.getAllData().length),i.total),l=(0<r&&0<parseFloat(i.paradas)&&(r=parseInt(r)*parseFloat(i.paradas),s=parseFloat(i.total)+parseInt(r)),nw.utils.evalueData(e.numeroAuxiliares)&&nw.utils.evalueData(e.configCliente.valor_auxiliar_carga)&&(s=parseFloat(s)+parseInt(e.numeroAuxiliares)*parseInt(e.configCliente.valor_auxiliar_carga)),o.length);!0===a?nwgeo.removeAllPolyLines():e.ui.contenedor_address.removeClass("contenedor_address_show"),$(".estimado").remove();e.ui.pago_group.prepend("<div class='estimado'></div>");for(var c=0,d=0;d<l;d++){var u=o[d],p=(console.log("f_pedir_0_mostrarServicios:::servi",u),0),_=(nw.evalueData(e.configCliente.tarifas_fijas_usa_valor_por_paradas)&&(_=e.ui.paradas_adicionales_iniciales_creacion.getValue(),console.log("totalpax",_),_=_.val,g="1",nw.utils.evalueData(u.pasajero_adicional_rango_inicia_cobro)&&(g=u.pasajero_adicional_rango_inicia_cobro),console.log("iniciaPax",g),console.log("totalpax",_),console.log("servi.valor_pasajero_adicional",u.valor_pasajero_adicional),console.log("self.configCliente.tarifas_fijas_usa_valor_por_paradas",e.configCliente.tarifas_fijas_usa_valor_por_paradas),nw.utils.evalueData(_))&&"SI"==e.configCliente.tarifas_fijas_usa_valor_por_paradas&&nw.utils.evalueData(u.valor_pasajero_adicional)&&g<_&&(p=parseFloat(u.valor_pasajero_adicional)*(parseFloat(_)-parseFloat(g))),console.log("recargoPaxAdicional",p),{}),g=0,m=(void 0!==u.metros&&""!=u.metros&&0<parseFloat(u.metros)&&(g=parseFloat(e.poly.total_metros)/parseFloat(u.metros)),console.log("f_pedir_0_mostrarServicios:::servi.inicia_metros_add",u.inicia_metros_add),console.log("f_pedir_0_mostrarServicios:::servi.valor_metros_add",u.valor_metros_add),console.log("f_pedir_0_mostrarServicios:::self.poly.total_metros",e.poly.total_metros),0),v=(nw.utils.evalueData(u.inicia_metros_add)&&nw.utils.evalueData(u.valor_metros_add)&&e.poly.total_metros>=parseFloat(u.inicia_metros_add)&&(v=e.poly.total_metros-parseFloat(u.inicia_metros_add),console.log("disAdd",v),v=parseFloat(v)/parseFloat(u.metros),console.log("disAdd",v),m=parseFloat(v)*parseFloat(u.valor_metros_add)),console.log("f_pedir_0_mostrarServicios:::valorsumadistanciaAdicional",m),parseFloat(g)*parseFloat(u.valor_unidad_metros)),f=(isNaN(v)&&(v=0),0),w=(void 0!==u.tiempo&&""!=u.tiempo&&0<parseFloat(u.tiempo)&&(f=parseFloat(e.poly.tiempo)/parseFloat(u.tiempo)),0),w=(0!==(w=nw.evalueData(u.minutosMinimosParaPedirService)&&parseInt(f)<parseInt(u.minutosMinimosParaPedirService)?u.minutosMinimosParaPedirService:w)?f=w:nw.evalueData(e.configCliente.minutosMinimosParaPedirService)&&parseInt(f)<parseInt(e.configCliente.minutosMinimosParaPedirService)&&(f=e.configCliente.minutosMinimosParaPedirService),parseFloat(f)*parseFloat(u.valor_unidad_tiempo)),b=(isNaN(w)&&(w=0),parseFloat(v)+parseFloat(w)+parseFloat(u.valor_banderazo)+parseFloat(s)),h=parseFloat(u.minima);_.recargos=s,_.valorbase=u.valor_banderazo,_.totaluniminutos=parseInt(f),_.valorminutos=w,_.totalunimetros=parseInt(e.poly.total_metros),_.valordistancia=parseFloat(v),_.unidad_metros=u.metros,_.valor_unidad_metros=u.valor_unidad_metros,_.unidad_tiempo=u.tiempo,_.valor_unidad_tiempo=u.valor_unidad_tiempo,_.valor_metros_add=u.valor_metros_add,_.inicia_metros_add=u.inicia_metros_add,_.concepto_recargo="",_.metros_cobro_recargo=0,_.valor_recargo=0,nw.evalueData(u.valor_recargo)&&(_.metros_cobro_recargo=u.metros_cobro_recargo,_.valor_recargo=u.valor_recargo,_.concepto_recargo=u.concepto_recargo),b=parseFloat(b)+parseFloat(_.valor_recargo),_.valor_peajes=0,_.metros_cobro_peaje=0,nw.evalueData(u.valor_peajes)&&(_.valor_peajes=u.valor_peajes,_.metros_cobro_peaje=u.metros_cobro_peaje),(b=parseFloat(b)+parseFloat(_.valor_peajes))<h&&(b=h),"LIBRE"===e.cobro&&(b=0),"SI"===u.solo_para_mujeres&&"hombre"===n.genero||(f=!1,nw.evalueData(u.ciudad_o_lugar_origen)&&nw.evalueData(u.ciudad_o_lugar_destino)&&"trayecto"!==u.valor_tarija_fija&&(f=u.valor_tarija_fija),console.log("valorsumadistanciaAdicional",m),console.log("valor_estimado 1",b),console.log("valor_tarifa_fija 1",f),nw.utils.evalueData(m)&&nw.utils.evalueData(b)&&(b=parseFloat(b)+parseFloat(m)),nw.utils.evalueData(m)&&nw.utils.evalueData(f)&&(f=parseFloat(f)+parseFloat(m)),nw.utils.evalueData(p)&&(b=parseFloat(b)+parseFloat(p),nw.utils.evalueData(f))&&(f=parseFloat(f)+parseFloat(p)),console.log("valor_estimado 2",b),console.log("valor_tarifa_fija 2",f),c++,(w={}).valor_estimado=b,w.iva=u.iva,w.ptm=e.poly.total_metros_text,w.pt=e.poly.tiempo_text,w.servi=u,w.others=_,w.id=u.id,e.__count=c,e.__vl_services[u.id]=w,e.debugConstruct&&console.log("SHOWPRICE:::f_pedir_0_mostrarServicios:::DATA_SEND",w),e.showPrice(b,u.iva,e.poly.total_metros_text,e.poly.tiempo_text,u,f,_,c))}if(0===c)return nw.loadingRemove(),nw.dialog("Lo sentimos, no hay cobertura para tu zona (Code101)"),e.loadInitial(),e.activeNormal(),e.reziseNormalMap(),e.debugConstruct&&console.log("NO_COBERTURA:::f_pedir_0_mostrarServicios:::"),!1;nw.loadingRemove(),$(".backInShowServices").addClass("backInShowServices_show"),!0!==a&&0==t&&(i=[{lat:e.geo.latitude,lng:e.geo.longitude},{lat:e.geoDestino.latitudDes,lng:e.geoDestino.longitudDes}],nwgeo.centerMap(e.map,e.markerMyPosition,e.markerDestino,!1,i,!0),e.debugConstruct)&&console.log("CENTER_MAP:::f_pedir_0_mostrarServicios:::")},destruct:function(){},members:{}}),nw.Class.define("f_showHiddenDate",{extend:nw.lists,construct:function(b,e,a){var o;b.debugConstruct&&console.log("START:::f_showHiddenDate:::minutesAdd",a),b.__show=!0,0!=a?(b.setHours(a),b.ui.fechas_group.setVisibility(!0),b.ui.fecha.setRequired(!0),b.ui.hora.setRequired(!0)):b.ui.fechas_group.setVisibility(!1),!0===e?("SI"==b.configCliente.usa_subservicios&&(o=document.querySelector(".conta_mod"))&&o.remove(),(a={}).empresa=b.__up.empresa,a.id_tarifa=b.__id_tarifa,a.id_sevice=b.servicioAllData.id,"SI"==b.configCliente.usa_subservicios&&(b.debugConstruct&&console.log("START:::f_showHiddenDate:::SUBSERVICIOS"),(e=new nw.rpc(b.getRpcUrl(),"servicios")).setAsync(!0),e.setLoading(!1),e.exec("querySubService",a,function(e){console.log("RESULT_SERVER:::f_showHiddenDate:::r",e);var a="",o=config.domain_rpc,i=!1;b.__select&&""!=b.__select&&(i=b.__select.getAttribute("id"));for(var t=0;t<e.length;t++){var n,r,s,l,c=e[t],d=(console.log("mod",c),n=nw.evalueData(c.icono)?o+c.icono:config.domain_rpc+config.carpet_files_extern+"img/iconos_servi/modalidad_check.png","trayecto"==c.valor?(r=b.__vl_services[c.servicio_id],b.showPrecioSubservice(r.valor_estimado,r.iva,r.ptm,r.pt,r.servi,c.valor,r.others),s=b.valor_total,c.valor=b.valor_total):s=c.valor,b.__vl_services[c.servicio_id]),u="",p=0,_=nw.userPolicies.getUserData(),g=(b.debugConstruct&&console.log("START:::f_showHiddenDate:::INICIA_CUPONES::up.cupon, servi",_.cupon,d),0),d=("string"==typeof _.cupon&&""!=_.cupon&&(_=JSON.parse(_.cupon),l=!0,1==(l=nw.evalueData(_.servicio)&&null!=_.servicio&&""!=_.servicio&&_.servicio!=d.id?!1:l))&&(g=""==(l="porcentaje"==_.tipo_descuento?_.valor:"")?"<div class='valuedesc_end_dos'><span class='spanDesc' >$"+nw.addNumber(s)+"</span></div>":"<div class='valuedesc_end_dos'><span class='spanDesc' style='padding-right: 10px;'>$"+nw.addNumber(s)+"</span> "+l+"%</div>",p=d.servi.descuento_maximo,u="","porcentaje"==_.tipo_descuento?s-=(s*parseInt(_.valor)/100).toFixed():"valor"==_.tipo_descuento&&(l=parseInt(_.valor),s<=(l=0<parseInt(p)&&parseInt(p)<l?parseInt(p):l)?s=0:s-=l),0<p)&&"valor"==_.tipo_descuento&&(u+="<span class='spanSaldo'>Desc max cupon:<br> $"+nw.addNumber(p)+"</span>"),console.log("mod.porcentaje_aumento",c.porcentaje_aumento),c.valor);nw.evalueData(c.porcentaje_aumento)&&(l=parseFloat(s)*parseFloat(c.porcentaje_aumento)/100,d=s=parseFloat(s)+parseFloat(l)),console.log("value_service",s),console.log("value_subservice",d),console.log("valor_sin_desc",g),console.log("saldo_text",u),a+="<div class='modalidad' id='mod"+t+"'>","SI"!=b.configCliente.mostrar_valor_despues_abordaje?void 0!==r&&void 0!==r.servi&&void 0!==r.servi.valor_mascota&&r.servi.valor_mascota&&0<r.servi.valor_mascota&&0<b.num_mascota?a+="<div class='mod_options'><img alt='' src='"+n+"' /></div> <div class='mod_text' data-valor='"+d+"' data='"+JSON.stringify(c)+"'><div>"+c.nombre+"</div><div>$"+Intl.NumberFormat().format(s)+" "+g+u+"</div><div>Aux. x "+r.servi.valor_mascota+"</div></div>":(a=(a=(a=(a=(a+="<div class='mod_options'>")+"<img alt='' src='"+n+"' /></div>")+"<div class='mod_text' data-valor='"+d+"' data='"+JSON.stringify(c)+"'>")+"<div>"+c.nombre+"</div>")+"<div>$"+Intl.NumberFormat().format(s),nw.evalueData(g)&&nw.evalueData(u)&&(a+=" "+g+u),a+="</div></div>"):(localStorage.setItem("valor_aproximado_viaje",s),a+="<div class='mod_options'><img alt='' src='"+n+"' /></div> <div class='mod_text' data-valor='"+d+"' data='"+JSON.stringify(c)+"'><div>"+c.nombre+"</div><div></div></div>"),a+="</div>"}var m=document.querySelector(".conta_mod"),v=(m&&m.remove(),document.createElement("div"));v.innerHTML=a,v.className="conta_mod",(m=document.querySelector(".fechas_group")).after(v),b.__select="";for(var f=0;f<e.length;f++){var c="#mod"+f,w=document.querySelector(c);w.addEventListener("click",function(e){b.__select&&""!=b.__select&&(b.__select.style.color="#db0e32",b.__select.style.border="1.1px solid #db0e32",b.__select.style.background="linear-gradient(239deg, rgba(211, 200, 203, 0.85), #f1f5f6)"),this.style.color="rgb(49, 52, 50)",this.style.border="1.1px solid #1e7f26",this.style.background="linear-gradient(239deg, rgb(123, 228, 132), rgb(172, 178, 173)",b.__select=this,b.__subservice=JSON.parse(this.querySelector(".mod_text").getAttribute("data")),b.valor_total=JSON.parse(this.querySelector(".mod_text").getAttribute("data-valor"))}),0==f&&w.click()}i&&(m=document.querySelector("#"+i))&&(m.style.color="rgb(49, 52, 50)",m.style.border="1.1px solid #1e7f26",m.style.background="linear-gradient(239deg, rgb(123, 228, 132), rgb(172, 178, 173)")}))):(b.setHours(0),b.ui.fechas_group.setVisibility(!1),b.ui.fecha.setRequired(!1),b.ui.hora.setRequired(!1),b.reziseNormalMap(),"SI"==b.configCliente.usa_subservicios&&(o=document.querySelector(".conta_mod"))&&o.remove())},destruct:function(){},members:{}}),nw.Class.define("f_pedirDataAirpot",{extend:nw.lists,construct:function(a,o){var i=new nw.forms;i.id="dataAirpot",i.html="<h1 style='text-align:center;'>"+nw.utils.tr("Ingrese datos del servicio")+"</h1><br />",i.showBack=!0,a.data_aeropuerto_servicio=!1,i.createBase();i.setFields([{name:"num_maletas",label:"No Maletas",type:"numeric",required:!0},{name:"num_personas",label:"No Personas",type:"numeric",required:!0},{name:"vuelo_numero",label:"Vuelo número (opcional)",type:"textField",required:!1},{name:"centro_costos",label:"Centro costos",type:"textField"}]),i.buttons=[{style:"text-shadow: none;font-weight: lighter;border: 0;",className:"btn_maxwidth",name:"save_data_airpot",label:"Guardar",callback:function(){if(!i.validate())return!1;var e=(a.__datAirpot=i).getRecord();a.data_aeropuerto_servicio=e,nw.home(),o(e)}}],i.show()},destruct:function(){},members:{}}),nw.Class.define("f_confirmar_valor_negociacion",{extend:nw.lists,construct:function(a,o){nw.userPolicies.getUserData();var e={setTitle:"Confirmar valor",id:"taskConfirmaTime",html:"<div class='titleconfirmatime'>Confirmar valor</div>",changeHash:!0,showBack:!0,closeBack:!1,destroyAutomaticOnAccept:!1},i=(nw.isMobile()&&(e.role="page",e.transition="slide"),e.fields=[],e.fields.push({label:"Confirma el valor del servicio",name:"valorfijargrupo",type:"startGroup"},{name:"moneda",label:"",type:"label"},{name:"valor_fijado",label:"",type:"numeric",required:!0},{type:"endGroup"}),nw.dialog("<div id='valorfijo' class='valorfijo'></div>",function(){var e=i.getRecord();return console.log("data",e),!!i.validate()&&(a.valor_total=parseFloat(e.valor_fijado),nw.remove(".container_valorfijo"),o())},function(){return a.pedirVar=!1,nw.remove(".container_valorfijo"),!0},{addClass:"container_valorfijo",original:!0,destroyAutomaticOnAccept:!1,iconAccept:"<i class='material-icons' style='top: 5px;position: relative;'>check_circle</i>",iconCancel:"<i class='material-icons' style='top: 5px;position: relative;'>cancel</i>"}),e.showButtons=!1,e.createInHome=!0,e.canvas="#valorfijo",e.id="valorfijo_list",e.id_form="valorfijo_list_int",nw.dialog2("",!1,!1,e));i.ui.moneda.setValue(config.moneda),i.ui.valor_fijado.focus(),$(".valor_fijado").focus()},destruct:function(){},members:{}}),nw.Class.define("f_ciudad_confirmar",{extend:nw.lists,construct:function(e){nw.remove(".popup_pil"),this.self_crearviaje=e,this.saveConfirmaCiudad()},destruct:function(){},members:{saveConfirmaCiudad:function(){var a=this,e={setTitle:"Confirmar ciudad",id:"taskConfirmaCiudad",html:"<div class='titleconfirmatime'>Confirma el tiempo que duraste para finalizar esta tarea</div>",changeHash:!0,showBack:!0,closeBack:!1,destroyAutomaticOnAccept:!1},o=(nw.isMobile()&&(e.role="page",e.transition="slide"),e.fields=[{name:"texto_confirmar_ciudad",label:"No hemos podido ubicar tu ciudad",type:"html"},{name:"ciudad",label:"Busca tu ciudad actual",placeholder:"Digita tu ciudad",type:"search",autocomplete:!0,required:!0}],nw.dialog("<div id='pruebauno' class='pruebauno'></div>",function(){return!!o.validate()&&(console.log("self.ciudad_all_data",a.ciudad_all_data),a.self_crearviaje.ciudad_origen=a.ciudad_all_data.nombre,nw.remove("."+o.id),nw.remove(".pruebauno_container"),!0)},!1,{addClass:"pruebauno_container",original:!0,destroyAutomaticOnAccept:!1}),e.showButtons=!1,e.createInHome=!0,e.canvas="#pruebauno",e.id="pruebauno_list",e.id_form="pruebauno_list_int",nw.dialog2("",!1,!1,e)),e={service:"app_user",method:"populateCiudades",showsinresult:!0};o.ui.ciudad.actionSearch(e),o.ui.ciudad.addListener("clickToken",function(e){if(console.log(e),!e.data)return nw.cleanTokenField(),!1;a.ciudad_all_data=e.data.row,o.ui.ciudad.setValue(e.data.row.nombre)}),$(".ciudad").focus()},save:function(){if(!this.validate())return!1;var e=this.getRecord(!0);console.log("data",e)},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_2_createActionsInputsSearchDirections",{extend:nw.lists,construct:function(o){o.debugConstruct&&(console.log("%c<<<<DEBUG: START_LAUNCH:::::::::::::: f_2_createActionsInputsSearchDirections>>>>","background: #33A51F; color: #2B0902"),console.log("START_LAUNCH:::::::::::::: f_2_createActionsInputsSearchDirections"));var e={strictBounds:!1},a=document.querySelector(".address"),a=(nwgeo.autocomplete(a,o.map,function(e){nw.evalueData(e.results.type)&&("airport"===e.results.type?o.__typeOriginOne=e.results.type:o.__typeOriginOne=!1);var a={};a.results=e.place,a.address=e.address,a.lat=e.place.geometry.location.lat(),a.lng=e.place.geometry.location.lng(),console.log("%c<<<<DEBUG: START_LAUNCH:::::::::::::: f_2_createActionsInputsSearchDirections>>>>","background: #33A51F; color: #2B0902"),console.log("r",e),console.log("se",a),o.setUbicOne(a,e.results),o.activeNormalV=!1,o.muestraAddressInit(),"SI"==o.configCliente.pedir_datos_viaje_airpot&&"airport"==e.results.type&&o.pedirDataAirpot(function(e){})},main.configCliente.paises_iso_relation_autocomplete_maps,e),document.querySelector(".address_destino"));nwgeo.autocomplete(a,o.map,function(a){o.debugConstruct&&console.log("RESULT::::::f_2_createActionsInputsSearchDirections:::INPUT addres_destino:r",a),console.log("self.configCliente.pedir_datos_viaje_airpot",o.configCliente.pedir_datos_viaje_airpot),"CARGA"==o.configCliente.app_para?o.formDatosCarga(function(){o.pointMapDestino(a)}):"SI"==o.configCliente.pedir_datos_viaje_airpot&&"airport"==a.results.type?o.pedirDataAirpot(function(e){o.pointMapDestino(a)}):o.pointMapDestino(a),o.activeNormalV=!0},main.configCliente.paises_iso_relation_autocomplete_maps,e)},destruct:function(){},members:{}}),nw.Class.define("f_traeTarifasContinua",{extend:nw.lists,construct:function(o,e){console.log("CREATE::f_traeTarifasContinua");var i=this;if((o.traeTarifas=i).self=o,i.no_line=e,o.__no_line=e,!o.launch)return!1;o.removeCarsMap(),o.ui.favoritos_group.removeClass("favoritos_group_show"),o.ui.listo_fijar.setVisibility(!1),o.ui.fijar_en_mapa_destino.setVisibility(!1),o.ui.fijar_en_mapa_origen.setVisibility(!1),o.ui.address.setVisibility(!0),o.recargosInit={},o.recargosInit.total=0,o.recargosInit.paradas=0,nw.utils.evalueData(o.configCliente.recargos_valor_parada_adicional)&&(o.recargosInit.paradas=o.configCliente.recargos_valor_parada_adicional),nw.loading(),o.setDataPago(),o.reziseNormalMap(),"horas"!==o.tipo&&o.ui.address_destino.setVisibility(!0);e=o.getRecord(!0);if(e.cobertura_por_ciudades="SI",void 0!==o.configCliente.cobertura_por_ciudades&&(e.cobertura_por_ciudades=o.configCliente.cobertura_por_ciudades),o.debugConstruct&&console.log("SHOW::f_traeTarifasContinua::data.cobertura_por_ciudades",e.cobertura_por_ciudades),"trayecto"===e.forma&&!nw.evalueData(e.address_destino))return o.ui.address_destino.setVisibility(!0),!1;if("horas"===e.forma)return $(".pago_group").addClass("buttons_group_fix_pago_group"),document.querySelector(".nw_widget_div_codigo_promo").classList.add("visibe_promo"),$(".buttons_group").addClass("buttons_group_fix"),o.valor_total="0",o.showPrice(0,19,0,0),nw.loadingRemove(),o.reziseMap(),!1;o.cleanPre(),document.querySelector(".centrar_mapa").style.display="none",o.ui.pago_group.addClass("buttons_group_fix_pago_group"),document.querySelector(".nw_widget_div_codigo_promo").classList.add("visibe_promo"),$(".btnMenuHeader").addClass("btnMenuHeader_hidden"),o.ui.contenedor_azul.addClass("containBtnFooter_group_fix"),o.ui.paradas_group.addClass("containBtnFooter_group_fix");var a=o.ui.pago_group.height(),a=(o.reziseMap(a),nw.userPolicies.getUserData()),t={};if(t.empresa=a.empresa,t.usuario=a.usuario,t.perfil=a.perfil,nw.evalueData(a.bodega)&&(t.bodega=a.bodega),t.ciudad_origen=o.ciudad_origen,t.name_place_origen=o.ciudad_origen+" "+o.name_place_origen+" "+e.address,t.ciudad_destino=o.ciudad_destino,t.name_place_destino=o.ciudad_destino,nw.evalueData(o.name_place_destino)&&(t.name_place_destino+=" "+o.name_place_destino),t.name_place_destino_text=o.name_place_destino+" "+o.name_place_destino_text,t.ciudad_origen===t.ciudad_destino?t.type="urbano":t.ciudad_origen!==t.ciudad_destino&&(t.type="intermunicipal"),nw.evalueData(o.__typeOriginOne)&&"airport"===o.__typeOriginOne&&(t.type=o.__typeOriginOne),nw.evalueData(o.__typeOrigin)&&"airport"===o.__typeOrigin&&(t.type=o.__typeOrigin),(i.validaAeropuerto(t.name_place_destino)||i.validaAeropuerto(t.name_place_destino_text)||i.validaAeropuerto(t.name_place_origen))&&(t.type="airport"),console.log("usu.type",t.type),o.typeInTravelget=t.type,t.cobertura_por_ciudades=e.cobertura_por_ciudades,t.configCliente=o.configCliente,!0!==o.validateDataSolicitudService(t))return!1;console.log("%c<<<<DEBUG: f_traeTarifasContinua START>>>>","background: #33A51F; color: #2B0902"),console.log("SHOW::f_traeTarifasContinua::DATA_SEND_SERVER:::usu",t),console.log("SHOW::f_traeTarifasContinua::DATA_SEND_SERVER:::data",e),console.log("%c<<<<DEBUG: f_traeTarifasContinua END>>>>","background: #33A51F; color: #2B0902");a=new nw.rpc(o.getRpcUrl(),"servicios");a.setAsync(!0),a.setLoading(!1);a.exec("consultaTarifasAllApp",t,function(e){var a;if(console.log("%c<<<<DEBUG RESULT_SERVER: f_traeTarifasContinua START>>>>","background: #33A51F; color: #2B0902"),console.log("RESULT_SERVER::f_traeTarifasContinua::getTarifasResult:::r",e),console.log("%c<<<<DEBUG RESULT_SERVER: f_traeTarifasContinua END>>>>","background: #33A51F; color: #2B0902"),0===(o.__data_service=e).length)return nw.loadingRemove(),e="Lo sentimos, no hemos encontrado cobertura para el sitio indicado.<br />",e=(e=(e=(e=(e=(e=(e="Lo sentimos, no hemos encontrado cobertura para el sitio indicado.<br /><div class='origienesYDestinos'><br /><strong>Tipo</strong>: "+t.type+"</strong>")+"<br /><strong>Dirección origen</strong>: "+o.ui.address.getValue()+"</strong>")+"<br /><strong>Ciudad origen</strong>: "+t.ciudad_origen+"</strong>")+"<br /><strong>Lugar origen</strong>: "+t.name_place_origen+"</strong><br /><br />")+"<br /><strong>Dirección Destino</strong>: "+o.ui.address_destino.getValue()+"</strong>")+"<br /><strong>Ciudad destino</strong>: "+t.ciudad_destino+"</strong>")+"<br /><strong>Lugar destino</strong>: "+t.name_place_destino+"</strong></div>",a={useDialogNative:!1,cleanHtml:!1},nw.dialog(e,!1,!1,a),o.loadInitial(),o.activeNormal(),o.reziseNormalMap(),!1;i.evalueContinuarPoliLyne()}),nw.loadingRemove(),$(".backInShowServices").addClass("backInShowServices_show"),o.ui.contenedor_address.removeClass("contenedor_address_show")},destruct:function(){},members:{evalueContinuarPoliLyne:function(){var e=this.self;if("SI"===e.configCliente.usar_api_polylinea_pedir_servicio)return this.continuarConPoliLyne();0<e.arrayParadas.length?this.continuarConPoliLyne():this.continuarSinPoliLyne()},continuarConPoliLyne:function(){var i=this,t=i.self,n=i.no_line,e=t.map,a={lat:t.geo.latitude,lng:t.geo.longitude,lat2:t.geoDestino.latitudDes,lng2:t.geoDestino.longitudDes},o=!1,r=(!0===n&&(o=!0),"animate"),s=(t.animations3D||(r="center"),t.debug&&console.log("coords",a),t.arrayParadas);t.line=nwgeo.addLineStreet(e,a,function(e){if(t.debugConstruct&&console.log("REPONSE_POLYLINE::f_traeTarifasContinua:::response",e),!e)return i.continuarSinPoliLyne(),!1;t.pathOriginToDestiny=JSON.stringify(e.pathOnetoOne),t.poly.tiempo=e[0].legs[0].duration_in_traffic.value,t.poly.tiempo_text=e[0].legs[0].duration_in_traffic.text,t.poly.total_metros=e[0].legs[0].distance.value,t.poly.total_metros_text=e[0].legs[0].distance.text,t.mostrarServicios(n,t.__data_service,t.recargosInit),t.__recargos=t.recargosInit;var a=new google.maps.LatLngBounds;a.extend({lat:parseFloat(t.geo.latitude),lng:parseFloat(t.geo.longitude)}),a.extend({lat:parseFloat(t.geoDestino.latitudDes),lng:parseFloat(t.geoDestino.longitudDes)});for(var o=0;o<t.arrayParadas.length;o++)nw.evalueData(t.arrayParadas[o].latitud)&&nw.evalueData(t.arrayParadas[o].longitud)&&a.extend({lat:parseFloat(t.arrayParadas[o].latitud),lng:parseFloat(t.arrayParadas[o].longitud)});nwgeo.native||t.map.fitBounds(a)},main.colorPolyLine,o,r,!0,!1,!0,!1,s)},continuarSinPoliLyne:function(){var e=this.self,a=this.no_line,o=parseFloat(e.geo.latitude),i=parseFloat(e.geo.longitude),t=parseFloat(e.geoDestino.latitudDes),n=parseFloat(e.geoDestino.longitudDes),o=nwgeo.distance(o,i,t,n),i=(o*=.001).toFixed(2),t=nwgeo.getTimeToDistanceAndSpeed(i,15),n=(e.poly.tiempo=60*t,e.poly.tiempo_text=Math.round(t)+" Minutos",e.poly.total_metros=1e3*i,e.poly.total_metros_text=i+"KM",e.mostrarServicios(a,e.__data_service,e.recargosInit),{lat:e.geo.latitude,lng:e.geo.longitude,lat2:e.geoDestino.latitudDes,lng2:e.geoDestino.longitudDes}),r=[],s=(r.push({lat:n.lat,lng:n.lng}),nwgeo.animateCamera(e.map,{target:{lat:n.lat,lng:n.lng},zoom:18,tilt:40,bearing:100,duration:2e3}),new google.maps.LatLngBounds);s.extend({lat:parseFloat(e.geo.latitude),lng:parseFloat(e.geo.longitude)}),s.extend({lat:parseFloat(e.geoDestino.latitudDes),lng:parseFloat(e.geoDestino.longitudDes)});for(var l=0;l<e.arrayParadas.length;l++)nw.evalueData(e.arrayParadas[l].latitud)&&nw.evalueData(e.arrayParadas[l].longitud)&&(s.extend({lat:parseFloat(e.arrayParadas[l].latitud),lng:parseFloat(e.arrayParadas[l].longitud)}),nwgeo.animateCamera(e.map,{target:{lat:parseFloat(e.arrayParadas[l].latitud),lng:parseFloat(e.arrayParadas[l].longitud)},zoom:18,tilt:40,bearing:100,duration:2e3}),r.push({lat:parseFloat(e.arrayParadas[l].latitud),lng:parseFloat(e.arrayParadas[l].longitud)}));r.push({lat:n.lat2,lng:n.lng2}),nwgeo.animateCamera(e.map,{target:{lat:n.lat2,lng:n.lng2},zoom:18,tilt:40,bearing:100,duration:2e3}),nwgeo.animateCamera(e.map,{target:r,zoom:18,tilt:40,bearing:100,duration:3e3}),nwgeo.native||e.map.fitBounds(s)},validaAeropuerto:function(e){if(console.log("string",e),nw.utils.evalueData(e)){if(e=e.toLowerCase(),console.log("string",e),-1!=e.indexOf("aeropuerto")||-1!=e.indexOf("airport"))return console.log("Is Airport???? SIII"),!0;console.log("Is Airport???? NOOOOOO")}return!1}}}),nw.Class.define("f_activeAbordo",{extend:nw.lists,construct:function(e,a){console.log("START:::ABORDO:::f_activeAbordo",a),e.fijaMarkerMapDestino({lat:a.latitudDes,lng:a.longitudDes}),e.debugConstruct&&console.log("CREATE:::MARKER_DESTINY:::f_activeAbordo",a),"SI"==e.configCliente.mostrar_valor_despues_abordaje&&(o=localStorage.getItem("valor_aproximado_viaje"))&&(o=Intl.NumberFormat().format(o),nw.dialog("El valor del viaje aproximado es $"+o,function(e){localStorage.removeItem("valor_aproximado_viaje")}),$(".popup_pil_text").css("cssText","border-radius: 5px;"),$(".popup_pil_text").css("cssText","font-weight:400;font-family:Arial, Helvetica, sans-serif;font-size:20px;padding:30px 10px;border-radius: 5px;"),$(".popup_pil_btns").css("cssText","font-size:24px;font-weight: bold; padding:10px 10px 20px 10px;"),$(".btnpil_acept").css("cssText","width: 150px;")),e.hiddenWaitingDriver(),document.querySelector(".centrar_mapa").style.display="block",e.ui.driver_en_camino.addClass("driver_en_camino_show");var o="En camino a "+a.destino+" <span class='timeAndKmToArrive'></span>",o=(o+="<span class='formapago'>"+a.tipo_pago+"</span>",nw.utils.evalueData(a.id_parada)&&(o+="<br> Parada#"+a.id_parada),o+="<br> Service#"+a.id,"Wompi"==a.tipo_pago&&(o+="<span class='formapagobtn'></span>"),e.htmlDatosConductor(a,o,!0)),o=(e.ui.html_driver_en_camino.setValue(o),e.useChat(a),"Wompi"==a.tipo_pago&&((o=document.createElement("button")).className="formapagobtn_btn",o.innerHTML="Pagar con <strong>Wompi</strong>",o.data=a,o.onclick=function(){var e=this.data,a=(console.log("dataaaaaaaaaaaaa",e),console.log("data.valor",e.valor),parseFloat(Math.trunc(e.valor.toString())+"00")),o=(console.log("price",a),{});o.reference=e.id+"-"+Math.random(),o.price=a,o.email=e.usuario,o.fullName=e.cliente_nombre,o.phoneNumber=e.celular,o.phoneNumberPrefix="+"+config.indicativo,(new nw.payWompi).start(o)},document.querySelector(".formapagobtn").appendChild(o)),""),o=("SI"===e.configCliente.usa_codigos_verificacion_servicio&&(o+="<br> Tu código de seguridad es: <strong>"+a.code_verifi_service_fin+"</strong>"),document.querySelector(".timeAndKmToArrive").innerHTML=o,$(".containInfoDriver").addClass("containInfoDriver_enrutafinal"),e.ui.cancelar_pedido_en_ruta.setVisibility(!1),nw.evalueData(e.activeWatchPosition)||e.iniciarWatchPosition(),e.ui.driver_en_camino.height());e.reziseMap(o),e.debugConstruct&&console.log("CHANGE:::HTML:::f_activeAbordo:::EN_CAMINO_TIME",a),!1===e.initAbordo&&(!1!==e.markerDestino&&nwgeo.setPositionMarker(e.markerDestino,a.latitudDes,a.longitudDes),!1===e.fram&&e.framePositionConductor(),e.useChat(a)),e.initAbordo=!0},destruct:function(){},members:{}}),nw.Class.define("f_4_resolveStatus",{extend:nw.lists,construct:function(e,a){function o(e){return 60*parseInt(e.split(":")[0])+parseInt(e.split(":")[1])+parseInt(e.split(":")[2])/60}var i,t,n,r,s,l;console.log("LAUNCH::::f_4_resolveStatus",a),!1!==e.loadedFirst||"SOLICITUD"!==a.estado&&"EN_RUTA"!==a.estado&&"EN_SITIO"!==a.estado&&"ABORDO"!==a.estado||(e.initIntervalo(),e.ciudad_destino=a.ciudad_destino),"EN_RUTA"===a.estado||"EN_SITIO"===a.estado||"ABORDO"===a.estado?(e.dataServiceActive=a,e.serviceActive=!0):e.serviceActive=!1,console.log("%c<<<<f_4_resolveStatus::: STATE "+a.estado+"!!!!!!!!!!!!!>>>>","background: #ff3366; color: #fff"),"SOLICITUD"===a.estado&&"reservado"!=a.tipo_servicio||"SOLICITUD"===a.estado&&"reservado"!=a.tipo_servicio&&!nw.evalueData(a.conductor_usuario)||"SOLICITUD"===a.estado&&"SI"==e.configCliente.driver_puede_ofertar_valor_servicio&&!nw.evalueData(a.conductor_usuario)?(e.dataServiceActive=a,0==e.circu&&(e.clearCircul(),e.circu=!0,e.ui.pago_group.addClass("buttons_group_fix_pago_group_hidden"),console.log("r.origen ",a.origen),e.ui.address.setValue(a.origen),e.ui.address_destino.setValue(a.destino),e.geo.latitude=a.latitudOri,e.geo.longitude=a.longitudOri,e.geoDestino.latitudDes=a.latitudDes,nwgeo.native||(n=new google.maps.LatLng(e.geo.latitude,e.geo.longitude),e.setPositionOne(n)),e.geoDestino.longitudDes=a.longitudDes),(n=document.querySelector(".iframechat"))||e.framePositionConductor(),i=(i=new Date).getHours()+":"+i.getMinutes()+":"+i.getSeconds(),i=(i=function(e,a){e=o(e);return o(a)-e}(a.hora,i)).toFixed(1),console.log("dddddddddddddddddddddddddddd",i),t=1,nw.evalueData(e.configCliente.tiempo_notificacion_servicio)&&0<parseFloat(e.configCliente.tiempo_notificacion_servicio)&&(t=parseFloat(e.configCliente.tiempo_notificacion_servicio)),e.debugConstruct&&console.log("RESPONSE_SERVER::::f_4_resolveStatus::self.configCliente.tiempo_notificacion_servicio, espera, dd = "+i,e.configCliente.tiempo_notificacion_servicio,t),i<t?(!nw.utils.evalueData(e.valor_total)&&nw.utils.evalueData(a.valor)&&(console.log("rrrrrrrrrrrrrrrrrr",a),e.valor_total=a.valor),e.showWaitingDriver(i,t)):e.noHayServicios()):"EN_RUTA"===a.estado?(console.log("RESOLVE_STATUS_CHANGE:::f_4_resolveStatus:::EN_RUTA",a),!1===e.initservice&&(e.framePositionConductor(),e.initservice=!0),clearInterval(e.inte),(n=document.querySelector(".iframechat"))||e.framePositionConductor(),e.circu=!1,e.activeEnRuta(a),nw.dialogRemove()):"EN_SITIO"===a.estado?(console.log("RESOLVE_STATUS_CHANGE:::f_4_resolveStatus:::EN_SITIO",a),(n=document.querySelector(".iframechat"))||e.framePositionConductor(),e.activeEnSitio(a)):"ABORDO"===a.estado?(console.log("RESOLVE_STATUS_CHANGE:::f_4_resolveStatus:::ABORDO",a),e.markerDestino||(e.geoDestino.latitudDes=a.latitudDes,e.geoDestino.longitudDes=a.longitudDes),(n=document.querySelector(".iframechat"))||(e.framePositionConductor(),e.initservice=!0),e.activeAbordo(a)):"LLEGADA_DESTINO"!==a.estado||nw.evalueData(a.calificacion_conductor)?"CANCELADO_POR_CONDUCTOR"!==a.estado||nw.evalueData(a.calificacion_conductor)?e.activeNormal():(nw.dialog("El conductor ha cancelado el servicio"),n=!1,(r=document.querySelector(".framechat"))&&r.remove(),(s=document.querySelector(".btn_chat"))&&s.remove(),1==e.actEnRuta&&(void 0!==e.polylineRuta&&null!==e.polylineRuta&&(e.polylineRuta.setMap(null),delete e.polylineRuta),e.actEnRuta=!1),nwgeo.removeAllPolyLines(),e.removeMarker4(),e.loadInitial(),e.activeNormal(),e.initservice=!1,e.clearIntervalo(),clearInterval(e.interval),l=document.querySelector("body"),(n=document.querySelector(".iframechat"))&&l.removeChild(n),setTimeout(function(){nw.loadingRemove(),main.resumenFinal(a,"cliente")},2e3)):(n=!1,(r=document.querySelector(".framechat"))&&r.remove(),(s=document.querySelector(".btn_chat"))&&s.remove(),1==e.actEnRuta&&(void 0!==e.polylineRuta&&null!==e.polylineRuta&&(e.polylineRuta.setMap(null),delete e.polylineRuta),e.actEnRuta=!1),nwgeo.removeAllPolyLines(),e.removeMarker4(),e.loadInitial(),e.activeNormal(),e.initservice=!1,e.clearIntervalo(),clearInterval(e.interval),l=document.querySelector("body"),(n=document.querySelector(".iframechat"))&&l.removeChild(n),setTimeout(function(){nw.loadingRemove(),main.resumenFinal(a,"cliente")},2e3)),e.loadedFirst=!0},destruct:function(){},members:{}}),nw.Class.define("f_activeEnSitio",{extend:nw.lists,construct:function(e,a){console.log("LAUNCH:::f_activeEnSitio",a),1==e.actEnRuta&&(void 0!==e.polylineRuta&&null!==e.polylineRuta&&(e.polylineRuta.setMap(null),delete e.polylineRuta),e.actEnRuta=!1),nwgeo.removeAllPolyLines(),e.hiddenWaitingDriver(),document.querySelector(".centrar_mapa").style.display="block",e.ui.driver_en_camino.addClass("driver_en_camino_show");var o="<span class='infoDriverText'>"+nw.utils.tr("¡Tu conductor ha llegado!"),o=("SI"===e.configCliente.usa_codigos_verificacion_servicio&&(o+="<br> Tu código de verificación es: "+a.code_verifi_service),nw.utils.evalueData(a.id_parada)&&(o+="<br> Parada#"+a.id_parada),o+="<br> Service#"+a.id,e.htmlDatosConductor(a,o+="</span>")),o=(e.ui.html_driver_en_camino.setValue(o),e.useChat(a),e.ui.driver_en_camino.height());e.reziseMap(o),e.conductorLlegaASitio=!0,e.debugConstruct&&console.log("END::CHANGE:::f_activeEnSitio:::CENTERMAP_ORIG/DRIVER")},destruct:function(){},members:{}}),nw.Class.define("f_activeNormal",{extend:nw.lists,construct:function(e){var a;e.debugConstruct&&console.log("START::::::f_activeNormal"),$(".containInfoDriver").remove(),e.clearIntervalo(),nwgeo.cleartWatchPostion(),e.hiddenWaitingDriver(),e.reziseNormalMap(),nwgeo.removeAllPolyLines(),document.querySelector(".centrar_mapa").style.display="block",e.activeWatchPosition=!1,e.markerDriver=!1,e.serviceActive=!1,e.servicioTomado=!1,e.recibeGeoDriver=!1,e.timeNoRecibeGeoDriver=0,e.conductorLlegaASitio=!1,e.polyLineDestino=!1,e.actEnRuta=!1,e.shotFirstUbicationDriver=!1,e.puntajeDriver=!1,e.createDataDriver=!1,nwgeo.type=null,e.fram=document.querySelector(".iframechat_"),e.fram&&(e.fram.remove(),e.loadInitial(),e.ui.address.setVisibility(!0),e.ui.address_destino.setValue(""),console.log(e.cancela_conductor),1==e.cancela_conductor)&&(e.cancela_conductor=!1,nw.dialog("El conductor ha cancelado el servicio")),e.ui.driver_en_camino.removeClass("driver_en_camino_show"),void 0!==e.navTable&&e.navTable.clean(),e.removeCarsMap(),"SI"==e.configCliente.usa_subservicios&&(a=document.querySelector(".conta_mod"))&&a.remove(),e.debugConstruct&&console.log("END::::::f_activeNormal"),e.resetValuesHome(),e.initIntervalo()},destruct:function(){},members:{}}),nw.Class.define("f_3_validaServiceActive",{extend:nw.lists,construct:function(o,e,i,a,t){o.debugConstruct&&console.log("START_LAUNCH::::::f_3_validaServiceActive");var n=this,r=e,s=(!o.recibeGeoDriver&&3<=o.timeNoRecibeGeoDriver&&(e=!0),!0===o.serviceActive&&!1===o.servicioTomado&&(o.servicioTomado=e=!0),o.debug&&(console.log("self.servicioTomado",o.servicioTomado),console.log("self.serviceActive",o.serviceActive),console.log("first",e),console.log("self.recibeGeoDriver",o.recibeGeoDriver),console.log("self.timeNoRecibeGeoDriver",o.timeNoRecibeGeoDriver)),(n.selfAll=o).buscaOfertasMain=n.buscaOfertas,nw.userPolicies.getUserData()),l={};function c(e){var a=e;void 0!==e[0]&&(a=e[0]),nw.remove(".form_ofertando_esperando"),nw.remove(".ofertas_container"),console.log("f_3_validaServiceActive:::resolveData::::ra, r",e,a),!1===e&&0==o.activeNormalV||!1===e?o.activeNormal():(nw.utils.evalueData(a.puntaje)||(a.puntaje="0"),"0"===a.puntaje&&(a.puntaje="0.1"),o.arrayDataBuscaOfertas=null,"SOLICITUD"!=a.estado||nw.evalueData(a.conductor_id)||"SI"==l.buscaOfertas&&(e=o.getRecord(),console.log("dataform",e),console.log("r",a),nw.utils.evalueData(e.address)||o.ui.address.setValue(a.origen),nw.utils.evalueData(e.address_destino)||o.ui.address_destino.setValue(a.destino),nw.utils.evalueData(e.datos_vehiculo_elegido)||o.ui.datos_vehiculo_elegido.setValue(a.datos_vehiculo_elegido),nw.utils.evalueData(e.descricion_carga)||o.ui.descricion_carga.setValue(a.descricion_carga),n.buscaOfertas(a)),e=[],console.log("vencidos",e),0<e.length&&o.updateVencidos(e),o.recibeGeoDriver=!1,o.timeNoRecibeGeoDriver++,a&&(a.type="cliente",main.id_service_active=a.id,o.resolveStatus(a)),nw.evalueData(a.driver_latitud)&&nw.evalueData(a.driver_longitud)&&("EN_RUTA"!==a.estado&&"EN_SITIO"!==a.estado&&"ABORDO"!==a.estado||(o.positionConductor={lat:a.driver_latitud,lng:a.driver_longitud},o.createMarkerDriver(!1,o.positionConductor),o.shotFirstUbicationDriver=!0,o.serviceActive=a,nw.evalueData(a.puntaje)&&(o.puntajeDriver=a.puntaje,e=document.querySelector(".containerPuntajeDriverSpan"))&&(document.querySelector(".containerPuntajeDriverSpan").innerHTML=o.showStarsDriver(),o.dataHtmlConductor=e.innerHTML))),nw.evalueData(i)&&i(a))}l.usuario=s.usuario,l.empresa=s.empresa,l.perfil=s.perfil,l.buscaOfertas="NO",l.configCliente=o.configCliente,console.log("self.serviceActive",o.serviceActive),console.log("firstInitial",r),console.log("self.configCliente.driver_puede_ofertar_valor_servicio",o.configCliente.driver_puede_ofertar_valor_servicio),0==o.serviceActive&&"SI"===o.configCliente.driver_puede_ofertar_valor_servicio&&(l.buscaOfertas="SI"),o.debug&&console.log("self.createDataDriver",o.createDataDriver),!0!==e&&o.createDataDriver&&o.puntajeDriver||(l.getDataGeoDriver=!0),o.debug&&(console.log("data.getDataGeoDriver",l.getDataGeoDriver),console.log("first",e)),"SI"==main.configCliente.usa_firebase?(console.log("dataFirebaseService",t),c(t)):((s=new nw.rpc(o.getRpcUrl(),"servicios")).setAsync(!0),s.setLoading(!1),console.log("f_3_validaServiceActive:::dataSend::::data",l),s.exec("servicioActivoUser",l,function(e){console.log("f_3_validaServiceActive:::responseServer::::ra, r",e),c(e)}))},destruct:function(){},members:{buscaOfertas:function(e,a){console.log("buscaOfertas",e,a);var o,i,t=this,n=("main"!=a&&(t.selfAll.arrayDataBuscaOfertas=e),nw.remove(".ofertas_container"),document.createElement("div")),a=(n.className="ofertas_container",document.body.appendChild(n),nw.userPolicies.getUserData());function r(e,a){console.log("ra",e);var o=e.conductor_foto,i=(nw.evalueData(e.conductor_foto_carro)&&(o=e.conductor_foto_carro),""),o=(i=(i=(i=(i=(i=(i=(i+="<div class='offer_datatravel'>")+("<div class='offer_foto' style='background-image: url("+config.domain_rpc+o+");'></div>"))+"<div class='offer_datos'>"+("<div class='offer_row offer_nombre'>"+e.conductor_nombre+"</div>"))+("<div class='offer_row offer_marcacarro'>"+e.conductor_marca_carro+"</div>")+"</div>")+"<div class='offer_precios'>"+("<div class='offer_row offer_oferta'>"+e.oferta+"</div>"))+"</div>"+"</div>")+"<div class='offer_buttons'>"+"</div>",document.createElement("div")),i=(o.className="ofertas_offer ofertas_offer_"+e.id,o.innerHTML=i,n.appendChild(o),document.createElement("button"));i.className="offer_btn offer_aceptar",i.innerHTML=nw.str("Aceptar"),i.data={data:e,row:o},i.onclick=function(){nw.remove(this.data.row),a.rechazarAceptarOferta(this.data.data,"ACEPTA_CLIENTE",function(e){if(!e)return nw.dialog("La oferta ya no está disponible");nw.dialog('<div class="loadingCenterTextIcon"><div class="cEftVf cEftVf_wtext"></div><div class="textLoading">Confirmando, por favor espere</div></div>',function(){return!1},!1,{original:!0,textAccept:"Ok",addClass:"form_ofertando_esperando",destroyAutomaticOnAccept:!1})})},o.querySelector(".offer_buttons").appendChild(i),(i=document.createElement("button")).className="offer_btn offer_rechazar",i.innerHTML=nw.str("Ignorar"),i.data={data:e,row:o},i.onclick=function(){nw.remove(this.data.row),a.rechazarAceptarOferta(this.data.data,"RECHAZADO_POR_USUARIO",function(e){}),0==document.querySelectorAll(".ofertas_offer").length&&nw.remove(".form_ofertando_esperando")},o.querySelector(".offer_buttons").appendChild(i)}main.destroyQueryOfertas(),"SI"==main.configCliente.usa_firebase?(o=0,(i={table:"servicios_ofertas"}).where_array=[],i.where_array[0]={variable:"empresa",operator:"==",equal:a.empresa},i.where_array[o++]={variable:"id_servicio",operator:"==",equal:e.id},i.where_array[1]={variable:"estado",operator:"==",equal:"OFERTADO"},i.limit=10,i.order=!1,i.getModelData=!1,i.destroyQuery=!1,console.log("ops",i),i.callback=function(e,o,a){queryGetOffers=a,console.log("r",e),console.log("snapshot:::buscaOfertas",o),console.log("snapshot.empty:::buscaOfertas",o.empty),o.docChanges().forEach(function(e){var a=e.doc.data();console.log("snapshot.empty:::buscaOfertas",o.empty),console.log("change.type:::buscaOfertas",e.type),console.log("data:::buscaOfertas",a),nw.remove(".ofertas_offer_"+a.id),"removed"!=e.type&&e.type,"added"==e.type&&r(a,t)})},nw.firebase.select(i)):(a=nw.userPolicies.getUserData(),(o=e).usuario_buscaoffer=a.usuario,(i=new nw.rpc(t.getRpcUrl(),"app_user")).setAsync(!0),i.setLoading(!1),console.log("buscaOfertas:::sendDataServer",o),i.exec("buscaOfertas",o,function(e){if(nw.loadingRemove(),console.log("buscaOfertas:::responseServer",e),!e)return!1;for(var a=0;a<e.length;a++)r(e[a],t)}))},rechazarAceptarOferta:function(o,i,t){this.selfAll.arrayDataBuscaOfertas=null;var e=nw.userPolicies.getUserData(),a={},e=(a.usuario=e.usuario,a.empresa=e.empresa,a.perfil=e.perfil,a.id=o.id,a.estado=i,new nw.rpc(nw.getRpcUrl(),"app_user"));e.setAsync(!0),e.setLoading(!1),console.log("ofertarViaje:::rechazarAceptarOferta:::dataSend",a),console.log("ofertarViaje:::rechazarAceptarOferta:::ra",o);e.exec("rechazaAceptaOferta",a,function(e){main.rechazarAceptarOfertaInFirebase(o.id);var a="RECHAZADO_POR_USUARIO"==i?"El usuario ha rechazado su oferta":"El usuario ha aceptado su oferta";nw.sendNotificacion({title:a,body:a,icon:"fcm_push_icon",sound:"default",data:"nw.dialog('"+a+"')",callback:"FCM_PLUGIN_ACTIVITY",to:o.token}),console.log("ofertarViaje:::rechazarAceptarOferta:::responseServer",e),t(e)})}}}),nw.Class.define("f_formDatosCarga",{extend:nw.lists,construct:function(i,o){i.detalle=new nw.forms,i.detalle.id="f_pagos_empresa",i.detalle.setTitle="Detalle del servicio",i.showBackCallBack=function(){nw.loadHome()},i.detalle.createBase();var e,a,t=function(){i.detalle.setFields([{label:"Detalle servicio",name:"detalle_servicio",type:"startGroup"},{name:"numero_auxiliares",label:"Número Auxiliares",type:"selectBox"},{name:"observaciones_servicio",label:"Observaciones generales del servicio",type:"textArea"},{name:"",type:"endGroup"},{label:"Datos Recogida",name:"datos_recogida",type:"startGroup"},{name:"contacto_recogida",label:"Contacto",type:"textField"},{name:"telefono_recogida",label:"Teléfono",type:"numeric"},{name:"observaciones_recogida",label:"Observaciones",type:"textArea"},{name:"",type:"endGroup"},{label:"Datos Entrega",name:"datos_entrega",type:"startGroup"},{name:"contacto_entrega",label:"Contacto",type:"textField"},{name:"telefono_entrega",label:"Teléfono",type:"numeric"},{name:"observaciones_entrega",label:"Observaciones",type:"textArea"},{name:"",type:"endGroup"},{label:"Datos mercancía",name:"datos_mercancia",type:"startGroup"},{name:"descripcion_carga",label:"Descripción de la carga que transportas",type:"textArea"},{name:"empaque",label:"Empaque. (Bultos, Estivas, Cajas)",type:"textField"},{name:"cantidad",label:"Cantidad",type:"numeric"},{name:"volumen",label:"Volumen",type:"textField"},{name:"peso",label:"Peso",type:"textField"},{name:"valor_declarado",label:"Valor Declarado",type:"numeric"},{name:"salida_periferia",label:"Salida Periferia",type:"switch",options:"<option value='NO'>NO</option><option value='SI'>SI</option>"},{name:"despacho",label:"Despacho Nacional",type:"switch",options:"<option value='NO'>NO</option><option value='SI'>SI</option>"},{name:"retorno",label:"Retorno",type:"switch",options:"<option value='NO'>NO</option><option value='SI'>SI</option>"},{name:"cargue",label:"Cargue",type:"switch",options:"<option value='NO'>NO</option><option value='SI'>SI</option>"},{name:"descargue",label:"Descargue",type:"switch",options:"<option value='NO'>NO</option><option value='SI'>SI</option>"},{name:"",type:"endGroup"}]),i.detalle.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar_detalle_servicio",label:"Aceptar",callback:function(){document.activeElement.blur(),i.detalle.validate()&&(nw.loading({text:"Enviando datos...",title:"Por favor espere..."}),setTimeout(function(){nw.loadingRemove();var e=i.detalle.getRecord();console.log("data",e),i.numeroAuxiliares=e.numero_auxiliares,i.data_carga=e,nw.home(),o(e)},1e3))}}],i.detalle.show();for(var e={},a=0;a<5;a++)e[a]=a;i.detalle.ui.numero_auxiliares.populateSelectFromArray(e),i.detalle.ui.numero_auxiliares.setValue("0"),console.log("main.configCliente.documentos_carga",main.configCliente.documentos_carga),void 0!==main.configCliente.documentos_carga&&$.each(main.configCliente.documentos_carga,function(e,a){var o;"id"!=e&&(o="NO"!==a,void 0!==i.detalle.ui[e])&&("SI_REQUIRED_FALSE"===a?(i.detalle.ui[e].setVisibility(!0),i.detalle.ui[e].setRequired(!1)):(i.detalle.ui[e].setVisibility(o),i.detalle.ui[e].setRequired(o)))})};nw.utils.evalueData(main.configCliente.documentos_carga)?t():(a=nw.userPolicies.getUserData(),(e={}).empresa=a.empresa,(a=new nw.rpc(nw.getRpcUrl(),"app_user")).setAsync(!0),a.setLoading(!0),a.exec("traeConfigCarga",e,function(e){console.log("traeConfig",e),main.configCliente.documentos_carga=e,t()}))},destruct:function(){},members:{}}),nw.Class.define("f_showPrice",{extend:nw.lists,construct:function(n,e,r,a,o,i,t,s,l){var c,d,u,p,_,g,m=this,v=(m.self=n,m.servi=i,console.log("f_showPrice:::servi, valor_estimado",i,e),nw.userPolicies.getUserData()),f=r,w=e+(r=e*r/100),b=v.saldo,h="$";nw.evalueData(e)||(h=r="",w=e="Por demanda"),"LIBRE"!==n.cobro?(c=w,e=_="",d=n.getMaxDiscount(w,i.descuento_maximo),n.descuento=0,s.descuento=d,e+="<span class='spanSaldo spanInfoService'><i class='material-icons'>info</i></span>",u=i.icono,g="",nw.evalueData(i.valor_mascota)&&"CARGA"!=n.configCliente.app_para&&(g=" + "+i.valor_mascota+" x mascota."),nw.evalueData(t)&&(c=t),c=("USD"==n.configCliente.moneda_por_defecto||"EUR"==n.configCliente.moneda_por_defecto?parseFloat:parseInt)(c),t="","string"==typeof v.cupon&&""!=v.cupon&&(v=JSON.parse(v.cupon),p=!0,1==(p=nw.evalueData(v.servicio)&&null!=v.servicio&&""!=v.servicio&&v.servicio!=i.id?!1:p))&&(t=""==(p="porcentaje"==v.tipo_descuento?v.valor:"")?"<div class='valuedesc_end'><span class='spanDesc' >$"+nw.addNumber(c.toFixed(2))+"</span></div>":"<div class='valuedesc_end valuedesc_end_padd'><span class='spanDesc'>$"+nw.addNumber(c.toFixed(2))+"</span> "+p+"%</div>",d=i.descuento_maximo,e="","porcentaje"==v.tipo_descuento?(p=(c*parseInt(v.valor)/100).toFixed(),c-=p):"valor"==v.tipo_descuento&&(p=parseInt(v.valor),0<parseInt(d)&&parseInt(d)<p&&(p=parseInt(d)),c<=p?c=0:c-=p),0<i.descuento_maximo&&"valor"==v.tipo_descuento&&(e+="<span class='spanSaldo'>Desc max cupon:<br> $"+nw.addNumber(i.descuento_maximo)+"</span>"),e+="<span class='spanSaldo spanInfoService'><i class='material-icons'>info</i></span>"),console.log("valor_total",w),console.log("tol",c),w=c=isNaN(c)?0:c,console.log("tol",c),console.log("valor_total",w),p="",i.ciudad_o_lugar_origen!==i.ciudad_o_lugar_destino&&(p="<span class='citiesdif'>"+i.ciudad_o_lugar_origen+" - "+i.ciudad_o_lugar_destino+"</span>"),v=i.tipo_servicio+p,nw.utils.evalueData(n.numeroAuxiliares)&&(v+="<span class='spannumeroauxiliarespricesshow'>"+n.numeroAuxiliares+" aux de carga</span>"),_=(_=(_+="<div class='cars_options'>")+"<img class='icon_service' src='"+config.domain_rpc+u+"' /><div>")+"<div class='textContainServices'> <span class='nameService'>"+v+"</span>",console.log("valor_sin_desc",t),console.log("adicional",g),console.log("saldo_text",e),p=c,console.log("toltoltoltoltoltoltoltoltoltoltol",c),nw.utils.evalueData(c)&&(p=nw.addNumber(c.toFixed(2))),console.log("valFixed",p),u=p+t+g+e,console.log("valueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEndvalueEnd",u),console.log("toltoltoltoltoltoltoltoltoltoltol",c),_=_+"<span class='spanValueEnd'>"+h+u+"</span><div>",v=document.querySelector(".estimado"),(p=document.createElement("div")).className="estimadoInt ",p.innerHTML=_,p.data={data:i,others:s,descuento:d,valor:w,serv:i.id,id_tarifa:i.id_service_tarifa_fija},n.__mas=!1,p.onclick=function(){m.clickInTarifa(this)},v.appendChild(p),1===l&&p.click(),s.servi=i,n.__mas=!0,p.querySelector(".spanInfoService").data=s,p.querySelector(".spanInfoService").onclick=function(){var e=this.data,a=(console.log("others",e),{}),o=(a.cleanHtml=!1,a.useDialogNative=!1,"<div class='containMoreInfoService'>"),e=(o=(o=(o=(o+="<span class='valorfixedpopup'>"+nw.addNumber(c.toFixed(2))+" </span>")+("<br /><span>"+nw.utils.tr("Valor base")+": $"+nw.addNumber(e.valorbase)+"</span>"))+("<br /><span> + X km ("+e.totalunimetros/1e3+"km): $"+nw.addNumber(e.valordistancia.toFixed(2))+"</span>"))+("<br /><span>+ X min ("+e.totaluniminutos+"min): $"+nw.addNumber(e.valorminutos.toFixed(2))+"</span>"),0<e.valor_peajes&&(o+="<br /><span>"+nw.utils.tr("Peajes")+": "+nw.addNumber(e.valor_peajes)+"</span>"),0<e.valor_recargo&&nw.evalueData(e.concepto_recargo)&&(o+="<br /><span>"+e.concepto_recargo+": "+nw.addNumber(e.valor_recargo)+"</span>"),0<e.recargos&&(o+="<br /><span>"+nw.utils.tr("Otros recargos")+": "+nw.addNumber(e.recargos)+"</span>"),0<e.descuento&&(o+="<br /><span>"+nw.utils.tr("Descuento")+": "+nw.addNumber(e.descuento)+"</span>"),parseFloat(e.valordistancia)+parseFloat(e.valorminutos)+parseFloat(e.servi.valor_banderazo)<parseFloat(e.servi.minima)&&(o+="<br /><span>"+nw.utils.tr("Valor mínimo")+": "+nw.addNumber(parseFloat(e.servi.minima).toFixed(2))+"</span>"),0<r&&(o+="<br /><span>+ "+nw.utils.tr("Impuestos")+" ("+f+"%): $"+nw.addNumber(r.toFixed(2))+"</span>"),nw.utils.evalueData(n.numeroAuxiliares)&&nw.utils.evalueData(n.configCliente.valor_auxiliar_carga)&&(o+="<br /><span>"+nw.utils.tr("Auxs de carga")+" ("+n.numeroAuxiliares+"): $"+parseInt(n.numeroAuxiliares)*parseInt(n.configCliente.valor_auxiliar_carga)+"</span>"),nw.utils.evalueData(e.servi.id_foraneo)&&(o+="<br /><span>ID("+e.servi.id_foraneo+")</span>"),n.ciudad_destino),i=(nw.evalueData(n.name_place_destino)&&(e+=" "+n.name_place_destino),"urbano"),t=(n.ciudad_origen===n.ciudad_destino?i="urbano":n.ciudad_origen!==n.ciudad_destino&&(i=void 0!==n.ciudad_origen.split(n.ciudad_destino)[1]||void 0!==n.ciudad_destino.split(n.ciudad_origen)[1]?"urbano":"intermunicipal"),console.log("self.typeInTravelget",n.typeInTravelget),i=n.typeInTravelget,"<br />"),o=o+((t+="<div class='origienesYDestinos'>")+(nw.utils.tr("Origen y destino")+".<br />")+("<br /><strong>"+nw.utils.tr("Tipo")+"</strong>: "+i+"</strong>")+("<br /><strong>"+nw.utils.tr("Dirección origen")+"</strong>: "+n.ui.address.getValue()+"</strong>")+("<br /><strong>"+nw.utils.tr("Ciudad origen")+"</strong>: "+n.ciudad_origen+"</strong>")+("<br /><strong>"+nw.utils.tr("Lugar origen")+"</strong>: "+n.ciudad_origen+" "+n.name_place_origen+"</strong>")+"<br /><br />"+("<br /><strong>"+nw.utils.tr("Dirección Destino")+"</strong>: "+n.ui.address_destino.getValue()+"</strong>")+("<br /><strong>"+nw.utils.tr("Ciudad destino")+"</strong>: "+n.ciudad_destino+"</strong>")+("<br /><strong>"+nw.utils.tr("Lugar destino")+"</strong>: "+e+"</strong>")+"</div>")+"</div>";nw.dialog(o,function(){return!0},!1,a)}):($(".estimado").remove(),_="<div class='estimado'><div class='estimadoInt'>","Por demanda"!==(g=t=w)&&b<w&&(g=w-b,t=nw.addNumber(g)),n.valor_total=g,n.ui.pago_group.prepend(_=(_+="<span class='cars_options'></span> <span class='spanValueEnd'>"+h+t+"</span></br>")+"</div>"+"</div>")),"SI"==n.configCliente.usa_subservicios&&$(".spanValueEnd").addClass("spanValueEnd_subservicios")},destruct:function(){},members:{clickInTarifa:function(e){var a=this.self,o=this.servi,i=document.querySelector(".acti"),i=(i&&i.classList.remove("acti"),a.ui.datos_vehiculo_elegido.setVisibility(!1),a.ui.datos_vehiculo_elegido.setRequired(!1),e.classList.add("acti"),e.data.others),i=(a.concepto_recargo_ruta_fija=i.concepto_recargo,a.valor_recargo_ruta_fija=i.valor_recargo,a.valor_peajes=i.valor_peajes,a.metros_cobro_recargo=i.metros_cobro_recargo,a.metros_cobro_peaje=i.metros_cobro_peaje,a.inicia_metros_add=i.inicia_metros_add,a.valor_metros_add=i.valor_metros_add,a.valordistancia=i.valordistancia,a.valorbase=i.valorbase,a.valorminutos=i.valorminutos,a.valor_unidad_tiempo=i.valor_unidad_tiempo,a.valor_unidad_metros=i.valor_unidad_metros,a.__id_tarifa=o.id_service_tarifa_fija,e.data.serv),t=e.data.valor;a.descuento_maximo=e.data.descuento,a.servicioAllData=e.data.data,a.subcategoria_servicio_text=e.data.data.tipo_servicio,a.servicio_nom=i,a.servicio_array=e.data,a.num_mascota=0,"SI"===o.reservar&&(a.ui.tipo_servicio.setVisibility(!1),a.ui.tipo_servicio.setRequired(!1),a.ui.tipo_servicio.setValue("reservado")),"SI"===o.pide_vehiculo_cliente&&(a.ui.datos_vehiculo_elegido.setVisibility(!0),a.ui.datos_vehiculo_elegido.setRequired(!0)),"SI"===o.mostrar_fecha_hora&&(e=a.minutos_agregar_hora,nw.evalueData(o.minutos_agregar_a_fecha)?(e=o.minutos_agregar_a_fecha,a.minutos_agregar_hora=e):a.minutos_agregar_hora=60,a.showHiddenDate(!0,parseInt(e))),"CARGA"==a.configCliente.app_para?void 0!==a.detalle?a.num_mascota=a.detalle.ui.numero_auxiliares.getValue():void 0!==a.dataServiceActive&&(a.num_mascota=a.dataServiceActive.numero_auxiliares):a.num_mascota=0,a.servicio_nom=i,a.valor_total=t,a.reziseMap()}}}),nw.Class.define("f_redimir_cupon",{extend:nw.forms,construct:function(e){var a=this,e=(a.id="f_redimir_cupon",a.canvas="#foo",a.setTitle="<span style='color:#fff;'>Promociones</span>",a.html="Redimir cupón promocional",a.showBack=!0,a.closeBack=!1,a.textClose="Volver",a.colorBtnBackIOS="#ffffff;",a.styleCloseIOS="color:#ffffff;color: rgb(255, 255, 255);background-color: transparent;border: 0;box-shadow:none;",a.createBase(),a.callback=e,[{label:"",style:"",name:"contenedor_promociones",mode:"div",type:"startGroup"},{name:"my_link_img",label:"<span class='imgRefiereAmigos' style='background-image: url("+config.domain_rpc+"/lib_mobile/driver/img/Cupones_IMG.png);'></span>",type:"html"},{name:"my_link_description",label:"<span class='titleRefiereAmigos'>Redimir cupón promocional</span><span class='descpRefiereAmigos'>Redime y viaja con nosotros a donde tu quieras.</span>",type:"html"},{label:"",style:"",name:"contenedor_refiere_amigos_actions",mode:"div",visible:!1,type:"startGroup"},{name:"nombre",label:"Código",placeholder:"Código",type:"textField",required:!0,visible:!1},{label:"",style:"",name:"contenedor_refiere_amigos_buttons",mode:"div",type:"startGroup"},{name:"redimir",label:"Redimir",type:"button",visible:!1},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{mode:"div",type:"endGroup"},{label:"",name:"l_cupones_group",type:"startGroup",visible:!0},{type:"endGroup"}]);a.setFields(e),a.show(),a.ui.redimir.addListener("click",function(){a.save()}),$("#f_redimir_cupon .nw_label_nombre").css("cssText","display:none!important;"),a.onAppear(function(){setTimeout(function(){a.createNavTableCupones();var e=new l_navtable_cupones;e.construct(a.canvas+" .l_cupones_group"),a.navTable=e},100)})},destruct:function(){},members:{save:function(){var o=this;if(!o.validate())return!1;var i=nw.userPolicies.getUserData(),e=o.getRecord(!0),a=(e.usuario=i.usuario,e.empresa=i.empresa,e.perfil=i.perfil,e.ciudad=i.ciudad,new nw.rpc(nw.getRpcUrl(),"vehiculo"));a.setAsync(!0);a.exec("validate_cupon",e,function(e){if(!1===e)return nw.dialog("El código no existe o ya fue redimido"),!1;var a={cleanHtml:!1},e=(nw.evalueData(i.saldo)||(i.saldo=0),parseFloat(i.saldo)+parseFloat(e.valor));i.saldo=e,window.localStorage.setItem("saldo",e),nw.dialog("<strong>¡Código redimido!</strong>",!1,!1,a),o.navTable.applyFilters()})},createNavTableCupones:function(){var d=this;nw.Class.define("l_navtable_cupones",{extend:nw.lists,construct:function(e){this.canvas=e;return this.setColumns([{name:"id",label:"ID",visible:!1},{style:{data:"width: 150px;position: relative;overflow: hidden;text-align: justify;height: auto;white-space: pre-wrap;font-size: 14px;font-weight: bold; left: 22px;"},name:"descripcion",label:""},{style:{data:"position: relative;font-weight: bold; font-size: 14px; left: 26px;",label:"color: grey;font-size: 14px;left: 26px;position: relative;"},name:"saldo",label:"Saldo:"},{style:{data:"position: relative;font-weight: bold; font-size: 14px; left: 26px;",label:"color: grey;font-size: 14px;left: 26px;position: relative;"},name:"nombre",label:"Codigo:"},{style:{data:"position: absolute;right: 10px;top: 0px;text-align: center;"},name:"fecha_expiracion",label:""},{name:"fecha_expiracion_format",label:"",visible:!1},{name:"servicio",label:"",visible:!1}]),this.applyFilters(),this},destruct:function(){},members:{contextMenu:function(){var o=this;nw.userPolicies.getUserData(),o.selectedRecord();new nw.contextmenu(this,"bottom").addAction("Quitar de la lista","material-icons create normal",function(e){var a=o.activeRow;$(a).remove()})},clicRow:function(){var e=this.selectedRecord();nw.console.log("clicRow",e)},applyFilters:function(){var l=this,c=nw.userPolicies.getUserData(),e={},a=(e.usuario=c.usuario,e.empresa=c.empresa,e.perfil=c.perfil,nw.console.log("clicRow",e),new nw.rpc(nw.getRpcUrl(),"servicios"));a.setAsync(!0),a.setLoading(!1);a.exec("consultaCupones",e,function(e){for(var a=[],o=(console.log(e),l.numberRow=0,nw.getActualFullDate("datetime-local")),i=0;i<e.length;i++){e[i].fecha_expiracion_format=e[i].fecha_expiracion;var t=nw.toDatetimeLocal(e[i].fecha_expiracion),t=nw.calcularTiempoDosFechas(o,t);e[i].fecha_expiracion="Vence en: <br>"+t.hours+"H:"+t.minutes+"M",e[i].saldo="$"+e[i].valor,"porcentaje"==e[i].tipo_descuento&&(e[i].saldo=e[i].valor+"%"),nw.evalueData(c.ciudad)&&nw.evalueData(e[i].ciudad)&&null!=e[i].ciudad&&""!=e[i].ciudad&&""!=c.ciudad&&c.ciudad!=e[i].ciudad||a.push(e[i])}l.setModelData(a),console.log(a);for(var n=0;n<a.length;n++){var r,s=document.querySelector(".l_cupones_group #rowlist_"+n);s&&((r=document.createElement("div")).className="contened-div-line",r.innerHTML='<svg class="card__svg" viewBox="43 0 540 500">\n                                  <path class="card__line1" d="M 0 100 Q 50 200 100 250 Q 250 400 350 300 C 400 250 550 150 650 300 Q 750 450 800 400 L 800 500 L 0 500" stroke="transparent" fill="#333"/>\n                                  <path class="card__line" d="M 0 100 Q 50 200 100 250 Q 250 400 350 300 C 400 250 550 150 650 300 Q 750 450 800 400" stroke="pink" stroke-width="3" fill="transparent"/>\n                                  </svg>',s.appendChild(r),r=document.createElement("div"),console.log(a[n].estado),"ACTIVO"==a[n].estado?(r.innerHTML='<i class="material-icons">check_circle</i><span>Activo</span>',r.className="btn_usu activo_cupon"):(r.innerHTML="Usar Cupon",r.className="btn_usu"),r.setAttribute("data",n),r.onclick=function(){var e,a=this.getAttribute("data");document.querySelector(".l_cupones_group #rowlist_"+a+" .containerListRow").click(),l.this_cup=this,/activo_cupon/.test(l.this_cup.classList)||((e=document.querySelector(".activo_cupon"))?nw.dialog("Ya esta usando un cupon, desea cambiarlo por este",function(){l.updateCupon(function(){e.classList.remove("activo_cupon"),e.innerHTML="Usar Cupon",l.this_cup.classList.add("activo_cupon"),l.this_cup.innerHTML='<i class="material-icons">check_circle</i><span>Activo</span>',nw.evalueData(d.callback)&&d.callback()})},function(){}):l.updateCupon(function(){l.this_cup.classList.add("activo_cupon"),l.this_cup.innerHTML='<i class="material-icons">check_circle</i><span>Activo</span>',nw.evalueData(d.callback)&&d.callback()}))},s.appendChild(r))}})},updateCupon:function(a){var o=nw.userPolicies.getUserData(),i=this.selectedRecord(),e=this.selectedRecord(),t=(e.usuario=o.usuario,e.empresa=o.empresa,e.perfil=o.perfil,new nw.rpc(nw.getRpcUrl(),"servicios"));t.setAsync(!0);t.exec("updateCupon",e,function(e){o.cupon=JSON.stringify(i),a()})}}})},populate:function(e){this.setRecord(e)}}}),nw.Class.define("f_ver_viaje",{extend:nw.forms,construct:function(e){var a=this;a.id="f_ver_viaje",a.closeBack=!1,(a.showBack=!0)===main.previsualiza&&(a.showBack=!1,a.changeHash=!1,a.transition="pop"),a.createBase(),a.datos=e;a.setFields([{styleContainer:"margin:0;",style:"height:400px;margin:0;",label:"Mapa",name:"mapa",type:"startGroup"},{type:"endGroup"},{visible:!0,label:"",name:"observaciones_html",type:"html"}]),a.buttons=[]},destruct:function(){},members:{createMapa:function(){var e=new nwgeo.getMap(!1);e.canvas=document.querySelector(this.canvas+" .mapa"),e.zoom=10,this.map=e.show()},createNavTableParadas:function(){var e=this.datos,a=document.querySelector("#f_ver_viaje #observaciones_html .nav_paradas"),o=document.createElement("div"),a=(o.style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",o.innerHTML="Paradas adicionales",a.appendChild(o),new l_navtable_paradas);a.construct("#f_ver_viaje #observaciones_html .nav_paradas",e),this.navTable=a},createLine:function(){var a=this,o=a.map,e=(console.log("self.marker1",a.marker1),console.log("self.marker1",a.marker2),nw.evalueData(a.marker1)&&nwgeo.removeMarker(a.marker1),nw.evalueData(a.marker2)&&nwgeo.removeMarker(a.marker2),new nwgeo.addMarker);e.map=o,e.latitude=a.latitude,e.longitude=a.longitude,e.title=a.direccion_origen,e.label="",e.icon=a.icon1,e.native=!1,e.draggable=!1,a.marker1=e.show();(e=new nwgeo.addMarker).map=o,e.latitude=a.latitudDes,e.longitude=a.longitudDes,e.title=a.direccion_destino,e.label="",e.icon=a.icon2,e.draggable=!1,e.native=!1,a.marker2=e.show();var e={lat:a.latitude,lng:a.longitude,lat2:a.latitudDes,lng2:a.longitudDes},i=main.colorPolyLine;nwgeo.addLineStreet(o,e,function(e){nwgeo.centerMap(o,a.marker1,a.marker2),a.callback(e)},i,!1,"animate",!0)}}}),nw.Class.define("l_historico_viajes",{extend:nw.lists,construct:function(){var i=this;i.showContextMenu=!0,i.id="l_historico_viajes",i.setTitle="Viajes",i.html="Viajes",i.showBack=!0,i.closeBack=!1,i.textClose="Volver",i.createBase(),i.estado="RESERVADO",i.configCliente=main.configCliente,i.icon=!1,main.dataServiceOpenHistory=!1,i.setColumns([{name:"id_enc",label:"",mode:"toolTip"},{name:"origen",label:"<i class='material-icons icon-historico icon-historicoA'>place</i>"},{name:"destino",label:"<i class='material-icons icon-historico icon-historicoB'>place</i>"},{name:"fechas_horas",label:""},{name:"conductor_html",label:""},{name:"tipo_pago",label:""},{name:"valor_total_servicio",label:"",mode:"money"},{name:"abordo",label:"Abordó",mode:"toolTip"},{name:"sentido",label:"Sentido",mode:"toolTip"},{name:"descricion_carga",label:"",mode:"toolTip"},{name:"iniciar_servicio",label:"",type:"button"},{name:"chat_conductor",label:"",type:"button"}]),i.buttons=[],i.buttons.push({style:"background-color: #ffffff;color:#333;font-weight: bold;border-bottom: 1px solid #ccc;",colorBtnBackIOS:"#6a6767",position:"top",name:"programados",label:"Próximos Reservas",callback:function(e){i.icon="playlist_add",i.action("RESERVADO",e)}},{style:"color:#6a6767;",colorBtnBackIOS:"#6a6767",position:"top",name:"activos",label:"Activos En ruta",callback:function(e){i.icon="playlist_play",i.action("ACTIVOS",e)}},{style:"color:#6a6767;",colorBtnBackIOS:"#333",position:"top",name:"pasados",label:"Pasados Histórico",callback:function(e){i.icon="playlist_add_check",i.action("PASADOS",e)}}),i.show();$(i.canvas).delegate(".rowName_iniciar_servicio","click",function(e,a){$(this.parentElement).trigger({type:"click"});var o=i.selectedRecord();console.log("iniciar:::data",o),i.openViajeParada(o)}),$(i.canvas).delegate(".rowName_chat_conductor","click",function(e,a){$(this.parentElement).trigger({type:"click"});var o=i.selectedRecord();console.log("iniciar:::data",o),i.openChatConductor(o)}),i.onAppear(function(){setTimeout(function(){i.varsClean(),i.applyFilters()},100)})},destruct:function(){},members:{action:function(e,a){$(".ui-block-b .btnExec").css({"background-color":"#f6f6f6",color:"#6a6767","font-weight":"lighter","border-bottom":"none"}),$(".l_historico_viajes .material-icons").css({color:"#6a6767"}),$(a).css({"background-color":"#ffffff",color:"#333","font-weight":"bold","border-bottom":"1px solid #ccc"}),$(a).find(".l_historico_viajes .material-icons").css({color:"#333"}),this.estado=e,this.varsClean(),this.applyFilters()},varsClean:function(){var e=this;e.clean(),e.loadMore=!1,e.limit_pagination=10,e.limit_old=0,e.limit_new=e.limit_pagination},applyFilters:function(){var r=this,e=document.querySelector(".contConsole"),e=(e&&e.remove(),r.limit_pagination=10,nw.evalueData(r.limit_old)||(r.limit_old=0),nw.evalueData(r.limit_new)||(r.limit_new=r.limit_pagination),nw.remove(".cargar_mas_list"),document.createElement("div")),e=(e.innerHTML=nw.utils.tr("Cargar más"),e.className="cargar_mas_list",e.onclick=function(){r.loadMore=!0,r.limit_old=r.limit_old+r.limit_pagination,r.limit_new=r.limit_pagination+1,r.applyFilters()},document.querySelector(r.canvas+" .containTable").appendChild(e),nw.userPolicies.getUserData()),a={},e=(a.usuario=e.usuario,a.id_usuario=e.id_usuario,a.empresa=e.empresa,a.perfil=e.perfil,a.estado=r.estado,a.filters=r.getFiltersData(),a.configCliente=r.configCliente,a.limit_old=r.limit_old,a.limit_new=r.limit_new,new nw.rpc(r.getRpcUrl(),"app_user"));e.setAsync(!0),e.setLoading(!0),console.log("l_historico_viajes:::applyFilters:::sendData:::data",a),nw.empty(".showZeroRows");e.exec("consulta_historico_servicios",a,function(e){console.log("l_historico_viajes:::applyFilters:::responseServer:::r",e),e&&0!=e.length||r.console();for(var a=[],o=0;o<e.length;o++){var i=e[o],t=(nw.evalueData(i.conductor_usuario)||(i.conductor_usuario="Sin asignar"),nw.evalueData(i.conductor)||(i.conductor="Sin asignar"),nw.evalueData(i.conductor_foto)&&(t=config.domain_rpc+nw.utils.getFileByType(i.conductor_foto,50),i.conductor_foto=t),i.fecha_hora_format=i.fecha_hora,console.log("rr.estado_parada",i.estado_parada),nw.evalueData(i.estado_parada)&&(i.abordo="NO","CONFIRMADO"!=i.estado_parada&&"ENTREGADO"!=i.estado_parada||(i.abordo="SI")),"<div class='enc_trav'>"),n=(t=(t+="<div class='enc_trav_ids_idsorparada'>")+("<span class='rowestadoids rowestadoids_id'>Servicio #"+i.id),nw.utils.evalueData(i.booking_id_journey)&&(t+=" CodeBooking #"+i.booking_id_journey),t=(t+="</span>")+("<span class='rowcolorstado'><span class='colorstado'></span> "+i.estado+"</span>")+"</div>",nw.utils.evalueData(i.id_parada)&&(t=(t=(t+="<div class='enc_trav_ids_idsorparada'>")+"<span class='rowestadoids rowestadoids_id'>Parada #"+i.id_parada+"</span>")+"<span class='rowcolorstado'><span class='colorstado'></span> "+i.estado_parada+"</span></div>"),t+="</div>",i.id_enc=t,"<div class='fechas_horas'>"),n=(n=(n+="<div class='fechas_horas_e fechas_horas_fecha'><i class='material-icons'>date_range</i> "+i.fecha+"</div>")+("<div class='fechas_horas_e fechas_horas_hora'><i class='material-icons'>access_time</i> "+i.hora+"</div>")+"</div>",i.fechas_horas=n,console.log("rrrrrrrrrrrrrrrrrrr",e),"<div class='conductor_html'>");n+="<i class='material-icons'>directions_car</i>",nw.utils.evalueData(i.placa)&&(n+="<span class='vehiculo_contain_html_placa'>"+i.placa+"</span>"),nw.utils.evalueData(i.vehiculo_text)&&(n+="<span>"+i.vehiculo_text+"</span>"),n=n+("<span>"+i.conductor+"</span>")+"</div>",i.conductor_html=n,i.iniciar_servicio="<i class='material-icons'>expand_more</i> Ampliar",i.chat_conductor="<i class='material-icons'>chat_bubble_outline</i> Chat",a.push(i)}r.setModelData(a,!1,!0,!1)})},contextMenu:function(){var a=this,o=a.selectedRecord(),e=(console.log("data",o),new nw.contextmenu(a,"bottom"));nw.evalueData(o.id_parada)?(e.addAction("Ampliar","material-icons expand_more normal",function(e){a.openViajeParada(o)}),"SI"==a.configCliente.pasajero_puede_cancelar_parada&&e.addAction("Cancelar parada","material-icons expand_more normal",function(e){nw.dialog("¿Está seguro de cancelar esta cancelación?",function(){a.cancelarParada(o)},function(){return!0},{textAccept:"Si, cancelar",textCancel:"Volver"})})):("reservado"!==o.tipo_servicio||"SOLICITUD"!==o.estado&&"ACEPTADO_RESERVA"!==o.estado||(e.addAction("Cancelar servicio","material-icons expand_more normal",function(e){a.cancelarServicio()}),!0===config.editarDireccionServiciosReservados&&e.addAction("Cambiar dirección de destino","material-icons expand_more normal.svg",function(e){a.editaDireccion()}),!0===config.reagendarServiciosReservados&&e.addAction("Reagendar","material-icons expand_more normal",function(e){a.editaFecha()})),e.addAction("Paradas o pasajeros adicionales","material-icons expand_more normal",function(e){a.editaParadasAdicionales()}),e.addAction("Ampliar","material-icons expand_more normal",function(e){a.openTravel()})),e.addAction("Chat / conductor","material-icons expand_more normal",function(e){console.log("data",o),a.openChatConductor(o)})},openChatConductor:function(e){var a={};a.id=e.id,nw.evalueData(e.id_parada)&&(a.id="_parada_"+e.id_parada),a.conductor="Conductor",nw.evalueData(e.conductor)&&(a.conductor=e.conductor),console.log("dsdsdsdsds",a),(new f_chat).construct(a),main.dataServiceOpenHistory=e},openViajeParada:function(e){main.openTravelByID(e.id)},cancelarParada:function(e){var a=this,o=new nw.rpc(a.getRpcUrl(),"app_user");o.setAsync(!0),o.setLoading(!1);o.exec("cancelarParada",e,function(e){console.log("ra",e),nw.dialog("Parada cancelada correctamente."),a.removeSelectedRecord()})},editaParadasAdicionales:function(){var o=this,i=o.selectedRecord(),t=(o.paradasAdd=new nw.forms,nw.userPolicies.getUserData());o.paradasAdd.id="f_padas_add",o.paradasAdd.setTitle="Paradas",o.showBackCallBack=function(){nw.back()},o.paradasAdd.createBase();o.paradasAdd.setFields([{label:"",name:"paradas_group",type:"startGroup",visible:!0},{type:"endGroup"}]),o.paradasAdd.buttons=[{style:"border: 0;background-color:#1abbd7;color:#fff;margin:0px;",icon:"material-icons check_circle normal",colorBtnBackIOS:"#fff",position:"top",name:"aceptar_detalle_servicio",label:"Crear parada",callback:function(){o.paradasAdd.guardar_paradas=!0,(new f_crear_parada).construct(o.paradasAdd)}}],o.paradasAdd.show(),o.paradasAdd.saveParada=function(e){console.log(e);e.empresa=t.empresa,e.perfil=t.perfil,e.usuario=t.usuario,e.id_servicio_edit=i.id,console.log(e);var a=new nw.rpc(o.getRpcUrl(),"servicios");a.setAsync(!0),a.setLoading(!1);a.exec("saveParada",e,function(e){o.paradasAdd.navTable.applyFilters(i.id),nw.dialog("Parada creada correctamente.")})},o.paradasAdd.createNavTableParadas=function(){var e=new l_navtable_paradas;e.construct("#f_padas_add .paradas_group",i),o.paradasAdd.navTable=e},o.paradasAdd.createNavTableParadas()},editaFecha:function(){var e=this.selectedRecord();(new f_reprograma).construct(this,e)},editaDireccion:function(){var e=this,a=e.selectedRecord();(new f_mapa).construct(a,function(){e.varsClean(),e.applyFilters()})},console:function(){var e=document.querySelector(".contConsole"),e=(e&&e.remove(),document.querySelector("#"+this.id)),a=document.createElement("div");a.className="contConsole",a.innerHTML="<div class='cont-left'>\n<div class='rad'><i class='material-icons' style='color:#fff!important;'>"+this.icon+"</i></div>\n<div class='lupa'>\n<div class='rad'><i class='material-icons' style='color:#fff;'>"+this.icon+"</i></div>\n</div>\n</div>\n<div class='cont-right'>Lo sentimos, no se encontraron datos.</div>",e.appendChild(a)},clicRow:function(){},openTravel:function(){var e=this,a=e.selectedRecord(),o=new f_ver_viaje_mapstatic;o.setTitle="<span style='color:#fff;'>Viaje</span>",o.construct(a),o.buttons.push({style:"",icon:"",colorBtnBackIOS:"#ffffff",position:"top",name:"problema",label:"Reportar un problema",callback:function(){var e=new f_novedades;e.construct(),e.populate(a)}}),console.log("DATA data",a),"reservado"!==a.tipo_servicio||"SOLICITUD"!==a.estado&&"ACEPTADO_RESERVA"!==a.estado||o.buttons.push({style:"",icon:"",colorBtnBackIOS:"#ffffff",position:"top",name:"cancelar",label:"Cancelar servicio",callback:function(){e.cancelarServicio()}}),o.show(),console.log(a);r=(r=(r=(r=(r=(r=(r="")+"<div class='separatorLine'></div><p><strong>Estado:</strong> "+a.estado+"</p>")+"<p><strong>Fecha solicitud:</strong> "+a.fecha_hora+"</p>")+"<p class='price_see'><strong>Forma de pago:</strong> "+a.tipo_pago+"</p>")+"<p><strong>Tipo de servicio:</strong> "+a.tipo_servicio+"</p>")+"<p><strong>Tarifa servicio tipo:</strong> "+a.tarifa+"</p>")+"<p class='price_see'><strong>Valor estimado:</strong> $"+nw.addNumber(a.valor)+"</p>";var i,t="0",t=(nw.evalueData(a.valor_total_servicio)&&(t=a.valor_total_servicio),r+="<p class='price_see'><strong>Valor final:</strong> $"+nw.addNumber(t)+"</p>","0"),t=(nw.evalueData(a.valor_espera)&&(t=a.valor_espera),r+="<p class='price_see'><strong>Valor espera:</strong> $"+nw.addNumber(t)+"</p>","0"),n=(r=(r=r+("<p><strong>Tiempo espera (minutos):</strong> "+(t=nw.evalueData(a.tiempo_espera)?a.tiempo_espera:t)+"</p>")+("<p><strong>Desde: </strong> "+a.ciudad_destino+" "+a.origen+"</p>"))+("<p><strong>Hasta: </strong> "+a.ciudad_origen+" "+a.destino+"</p>"),nw.evalueData(a.subcategoria_servicio_text)&&(r+="<p><strong>Tipo servicio: </strong>"+a.subcategoria_servicio_text+"</p>"),nw.evalueData(a.conductor)&&(r=(r+="<p><strong>Conductor: </strong> <br /><span class='fotoConductorLista' style='background-image:url("+config.domain_rpc+a.conductor_foto+")'></span>"+a.conductor+"</p>")+"<p>"+a.vehiculo_text+" "+a.vehiculo_color+" "+a.placa+"</p>"),"Sin metros de finalización"),t="Sin tiempo final",t=(r=(r=(r=(r+="<p><strong>Tiempo estimado inicial (minutos): </strong>"+a.tiempo_estimado+"</p>")+("<p><strong>Distancia estimada inicial (metros): </strong>"+a.total_metros+"</p>"))+("<p><strong>Distancia final (metros): </strong>"+(n=nw.evalueData(a.total_metros_final)?a.total_metros_final:n)+"</p>"))+("<p><strong>Tiempo final (minutos): </strong>"+(t=nw.evalueData(a.tiempo)?a.tiempo:t)+"</p>"),"Sin hora de aceptación del servicio del conductor"),t=(r+="<p><strong>Hora acepta servicio conductor: </strong>"+(t=nw.evalueData(a.hora_acepta_servicio)?a.hora_acepta_servicio:t)+"</p>","Sin hora de llegada a sitio origen del conductor"),t=(r+="<p><strong>Hora llegada a sitio origen conductor: </strong>"+(t=nw.evalueData(a.hora_llegada)?a.hora_llegada:t)+"</p>","Sin hora de abordaje del pasajero en sitio origen"),n="Sin fecha de finalización",r=(r=(r+="<p><strong>Hora abordaje de pasajero en sitio origen: </strong>"+(t=nw.evalueData(a.hora_inicio)?a.hora_inicio:t)+"</p>")+"<p><strong>Hora finalización: </strong>"+(n=nw.evalueData(a.hora_fin_servicio)?a.hora_fin_servicio:n)+"</p>")+"<p class='price_see'><strong>Descuento aplicado: </strong>$"+nw.addNumber(a.descuento_aplicado)+"</p>";if(nw.evalueData(a.datos_vehiculo_elegido)&&(r+="<p><strong>Datos vehículo elegido: </strong>"+a.datos_vehiculo_elegido+"</p>"),nw.evalueData(a.descricion_carga)&&(r+="<p><strong>Observaciones: </strong>"+a.descricion_carga+"</p>"),r+="<p><strong>ID: </strong>"+a.id+"</p>","CARGA"==e.configCliente.app_para&&(nw.evalueData(a.numero_auxiliares)&&(r+="<p><strong>Numero Auxiliares: </strong>"+a.numero_auxiliares+"</p>"),nw.evalueData(a.salida_periferia)&&(r+="<p><strong>Salida periferia: </strong>"+a.salida_periferia+"</p>"),nw.evalueData(a.despacho)&&(r+="<p><strong>Despacho: </strong>"+a.despacho+"</p>"),nw.evalueData(a.retorno)&&(r+="<p><strong>Retorno: </strong>"+a.retorno+"</p>"),nw.evalueData(a.cargue)&&(r+="<p><strong>Cargue: </strong>"+a.cargue+"</p>"),nw.evalueData(a.descargue)&&(r+="<p><strong>Descargue: </strong>"+a.descargue+"</p>"),nw.evalueData(a.observaciones_servicio)&&(r+="<p><strong>Observaciones servicio: </strong>"+a.observaciones_servicio+"</p>"),nw.evalueData(a.contacto_recogida)&&(r+="<p><strong>Contacto recogida: </strong>"+a.contacto_recogida+"</p>"),nw.evalueData(a.telefono_recogida)&&(r+="<p><strong>Telefono recogida: </strong>"+a.telefono_recogida+"</p>"),nw.evalueData(a.observaciones_recogida)&&(r+="<p><strong>Observaciones recogida: </strong>"+a.observaciones_recogida+"</p>"),nw.evalueData(a.contacto_entrega)&&(r+="<p><strong>Contacto entrega: </strong>"+a.contacto_entrega+"</p>"),nw.evalueData(a.telefono_entrega)&&(r+="<p><strong>Telefono entrega: </strong>"+a.telefono_entrega+"</p>"),nw.evalueData(a.observaciones_entrega)&&(r+="<p><strong>Observaciones entrega: </strong>"+a.observaciones_entrega+"</p>"),nw.evalueData(a.cantidad)&&(r+="<p><strong>cantidad: </strong>"+a.cantidad+"</p>"),nw.evalueData(a.volumen)&&(r+="<p><strong>Volumen: </strong>"+a.volumen+"</p>"),nw.evalueData(a.peso)&&(r+="<p><strong>Peso: </strong>"+a.peso+"</p>"),nw.evalueData(a.empaque)&&(r+="<p><strong>Empaque: </strong>"+a.empaque+"</p>"),nw.evalueData(a.valor_declarado))&&(r+="<p><strong>Valor declarado: </strong>"+a.valor_declarado+"</p>"),nw.evalueData(a.firma_recibido)&&(r+="<p style='margin-top: 38px;margin-bottom: 48px;'><strong>Firma recibido: </strong><span \n                    style='background-image: url("+config.domain_rpc+a.firma_recibido+");padding: 27px 42px;background-size: contain;left: 11px;position: relative;' \n                    class='fotoFirma'></span></p>"),nw.evalueData(a.calificacion)){for(var s=parseInt(a.calificacion),l="<p><strong style='top: -8px;position: relative;'>Calificación: </strong>",c=0;c<5;c++)l+=c<s?"<i class='ico_1 material-icons' style='color: #e04935;'>star</i>":"<i class='ico_1 material-icons'>star_border</i>";r+=l+="</p>"}o.ui.observaciones_html.setValue(r+="<div class='nav_paradas'></div>"),o.direccion_origen=a.origen,o.direccion_destino=a.destino,o.latitude=a.latitudOri,o.longitude=a.longitudOri,o.latitudDes=a.latitudDes,o.longitudDes=a.longitudDes,o.createMapa(o),"SI"==e.configCliente.paradas_adicional&&(t=a,n=o.canvas+" #observaciones_html .nav_paradas",r=document.querySelector(n),(i=document.createElement("div")).style="font-size: 16px;text-align: center;font-weight: bold;text-decoration: underline;",i.innerHTML="Paradas adicionales",r.appendChild(i),(r=new l_navtable_paradas).construct(n,t),o.navTable=r)},canvas:function(e){this.canvas=e},cancelarServicio:function(){var e=this.selectedRecord(),a=(console.log("data",e),this.datos_servicio_activo=e,new f_cancelar_servicio);a.construct(this),a.ui.id.setValue(e.id)},cancelservice:function(){this.varsClean(),this.applyFilters()}}}),nw.Class.define("l_comentarios",{extend:nw.lists,construct:function(){var e=this;e.showContextMenu=!1,e.id="l_comentarios",e.setTitle="Comentarios",e.html="Comentarios",e.showBack=!0,e.closeBack=!1,e.textClose="Atrás",e.createBase();e.setColumns([{name:"id",label:"ID",visible:!1},{name:"puntaje",label:"Puntaje"},{name:"comentarios",label:"Comentario"}]),e.applyFilters(),e.show()},destruct:function(){},members:{clicRow:function(){var e=this.selectedRecord(),a=(console.log(e),new f_vehiculo);a.construct(function(){main.misVehiculos()}),a.populate(e)},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o=(nw.loading({text:"Cargando...",textVisible:!0,html:"",theme:"b",container:a.canvas}),{}),e=(o.usuario=e.usuario,new nw.rpc(a.getRpcUrl(),"servicios"));e.setAsync(!0);e.exec("consulataMisComentarios",o,function(e){nw.loadingRemove({container:a.canvas}),a.setModelData(e)})}}}),nw.Class.define("l_navtable_paradas",{extend:nw.lists,construct:function(e,a,o){var i=this;nw.evalueData(o)&&o.debugConstruct&&console.log("START:::l_navtable_paradas"),i.canvas=e,i.showContextMenu=!0;return i.setColumns([{name:"id",label:"ID"},{name:"index_arrayParadas",label:"Index arrayParadas"},{name:"index_markersParadas",label:"Index markersParadas"},{name:"direccion",label:"Dirección"},{name:"nombre_pasajero",label:""},{name:"descripcion_carga",label:""},{name:"latitud",label:"Latitud",visible:!1},{name:"longitud",label:"Longitud",visible:!1}]),a&&i.applyFilters(a.id),i},destruct:function(){},members:{clicRow:function(){var e=this.selectedRecord();console.log(e),this.contextMenu()},contextMenu:function(){var a=this,e=a.selectedRecord(),o=new nw.contextmenu(this,"bottom");o.addAction("Eliminar","nwmaker/img/baseline-create-24px.svg",function(e){nw.dialog("¿Esta seguro de eliminar esta parada?",function(){a.deleteParada()})}),nw.evalueData(e.id)&&o.addAction("Editar","nwmaker/img/baseline-create-24px.svg",function(e){a.editaParada()})},editaParada:function(){var e=this.selectedRecord(),a=(console.log(e),nw.userPolicies.getUserData(),new f_crear_parada);this.update_paradas=!0,a.construct(this),a.ui.direccion.setValue(e.direccion),a.ui.nombre_pasajero.setValue(e.nombre_pasajero),a.ui.descripcion_carga.setValue(e.descripcion_carga),a.ui.latitud.setValue(e.latitud_parada),a.ui.longitud.setValue(e.longitud_parada)},updateParada:function(a){var o=this,e=o.selectedRecord(),i=(console.log(e),nw.userPolicies.getUserData()),t=a,i=(t.empresa=i.empresa,t.perfil=i.perfil,t.usuario=i.usuario,t.id_servicio=e.id_servicio,t.id=e.id,new nw.rpc(o.getRpcUrl(),"servicios"));i.setAsync(!0),i.setLoading(!1);i.exec("actualizaParada",t,function(e){o.applyFilters(a.id_servicio),nw.dialog("Parada  modificada correctamente.")})},deleteParada:function(){var a=this,o=a.selectedRecord();if(console.log("deleteParada:::data",o),!nw.evalueData(o.id))return console.log("main.selfCrearViaje.arrayParadas",main.selfCrearViaje.arrayParadas),console.log("main.selfCrearViaje.markersParadas",main.selfCrearViaje.markersParadas),""!==o.index_arrayParadas&&main.selfCrearViaje.arrayParadas.pop(o.index_arrayParadas),""!==o.index_markersParadas&&(main.selfCrearViaje.markersParadas.pop(o.index_markersParadas),nwgeo.removeMarker(main.selfCrearViaje.markersParadas[o.index_markersParadas])),console.log("main.selfCrearViaje.arrayParadas",main.selfCrearViaje.arrayParadas),console.log("main.selfCrearViaje.markersParadas",main.selfCrearViaje.markersParadas),a.removeRow(a.activeRow),main.selfCrearViaje.continuar(),!1;var e=nw.userPolicies.getUserData(),i=o,e=(i.empresa=e.empresa,i.perfil=e.perfil,i.usuario=e.usuario,new nw.rpc(a.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("eliminaParada",i,function(e){a.applyFilters(o.id_servicio),nw.dialog("Parada eliminada correctamente.")})},applyFilters:function(e){nw.loading();var a=this,o=nw.userPolicies.getUserData(),i={},e=(i.id_service=e,i.empresa=o.empresa,new nw.rpc(a.getRpcUrl(),"app_user"));e.setAsync(!0),e.setLoading(!1);e.exec("paradasAdicionalesUserApp",i,function(e){console.log(e),nw.loadingRemove({container:a.canvas}),a.setModelData(e)})}}}),nw.Class.define("l_vehiculos",{extend:nw.lists,construct:function(){var e=this;e.showContextMenu=!0,e.id="l_vehiculos",e.setTitle="Mis vehículos",e.html="Mis vehículos",e.showBack=!0,e.closeBack=!1,e.textClose="Atrás",e.createBase();e.setColumns([{name:"id",label:"ID",visible:!1},{name:"placa",label:"Placa"},{name:"marca_text",label:"Marca",mode:"Marca",visible:!0},{name:"color",label:"Color",visible:!1},{name:"modelo",label:"Modelo",visible:!1},{name:"imagen_vehi",label:"Foto",mode:"phpthumb",visible:!1},{name:"fecha_vencimiento_soat",label:"Soat",mode:"date_format",visible:!1}]),e.buttons=[],e.buttons.push({icon:"material-icons add normal",position:"top",name:"nuevo",label:"Nuevo",callback:function(){(new f_vehiculo).construct(function(){main.misVehiculos()})}}),e.applyFilters(),e.show()},destruct:function(){},members:{contextMenu:function(){var a=this,o=(nw.userPolicies.getUserData(),a.selectedRecord()),e=new nw.contextmenu(this,"bottom");e.addAction("Eliminar","material-icons delete normal",function(e){a.eliminar(o)}),e.addAction("Editar","material-icons create normal",function(e){var a=new f_vehiculo;a.construct(function(){main.misVehiculos()}),a.populate(o)})},clicRow:function(){var e=this.selectedRecord(),a=(console.log(e),new f_vehiculo);a.construct(function(){main.misVehiculos()}),a.populate(e)},canvas:function(e){this.canvas=e},eliminar:function(a){var o=this;nw.dialog("¿Desea eliminar este vehículo?",function(){nw.loading({text:"Eliminando...",textVisible:!0,html:"",theme:"b",container:o.canvas});var e=new nw.rpc(o.getRpcUrl(),"vehiculo");e.setAsync(!0);e.exec("eliminarVehiculo",a,function(e){nw.loadingRemove({container:o.canvas}),nw.dialog("Eliminado correctamente"),main.misVehiculos()})},function(){})},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o=(nw.loading({text:"Cargando visitas...",textVisible:!0,html:"",theme:"b",container:a.canvas}),{}),e=(o.id_usuario=e.id_usuario,o.list=!0,o.filters=a.getFiltersData(),new nw.rpc(a.getRpcUrl(),"vehiculo"));e.setAsync(!0);e.exec("consulataVehiculos",o,function(e){nw.loadingRemove({container:a.canvas}),a.setModelData(e)})}}}),nw.Class.define("l_tarjetas_credito",{extend:nw.lists,construct:function(e){var a=this;a.showContextMenu=!0,a.id="l_tarjetas_credito",a.setTitle="Pagos",a.html="Mis tarjetas de crédito",a.showBack=!0,a.closeBack=!1,a.textClose="Atrás",a.createBase(),a.callback=e;a.setColumns([{name:"nombre",label:""}]),a.buttons=[],a.buttons.push({icon:"material-icons add_circle normal",position:"top",name:"nuevo",label:"Añadir nuevo",callback:function(){(new f_tarjetas_credito).construct()}}),a.show(),a.onAppear(function(){setTimeout(function(){a.applyFilters()},100)})},destruct:function(){},members:{contextMenu:function(){var a=this,o=(nw.userPolicies.getUserData(),a.selectedRecord());new nw.contextmenu(this,"bottom").addAction("Eliminar","material-icons delete normal",function(e){a.eliminar(o)})},clicRow:function(){},eliminar:function(a){var o=this;nw.dialog("¿Desea eliminar este registro?",function(){var e=new nw.rpc(o.getRpcUrl(),"nwMaker");e.setAsync(!0),e.setLoading(!0);e.exec("eliminarCreditCard",a,function(e){nw.dialog("Eliminado correctamente"),o.applyFilters(),nw.evalueData(o.callback)&&o.callback()})},function(){})},applyFilters:function(){var a=this,e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,o.empresa=e.empresa,o.perfil=e.perfil,new nw.rpc(a.getRpcUrl(),"nwMaker"));e.setAsync(!0),e.setLoading(!0);e.exec("myCreditsCards",o,function(e){console.log("applyFilters",e),a.setModelData(e)})}}}),nw.Class.define("l_navtable_favoritos",{extend:nw.lists,construct:function(e,a){var o=this;o.id="l_navtable_favoritos",o.setTitle="Favoritos",o.html="Favoritos",o.showBack=!1,o.closeBack=!0,o.textClose="Volver",o.html="",o.showContextMenu=!1,o.parent=a,nw.evalueData(a)?o.canvas=e:(o.createBase(),o.showContextMenu=!0);return o.setColumns([{name:"id",label:"ID",visible:!1},{name:"nombre",label:""},{name:"direccion",label:"",visible:!1}]),o.buttons=[],o.buttons.push({icon:"material-icons add normal",position:"top",name:"nuevo",label:"Nuevo",callback:function(){var e=new f_favoritos;e.construct(function(){o.clean(),o.applyFilters(),main.navTableFavoritos.clean(),main.navTableFavoritos.applyFilters()}),e.ui.nombre.setVisibility(!1)}}),o.show(),o.onAppear(function(){setTimeout(function(){o.applyFilters()},100)}),o},destruct:function(){},members:{clicRow:function(){var e,a,o,i,t=this,n=t.selectedRecord();return n.nombre=nw.stripTags(n.nombre_clean),""===n.direccion?(i=new f_favoritos,"home"===n.tipo?n.nombre=nw.utils.tr("Casa"):"work"===n.tipo&&(n.nombre=nw.utils.tr("Trabajo")),i.construct(function(){t.clean(),t.applyFilters(),main.navTableFavoritos.clean(),main.navTableFavoritos.applyFilters()}),i.orden=1,i.tipo=n.tipo,i.populate(n),!1):nw.evalueData(t.parent)?(e=t.parent.getRecord(),a=JSON.parse(n.results),!!nw.evalueData(a)&&((o={}).lat=a.lat,o.lng=a.lng,o.ciudad=a.ciudad,o.name=n.direccion,o.icon=a.icon,o.name_place=a.name_place,o.allData=a,o.type=a.type,"CARGA"==t.parent.configCliente.app_para&&nw.utils.evalueData(e.address)?t.parent.formDatosCarga(function(){t.parent.pointMapDestinoExec(o)}):"SI"==t.parent.configCliente.pedir_datos_viaje_airpot&&"airport"==a.type&&nw.evalueData(t.parent)?t.parent.pedirDataAirpot(function(e){t.parent.pointMapDestinoExec(o)}):t.parent.pointMapDestinoExec(o),!0)):((i=new f_favoritos).construct(function(){t.clean(),t.applyFilters(),main.navTableFavoritos.clean(),main.navTableFavoritos.applyFilters()}),void i.populate(n))},contextMenu:function(){var a=this,o=a.selectedRecord(),e=new nw.contextmenu(this,"bottom");e.addAction("Eliminar","nwmaker/img/baseline-create-24px.svg",function(e){a.eliminar(o)}),e.addAction("Editar","nwmaker/img/baseline-create-24px.svg",function(e){var a=new f_favoritos;a.construct(),a.populate(o)})},eliminar:function(a){var o=this;nw.dialog("¿Desea eliminar este registro?",function(){nw.loading({text:"Eliminando...",textVisible:!0,html:"",theme:"b",container:o.canvas});var e=new nw.rpc(o.getRpcUrl(),"servicios");e.setAsync(!0);e.exec("eliminarUbicacion",a,function(e){nw.loadingRemove({container:o.canvas}),nw.dialog("Eliminado correctamente"),(new l_navtable_favoritos).construct()})},function(){})},applyFilters:function(){var u=this,e=nw.userPolicies.getUserData(),a={},e=(a.empresa=e.empresa,a.usuario=e.usuario,a.perfil=e.perfil,new nw.rpc(u.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("populateFavoritos",a,function(e){for(var a=[],o=(e=e||[],!1),i=!1,t=0;t<e.length;t++)"home"===e[t].tipo&&(o=!0),"work"===e[t].tipo&&(i=!0);var n=[];o||n.push({tipo:"home",direccion:"",nombre:"Agregar dirección particular",nombre_clean:"Agregar dirección particular"}),i||n.push({tipo:"work",direccion:"",nombre:"Agregar dirección laboral",nombre_clean:"Agregar dirección laboral"});for(t=0;t<e.length;t++)n.push(e[t]);for(t=0;t<n.length;t++){var r,s,l,c,d=n[t];nw.evalueData(d.results)&&(r=JSON.parse(d.results),nw.evalueData(r))&&(r="",s="access_time","SI"===d.agregado_especial&&(s="favorite"),"home"===d.tipo?(s="home",r=" listFavAdd listFav_home"):"work"===d.tipo&&(s="work",r=" listFavAdd listFav_work"),l="classdataDir",c="",d.nombre!==d.direccion&&(c="<span class='spanDireccFavir'>"+d.direccion+"</span>",l=""),d.nombre_clean=d.nombre,d.nombre="<span class='spanNameFavir "+r+" "+l+"'><span class='spanIconFavir'><i class='material-icons'>"+s+"</i></span>"+nw.utils.tr(d.nombre)+"</span>"+c,a.push(d))}u.setModelData(a)})}}}),nw.Class.define("main",{extend:nw.menu,construct:function(){var e,a=this,o=(console.log("VERSION:::",device.version),config.addTextInAccountOtherData="",config.addButtonsInAccountOtherData=[],main.sumAddbtns=-1,a.debugConstruct=config.debugConstruct,nw.userPolicies.getUserData()),i=nw.utils.getMobileOperatingSystem();return nw.isOnline()||nw.dialog("Por favor verifique su conexión a internet"),"IOS"===i&&(i=parseInt(config.version_in_this_device)+1,i=config.domain_rpc+"/lib_mobile/user/css/iphone.css?v="+i,(e=document.createElement("link")).rel="stylesheet",e.type="text/css",e.href=i,document.getElementsByTagName("head")[0].appendChild(e)),main.configCliente={},a.colorPolyLine="#dc471e",nw.evalueData(config.colorPolyLine)&&(a.colorPolyLine=config.colorPolyLine),a.previsualiza=!1,a.get=nw.getGET(),a.get&&void 0!==a.get.service?(nwgeo.initialize(function(){a.previsualiza=!0;var e=a.get.service.replace("#f_ver_viaje","");nw.loading({text:"Por favor espere...",title:"Cargando viaje..."}),"#f_ver_viaje"===window.location.hash&&(window.location.href=window.location.href.replace("#f_ver_viaje",""),window.location.href=window.location.href.replace("//lib_mobile","/lib_mobile")),setTimeout(function(){a.openTravelByID(e),nw.loadingRemove()},1e3)},!0),!1):!!nw.evalueData(o.usuario)&&(a.validaPermisosDisp(function(){a.openInitWindow()}),a.addInProfile(),$(window).on("navigate",function(e,a){var a=a.state.direction;a&&"back"==a&&(a=document.querySelector(".textContainServices"),document.querySelector(".nw_widget_div_backAdondevamos_show"))&&!a&&(main.selfCrearViaje.loadInitial(),main.selfCrearViaje.activeNormal(),main.selfCrearViaje.resetValuesHome())}),void setTimeout(function(){a.getDataByCustomer()},2e3))},destruct:function(){},members:{selfCrearViaje:null,selfMapaDriver:null,id_service_active:null,addBtnAccount:function(a,o,i,t){main.sumAddbtns=main.sumAddbtns+1,config.addButtonsInAccountOtherData[main.sumAddbtns]=function(){var e=nw.generateLink(a,t,"center",0,o,"material-icons "+i+" normal false","lists_simple","btn_others_account");nw.appendLinkMenu(e,".menuProfile")}},openInitWindow:function(){var e=this,a=(nw.userPolicies.getUserData(),nw.utils.getMobileOperatingSystem(),nw.isOnline()),o=1e3,i=5,t=0;setTimeout(function(){!function e(){console.log("main.position_initial",main.position_initial);if(nw.utils.evalueData(window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION"))&&("rejected"==window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")||"skip"==window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")))return nw.remove(".loading_home_localiz"),nw.remove(".loading_home_localiz_2"),void nw.remove(".main_loading_initial_without_lib");if(!1!==main.position_initial)return;nw.loading({text:"",title:"Buscando tu ubicación, por favor espera",addClass:"loading_home_localiz_2"});setTimeout(function(){if(!1===main.position_initial){if(console.log("maxintentos",i),console.log("intentos",t),i<t)return window.location.reload(),!1;t++,nw.remove(".loading_home_localiz_2"),e()}else nw.remove(".loading_home_localiz_2")},o);o=1e3}()},5e3),!nw.utils.evalueData(window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION"))||"rejected"!=window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")&&"skip"!=window.localStorage.getItem("userPermissionsSet_ACCESS_FINE_LOCATION")||(nw.remove(".loading_home_localiz"),nw.remove(".loading_home_localiz_2"),nw.remove(".main_loading_initial_without_lib")),main.servtoke=!1,main.usegooglenative=!1,"undefined"!=typeof plugin&&void 0!==plugin.google&&(main.usegooglenative=!0);setTimeout(function(){nw.evalueData(window.localStorage.getItem("updategpsfirsttime_ios"))||(window.localStorage.setItem("updategpsfirsttime_ios","SI"),nw.remove(".loading_home_localiz"))},1e4),a||(nwgeo.setDataGeoLocal({latitud:10,longitud:10}),nw.remove(".loading_home_localiz"),n()),main.position_initial=!1;function n(){e.crearViaje()}nwgeo.getMapLocation(function(e){console.log("1:::::::::::::::::::position",e,nwgeo),main.position_initial=e,nwgeo.native?(setTimeout(function(){nw.remove(".loading_home_localiz"),nw.remove(".main_loading_initial_without_lib")},1e3),n()):nwgeo.initialize(function(e){setTimeout(function(){nw.remove(".loading_home_localiz"),nw.remove(".main_loading_initial_without_lib")},1e3),main.gps=e,n()},!0,"")},!1,!0)},getConfigCache:function(){if(nw.utils.evalueData(window.localStorage.getItem("configurationInitAccountMovilmove"))&&nw.utils.evalueData(window.localStorage.getItem("lastVersionCacheCloud"))){var e=window.localStorage.getItem("configurationInitAccountMovilmove"),e=JSON.parse(e),a=window.localStorage.getItem("version_in_this_device"),o=window.localStorage.getItem("lastVersionCacheCloud");if(console.log("versionCache",o),console.log("cacheStorage",a),console.log("cacheStorage.split(-)[0]",a.split("-")[0]),a.split("-")[0]==o)return console.log("configuracionServi:::jsonCache",e),console.log("configuracionServi local"),e}return!1},loadInitFirebase:function(){var e=this,a=nw.userPolicies.getUserData(),a=(console.log("up",a),"NO"),o=("SI"==main.configCliente.usa_firebase&&(a="SI"),!1),i=config.domain_rpc,i=nw.utils.str_replace("/","",i),t=(i=nw.utils.str_replace("//","",i),i=nw.utils.str_replace(":","",i),i=nw.utils.str_replace("https","",i),i=nw.utils.str_replace("http","",i),console.log("domain",i),!1);if("app.movilmove.com"!=i&&"app.transfershcy.com"!=i||(o="PRODUCCIÓN",t={apiKey:"AIzaSyCANJzxDNeSj-MFeOdEtOEmapAiR0r5Yvw",authDomain:"movilmove-services.firebaseapp.com",projectId:"movilmove-services",storageBucket:"movilmove-services.appspot.com",messagingSenderId:"766196491813",appId:"1:766196491813:web:9f1e67fa80f885094d01cc"}),"test.movilmove.com"!=i&&"ultimamilla.sitca.co"!=i&&"eu.movilmove.com"!=i&&"192.168.1.45"!=i&&"movilmove.loc"!=i&&"192.168.1.64"!=i&&"192.168.1.7"!=i||(o="PRUEBAS",t={apiKey:"AIzaSyDficCW6wxBnN_9uuwrp7yUBQVukXmhMBg",authDomain:"movilmove-services-test.firebaseapp.com",projectId:"movilmove-services-test",storageBucket:"movilmove-services-test.appspot.com",messagingSenderId:"496616900417",appId:"1:496616900417:web:13ae352d745983daed03c0"}),!o||!t)return nw.utils.dialog("NO puede activar Firebase en este dominio "+i+". No autorizado."),!1;config.addTextInAccountOtherData+="<br />"+("¡Realtime active (LoadServices: "+a+") in mode "+o+"! "+i)+" ",nw.firebase.load(t,function(){"SI"==main.configCliente.usa_firebase&&e.getServiceInFirebase(),e.getNotificationsInFirebase()})},readNotificationsInFirebase:function(e){var a=nw.userPolicies.getUserData(),o=(console.log("datarow",e),{});o.collection=e.collection,o.document=e.document,o.fields={},o.fields["open_"+nw.utils.cleanUserNwC(a.usuario)]="SI",o.fields["count_"+nw.utils.cleanUserNwC(a.usuario)]=0,nw.firebase.update(o)},getNotificationsInFirebase:function(){var r=this,s=(nw.utils.createContainerNotifications(),app.readNotificationsInFirebase=r.readNotificationsInFirebase,nw.userPolicies.getUserData()),e={table:"chats"};e.where_array=[],e.where_array[0]={variable:"empresa",operator:"==",equal:s.empresa},e.where_array[1]={variable:"usuarios",operator:"array-contains",equal:s.usuario},e.limit=10,e.order=!0,e.orderField="date",e.orderAscDesc="desc",e.getModelData=!1,e.destroyQuery=!1,console.log("ops",e),e.callback=function(e,a,o){console.log("getNotificationsInFirebase:::snapshot.empty",a.empty),a.docChanges().forEach(function(e){for(var a,o=e.doc.data(),i=(console.warn("getNotificationsInFirebase:::change.type:::data",e.type,o),document.querySelector(".framechat_conversation_"+o.room)),t=0;t<o.usuarios_more_data.length;t++){var n=o.usuarios_more_data[t];n.usuario!=s.usuario&&(o.title=n.nombre,o.envia_foto=n.foto)}for(a in o.others="Servicio#"+o.id_viaje+" para el "+o.id_servicio_fecha+" "+o.id_servicio_hora+" (Room "+o.room+")",nw.utils.evalueData(o.all_data_travel)&&nw.utils.evalueData(o.all_data_travel.placa)&&(o.others+=" - Placa "+o.all_data_travel.placa),o)a=="count_"+nw.utils.cleanUserNwC(s.usuario)&&(o.count=o["count_"+nw.utils.cleanUserNwC(s.usuario)]),a=="total_"+nw.utils.cleanUserNwC(s.usuario)&&(o.total=o["total_"+nw.utils.cleanUserNwC(s.usuario)]),a=="open_"+nw.utils.cleanUserNwC(s.usuario)&&(o.open=o["open_"+nw.utils.cleanUserNwC(s.usuario)]);i?r.readNotificationsInFirebase(o):nw.utils.addBellNewNotification(o,e.type),o.callback=function(e){var a={};a.id=e.room,a.conductor=e.title,(new f_chat).construct(a)},nw.utils.addNewNotification(o)})},nw.firebase.select(e)},getServiceInFirebase:function(){var i,t,e,a;return"SI"==main.configCliente.usa_firebase&&"NO"!=main.configCliente.usa_firebase_account&&(i=this,t=main.selfCrearViaje,e=nw.userPolicies.getUserData(),(a={table:"servicios",where_array:[]}).where_array[0]={variable:"empresa",operator:"==",equal:e.empresa},a.where_array[1]={variable:"parada_data_users",operator:"array-contains",equal:e.usuario},a.where_array[2]={variable:"estado",operator:"in",equal:["SOLICITUD","EN_RUTA","EN_SITIO","ABORDO","LLEGADA_DESTINO"]},a.where_array[3]={variable:"calificacion_conductor",operator:"==",equal:null},a.limit=200,a.order=!0,a.orderField="id",a.orderAscDesc="desc",a.getModelData=!1,a.destroyQuery=!1,a.callback=function(e,a,o){a.docChanges().forEach(function(e){var a=e.doc.data(),o=a;"removed"!=e.type&&(console.log("%c<<<<FIREBASE_GET_SERVICES_ACTIVES::: change.type "+e.type+" - ID: "+o.id+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("change.type:::data",e.type,o),i.validateQueryFirebase(a))&&(o=i.filteredDataFirebase(o),t.validaServiceActive(!1,function(e){},!0,o))})},void nw.firebase.select(a))},validateQueryFirebase:function(e){var a=nw.userPolicies.getUserData(),o=!0;if(1==e.paradas)for(var i=0;i<e.parada_data.length;i++){var t=e.parada_data[i];if(t.usuario_pasajero==a.usuario&&"CANCELADO_POR_CLIENTE"==t.estado){o=!1;break}}return!(!o||("SOLICITUD"!=e.estado||"reservado"==e.tipo_servicio&&"SI"!=e.ofertado)&&("EN_RUTA"!=e.estado||!nw.utils.evalueData(e.conductor_id))&&("ABORDO"!=e.estado||!nw.utils.evalueData(e.conductor_id))&&("EN_SITIO"!=e.estado||!nw.utils.evalueData(e.conductor_id))&&("LLEGADA_DESTINO"!=e.estado||nw.utils.evalueData(e.calificacion_conductor))&&!("CANCELADO_POR_CONDUCTOR"==e.estado&&nw.utils.evalueData(e.conductor_id)&&!nw.utils.evalueData(e.calificacion_conductor)&&""<=e.fecha+" "+e.hora))},filteredDataFirebase:function(e){var a=nw.userPolicies.getUserData();if(1==e.paradas)for(var o=0;o<e.parada_data.length;o++){var i=e.parada_data[o];if(i.usuario_pasajero==a.usuario){e.id_parada=i.id,nw.utils.evalueData(i.latitud_parada)&&(e.latitudOri=i.latitud_parada),nw.utils.evalueData(i.longitud_parada)&&(e.longitudOri=i.longitud_parada),e.estado_parada=i.estado,e.calificacion_conductor=i.calificacion_a_conductor;var t=e.estado;("SOLICITUD"==i.estado&&"EN_RUTA"==e.estado||"SOLICITUD"==i.estado&&"ABORDO"==e.estado)&&(t="EN_RUTA"),"NOVEDAD"==i.estado&&(t="LLEGADA_DESTINO"),"REPARTO_DETENIDO"==i.estado&&(t="EN_SITIO"),"ENTREGADO"==i.estado&&(t="ABORDO"),"REPARTO"==i.estado&&(t="EN_RUTA"),"LLEGADA_DESTINO"!=e.estado&&"CANCELADO_POR_ADMIN"!=e.estado&&"CANCELADO_POR_CONDUCTOR"!=e.estado&&"CANCELADO_POR_USUARIO"!=e.estado||(t="LLEGADA_DESTINO"),e.estado=t;break}}return e},registerServiceInFirebase:function(e){if("NO"==main.configCliente.usa_firebase_account)return!1;var a=nw.userPolicies.getUserData(),o=(console.log("id",e),e=e.toString(),console.log("id",e),{}),e=(o.ids=e.split("#"),o.empresa=a.empresa,console.log("registerInFirebase:::sendData",o),new nw.rpc(nw.getRpcUrl(),"servicios_admin"));e.setAsync(!0),e.setLoading(!1);e.exec("getTravelsForFirebase",o,function(e){console.log("registerInFirebase:::responseServer",e);for(var a=0;a<e.length;a++){var o,i=e[a],t=(console.log("ra",i),{});for(o in t.collection="servicios",t.document=i.id,i)t[o]=i[o];nw.firebase.set(t),console.log("%c<<<<FIREBASE_REGISTER_SERVICE::: ID: "+i.id+"!!!!!!!!!!!!!>>>>","background: orange; color: #000"),console.log("p:::data",t)}})},rechazarAceptarOfertaInFirebase:function(e){if("NO"==main.configCliente.usa_firebase_account)return!1;var a=nw.userPolicies.getUserData(),o=(console.log("id",e),{}),e=(o.id=e,o.empresa=a.empresa,console.log("registerInFirebase:::sendData",o),new nw.rpc(nw.getRpcUrl(),"servicios_admin"));e.setAsync(!0),e.setLoading(!1);e.exec("getOffersByTravelsForFirebase",o,function(e){console.log("registerInFirebase:::responseServer",e);var a,o={collection:"servicios_ofertas"};for(a in o.document=e.id,e)o[a]=e[a];nw.firebase.set(o)})},destroyQueryOfertas:function(){"undefined"!=typeof queryGetOffers&&queryGetOffers()},getDataByCustomer:function(){var e,a=nw.userPolicies.getUserData();nw.evalueData(a.bodega)&&((e={}).id=a.bodega,(a=new nw.rpc(nw.getRpcUrl(),"usuarios")).setAsync(!0),a.setLoading(!1),a.exec("getDataByCustomer",e,function(e){if(console.log("getDataByCustomer",e),!e)return!1;var a=document.createElement("div");a.className="encCustomerComp",a.innerHTML="<div class='custome custName'>"+e.razon_social+"</div><div class='custome custLogo' style='background-image: url("+config.domain_rpc+e.logo+");'></div>",document.querySelector(".headerHome").appendChild(a)}))},validaPermisosDisp:function(i){var t,e,a,n=this;n.allPermissionGranted=!0,void 0!==nw.permissions?(nw.remove(".div_container_skips_notificacions"),nw.remove(".popup_intered_permissions"),(t=document.createElement("div")).className="div_container_skips_notificacions",document.body.appendChild(t),nw.permissions.get("ACCESS_FINE_LOCATION","Por favor activa la ubicación precisa para poder ubicarte en el mapa",function(e,a){console.log("response",e),console.log("text",a);var o="<span style='color: green;'>Permiso concedido ubicación precisa.</span>";"rejected"!==e&&"skip"!==e||(n.allPermissionGranted=!1,o="<span style='color: red;'>Denegaste/omitiste la ubicación precisa, podrías presentar problemas de ubicación.</span>",(e=document.createElement("div")).className="popup_intered_permissions",e.innerHTML="La ubicación precisa está actualmente desactivada, toca para activarla.",e.onclick=function(){this.remove(),window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})},t.appendChild(e)),config.addTextInAccountOtherData+="<br />"+o,n.addBtnAccount("Ubicación","Configurar permisos de ubicación","edit_location",function(){window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})}),n.savePerm(a),cordova.version,nw.permissions.get("POST_NOTIFICATIONS","Por favor activa las notificaciones para recibir mensajes de chat, nuevos servicios y otros",function(e,a){console.log("response",e),console.log("text",a);var o="<span style='color: green;'>Permiso concedido notificaciones.</span>";"rejected"!==e&&"skip"!==e||(n.allPermissionGranted=!1,o="<span style='color: red;'>Denegaste las notificaciones, podrías presentar problemas de comunicación.</span>",(e=document.createElement("div")).className="popup_intered_permissions",e.innerHTML="Las notificaciones están actualmente desactivadas, toca para activarlas.",e.onclick=function(){this.remove(),window.cordova.plugins.settings.open("notification_id",function(){console.log("opened settings")},function(){console.log("failed to open settings")})},t.appendChild(e)),config.addTextInAccountOtherData+="<br />"+o,n.addBtnAccount("Notificaciones","Configurar permisos de notificaciones","notifications",function(){window.cordova.plugins.settings.open("notification_id",function(){console.log("opened settings")},function(){console.log("failed to open settings")})}),n.savePerm(a),void 0!==i&&i()},function(){window.cordova.plugins.settings.open("notification_id",function(){console.log("opened settings")},function(){console.log("failed to open settings")})})},function(){window.cordova.plugins.settings.open("application_details",function(){console.log("opened settings")},function(){console.log("failed to open settings")})})):(e=nw.userPolicies.getUserData(),a=nw.utils.getMobileOperatingSystem(),void 0!==cordova.plugins&&void 0!==cordova.plugins.notification&&(cordova.plugins.notification.local.hasPermission(function(e){}),cordova.plugins.notification.local.requestPermission(function(e){}),cordova.plugins.notification.local.schedule({title:"¡Bienvenido!",text:"Hola "+e.nombre,foreground:!0})),"IOS"!=a&&void 0!==cordova.plugins&&void 0!==cordova.plugins.diagnostic&&(cordova.plugins.diagnostic.requestRuntimePermissions(function(e){for(var a in e)switch(e[a]){case cordova.plugins.diagnostic.permissionStatus.GRANTED:console.log("Permission granted to use "+a);break;case cordova.plugins.diagnostic.permissionStatus.NOT_REQUESTED:console.log("Permission to use "+a+" has not been requested yet");break;case cordova.plugins.diagnostic.permissionStatus.DENIED:console.log("Permission denied to use "+a+" - ask again?");break;case cordova.plugins.diagnostic.permissionStatus.DENIED_ALWAYS:console.log("Permission permanently denied to use "+a+" - guess we won't be using it then!")}n.savePerm(JSON.stringify(e))},function(e){console.log("The following error occurred: ",e),console.error("The following error occurred: "+e),n.savePerm(e)},[cordova.plugins.diagnostic.permission.ACCESS_COARSE_LOCATION,cordova.plugins.diagnostic.permission.ACCESS_FINE_LOCATION,cordova.plugins.diagnostic.permission.ACCESS_MEDIA_LOCATION,cordova.plugins.diagnostic.permission.POST_NOTIFICATIONS,cordova.plugins.diagnostic.permission.CAMERA,cordova.plugins.diagnostic.permission.READ_EXTERNAL_STORAGE,cordova.plugins.diagnostic.permission.READ_PHONE_STATE]),cordova.plugins.diagnostic.requestCameraAuthorization(function(e){console.log("Authorization request for camera use was "+(e==cordova.plugins.diagnostic.permissionStatus.GRANTED?"granted":"denied"))},function(e){console.error("The following error occurred: "+e)},!1),cordova.plugins.diagnostic.requestExternalStorageAuthorization(function(e){console.log("Authorization request for external storage use was "+(e==cordova.plugins.diagnostic.permissionStatus.GRANTED?"granted":"denied"))},function(e){console.error("cordova.plugins.diagnostic.requestExternalStorageAuthorization",e)}),cordova.plugins.diagnostic.getExternalStorageAuthorizationStatus(function(e){e===cordova.plugins.diagnostic.permissionStatus.GRANTED&&console.log("External storage use is authorized")},function(e){console.error("The following error occurred: "+e)}),cordova.plugins.diagnostic.isExternalStorageAuthorized(function(e){console.log("App is "+(e?"authorized":"denied")+" access to the external storage")},function(e){console.error("The following error occurred: "+e)})),nw.utils.getPermission(["android.permission.CAMERA","android.permission.MANAGE_EXTERNAL_STORAGE","android.permission.ACCESS_BACKGROUND_LOCATION","android.permission.ACCESS_FINE_LOCATION","android.permission.ACCESS_COARSE_LOCATION","android.permission.READ_PHONE_STATE","android.permission.READ_EXTERNAL_STORAGE","android.permission.READ_MEDIA_IMAGES","android.permission.READ_MEDIA_AUDIO","android.permission.ACTION_CREATE_DOCUMENT","android.permission.ACTION_OPEN_DOCUMENT","android.permission.READ_MEDIA_VIDEO","android.permission.READ_MEDIA_IMAGES","android.permission.POST_NOTIFICATIONS","android.permission.WRITE_EXTERNAL_STORAGE","android.permission.ACCESS_MEDIA_LOCATION","android.permission.ACCESS_WIFI_STATE","android.permission.ACCESS_NETWORK_STATE"],function(e){console.error("Permisos final result",e)}),void 0!==cordova.plugins&&void 0!==cordova.plugins.firebase&&void 0!==cordova.plugins.firebase.messaging&&cordova.plugins.firebase.messaging.requestPermission({forceShow:!1}).then(function(){console.log("Push messaging is allowed")}),void 0!==cordova.plugins&&void 0!==cordova.plugins.notification&&void 0!==cordova.plugins.notification.local&&(cordova.plugins.notification.local.setDummyNotifications(),cordova.plugins.notification.local.hasPermission(function(e){console.log("granted",e),e||nw.dialog("Activar notificaciones",function(){cordova.plugins.notification.local.requestPermission(function(e){console.log("granted",e),alert("cordova.plugins.notification.local.requestPermission granted"),alert(e)})},function(){return!0})}),cordova.plugins.notification.local.requestPermission(function(e){console.log("granted",e)}),cordova.plugins.notification.local.schedule({title:"¡Bienvenido!",text:"Hola "+e.nombre,foreground:!0})),void 0!==i&&i())},savePerm:function(a){var e=nw.userPolicies.getUserData(),o=nw.utils.getMobileOperatingSystem(),i="NO",t=(nw.utils.evalueData(window.localStorage.getItem("userPermissionsSet"))&&(console.log("text",a),console.log("window.localStorage.getItem(userPermissionsSet)",window.localStorage.getItem("userPermissionsSet")),window.localStorage.getItem("userPermissionsSet")==a)&&(i="SI"),{}),e=(t.usuario=e.usuario,t.empresa=e.empresa,t.perfil=e.perfil,t.os=o,t.text=a,t.actualizar=i,t.token=null,nw.evalueData(window.localStorage.getItem("token"))&&(t.token=window.localStorage.getItem("token")),new nw.rpc(nw.getRpcUrl(),"app_user"));e.setAsync(!0),e.setLoading(!1),console.log("savePermisos:::dataSend",t);e.exec("savePermisos",t,function(e){window.localStorage.setItem("userPermissionsSet",a),console.log("savePermisos:::responseServer",e)})},getDataTravelByID:function(e,a){var o={},e=(o.id=e,new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("getServiceByID",o,function(e){if(console.log("RESULT_SERVER:::openTravelByID:::",e),!e)return nw.dialog("No existe el servicio"),!1;a(e)})},intervalMapExtern:null,openTravelByID:function(e){var n=this,r=new f_ver_viaje_mapstatic,s=(r.id="ver_viaje_extern",r.id_form="ver_viaje_extern",r.setTitle="<div class='titleencviajeexte'>"+config.logotipoHeader+"</div>",r.construct(),r.show(),nw.getMobileOperatingSystem()),s=nw.utils.getMobileOperatingSystem(),l=!1;n.get&&(console.log("self.get",n.get),void 0!==n.get.service)&&(l=!0),function t(){n.getDataTravelByID(e,function(e){console.log("data",e),r.icon1=config.domain_rpc+config.carpet_files_extern+"/img/pin46.png",r.icon2=config.domain_rpc+config.carpet_files_extern+"/img/pin_negro_44.png",r.direccion_origen=!1;var a,o=r.direccion_destino=!1,i=("ABORDO"===e.estado&&nw.utils.evalueData(e.latitud_actual)&&nw.utils.evalueData(e.longitud_actual)?(o=!0,r.latitude=e.latitud_actual,r.longitude=e.longitud_actual,r.icon1=config.domain_rpc+config.carpet_files_extern+"/img/ubicacion-carro.png"):(r.latitude=e.latitudOri,r.longitude=e.longitudOri),r.latitudDes=e.latitudDes,r.longitudDes=e.longitudDes,"LLEGADA_DESTINO"===e.estado||l||(r.latitudDes=nwgeo.latitude,r.longitudDes=nwgeo.longitude,nw.utils.evalueData(e.latitud_actual)&&nw.utils.evalueData(e.longitud_actual)&&(r.latitude=e.latitud_actual,r.longitude=e.longitud_actual)),r.createMapa(r),nw.remove(".containSddInfo"),"<div class='containSddInfo'>");i=(i=(i=i+"<div class='separatorLine'></div>"+(o?"<p><strong>El viaje ha iniciado, en camino a destino</strong></p>":"<p><strong>El viaje aún no ha iniciado</strong></p>"))+"<p><strong>Estado:</strong> "+e.estado+"</p>")+"<p><strong>Fecha:</strong> "+e.fecha_creacion+"</p>",n.get||(i+="<p><strong>Valor estimado:</strong> $"+nw.addNumber(e.valor)+"</p>",nw.evalueData(e.valor_total_servicio)&&(i+="<p><strong>Valor final:</strong> $"+nw.addNumber(e.valor_total_servicio)+"</p>")),i=(i+="<p><strong>De: </strong> "+e.ciudad_destino+" "+e.origen+"</p>")+"<p><strong>Hasta: </strong> "+e.ciudad_origen+" "+e.destino+"</p>",nw.evalueData(e.subcategoria_servicio_text)&&(i+="<p><strong>Tipo servicio: </strong>"+e.subcategoria_servicio_text+"</p>"),nw.evalueData(e.conductor)&&(i+="<p><strong>Conductor: </strong> <br /><span class='fotoConductorLista' style='background-image:url("+config.domain_rpc+e.conductor_foto+")'></span>"+e.conductor+"</p>","NO"!==main.configCliente.telefono_conductor_visible_para_pasajero)&&(i+="<p>"+e.vehiculo_text+" "+e.vehiculo_color+" "+e.placa+" "+e.conductor_celular+"</p>"),"NO"!==main.configCliente.telefono_conductor_visible_para_pasajero&&nw.evalueData(e.conductor_celular)&&(i+="<p class='telefono_conductor_ampliar'><strong>Teléfono conductor: </strong>"+e.conductor_celular+"</p>"),nw.evalueData(e.total_metros)&&(i+="<p><strong>Distancia (metros): </strong>"+e.total_metros+"</p>"),nw.evalueData(e.hora_inicio)&&(i+="<p><strong>Inicio: </strong>"+e.hora_inicio+"</p>"),nw.evalueData(e.hora_fin_servicio)&&(i+="<p><strong>Llegada: </strong>"+e.hora_fin_servicio+"</p>"),n.get||(i+="<p><strong>Descuento aplicado: </strong>$"+nw.addNumber(e.descuento_aplicado)+"</p>"),nw.evalueData(e.datos_vehiculo_elegido)&&(i+="<p><strong>Datos vehículo elegido: </strong>"+e.datos_vehiculo_elegido+"</p>"),nw.evalueData(e.descricion_carga)&&(i+="<p><strong>Observaciones: </strong>"+e.descricion_carga+"</p>"),i=(i+="<p><strong>ID: </strong>"+e.id+"</p>")+"<div class='nav_paradas'></div></div>",r.ui.observaciones_html.setValue(i),"LLEGADA_DESTINO"===e.estado?"browser"!==cordova.platformId&&"ANDROID"===s||"IOS"===s||(i="<h1>Viaje finalizado</h1>",o=function(){var e=nw.utils.getMobileOperatingSystem(),a=config.url_play_store;return"ANDROID"===e&&(a=config.url_play_store),"IOS"===e&&(a=config.url_app_store),nw.utils.openLink(a,"_BLANK"),!1},e=function(){return!0},(a={original:!0}).textAccept="¡Descarga "+config.name+"!",a.addClass="descarga_popup",nw.dialog(i,o,e,a)):n.intervalMapExtern=setTimeout(function(){var e=document.querySelector(".ver_viaje_extern");if(!e)return clearTimeout(n.intervalMapExtern),!1;t()},3e4)})}()},misComentarios:function(){(new l_comentarios).construct()},resumenFinal:function(e,a){var o=new f_resumen_final;e.type=a,o.populate(e,function(){o.construct()})},configCompany:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.id_usuario=e.id_usuario,a.empresa=e.empresa,new nw.rpc(nw.getRpcUrl(),"servicios"));e.setAsync(!0),e.setLoading(!1);e.exec("consultaConfiguracion",a,function(e){configCompany=e})},addInProfile:function(){var o=this;nw.addProfile=function(e){var e="."+e.id,a=nw.generateLink("Comentarios",function(){o.misComentarios()},"center",0,"Comentarios que me han realizado","material-icons email normal false","lists_simple","btn_correo");nw.appendLinkMenu(a,e)}},misTarjetasCredito:function(e){(new l_tarjetas_credito).construct(e)},redimirCupon:function(e){(new f_redimir_cupon).construct(e)},crearViaje:function(e){var a=this;if(nw.isOnline()){if(!main.usegooglenative&&"undefined"==typeof google)return setTimeout(function(){a.crearViaje(e)},100),!1}else nw.dialog("La API de mapas no cargó debido a que no cuenta con conexión a internet, red deficiente o nula."),google=[];if(nw.evalueData(a.selfCrearViaje)&&nw.evalueData(e))return a.selfCrearViaje.validaServiceActive(),!0;main.selfCrearViaje=new f_crear_viaje,main.selfCrearViaje.construct(function(){setTimeout(function(){a.loadInitFirebase()},1e3)})},timeEsperaConfirmationUser:function(){return 3e3},timeLlegadaDelConductor:function(){return 3e3},misVehiculos:function(){var e=new l_vehiculos;return e.construct(),e},driverMapaServicios:function(e){return"undefined"==typeof google?(nw.dialog("La API de mapas no ha cargado totalmente, espere por favor."),!1):nw.evalueData(this.selfCrearViaje)&&nw.evalueData(e)?(this.selfCrearViaje.validaServiceActive(),!0):void(new f_driver_mapa_servicios).construct()},vehiculo:!1,serviceDriveCancelInterval:function(){clearTimeout(main.interval),main.interval=setTimeout(function(){main.serviceDriveCancelExec()},5e3)},serviceToken:function(e){this.debugConstruct&&console.log("LAUNCH:::serviceToken:::service",e),main.servtoke=e},serviceDriveCancelExec:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0),e.setLoading(!1);e.exec("servicioActivoConductor",a,function(e){return console.log("serviceDriveCancelExec",e),!1!==e&&("CANCELADO_POR_USUARIO"===e.estado?(nw.cleanAllWindow(),nw.home(),nw.dialog("El cliente canceló el servicio"),!1):void main.serviceDriveCancelInterval())})},serviceDriver:function(){var e=nw.userPolicies.getUserData(),a={},e=(a.id_usuario=e.id_usuario,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0);e.exec("servicioActivoConductor",a,function(o){var i,a,e;return console.log("serviceDriver",o),!1!==o&&("LLEGADA_DESTINO"!==o.estado||nw.evalueData(o.estado_final)?"CANCELADO_POR_USUARIO"!==o.estado&&"LLEGADA_DESTINO"!==o.estado&&(i=o.token_usuario,(a=new f_esperando_confirmacion).setTitle="<span style='color:#fff;'>Servicio en ruta</span>",a.construct(),a.buttons.push({style:"background-size:20px;box-shadow: none;border: 0;background-color: orange;color: #ffffff;width:40%;",icon:"material-icons message normal",colorBtnBackIOS:"#ffffff",position:"bottom",name:"aceptar",label:"Mensaje",callback:function(){a.getRecord();if(!a.validate())return!1}},{style:"background-size:20px;box-shadow: none;border: 0;background-color: red;color: #ffffff;display:none;",icon:"nwmaker/img/baseline-how_to_reg-24px.svg",colorBtnBackIOS:"#ffffff",position:"bottom",name:"finalizar",label:"Finalizar viaje",callback:function(){var e={},a=(e.id=o.id,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0);a.exec("llegadaServicioDestiono",e,function(e){console.log(e),clearTimeout(main.interval),nw.cleanAllWindow(),nw.dialog("Servicio finalizado correctamente"),main.resumenFinal(o,"driver"),nw.sendNotificacion({title:"Tu viaje ha finalizado",body:"Tu viaje ha finalizado",icon:"fcm_push_icon",sound:"default",data:"main.crearViaje('"+o.id+"')",callback:"FCM_PLUGIN_ACTIVITY",to:i})})}},{style:"background-size:20px;box-shadow: none;border: 0;background-color: orange;color: #ffffff;display:none;width:100%;",icon:"material-icons how_to_reg normal",colorBtnBackIOS:"#ffffff",position:"bottom",name:"abordar",label:"Confirmar abordaje",callback:function(){var e={},a=(e.id=o.id,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0);a.exec("confirmarAbordaje",e,function(e){console.log(e),$(".dirigete").text("Servicio abordo activo"),$(".finalizar").css({display:"block"}),$(".aceptar").css({display:"none"}),$(".abordar").css({display:"none"}),nw.sendNotificacion({title:"Ha iniciado tu viaje",body:"Buen viaje!",icon:"fcm_push_icon",sound:"default",data:"main.crearViaje('"+e.id+"')",callback:"FCM_PLUGIN_ACTIVITY",to:i})})}},{style:"background-size:20px;box-shadow: none;border: 0;background-color: orange;color: #ffffff;width:55%;margin:0px;",icon:"",colorBtnBackIOS:"#ffffff",position:"bottom",name:"aceptar",label:"Confirmar llegada",callback:function(){var e={},a=(e.id=o.id,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));a.setAsync(!0);a.exec("llegadaServicioCon",e,function(e){console.log(e),$(".dirigete").text("Confirmar abordaje"),$(".aceptar").css({display:"none"}),$(".abordar").css({display:"block"}),nw.sendNotificacion({title:"Tu conductor ha llegado",body:"Dirígete al punto de origen",icon:"fcm_push_icon",sound:"default",data:"main.crearViaje('"+e.id+"')",callback:"FCM_PLUGIN_ACTIVITY",to:i})})}}),a.show(),a.createMapa(),e="<h1 class='dirigete'>Dirígete al punto de origen</h1>",e=(e=(e+="<p style='margin :0px;'><strong>ID: </strong>"+o.id+"</p>")+"<p style='margin :0px;'><strong>Estado: </strong>"+o.estado+"</p>")+"<p style='margin :0px;'><strong>Origen: </strong>"+o.origen+"</p>",a.addHeaderNote(e),a.latitude=nwgeo.latitude,a.longitude=nwgeo.longitude,a.latitudDes=o.latitudOri,a.longitudDes=o.longitudOri,a.callback=function(e){console.log(e),a.map.setZoom(nwgeo.zoom)},a.createLine(),"EN_SITIO"===o.estado&&($(".dirigete").text("Confirmar abordaje"),$(".aceptar").css({display:"none"}),$(".abordar").css({display:"block"})),"ABORDO"===o.estado&&($(".dirigete").text("Servicio abordo activo"),$(".finalizar").css({display:"block"}),$(".aceptar").css({display:"none"}),$(".abordar").css({display:"none"})),void main.serviceDriveCancelInterval()):(main.resumenFinal(o,"driver"),!1))})},statusDriver:function(){var a=this,e=nw.userPolicies.getUserData(),o={},e=(o.usuario=e.usuario,new nw.rpc(nw.getRpcUrl(),"servicios_conductor"));e.setAsync(!0);e.exec("conductorActivo",o,function(e){if(!1===e)return nw.dialog("Su usuario no se encuentra activo para iniciar servicios de socio conductor."),!1;a.conductorStatus=!0})},cuponInUse:function(){var a,e,o;"SI"==main.configCliente.cod_promocional&&(a=nw.userPolicies.getUserData(),(e={}).usuario=a.usuario,e.empresa=a.empresa,e.perfil=a.perfil,console.log("cuponInUse:::sendDataServer:::data",e),(o=new nw.rpc(nw.getRpcUrl(),"servicios")).setAsync(!0),o.setLoading(!1),o.exec("consultaCuponesActive",e,function(e){console.log("cuponInUse:::responseServer:::r",e),a.cupon=e?JSON.stringify(e):""}))},openHistoricoViajes:function(){var e=new l_historico_viajes;return e.construct(),e},slotRecargas:function(){(new f_recargas).construct()},reloadApp:function(){window.location.reload()},newServiceRutaCliente:function(){nw.dialog("Tienes un nuevo servicio, revisa tu historial.")},ofertaNotificaRecibe:function(e){console.log("estado",e)},nueva_recarga:function(){nw.dialog("Tienes una nueva recarga.",function(){window.location.reload()})},newNotificationChat:function(e){nw.utils.toast({html:e,timeRemove:5e3,addClass:"toast-enviado"})}}}),window.addEventListener("message",function(e){console.log("e",e);e=e.data;"getCode"==e.tipo?(console.log("r",e.html),window.localStorage.setItem("html_lib",e.html)):"getCodeCssMain"==e.tipo&&(console.log("r",e.html),window.localStorage.setItem("css_lib",e.html))});